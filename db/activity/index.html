<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<meta name="author" content="v 5.21.0">
<title>Activiti 用户手册</title>
<style>
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #003b6b; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #00579e; text-decoration: none; line-height: inherit; }
a:hover, a:focus { color: #333333; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: Arial, sans-serif; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 0.75em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: Arial, sans-serif; font-weight: normal; font-style: normal; color: #7b2d00; text-rendering: optimizeLegibility; margin-top: 0.5em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #ff6b15; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; color: #003426; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 0.75em; list-style-position: outside; font-family: Arial, sans-serif; }

ul, ol { margin-left: 1.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3em; font-weight: bold; }
dl dd { margin-bottom: 0.75em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: black; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 0.75em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #e15200; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #e15200; }

blockquote, blockquote p { line-height: 1.6; color: #333333; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #d8d8ce; }
table thead, table tfoot { background: -webkit-linear-gradient(top, #add386, #90b66a); font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: white; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #6d6e71; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #edf2f2; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }

a:hover, a:focus { text-decoration: underline; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; font-style: normal !important; letter-spacing: 0; padding: 3px 2px 1px 2px; background-color: #eeeeee; border: 1px solid #dddddd; -webkit-border-radius: 0; border-radius: 0; line-height: inherit; }

pre, pre > code { line-height: 1.6; color: black; font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; }

.keyseq { color: #333333; }

kbd { display: inline-block; color: black; font-size: 0.75em; line-height: 1.4; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: black; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 1.5em; padding-right: 1.5em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: #7b2d00; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #dddddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #dddddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #e15200; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #333333; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #333333; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: #7b2d00; border-bottom: 1px solid #dddddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#toc { border-bottom: 0 solid #dddddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: Arial, sans-serif; list-style-type: none; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #003b6b; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: white; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: none; padding: 1.25em; }

#footer-text { color: black; line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 0 solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #7b2d00; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #622400; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: #7b2d00; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: Arial, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #e15200; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #003b6b; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #eeeeee; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px dashed #666666; -webkit-border-radius: 0; border-radius: 0; word-wrap: break-word; padding: 1.25em 1.5625em 1.125em 1.5625em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #eeeeee; background-color: black; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 1.25em 1.5625em 1.125em 1.5625em; -webkit-border-radius: 0; border-radius: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 0.75em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #333333; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #003b6b; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #e15200; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 0.75em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #333333; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.05em; color: #e15200; }

.quoteblock.abstract { margin: 0 0 0.75em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.spread { width: 100%; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #d8d8ce; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.4; background: -webkit-linear-gradient(top, #add386, #90b66a); }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: white; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.375em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-check-square-o:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.375em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .75em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
span.footnote a:active, span.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #004176; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: black; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { border-bottom: 1px solid #dddddd; }

.sect1 { padding-bottom: 0; }

#toctitle { color: #00406F; font-weight: normal; margin-top: 1.5em; }

.sidebarblock { border-color: #aaa; }

code { -webkit-border-radius: 4px; border-radius: 4px; }

p.tableblock.header { color: #6d6e71; }

.literalblock pre, .listingblock pre { background: #eeeeee; }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Activiti 用户手册</h1>
<div class="details">
<span id="author" class="author">v 5.21.0</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_简介">1. 简介</a>
<ul class="sectlevel2">
<li><a href="#license">1.1. 协议</a></li>
<li><a href="#download">1.2. 下载</a></li>
<li><a href="#sources">1.3. 源码</a></li>
<li><a href="#required.software">1.4. 必要的软件</a>
<ul class="sectlevel3">
<li><a href="#_jdk_6">1.4.1. JDK 6+</a></li>
<li><a href="#_eclipse_indigo_和_juno">1.4.2. Eclipse Indigo 和 Juno</a></li>
</ul>
</li>
<li><a href="#reporting.problems">1.5. 反馈问题</a></li>
<li><a href="#experimental">1.6. 试验性功能</a></li>
<li><a href="#internal">1.7. 内部实现类</a></li>
</ul>
</li>
<li><a href="#_开始">2. 开始</a>
<ul class="sectlevel2">
<li><a href="#demo.setup.one.minute.version">2.1. 一分钟入门</a></li>
<li><a href="#activiti.setup">2.2. Activiti安装</a></li>
<li><a href="#activiti.setup.database">2.3. Activiti数据库配置</a></li>
<li><a href="#getting.started.including.libs">2.4. 引入Activiti jar与依赖</a></li>
<li><a href="#getting.started.next.steps">2.5. 下一步</a></li>
</ul>
</li>
<li><a href="#_配置_configuration">3. 配置 Configuration</a>
<ul class="sectlevel2">
<li><a href="#configuration">3.1. 创建ProcessEngine Creating a ProcessEngine</a></li>
<li><a href="#configurationRoot">3.2. ProcessEngineConfiguration bean</a></li>
<li><a href="#databaseConfiguration">3.3. 数据库配置 Database configuration</a></li>
<li><a href="#jndiDatasourceConfig">3.4. JNDI数据源配置 JNDI Datasource Configuration</a>
<ul class="sectlevel3">
<li><a href="#jndi_usage">3.4.1. 使用 Usage</a></li>
<li><a href="#jndi_configuration">3.4.2. 配置 Configuration</a></li>
</ul>
</li>
<li><a href="#supporteddatabases">3.5. 支持的数据库 Supported databases</a></li>
<li><a href="#creatingDatabaseTable">3.6. 创建数据库表 Creating the database tables</a></li>
<li><a href="#database.tables.explained">3.7. 数据库表名说明 Database table names explained</a></li>
<li><a href="#databaseUpgrade">3.8. 数据库升级 Database upgrade</a></li>
<li><a href="#jobExecutorConfiguration">3.9. 作业执行器与异步执行器（从5.17.0版本起） Job Executor and Async Executor (since version 5.17.0)</a></li>
<li><a href="#_启用作业执行器_job_executor_activation">3.10. 启用作业执行器 Job executor activation</a></li>
<li><a href="#_启用异步执行器_async_executor_activation">3.11. 启用异步执行器 Async executor activation</a></li>
<li><a href="#mailServerConfiguration">3.12. 配置邮件服务器 Mail server configuration</a></li>
<li><a href="#historyConfiguration">3.13. 配置历史 History configuration</a></li>
<li><a href="#exposingConfigurationBeans">3.14. 配置在表达式与脚本中暴露的bean Exposing configuration beans in expressions and scripts</a></li>
<li><a href="#processDefinitionCacheConfiguration">3.15. 配置部署缓存 Deployment cache configuration</a></li>
<li><a href="#loggingConfiguration">3.16. 日志 Logging</a></li>
<li><a href="#MDC">3.17. 映射诊断上下文 Mapped Diagnostic Contexts</a></li>
<li><a href="#eventDispatcher">3.18. 事件处理器 Event handlers</a>
<ul class="sectlevel3">
<li><a href="#eventDispatcherListener">3.18.1. 事件监听器实现 Event listener implementation</a></li>
<li><a href="#eventDispatcherConfiguration">3.18.2. 配置与安装 Configuration and setup</a></li>
<li><a href="#eventDispatcherConfigurationRuntime">3.18.3. 在运行时增加监听器 Adding listeners at runtime</a></li>
<li><a href="#eventDispatcherConfigurationProcessDefinition">3.18.4. 为流程定义增加监听器 Adding listeners to process definitions</a>
<ul class="sectlevel4">
<li><a href="#_执行用户定义逻辑的监听器_listeners_executing_user_defined_logic">执行用户定义逻辑的监听器 Listeners executing user-defined logic</a></li>
<li><a href="#_抛出bpmn事件的监听器_listeners_throwing_bpmn_events">抛出BPMN事件的监听器 Listeners throwing BPMN events</a></li>
<li><a href="#_关于流程定义监听器的说明_notes_on_listeners_on_a_process_definition">关于流程定义监听器的说明 Notes on listeners on a process-definition</a></li>
</ul>
</li>
<li><a href="#eventDispatcherCustomEvents">3.18.5. 通过API分发事件 Dispatching events through API</a></li>
<li><a href="#eventDispatcherEventTypes">3.18.6. 支持的事件类型 Supported event types</a></li>
<li><a href="#eventDispatcherRemarks">3.18.7. 附加信息 Additional remarks</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#chapterApi">4. The Activiti API</a>
<ul class="sectlevel2">
<li><a href="#apiEngine">4.1. 流程引擎API与服务 The Process Engine API and services</a></li>
<li><a href="#_异常策略_exception_strategy">4.2. 异常策略 Exception strategy</a></li>
<li><a href="#api.services">4.3. 使用Activiti services(Working with the Activiti services)</a>
<ul class="sectlevel3">
<li><a href="#api.services.deployment">4.3.1. 部署流程 Deploying the process</a></li>
<li><a href="#api.services.start.processinstance">4.3.2. 启动流程实例 Starting a process instance</a></li>
<li><a href="#api.services.tasks">4.3.3. 完成任务 Completing tasks</a></li>
<li><a href="#api.services.suspend">4.3.4. 暂停与激活流程 Suspending and activating a process</a></li>
<li><a href="#api.services">4.3.5. 扩展阅读 Further reading</a></li>
</ul>
</li>
<li><a href="#queryAPI">4.4. 查询API (Query API)</a></li>
<li><a href="#apiVariables">4.5. 变量 Variables</a></li>
<li><a href="#apiExpressions">4.6. 表达式 Expressions</a></li>
<li><a href="#apiUnitTesting">4.7. 单元测试 Unit testing</a></li>
<li><a href="#apiDebuggingUnitTest">4.8. Debug单元测试(Debugging unit tests)</a></li>
<li><a href="#apiProcessEngineInWebApp">4.9. Web应用中的流程引擎 The process engine in a web application</a></li>
</ul>
</li>
<li><a href="#springintegration">5. 集成Spring (Spring integration)</a>
<ul class="sectlevel2">
<li><a href="#_processenginefactorybean">5.1. ProcessEngineFactoryBean</a></li>
<li><a href="#_事务_transactions">5.2. 事务 Transactions</a></li>
<li><a href="#springExpressions">5.3. 表达式 Expressions</a></li>
<li><a href="#_自动部署资源_automatic_resource_deployment">5.4. 自动部署资源 Automatic resource deployment</a></li>
<li><a href="#springUnitTest">5.5. 单元测试 Unit testing</a></li>
<li><a href="#_通过hibernate_4_2_x使用jpa_jpa_with_hibernate_4_2_x">5.6. 通过Hibernate 4.2.x使用JPA (JPA with Hibernate 4.2.x)</a></li>
<li><a href="#springSpringBoot">5.7. Spring Boot</a>
<ul class="sectlevel3">
<li><a href="#_兼容性_compatibility">5.7.1. 兼容性 Compatibility</a></li>
<li><a href="#_开始_getting_started">5.7.2. 开始 Getting started</a></li>
<li><a href="#_更换数据源与连接池_changing_the_database_and_connection_pool">5.7.3. 更换数据源与连接池 Changing the database and connection pool</a></li>
<li><a href="#_rest支持_rest_support">5.7.4. REST支持 (REST support)</a></li>
<li><a href="#_jpa支持_jpa_support">5.7.5. JPA支持 (JPA support)</a></li>
<li><a href="#_扩展阅读_further_reading">5.7.6. 扩展阅读 Further Reading</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#chDeployment">6. 部署 Deployment</a>
<ul class="sectlevel2">
<li><a href="#_业务存档_business_archives">6.1. 业务存档 Business archives</a>
<ul class="sectlevel3">
<li><a href="#_编程方式部署_deploying_programmatically">6.1.1. 编程方式部署 Deploying programmatically</a></li>
<li><a href="#deploymentWithExplorer">6.1.2. 使用Activiti Exploreer部署 (Deploying with Activiti Explorer)</a></li>
</ul>
</li>
<li><a href="#_外部资源_external_resources">6.2. 外部资源 External resources</a>
<ul class="sectlevel3">
<li><a href="#_java类_java_classes">6.2.1. Java类 Java classes</a></li>
<li><a href="#_在流程中使用spring_bean_using_spring_beans_from_a_process">6.2.2. 在流程中使用Spring bean (Using Spring beans from a process)</a></li>
<li><a href="#_创建单独应用_creating_a_single_app">6.2.3. 创建单独应用 Creating a single app</a></li>
</ul>
</li>
<li><a href="#versioningOfProcessDefinitions">6.3. 流程定义的版本 Versioning of process definitions</a></li>
<li><a href="#providingProcessDiagram">6.4. 提供流程图 Providing a process diagram</a></li>
<li><a href="#generatingProcessDiagram">6.5. 生成流程图 Generating a process diagram</a></li>
<li><a href="#deploymentCategory">6.6. 类别 Category</a></li>
</ul>
</li>
<li><a href="#bpmn20">7. BPMN 2.0介绍 BPMN 2.0 Introduction</a>
<ul class="sectlevel2">
<li><a href="#whatIsBpmn">7.1. BPMN是什么？ What is BPMN?</a></li>
<li><a href="#bpmnDefiningProcess">7.2. 定义流程 Defining a process</a></li>
<li><a href="#_准备_十分钟教程_getting_started_10_minute_tutorial">7.3. 准备：十分钟教程 Getting started: 10 minute tutorial</a>
<ul class="sectlevel3">
<li><a href="#bpmn10MinuteTutorialPrerequisites">7.3.1. 先决条件 Prerequisites</a></li>
<li><a href="#bpmn10MinuteTutorialGoal">7.3.2. 目标 Goal</a></li>
<li><a href="#bpmnFirstExampleUseCase">7.3.3. 用例 Use case</a></li>
<li><a href="#bpmnFirstExampleDiagram">7.3.4. 流程图 Process diagram</a></li>
<li><a href="#bpmnFirstExampleXml">7.3.5. XML表现 XML representation</a></li>
<li><a href="#bpmnFirstExamplStartProcess">7.3.6. 启动流程实例 Starting a process instance</a></li>
<li><a href="#bpmnFirstExampleCandidateList">7.3.7. 任务列表 Task lists</a></li>
<li><a href="#bpmnFirstExampleClaimTask">7.3.8. 申领任务 Claiming the task</a></li>
<li><a href="#bpmnFirstExampleCompleteTask">7.3.9. 完成任务 Completing the task</a></li>
<li><a href="#bpmnFirstExampleEndingProcess">7.3.10. 结束流程 Ending the process</a></li>
<li><a href="#bpmnFirstExampleCode">7.3.11. 代码总结 Code overview</a></li>
<li><a href="#bpmnFirstExampleFutureEnhancements">7.3.12. 继续提高 Future enhancements</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#bpmnConstructs">8. BPMN 2.0 结构 BPMN 2.0 Constructs</a>
<ul class="sectlevel2">
<li><a href="#bpmnCustomExtensions">8.1. 自定义扩展 Custom extensions</a></li>
<li><a href="#bpmnEvents">8.2. 事件 Events</a>
<ul class="sectlevel3">
<li><a href="#eventDefinitions">8.2.1. 事件定义 Event Definitions</a></li>
<li><a href="#timerEventDefinitions">8.2.2. 定时器事件定义 Timer Event Definitions</a></li>
<li><a href="#bpmnErrorEventDefinition">8.2.3. 错误事件定义 Error Event Definitions</a></li>
<li><a href="#bpmnSignalEventDefinition">8.2.4. 信号事件定义 Signal Event Definitions</a>
<ul class="sectlevel4">
<li><a href="#bpmnSignalEventDefinitionThrow">抛出信号事件 Throwing a Signal Event</a></li>
<li><a href="#bpmnSignalEventDefinitionCatch">捕获信号事件 Catching a Signal Event</a></li>
<li><a href="#bpmnSignalEventDefinitionQuery">查询信号事件订阅 Querying for Signal Event subscriptions</a></li>
<li><a href="#bpmnSignalEventDefinitionScope">信号事件范围 Signal event scope</a></li>
<li><a href="#bpmnSignalEventDefinitionExample">信号事件示例 Signal Event example(s)</a></li>
</ul>
</li>
<li><a href="#bpmnMessageEventDefinition">8.2.5. 消息事件定义 Message Event Definitions</a>
<ul class="sectlevel4">
<li><a href="#bpmnMessageEventDefinitionThrow">抛出消息事件 Throwing a Message Event</a></li>
<li><a href="#bpmnMessageEventDefinitionQuery">查询消息事件订阅 Querying for Message Event subscriptions</a></li>
<li><a href="#bpmnMessageEventDefinitionExample">消息事件示例 Message Event example(s)</a></li>
</ul>
</li>
<li><a href="#bpmnStartEvents">8.2.6. 启动事件 Start Events</a></li>
<li><a href="#bpmnNoneStartEvent">8.2.7. 空启动事件 None Start Event</a>
<ul class="sectlevel4">
<li><a href="#noneStartEventDescription">描述 Description</a></li>
<li><a href="#noneStartEventGraphicalNotation">图示 Graphical notation</a></li>
<li><a href="#noneStartEventXml">XML表示 XML representation</a></li>
<li><a href="#noneStartEventCustomExtension">空启动事件的自定义扩展 Custom extensions for the none start event</a></li>
</ul>
</li>
<li><a href="#bpmnTimerStartEvent">8.2.8. 定时器启动事件 Timer Start Event</a>
<ul class="sectlevel4">
<li><a href="#timerStartEventDescription">描述 Description</a></li>
<li><a href="#timerStartEventGraphicalNotation">图示 Graphical notation</a></li>
<li><a href="#timerStartEventXml">XML表示 XML representation</a></li>
</ul>
</li>
<li><a href="#bpmnMessageStartEvent">8.2.9. 消息启动事件 Message Start Event</a>
<ul class="sectlevel4">
<li><a href="#messageStartEventDescription">描述 Description</a></li>
<li><a href="#messageStartEventGraphicalNotation">图示 Graphical notation</a></li>
<li><a href="#messageStartEventXml">XML表示 XML representation</a></li>
</ul>
</li>
<li><a href="#bpmnSignalStartEvent">8.2.10. 信号启动事件 Signal Start Event</a>
<ul class="sectlevel4">
<li><a href="#bpmnSignalStartEventDescription">描述 Description</a></li>
<li><a href="#signalStartEventGraphicalNotation">图示 Graphical notation</a></li>
<li><a href="#signalStartEventXml">XML表示 XML representation</a></li>
</ul>
</li>
<li><a href="#bpmnErrorStartEvent">8.2.11. 错误启动事件 Error Start Event</a>
<ul class="sectlevel4">
<li><a href="#errorStartEventDescription">描述 Description</a></li>
<li><a href="#errorStartEventGraphicalNotation">图示 Graphical notation</a></li>
<li><a href="#errorStartEventXml">XML表示 XML representation</a></li>
</ul>
</li>
<li><a href="#bpmnEndEvent">8.2.12. 结束事件 End Events</a></li>
<li><a href="#bpmnNoneEndEvent">8.2.13. 空结束事件 None End Event</a>
<ul class="sectlevel4">
<li><a href="#noneEndEventDescription">描述 Description</a></li>
<li><a href="#bpmnNoneEndEventDescription">图示 Graphical notation</a></li>
<li><a href="#bpmnNoneStartEventXml">XML表示 XML representation</a></li>
</ul>
</li>
<li><a href="#bpmnErrorEndEvent">8.2.14. 错误结束事件 Error End Event</a>
<ul class="sectlevel4">
<li><a href="#bpmnErrorEndEventDescription">描述 Description</a></li>
<li><a href="#bpmnErrorEndEventGraphicalNotation">图示 Graphical notation</a></li>
<li><a href="#bpmnErrorEndEventXml">XML表示 XML representation</a></li>
</ul>
</li>
<li><a href="#bpmnCancelEndEvent">8.2.15. 终止结束事件 Terminate End Event</a>
<ul class="sectlevel4">
<li><a href="#_描述_description">描述 Description</a></li>
<li><a href="#_图示_graphical_notation">图示 Graphical notation</a></li>
<li><a href="#_xml表示_xml_representation">XML表示 XML representation</a></li>
</ul>
</li>
<li><a href="#_取消结束事件_cancel_end_event">8.2.16. 取消结束事件 Cancel End Event</a>
<ul class="sectlevel4">
<li><a href="#_描述_description_2">描述 Description</a></li>
<li><a href="#bpmnCancelEndEventGraphicalNotation">图示 Graphical notation</a></li>
<li><a href="#bpmnCancelEndEventXml">XML表示 XML representation</a></li>
</ul>
</li>
<li><a href="#bpmnBoundaryEvent">8.2.17. 边界事件 Boundary Events</a></li>
<li><a href="#bpmnTimerBoundaryEvent">8.2.18. 定时器边界事件 Timer Boundary Event</a>
<ul class="sectlevel4">
<li><a href="#timerBoundaryEventDescription">描述 Description</a></li>
<li><a href="#bpmnTimerBoundaryEventGraphicalNotation">图示 Graphical Notation</a></li>
<li><a href="#bpmnTimerBoundaryEventXml">XML表示 XML Representation</a></li>
<li><a href="#bpmnKnownIssueBoundaryEvent">边界事件的已知问题 Known issue with boundary events</a></li>
</ul>
</li>
<li><a href="#bpmnBoundaryErrorEvent">8.2.19. 错误边界事件 Error Boundary Event</a>
<ul class="sectlevel4">
<li><a href="#bpmnBoundaryErrorEventDescription">描述 Description</a></li>
<li><a href="#bpmnBoundaryErrorEventgraphicalNotation">图示 Graphical notation</a></li>
<li><a href="#bpmnBoundaryErrorEventXml">XML表示 Xml representation</a></li>
<li><a href="#bpmnBoundaryErrorEventExample">示例 Example</a></li>
</ul>
</li>
<li><a href="#bpmnBoundarySignalEvent">8.2.20. 信号边界事件 Signal Boundary Event</a>
<ul class="sectlevel4">
<li><a href="#bpmnBoundarySignalEventDescription">描述 Description</a></li>
<li><a href="#bpmnBoundarySignalEventGraphicalNotation">图示 Graphical notation</a></li>
<li><a href="#bpmnBoundarySignalEventXml">XML表示 XML representation</a></li>
<li><a href="#bpmnBoundarySignalEventExample">示例 Example</a></li>
</ul>
</li>
<li><a href="#bpmnBoundaryMessageEvent">8.2.21. 消息边界事件 Message Boundary Event</a>
<ul class="sectlevel4">
<li><a href="#bpmnBoundaryMessageEventDescription">描述 Description</a></li>
<li><a href="#bpmnBoundaryMessageEventGraphicalNotation">图示 Graphical notation</a></li>
<li><a href="#bpmnBoundaryMessageEventXml">XML表示 XML representation</a></li>
<li><a href="#bpmnBoundaryMessageEventExample">示例 Example</a></li>
</ul>
</li>
<li><a href="#bpmnBoundaryCancelEvent">8.2.22. 取消边界事件 Cancel Boundary Event</a>
<ul class="sectlevel4">
<li><a href="#_描述_description_3">描述 Description</a></li>
<li><a href="#bpmnBoundaryCancelEventGraphicalNotation">图示 Graphical notation</a></li>
<li><a href="#bpmnBoundarySignalEventXml">XML表示 XML representation</a></li>
</ul>
</li>
<li><a href="#bpmnBoundaryCompensationEvent">8.2.23. 补偿边界事件 Compensation Boundary Event</a>
<ul class="sectlevel4">
<li><a href="#_描述_description_4">描述 Description</a></li>
<li><a href="#bpmnBoundaryCompensationEventGraphicalNotation">图示 Graphical notation</a></li>
<li><a href="#bpmnBoundaryCompensationEventXml">XML表示 XML representation</a></li>
</ul>
</li>
<li><a href="#bpmnIntermediateCatchingEvent">8.2.24. 捕获中间事件 Intermediate Catching Events</a></li>
<li><a href="#bpmnTimerIntermediateEvent">8.2.25. 定时器捕获中间事件 Timer Intermediate Catching Event</a>
<ul class="sectlevel4">
<li><a href="#bpmnTimerIntermediateEventDescription">描述 Description</a></li>
<li><a href="#bpmnTimerIntermediateEventGraphicalNotation">图示 Graphical Notation</a></li>
<li><a href="#bpmnTimerIntermediateEventXml">XML表示 XML Representation</a></li>
</ul>
</li>
<li><a href="#bpmnIntermediateSignalEvent">8.2.26. 信号捕获中间事件 Signal Intermediate Catching Event</a>
<ul class="sectlevel4">
<li><a href="#bpmnIntermediateSignalEventDescription">描述 Description</a></li>
<li><a href="#bpmnIntermediateSignalEventGraphicalNotation">图示 Graphical notation</a></li>
<li><a href="#bpmnIntermediateSignalEventXml">XML表示 XML representation</a></li>
<li><a href="#bpmnIntermediateSignalEventExample">示例 Example</a></li>
</ul>
</li>
<li><a href="#bpmnIntermediateMessageEvent">8.2.27. 消息捕获中间事件 Message Intermediate Catching Event</a>
<ul class="sectlevel4">
<li><a href="#bpmnIntermediateMessageEventDescription">描述 Description</a></li>
<li><a href="#bpmnIntermediateMessageEventGraphicalNotation">图示 Graphical notation</a></li>
<li><a href="#bpmnIntermediateSignalEventXml">XML表示 XML representation</a></li>
<li><a href="#bpmnIntermediateMessageEventExample">示例 Example</a></li>
</ul>
</li>
<li><a href="#bpmnIntermediateThrowEvent">8.2.28. 抛出中间事件 Intermediate Throwing Event</a></li>
<li><a href="#bpmnIntermediateThrowNoneEvent">8.2.29. 空抛出中间事件 Intermediate Throwing None Event</a></li>
<li><a href="#bpmnIntermediateThrowSignalEvent">8.2.30. 信号抛出中间事件 Signal Intermediate Throwing Event</a>
<ul class="sectlevel4">
<li><a href="#bpmnIntermediateThrowSignalEventDescription">描述 Description</a></li>
<li><a href="#bpmnIntermediateThrowSignalEventGraphicalNotation">图示 Graphical notation</a></li>
<li><a href="#bpmnIntermediateThrowSignalEventXml">XML表示 XML representation</a></li>
<li><a href="#bpmnIntermediateSignalEventExample">示例 Example</a></li>
</ul>
</li>
<li><a href="#bpmnIntermediateThrowCompensationEvent">8.2.31. 补偿抛出中间事件 Compensation Intermediate Throwing Event</a>
<ul class="sectlevel4">
<li><a href="#_描述_description_5">描述 Description</a></li>
<li><a href="#bpmnIntermediateThrowCompensationEventGraphicalNotation">图示 Graphical notation</a></li>
<li><a href="#bpmnIntermediateThrowSignalEventXml">Xml representation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#bpmnSequenceFlow">8.3. 顺序流 Sequence Flow</a>
<ul class="sectlevel3">
<li><a href="#sequenceFlowDescription">8.3.1. 描述 Description</a></li>
<li><a href="#sequenceFlowGraphicalNotation">8.3.2. 图示 Graphical notation</a></li>
<li><a href="#sequenceFlowXml">8.3.3. XML表示 XML representation</a></li>
<li><a href="#bpmnConditionalSequenceFlow">8.3.4. 条件顺序流 Conditional sequence flow</a>
<ul class="sectlevel4">
<li><a href="#condSeqFlowDescription">描述 Description</a></li>
<li><a href="#conditionalSequenceFlowGraphicalNotation">图示 Graphical notation</a></li>
<li><a href="#conditionalSequenceFlowXml">XML表示 XML representation</a></li>
</ul>
</li>
<li><a href="#bpmnDefaultSequenceFlow">8.3.5. 默认顺序流 Default sequence flow</a>
<ul class="sectlevel4">
<li><a href="#bpmnDefaultSequenceFlowDescription">描述 Description</a></li>
<li><a href="#bpmnDefaultSequenceFlowGraphicalNotation">图示 Graphical notation</a></li>
<li><a href="#bpmnDefaultSequenceFlowXmlRepresentation">XML表示 XML representation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#bpmnGateways">8.4. 网关 Gateways</a>
<ul class="sectlevel3">
<li><a href="#bpmnExclusiveGateway">8.4.1. 排他网关 Exclusive Gateway</a>
<ul class="sectlevel4">
<li><a href="#exclusiveGatewayDescription">描述 Description</a></li>
<li><a href="#exclusiveGatewayGraphNotation">图示 Graphical notation</a></li>
<li><a href="#exclusiveGatewayXML">XML表示 XML representation</a></li>
</ul>
</li>
<li><a href="#bpmnParallelGateway">8.4.2. 并行网关 Parallel Gateway</a>
<ul class="sectlevel4">
<li><a href="#bpmnParallelGatewayDescription">描述 Description</a></li>
<li><a href="#bpmnParallelGatewayGraphicalNotation">图示 Graphical Notation</a></li>
<li><a href="#bpmnParallelGatewayXML">XML表示 XML representation</a></li>
</ul>
</li>
<li><a href="#bpmnInclusiveGateway">8.4.3. 包容网关 Inclusive Gateway</a>
<ul class="sectlevel4">
<li><a href="#bpmnInclusiveGatewayDescription">描述 Description</a></li>
<li><a href="#bpmnInclusiveGatewayGraphicalNotation">图示 Graphical Notation</a></li>
<li><a href="#bpmnInclusiveGatewayXML">XML表示 XML representation</a></li>
</ul>
</li>
<li><a href="#bpmnEventbasedGateway">8.4.4. 基于事件的网关 Event-based Gateway</a>
<ul class="sectlevel4">
<li><a href="#eventBasedGatewayDescription">描述 Description</a></li>
<li><a href="#eventBasedGatewayGraphNotation">图示 Graphical notation</a></li>
<li><a href="#eventBasedGatewayXML">XML表示 XML representation</a></li>
<li><a href="#eventBasedGatewayExample">示例 Example(s)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#bpmnTask">8.5. 任务 Tasks</a>
<ul class="sectlevel3">
<li><a href="#bpmnUserTask">8.5.1. 用户任务 User Task</a>
<ul class="sectlevel4">
<li><a href="#bpmnUserTaskDescription">描述 Description</a></li>
<li><a href="#bpmnUserTaskGraphicalNotation">图示 Graphical notation</a></li>
<li><a href="#bpmnUserTaskXml">XML表示 XML representation</a></li>
<li><a href="#bpmnUserTaskDueDate">到期日期 Due Date</a></li>
<li><a href="#bpmnUserTaskAssignment">用户指派 User assignment</a></li>
<li><a href="#bpmnUserTaskUserAssignmentExtension">用于任务指派的Activiti扩展 Activiti extensions for task assignment</a></li>
<li><a href="#bpmnUserTaskUserCustomIdentityLinkAssignmentExtension">自定义身份联系类型（试验特性） Custom identity link types (Experimental)</a></li>
<li><a href="#bpmnUserTaskUserCustomAssignmentTaskListeners">通过任务监听器自定义指派 Custom Assignment via task listeners</a></li>
</ul>
</li>
<li><a href="#bpmnScriptTask">8.5.2. 脚本任务 Script Task</a>
<ul class="sectlevel4">
<li><a href="#bpmnScriptTaskDescription">描述 Description</a></li>
<li><a href="#bpmnScriptTaskGraphicalNotation">图示 Graphical Notation</a></li>
<li><a href="#bpmnScriptTaskXml">XML表示 XML representation</a></li>
<li><a href="#bpmnScriptTaskVariables">脚本中的变量 Variables in scripts</a></li>
<li><a href="#bpmnScriptTaskResultValue">脚本结果 Script results</a></li>
<li><a href="#_安全性_security">安全性 Security</a></li>
</ul>
</li>
<li><a href="#bpmnJavaServiceTask">8.5.3. Java服务任务 Java Service Task</a>
<ul class="sectlevel4">
<li><a href="#bpmnJavaServiceTaskDescription">描述 Description</a></li>
<li><a href="#bpmnJavaServiceTaskGraphicalNotation">图示 Graphical Notation</a></li>
<li><a href="#bpmnJavaServiceTaskXML">XML表示 XML representation</a></li>
<li><a href="#bpmnJavaServiceTaskImplementation">实现 Implementation</a></li>
<li><a href="#serviceTaskFieldInjection">字段注入 Field Injection</a></li>
<li><a href="#serviceTaskFieldInjectionThreadSafety">字段注入与线程安全 Field injection and thread safety</a></li>
<li><a href="#serviceTaskResultValue">服务任务的结果 Service task results</a></li>
<li><a href="#serviceTaskExceptionHandling">处理异常 Handling exceptions</a>
<ul class="sectlevel5">
<li><a href="#serviceTaskBpmnErrors">抛出BPMN错误 Throwing BPMN Errors</a></li>
<li><a href="#exceptionMapping">异常映射 Exception mapping</a></li>
<li><a href="#serviceTaskExceptionSequenceFlow">异常顺序流 Exception Sequence Flow</a></li>
</ul>
</li>
<li><a href="#serviceTaskCallActivitiService">在JavaDelegate中使用Activiti服务 Using an Activiti service from within a JavaDelegate</a></li>
</ul>
</li>
<li><a href="#bpmnWebserviceTask">8.5.4. Web服务任务 Web Service Task</a>
<ul class="sectlevel4">
<li><a href="#_描述_description_6">描述 Description</a></li>
<li><a href="#bpmnWebserviceTaskGraphicalNotation">图示 Graphical Notation</a></li>
<li><a href="#bpmnWebserviceTaskXML">XML表示 XML representation</a></li>
<li><a href="#bpmnWebserviceTaskIOSpecification">Web服务任务IO规范 Web Service Task IO Specification</a></li>
<li><a href="#bpmnWebserviceTaskDataInputAssociation">Web服务任务数据输入关联 Web Service Task data input associations</a></li>
<li><a href="#bpmnWebserviceTaskDataOutputAssociation">Web服务任务数据输出关联 Web Service Task data output associations</a></li>
</ul>
</li>
<li><a href="#bpmnBusinessRuleTask">8.5.5. 业务规则任务 Business Rule Task</a>
<ul class="sectlevel4">
<li><a href="#_描述_description_7">描述 Description</a></li>
<li><a href="#bpmnBusinessRuleTaskGraphicalNotation">图示 Graphical Notation</a></li>
<li><a href="#bpmnBusinessRuleTaskXML">XML表示 XML representation</a></li>
</ul>
</li>
<li><a href="#bpmnEmailTask">8.5.6. 邮件任务 Email Task</a>
<ul class="sectlevel4">
<li><a href="#bpmnEmailTaskServerConfiguration">邮件服务器配置 Mail server configuration</a></li>
<li><a href="#bpmnEmailTaskUsage">定义邮件任务 Defining an Email Task</a></li>
<li><a href="#bpmnEmailTaskExampleUsage">使用示例 Example usage</a></li>
</ul>
</li>
<li><a href="#bpmnMuleTask">8.5.7. Mule任务 Mule Task</a>
<ul class="sectlevel4">
<li><a href="#bpmnMuleTaskUsage">定义Mule任务 Defining an Mule Task</a></li>
<li><a href="#bpmnMuleTaskExampleUsage">使用示例 Example usage</a></li>
</ul>
</li>
<li><a href="#bpmnCamelTask">8.5.8. Camel任务 Camel Task</a>
<ul class="sectlevel4">
<li><a href="#bpmnCamelTaskUsage">定义Camel任务 Defining a Camel Task</a></li>
<li><a href="#bpmnCamelTaskSimpleCamelCall">简单Camel调用示例 Simple Camel Call example</a></li>
<li><a href="#bpmnCamelTaskPingPong">连通性测试 Ping Pong example</a></li>
<li><a href="#_返回变量_returning_back_the_variables">返回变量 Returning back the variables</a></li>
<li><a href="#bpmnCamelTaskAsyncPingPong">异步连通性测试 Asynchronous Ping Pong example</a></li>
<li><a href="#bpmnCamelTaskAsyncPingPong">从Camel路由实例化工作流 Instantiate workflow from Camel route</a></li>
</ul>
</li>
<li><a href="#bpmnManualTask">8.5.9. 手动任务 Manual Task</a>
<ul class="sectlevel4">
<li><a href="#bpmnManualTaskDescription">描述 Description</a></li>
<li><a href="#bpmnManualTaskGraphicalNotation">图示 Graphical Notation</a></li>
<li><a href="#bpmnManualTaskXml">XML表示 XML representation</a></li>
</ul>
</li>
<li><a href="#bpmnReceiveTask">8.5.10. Java接收任务 Java Receive Task</a>
<ul class="sectlevel4">
<li><a href="#bpmnReceiveTaskDescription">描述 Description</a></li>
<li><a href="#_图示_graphical_notation_2">图示 Graphical notation</a></li>
<li><a href="#_xml表示_xml_representation_2">XML表示 XML representation</a></li>
</ul>
</li>
<li><a href="#bpmnShellTask">8.5.11. Shell任务 Shell Task</a>
<ul class="sectlevel4">
<li><a href="#bpmnShellTaskDescription">描述 Description</a></li>
<li><a href="#bpmnShellTaskUsage">定义Shell任务 Defining a shell task</a></li>
<li><a href="#bpmnShellTaskExampleUsage">使用示例 Example usage</a></li>
</ul>
</li>
<li><a href="#executionListeners">8.5.12. 执行监听器 Execution listener</a>
<ul class="sectlevel4">
<li><a href="#executionListenerFieldInjection">执行监听器上的字段注入 Field injection on execution listeners</a></li>
</ul>
</li>
<li><a href="#taskListeners">8.5.13. 任务监听器 Task listener</a></li>
<li><a href="#bpmnMultiInstance">8.5.14. 多实例 Multi-instance (for each)</a>
<ul class="sectlevel4">
<li><a href="#bpmnMultiInstanceDescription">描述 Description</a></li>
<li><a href="#bpmnMultiInstanceGraphicalNotation">图示 Graphical notation</a></li>
<li><a href="#bpmnMultiInstanceXml">XML表示 Xml representation</a></li>
<li><a href="#bpmnMultiInstanceBoundaryEvent">边界事件与多实例 Boundary events and multi-instance</a></li>
<li><a href="#bpmnCompensationHandlers">多实例与执行监听器 Multi instance and execution listeners</a></li>
</ul>
</li>
<li><a href="#_补偿处理器_compensation_handlers">8.5.15. 补偿处理器 Compensation Handlers</a>
<ul class="sectlevel4">
<li><a href="#bpmnCompensationHandlerDescription">描述 Description</a></li>
<li><a href="#bpmnCompensationHandlerGraphicalNotation">图示 Graphical notation</a></li>
<li><a href="#bpmnCompensationHandlerXml">XML表示 XML representation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#bpmnSubprocessAndCallActivity">8.6. 子流程与调用活动 Sub-Processes and Call Activities</a>
<ul class="sectlevel3">
<li><a href="#bpmnSubProcess">8.6.1. 子流程 Sub-Process</a>
<ul class="sectlevel4">
<li><a href="#bpmnSubProcessDescription">描述 Description</a></li>
<li><a href="#bpmnSubProcessGraphicalNotation">图示 Graphical Notation</a></li>
<li><a href="#bpmnSubProcessXML">XML表示 XML representation</a></li>
</ul>
</li>
<li><a href="#bpmnEventSubprocess">8.6.2. 事件子流程 Event Sub-Process</a>
<ul class="sectlevel4">
<li><a href="#bpmnEventSubprocessDescription">描述 Description</a></li>
<li><a href="#bpmnEventSubprocessGraphicalNotation">图示 Graphical Notation</a></li>
<li><a href="#bpmnEventSubprocessXMLRepresentation">XML表示 XML representation</a></li>
<li><a href="#bpmnEventSubprocessExample">示例 Example</a></li>
</ul>
</li>
<li><a href="#bpmnTransactionSubprocess">8.6.3. 事务子流程 Transaction subprocess</a>
<ul class="sectlevel4">
<li><a href="#_描述_description_8">描述 Description</a></li>
<li><a href="#bpmnEventSubprocessGraphicalNotation">图示 Graphical Notation</a></li>
<li><a href="#bpmnEventSubprocessXMLRepresentation">XML表示 XML representation</a></li>
<li><a href="#bpmnEventSubprocessExample">示例 Example</a></li>
</ul>
</li>
<li><a href="#bpmnCallActivity">8.6.4. 调用活动（子流程） Call activity (subprocess)</a>
<ul class="sectlevel4">
<li><a href="#bpmnCallActivityDescription">描述 Description</a></li>
<li><a href="#bpmnCallActivityGraphicalNotation">图示 Graphical Notation</a></li>
<li><a href="#bpmnCallActivityXMLRepresentation">XML表现 XML representation</a></li>
<li><a href="#bpmnCallActivityPassVariables">传递变量 Passing variables</a></li>
<li><a href="#bpmnCallActivityExample">示例 Example</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#bpmnConcurrencyAndTransactions">8.7. 事务与并发 Transactions and Concurrency</a>
<ul class="sectlevel3">
<li><a href="#asyncContinuations">8.7.1. 异步延续 Asynchronous Continuations</a></li>
<li><a href="#failRetry">8.7.2. 失败重试 Fail Retry</a></li>
<li><a href="#exclusiveJobs">8.7.3. 排他作业 Exclusive Jobs</a>
<ul class="sectlevel4">
<li><a href="#_为什么排他作业_why_exclusive_jobs">为什么排他作业？ Why exclusive Jobs?</a></li>
<li><a href="#_什么是排他作业_what_are_exclusive_jobs">什么是排他作业？ What are exclusive jobs?</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#security">8.8. 流程启动认证 Process Initiation Authorization</a></li>
<li><a href="#dataobjects">8.9. 数据对象 Data objects</a></li>
</ul>
</li>
<li><a href="#forms">9. 表单 Forms</a>
<ul class="sectlevel2">
<li><a href="#formProperties">9.1. 表单参数 Form properties</a></li>
<li><a href="#externalFormRendering">9.2. 外部表单渲染 External form rendering</a></li>
</ul>
</li>
<li><a href="#_jpa_java_persistence_api_java持久化api">10. JPA（Java Persistence API Java持久化API）</a>
<ul class="sectlevel2">
<li><a href="#_需求_requirements">10.1. 需求 Requirements</a></li>
<li><a href="#jpaconfiguration">10.2. 配置 Configuration</a></li>
<li><a href="#_使用_usage">10.3. 使用 Usage</a>
<ul class="sectlevel3">
<li><a href="#_简单示例_simple_example">10.3.1. 简单示例 Simple Example</a></li>
<li><a href="#_查询jpa流程变量_query_jpa_process_variables">10.3.2. 查询JPA流程变量 Query JPA process variables</a></li>
<li><a href="#_使用spring_bean与jpa的高级示例_advanced_example_using_spring_beans_and_jpa">10.3.3. 使用Spring bean与JPA的高级示例 Advanced example using Spring beans and JPA</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#history">11. 历史 History</a>
<ul class="sectlevel2">
<li><a href="#historyQuery">11.1. 查询历史 Querying history</a>
<ul class="sectlevel3">
<li><a href="#historyQueryProcessInstance">11.1.1. 历史流程实例查询 HistoricProcessInstanceQuery</a></li>
<li><a href="#historyQueryVariableInstance">11.1.2. 历史变量实例查询 HistoricVariableInstanceQuery</a></li>
<li><a href="#historyQueryActivityInstance">11.1.3. 历史活动实例查询 HistoricActivityInstanceQuery</a></li>
<li><a href="#historyQueryDetail">11.1.4. 历史详情查询 HistoricDetailQuery</a></li>
<li><a href="#historyQueryTaskInstance">11.1.5. 历史任务示例查询  HistoricTaskInstanceQuery</a></li>
</ul>
</li>
<li><a href="#historyConfig">11.2. 历史配置 History configuration</a></li>
<li><a href="#historyFormAuditPurposes">11.3. 审计目的历史 History for audit purposes</a></li>
</ul>
</li>
<li><a href="#activitiDesigner">12. Eclipse Designer</a>
<ul class="sectlevel2">
<li><a href="#eclipseDesignerInstallation">12.1. 安装 Installation</a></li>
<li><a href="#eclipseDesignerEditorFeatures">12.2. Activiti Designer编辑器功能 Activiti Designer editor features</a></li>
<li><a href="#eclipseDesignerBPMNFeatures">12.3. Activiti Designer BPMN功能 Activiti Designer BPMN features</a></li>
<li><a href="#eclipseDesignerDeployment">12.4. Activiti Designer部署功能 Activiti Designer deployment features</a></li>
<li><a href="#eclipseDesignerExtending">12.5. 扩展Activiti Designer (Extending Activiti Designer)</a>
<ul class="sectlevel3">
<li><a href="#eclipseDesignerCustomizingPalette">12.5.1. 自定义画板 Customizing the palette</a>
<ul class="sectlevel4">
<li><a href="#_设置扩展_extension_setup_eclipse_maven">设置扩展 Extension setup (Eclipse/Maven)</a></li>
<li><a href="#eclipseDesignerApplyingExtension">在Activiti Designer中应用你的扩展 Applying your extension to Activiti Designer</a></li>
<li><a href="#_为画板添加图形_adding_shapes_to_the_palette">为画板添加图形 Adding shapes to the palette</a>
<ul class="sectlevel5">
<li><a href="#eclipseDesignerConfiguringRuntime">配置自定义服务任务的运行时执行 Configuring runtime execution of Custom Service Tasks</a></li>
</ul>
</li>
<li><a href="#eclipseDesignerPropertyTypes">参数类型 Property types</a>
<ul class="sectlevel5">
<li><a href="#_propertytype_text">PropertyType.TEXT</a></li>
<li><a href="#_propertytype_multiline_text">PropertyType.MULTILINE_TEXT</a></li>
<li><a href="#_propertytype_period">PropertyType.PERIOD</a></li>
<li><a href="#_propertytype_boolean_choice">PropertyType.BOOLEAN_CHOICE</a></li>
<li><a href="#_propertytype_radio_choice">PropertyType.RADIO_CHOICE</a></li>
<li><a href="#_propertytype_combobox_choice">PropertyType.COMBOBOX_CHOICE</a></li>
<li><a href="#_propertytype_date_picker">PropertyType.DATE_PICKER</a></li>
<li><a href="#_propertytype_data_grid">PropertyType.DATA_GRID</a></li>
</ul>
</li>
<li><a href="#_在画板中禁用默认图形_disabling_default_shapes_in_the_palette">在画板中禁用默认图形 Disabling default shapes in the palette</a></li>
</ul>
</li>
<li><a href="#_验证流程图与输出为自定义格式_validating_diagrams_and_exporting_to_custom_output_formats">12.5.2. 验证流程图与输出为自定义格式 Validating diagrams and exporting to custom output formats</a>
<ul class="sectlevel4">
<li><a href="#_创建processvalidator扩展_creating_a_processvalidator_extension">创建ProcessValidator扩展 Creating a ProcessValidator extension</a></li>
<li><a href="#_创建exportmarshaller扩展_creating_an_exportmarshaller_extension">创建ExportMarshaller扩展 Creating an ExportMarshaller extension</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#activitiExplorer">13. Activiti Explorer</a>
<ul class="sectlevel2">
<li><a href="#_配置_configuration_2">13.1. 配置 Configuration</a></li>
<li><a href="#_流程图_process_diagram">13.2. 流程图 Process diagram</a></li>
<li><a href="#_任务_tasks">13.3. 任务 Tasks</a></li>
<li><a href="#_启动流程实例_start_process_instances">13.4. 启动流程实例 Start process instances</a></li>
<li><a href="#_我的实例_my_instances">13.5. 我的实例 My instances</a></li>
<li><a href="#_管理_administration">13.6. 管理 Administration</a></li>
<li><a href="#explorer.reporting">13.7. 报告 Reporting</a>
<ul class="sectlevel3">
<li><a href="#explorer.reporting.json">13.7.1. 报告数据JSON （Report data JSON）</a></li>
<li><a href="#explorer.reporting.example">13.7.2. 实例流程 Example process</a></li>
<li><a href="#explorer.reporting.start.form">13.7.3. 报告启动表单 Report start forms</a></li>
<li><a href="#explorer.reporting.examples">13.7.4. 示例流程 Example processes</a></li>
</ul>
</li>
<li><a href="#explorer.change.database">13.8. 改变数据库 Changing the database</a></li>
</ul>
</li>
<li><a href="#activitiModeler">14. Activiti Modeler</a>
<ul class="sectlevel2">
<li><a href="#_编辑模型_model_editing">14.1. 编辑模型 Model editing</a></li>
<li><a href="#_导入现有模型_importing_existing_models">14.2. 导入现有模型 Importing existing models</a></li>
<li><a href="#_将已部署定义转换为可编辑模型_convert_deployed_definitions_to_a_editable_model">14.3. 将已部署定义转换为可编辑模型 Convert deployed definitions to a editable model</a></li>
<li><a href="#_将模型导出为bpmn_xml_export_model_to_bpmn_xml">14.4. 将模型导出为BPMN XML （Export model to BPMN XML）</a></li>
<li><a href="#_将模型部署至activiti引擎_deploy_model_to_the_activiti_engine">14.5. 将模型部署至Activiti引擎 Deploy model to the Activiti Engine</a></li>
</ul>
</li>
<li><a href="#_rest_api">15. REST API</a>
<ul class="sectlevel2">
<li><a href="#_activiti_rest一般原则_general_activiti_rest_principles">15.1. Activiti REST一般原则 General Activiti REST principles</a>
<ul class="sectlevel3">
<li><a href="#_安装与认证_installation_and_authentication">15.1.1. 安装与认证 Installation and Authentication</a></li>
<li><a href="#_配置_configuration_3">15.1.2. 配置 Configuration</a></li>
<li><a href="#restUsageInTomcat">15.1.3. 在Tomcat中使用 Usage in Tomcat</a></li>
<li><a href="#_方法与返回码_methods_and_return_codes">15.1.4. 方法与返回码 Methods and return-codes</a></li>
<li><a href="#_错误响应体_error_response_body">15.1.5. 错误响应体 Error response body</a></li>
<li><a href="#_请求参数_request_parameters">15.1.6. 请求参数 Request parameters</a>
<ul class="sectlevel4">
<li><a href="#_url片段_url_fragments">URL片段 URL fragments</a></li>
<li><a href="#_rest_url查询参数_rest_url_query_parameters">Rest URL查询参数 Rest URL query parameters</a></li>
<li><a href="#restJsonBody">JSON体参数 JSON body parameters</a></li>
<li><a href="#restPagingAndSort">分页与排序 Paging and sorting</a></li>
<li><a href="#restQueryVariable">JSON查询变量格式</a></li>
<li><a href="#restVariables">变量表示 Variable representation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_部署_deployment">15.2. 部署 Deployment</a>
<ul class="sectlevel3">
<li><a href="#_部署的列表_list_of_deployments">15.2.1. 部署的列表 List of Deployments</a></li>
<li><a href="#_获取一个部署_get_a_deployment">15.2.2. 获取一个部署 Get a deployment</a></li>
<li><a href="#_创建一个新部署_create_a_new_deployment">15.2.3. 创建一个新部署 Create a new deployment</a></li>
<li><a href="#_删除一个部署_delete_a_deployment">15.2.4. 删除一个部署 Delete a deployment</a></li>
<li><a href="#_列表一个部署中的资源_list_resources_in_a_deployment">15.2.5. 列表一个部署中的资源 List resources in a deployment</a></li>
<li><a href="#_获取一个部署资源_get_a_deployment_resource">15.2.6. 获取一个部署资源 Get a deployment resource</a></li>
<li><a href="#_获取一个部署资源的内容_get_a_deployment_resource_content">15.2.7. 获取一个部署资源的内容 Get a deployment resource content</a></li>
</ul>
</li>
<li><a href="#_流程定义_process_definitions">15.3. 流程定义 Process Definitions</a>
<ul class="sectlevel3">
<li><a href="#_流程定义的列表_list_of_process_definitions">15.3.1. 流程定义的列表 List of process definitions</a></li>
<li><a href="#_获取一个流程定义">15.3.2. 获取一个流程定义</a></li>
<li><a href="#_更新一个流程定义的分类_update_category_for_a_process_definition">15.3.3. 更新一个流程定义的分类 Update category for a process definition</a></li>
<li><a href="#_获取一个流程定义资源的内容_get_a_process_definition_resource_content">15.3.4. 获取一个流程定义资源的内容 Get a process definition resource content</a></li>
<li><a href="#_获取一个流程定义的bpmn模型_get_a_process_definition_bpmn_model">15.3.5. 获取一个流程定义的BPMN模型 Get a process definition BPMN model</a></li>
<li><a href="#_暂停一个流程定义_suspend_a_process_definition">15.3.6. 暂停一个流程定义 Suspend a process definition</a></li>
<li><a href="#_激活一个流程定义_activate_a_process_definition">15.3.7. 激活一个流程定义 Activate a process definition</a></li>
<li><a href="#_获取一个流程定义的所有候选启动者_get_all_candidate_starters_for_a_process_definition">15.3.8. 获取一个流程定义的所有候选启动者 Get all candidate starters for a process-definition</a></li>
<li><a href="#_为一个流程定义添加一个候选启动者_add_a_candidate_starter_to_a_process_definition">15.3.9. 为一个流程定义添加一个候选启动者 Add a candidate starter to a process definition</a></li>
<li><a href="#_从一个流程定义中删除一个候选启动者_delete_a_candidate_starter_from_a_process_definition">15.3.10. 从一个流程定义中删除一个候选启动者 Delete a candidate starter from a process definition</a></li>
<li><a href="#_从一个流程定义中获取一个候选启动者_get_a_candidate_starter_from_a_process_definition">15.3.11. 从一个流程定义中获取一个候选启动者 Get a candidate starter from a process definition</a></li>
</ul>
</li>
<li><a href="#_模型_models">15.4. 模型 Models</a>
<ul class="sectlevel3">
<li><a href="#_获取模型的列表_get_a_list_of_models">15.4.1. 获取模型的列表 Get a list of models</a></li>
<li><a href="#_获取一个模型_get_a_model">15.4.2. 获取一个模型 Get a model</a></li>
<li><a href="#_更新一个模型_update_a_model">15.4.3. 更新一个模型 Update a model</a></li>
<li><a href="#_创建一个模型_create_a_model">15.4.4. 创建一个模型 Create a model</a></li>
<li><a href="#_删除一个模型_delete_a_model">15.4.5. 删除一个模型 Delete a model</a></li>
<li><a href="#_获取一个模型的编辑器源码_get_the_editor_source_for_a_model">15.4.6. 获取一个模型的编辑器源码 Get the editor source for a model</a></li>
<li><a href="#_设置一个模型的编辑器源码_set_the_editor_source_for_a_model">15.4.7. 设置一个模型的编辑器源码 Set the editor source for a model</a></li>
<li><a href="#_获取一个模型的附加编辑器源码_get_the_extra_editor_source_for_a_model">15.4.8. 获取一个模型的附加编辑器源码 Get the extra editor source for a model</a></li>
<li><a href="#_设置一个模型的附加编辑器源码_set_the_extra_editor_source_for_a_model">15.4.9. 设置一个模型的附加编辑器源码 Set the extra editor source for a model</a></li>
</ul>
</li>
<li><a href="#_流程实例_process_instances">15.5. 流程实例 Process Instances</a>
<ul class="sectlevel3">
<li><a href="#_获取一个流程实例_get_a_process_instance">15.5.1. 获取一个流程实例 Get a process instance</a></li>
<li><a href="#_删除一个流程实例_delete_a_process_instance">15.5.2. 删除一个流程实例 Delete a process instance</a></li>
<li><a href="#_激活或暂停一个流程实例_activate_or_suspend_a_process_instance">15.5.3. 激活或暂停一个流程实例 Activate or suspend a process instance</a></li>
<li><a href="#_启动一个流程实例_start_a_process_instance">15.5.4. 启动一个流程实例 Start a process instance</a></li>
<li><a href="#restProcessInstancesGet">15.5.5. 流程实例的列表 List of process instances</a></li>
<li><a href="#_查询流程实例_query_process_instances">15.5.6. 查询流程实例 Query process instances</a></li>
<li><a href="#_获取一个流程实例的流程图_get_diagram_for_a_process_instance">15.5.7. 获取一个流程实例的流程图 Get diagram for a process instance</a></li>
<li><a href="#_获取流程实例的参与人_get_involved_people_for_process_instance">15.5.8. 获取流程实例的参与人 Get involved people for process instance</a></li>
<li><a href="#_为一个流程实例添加一个参与用户_add_an_involved_user_to_a_process_instance">15.5.9. 为一个流程实例添加一个参与用户 Add an involved user to a process instance</a></li>
<li><a href="#_从一个流程实例中移除一个参与用户_remove_an_involved_user_to_from_process_instance">15.5.10. 从一个流程实例中移除一个参与用户 Remove an involved user to from process instance</a></li>
<li><a href="#_一个流程实例的变量的列表_list_of_variables_for_a_process_instance">15.5.11. 一个流程实例的变量的列表 List of variables for a process instance</a></li>
<li><a href="#_获取一个流程实例的一个变量_get_a_variable_for_a_process_instance">15.5.12. 获取一个流程实例的一个变量 Get a variable for a process instance</a></li>
<li><a href="#_为一个流程实例创建_或更新_变量_create_or_update_variables_on_a_process_instance">15.5.13. 为一个流程实例创建（或更新）变量 Create (or update) variables on a process instance</a></li>
<li><a href="#_为一个流程实例更新一个变量_update_a_single_variable_on_a_process_instance">15.5.14. 为一个流程实例更新一个变量 Update a single variable on a process instance</a></li>
<li><a href="#_为一个流程实例创建一个新的二进制变量_create_a_new_binary_variable_on_a_process_instance">15.5.15. 为一个流程实例创建一个新的二进制变量 Create a new binary variable on a process-instance</a></li>
<li><a href="#_为一个流程实例更新一个已有的二进制变量_update_an_existing_binary_variable_on_a_process_instance">15.5.16. 为一个流程实例更新一个已有的二进制变量 Update an existing binary variable on a process-instance</a></li>
</ul>
</li>
<li><a href="#_执行_executions">15.6. 执行 Executions</a>
<ul class="sectlevel3">
<li><a href="#_获取一个执行_get_an_execution">15.6.1. 获取一个执行 Get an execution</a></li>
<li><a href="#_对一个执行进行操作_execute_an_action_on_an_execution">15.6.2. 对一个执行进行操作 Execute an action on an execution</a></li>
<li><a href="#_获取一个执行中的激活活动_get_active_activities_in_an_execution">15.6.3. 获取一个执行中的激活活动 Get active activities in an execution</a></li>
<li><a href="#restExecutionsGet">15.6.4. 执行的列表 List of executions</a></li>
<li><a href="#_查询执行_query_executions">15.6.5. 查询执行 Query executions</a></li>
<li><a href="#_一个执行中的变量的列表_list_of_variables_for_an_execution">15.6.6. 一个执行中的变量的列表 List of variables for an execution</a></li>
<li><a href="#_获取一个执行的一个变量_get_a_variable_for_an_execution">15.6.7. 获取一个执行的一个变量 Get a variable for an execution</a></li>
<li><a href="#_为一个执行创建_或更新_变量_create_or_update_variables_on_an_execution">15.6.8. 为一个执行创建（或更新）变量 Create (or update) variables on an execution</a></li>
<li><a href="#_为一个执行更新一个变量_update_a_variable_on_an_execution">15.6.9. 为一个执行更新一个变量 Update a variable on an execution</a></li>
<li><a href="#_为一个执行创建一个新的二进制变量_create_a_new_binary_variable_on_an_execution">15.6.10. 为一个执行创建一个新的二进制变量 Create a new binary variable on an execution</a></li>
<li><a href="#_为一个执行更新一个已有二进制变量_update_an_existing_binary_variable_on_a_process_instance">15.6.11. 为一个执行更新一个已有二进制变量 Update an existing binary variable on a process-instance</a></li>
</ul>
</li>
<li><a href="#_任务_tasks_2">15.7. 任务 Tasks</a>
<ul class="sectlevel3">
<li><a href="#_获取一个任务_get_a_task">15.7.1. 获取一个任务 Get a task</a></li>
<li><a href="#restTasksGet">15.7.2. 任务的列表 List of tasks</a></li>
<li><a href="#_查询任务_query_for_tasks">15.7.3. 查询任务 Query for tasks</a></li>
<li><a href="#_更新一个任务_update_a_task">15.7.4. 更新一个任务 Update a task</a></li>
<li><a href="#_任务操作_task_actions">15.7.5. 任务操作 Task actions</a></li>
<li><a href="#_删除一个任务_delete_a_task">15.7.6. 删除一个任务 Delete a task</a></li>
<li><a href="#_获取一个任务的所有变量_get_all_variables_for_a_task">15.7.7. 获取一个任务的所有变量 Get all variables for a task</a></li>
<li><a href="#_从一个任务中获取一个变量_get_a_variable_from_a_task">15.7.8. 从一个任务中获取一个变量 Get a variable from a task</a></li>
<li><a href="#_获取一个变量的二进制数据_get_the_binary_data_for_a_variable">15.7.9. 获取一个变量的二进制数据 Get the binary data for a variable</a></li>
<li><a href="#_为一个任务创建_或更新_变量_create_or_update_variables_on_a_task">15.7.10. 为一个任务创建（或更新）变量 Create (or update) variables on a task</a></li>
<li><a href="#_为一个任务创建一个新的二进制变量_create_a_new_binary_variable_on_a_task">15.7.11. 为一个任务创建一个新的二进制变量 Create a new binary variable on a task</a></li>
<li><a href="#_为一个任务更新一个已有变量_update_an_existing_variable_on_a_task">15.7.12. 为一个任务更新一个已有变量 Update an existing variable on a task</a></li>
<li><a href="#_为一个任务更新一个二进制变量_updating_a_binary_variable_on_a_task">15.7.13. 为一个任务更新一个二进制变量 Updating a binary variable on a task</a></li>
<li><a href="#_为一个任务删除一个变量_delete_a_variable_on_a_task">15.7.14. 为一个任务删除一个变量 Delete a variable on a task</a></li>
<li><a href="#_为一个任务删除所有本地变量_delete_all_local_variables_on_a_task">15.7.15. 为一个任务删除所有本地变量 Delete all local variables on a task</a></li>
<li><a href="#_获取一个任务的所有身份关联_get_all_identity_links_for_a_task">15.7.16. 获取一个任务的所有身份关联 Get all identity links for a task</a></li>
<li><a href="#_获取一个任务的组或用户的所有身份关联_get_all_identitylinks_for_a_task_for_either_groups_or_users">15.7.17. 获取一个任务的组或用户的所有身份关联 Get all identitylinks for a task for either groups or users</a></li>
<li><a href="#_获取一个任务的一个身份关联_get_a_single_identity_link_on_a_task">15.7.18. 获取一个任务的一个身份关联 Get a single identity link on a task</a></li>
<li><a href="#_为一个任务创建一个身份关联_create_an_identity_link_on_a_task">15.7.19. 为一个任务创建一个身份关联 Create an identity link on a task</a></li>
<li><a href="#_为一个任务删除一个身份关联_delete_an_identity_link_on_a_task">15.7.20. 为一个任务删除一个身份关联 Delete an identity link on a task</a></li>
<li><a href="#_为一个任务创建一个新备注_create_a_new_comment_on_a_task">15.7.21. 为一个任务创建一个新备注 Create a new comment on a task</a></li>
<li><a href="#_获取一个任务的所有备注_get_all_comments_on_a_task">15.7.22. 获取一个任务的所有备注 Get all comments on a task</a></li>
<li><a href="#_获取一个任务的一个备注_get_a_comment_on_a_task">15.7.23. 获取一个任务的一个备注 Get a comment on a task</a></li>
<li><a href="#_为一个任务删除一个备注_delete_a_comment_on_a_task">15.7.24. 为一个任务删除一个备注 Delete a comment on a task</a></li>
<li><a href="#_获取一个任务的所有事件_get_all_events_for_a_task">15.7.25. 获取一个任务的所有事件 Get all events for a task</a></li>
<li><a href="#_获取一个任务的一个事件_get_an_event_on_a_task">15.7.26. 获取一个任务的一个事件 Get an event on a task</a></li>
<li><a href="#_为一个任务创建一个新的附件_带有一个指向外部资源的链接_create_a_new_attachment_on_a_task_containing_a_link_to_an_external_resource">15.7.27. 为一个任务创建一个新的附件，带有一个指向外部资源的链接 Create a new attachment on a task, containing a link to an external resource</a></li>
<li><a href="#_为一个任务创建一个新的附件_带有附加文件_create_a_new_attachment_on_a_task_with_an_attached_file">15.7.28. 为一个任务创建一个新的附件，带有附加文件 Create a new attachment on a task, with an attached file</a></li>
<li><a href="#_获取一个任务的所有附件_get_all_attachments_on_a_task">15.7.29. 获取一个任务的所有附件 Get all attachments on a task</a></li>
<li><a href="#_获取一个任务的一个附件_get_an_attachment_on_a_task">15.7.30. 获取一个任务的一个附件 Get an attachment on a task</a></li>
<li><a href="#_获取一个附件的内容_get_the_content_for_an_attachment">15.7.31. 获取一个附件的内容 Get the content for an attachment</a></li>
<li><a href="#_为一个任务删除一个附件_delete_an_attachment_on_a_task">15.7.32. 为一个任务删除一个附件 Delete an attachment on a task</a></li>
</ul>
</li>
<li><a href="#_历史_history">15.8. 历史 History</a>
<ul class="sectlevel3">
<li><a href="#_获取一个历史流程实例_get_a_historic_process_instance">15.8.1. 获取一个历史流程实例 Get a historic process instance</a></li>
<li><a href="#restHistoricProcessInstancesGet">15.8.2. 历史流程实例的列表 List of historic process instances</a></li>
<li><a href="#_查询历史流程实例_query_for_historic_process_instances">15.8.3. 查询历史流程实例 Query for historic process instances</a></li>
<li><a href="#_删除一个历史流程实例_delete_a_historic_process_instance">15.8.4. 删除一个历史流程实例 Delete a historic process instance</a></li>
<li><a href="#_获取一个历史流程实例的身份关联_get_the_identity_links_of_a_historic_process_instance">15.8.5. 获取一个历史流程实例的身份关联 Get the identity links of a historic process instance</a></li>
<li><a href="#_获取一个历史流程实例变量的二进制数据_get_the_binary_data_for_a_historic_process_instance_variable">15.8.6. 获取一个历史流程实例变量的二进制数据 Get the binary data for a historic process instance variable</a></li>
<li><a href="#_为一个历史流程实例创建一个新的备注_create_a_new_comment_on_a_historic_process_instance">15.8.7. 为一个历史流程实例创建一个新的备注 Create a new comment on a historic process instance</a></li>
<li><a href="#_获取一个历史流程实例的所有备注_get_all_comments_on_a_historic_process_instance">15.8.8. 获取一个历史流程实例的所有备注 Get all comments on a historic process instance</a></li>
<li><a href="#_获取一个历史流程实例的一个备注_get_a_comment_on_a_historic_process_instance">15.8.9. 获取一个历史流程实例的一个备注 Get a comment on a historic process instance</a></li>
<li><a href="#_从一个历史流程实例中删除一个备注_delete_a_comment_on_a_historic_process_instance">15.8.10. 从一个历史流程实例中删除一个备注 Delete a comment on a historic process instance</a></li>
<li><a href="#_获取一个历史任务实例_get_a_single_historic_task_instance">15.8.11. 获取一个历史任务实例 Get a single historic task instance</a></li>
<li><a href="#restHistoricTaskInstancesGet">15.8.12. 获取历史任务实例 Get historic task instances</a></li>
<li><a href="#_查询历史任务实例_query_for_historic_task_instances">15.8.13. 查询历史任务实例 Query for historic task instances</a></li>
<li><a href="#_删除一个历史任务实例_delete_a_historic_task_instance">15.8.14. 删除一个历史任务实例 Delete a historic task instance</a></li>
<li><a href="#_获取一个历史任务实例的身份关联_get_the_identity_links_of_a_historic_task_instance">15.8.15. 获取一个历史任务实例的身份关联 Get the identity links of a historic task instance</a></li>
<li><a href="#_获取一个历史流程实例变量的二进制数据_get_the_binary_data_for_a_historic_task_instance_variable">15.8.16. 获取一个历史流程实例变量的二进制数据 Get the binary data for a historic task instance variable</a></li>
<li><a href="#restHistoricActivityInstancesGet">15.8.17. 获取历史活动实例 Get historic activity instances</a></li>
<li><a href="#_查询历史活动实例_query_for_historic_activity_instances">15.8.18. 查询历史活动实例 Query for historic activity instances</a></li>
<li><a href="#restHistoricVariableInstancesGet">15.8.19. 历史变量实例的列表 List of historic variable instances</a></li>
<li><a href="#_查询历史变量实例_query_for_historic_variable_instances">15.8.20. 查询历史变量实例 Query for historic variable instances</a></li>
<li><a href="#_获取历史任务实例变量的二进制数据_get_the_binary_data_for_a_historic_task_instance_variable">15.8.21. 获取历史任务实例变量的二进制数据 Get the binary data for a historic task instance variable</a></li>
<li><a href="#restHistoricDetailGet">15.8.22. 获取历史详情 Get historic detail</a></li>
<li><a href="#_查询历史详情_query_for_historic_details">15.8.23. 查询历史详情 Query for historic details</a></li>
<li><a href="#_获取历史详情变量的二进制数据_get_the_binary_data_for_a_historic_detail_variable">15.8.24. 获取历史详情变量的二进制数据 Get the binary data for a historic detail variable</a></li>
</ul>
</li>
<li><a href="#_表单_forms">15.9. 表单 Forms</a>
<ul class="sectlevel3">
<li><a href="#_获取表单数据_get_form_data">15.9.1. 获取表单数据 Get form data</a></li>
<li><a href="#_提交任务表单数据_submit_task_form_data">15.9.2. 提交任务表单数据 Submit task form data</a></li>
</ul>
</li>
<li><a href="#_数据库表_database_tables">15.10. 数据库表 Database tables</a>
<ul class="sectlevel3">
<li><a href="#_表的列表_list_of_tables">15.10.1. 表的列表 List of tables</a></li>
<li><a href="#_获取一个表_get_a_single_table">15.10.2. 获取一个表 Get a single table</a></li>
<li><a href="#_获取一个表的列信息_get_column_info_for_a_single_table">15.10.3. 获取一个表的列信息 Get column info for a single table</a></li>
<li><a href="#_获取一个表的行数据_get_row_data_for_a_single_table">15.10.4. 获取一个表的行数据 Get row data for a single table</a></li>
</ul>
</li>
<li><a href="#_引擎_engine">15.11. 引擎 Engine</a>
<ul class="sectlevel3">
<li><a href="#_获取引擎参数_get_engine_properties">15.11.1. 获取引擎参数 Get engine properties</a></li>
<li><a href="#_获取引擎信息_get_engine_info">15.11.2. 获取引擎信息 Get engine info</a></li>
</ul>
</li>
<li><a href="#_运行时_runtime">15.12. 运行时 Runtime</a>
<ul class="sectlevel3">
<li><a href="#_已接收到信号事件_signal_event_received">15.12.1. 已接收到信号事件 Signal event received</a></li>
</ul>
</li>
<li><a href="#_作业_jobs">15.13. 作业 Jobs</a>
<ul class="sectlevel3">
<li><a href="#_获取一个作业_get_a_single_job">15.13.1. 获取一个作业 Get a single job</a></li>
<li><a href="#_删除一个作业_delete_a_job">15.13.2. 删除一个作业 Delete a job</a></li>
<li><a href="#_执行一个作业_execute_a_single_job">15.13.3. 执行一个作业 Execute a single job</a></li>
<li><a href="#_获取一个作业的异常栈_get_the_exception_stacktrace_for_a_job">15.13.4. 获取一个作业的异常栈 Get the exception stacktrace for a job</a></li>
<li><a href="#_获取作业的列表_get_a_list_of_jobs">15.13.5. 获取作业的列表 Get a list of jobs</a></li>
</ul>
</li>
<li><a href="#_用户_users">15.14. 用户 Users</a>
<ul class="sectlevel3">
<li><a href="#_获取一个用户_get_a_single_user">15.14.1. 获取一个用户 Get a single user</a></li>
<li><a href="#_获取用户的列表_get_a_list_of_users">15.14.2. 获取用户的列表 Get a list of users</a></li>
<li><a href="#_更新一个用户_update_a_user">15.14.3. 更新一个用户 Update a user</a></li>
<li><a href="#_创建一个用户_create_a_user">15.14.4. 创建一个用户 Create a user</a></li>
<li><a href="#_删除一个用户_delete_a_user">15.14.5. 删除一个用户 Delete a user</a></li>
<li><a href="#_获取一个用户的图片_get_a_user_s_picture">15.14.6. 获取一个用户的图片 Get a user&#8217;s picture</a></li>
<li><a href="#_更新一个用户的图片_updating_a_user_s_picture">15.14.7. 更新一个用户的图片 Updating a user&#8217;s picture</a></li>
<li><a href="#_列表一个用户的信息_list_a_user_s_info">15.14.8. 列表一个用户的信息 List a user&#8217;s info</a></li>
<li><a href="#_获取一条用户信息_get_a_user_s_info">15.14.9. 获取一条用户信息 Get a user&#8217;s info</a></li>
<li><a href="#_更新一条用户信息_update_a_user_s_info">15.14.10. 更新一条用户信息 Update a user&#8217;s info</a></li>
<li><a href="#_创建一条新的用户信息记录_create_a_new_user_s_info_entry">15.14.11. 创建一条新的用户信息记录 Create a new user&#8217;s info entry</a></li>
<li><a href="#_删除一条用户信息_delete_a_user_s_info">15.14.12. 删除一条用户信息 Delete a user&#8217;s info</a></li>
</ul>
</li>
<li><a href="#_组_groups">15.15. 组 Groups</a>
<ul class="sectlevel3">
<li><a href="#_获取一个组_get_a_single_group">15.15.1. 获取一个组 Get a single group</a></li>
<li><a href="#_获取组的列表_get_a_list_of_groups">15.15.2. 获取组的列表 Get a list of groups</a></li>
<li><a href="#_更新一个组_update_a_group">15.15.3. 更新一个组 Update a group</a></li>
<li><a href="#_创建一个组_create_a_group">15.15.4. 创建一个组 Create a group</a></li>
<li><a href="#_删除一个组_delete_a_group">15.15.5. 删除一个组 Delete a group</a></li>
<li><a href="#_获取一个组中的成员_get_members_in_a_group">15.15.6. 获取一个组中的成员 Get members in a group</a></li>
<li><a href="#_为一个组添加一个成员_add_a_member_to_a_group">15.15.7. 为一个组添加一个成员 Add a member to a group</a></li>
<li><a href="#_从一个组中删除一个成员_delete_a_member_from_a_group">15.15.8. 从一个组中删除一个成员 Delete a member from a group</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#cdiintegration">16. CDI集成 CDI integration</a>
<ul class="sectlevel2">
<li><a href="#_设置activiti_cdi_setting_up_activiti_cdi">16.1. 设置activiti-cdi (Setting up activiti-cdi)</a>
<ul class="sectlevel3">
<li><a href="#_查找流程引擎_looking_up_a_process_engine">16.1.1. 查找流程引擎 Looking up a Process Engine</a></li>
<li><a href="#_配置流程引擎_configuring_the_process_engine">16.1.2. 配置流程引擎 Configuring the Process Engine</a></li>
<li><a href="#_部署流程_deploying_processes">16.1.3. 部署流程 Deploying Processes</a></li>
</ul>
</li>
<li><a href="#_cdi的基于上下文的流程执行_contextual_process_execution_with_cdi">16.2. CDI的基于上下文的流程执行 Contextual Process Execution with CDI</a>
<ul class="sectlevel3">
<li><a href="#_将一个会话关联至一个流程实例_associating_a_conversation_with_a_process_instance">16.2.1. 将一个会话关联至一个流程实例 Associating a Conversation with a Process Instance</a></li>
<li><a href="#_声明式控制流程_declaratively_controlling_the_process">16.2.2. 声明式控制流程 Declaratively controlling the Process</a></li>
<li><a href="#_从流程中引用bean_referencing_beans_from_the_process">16.2.3. 从流程中引用Bean (Referencing Beans from the Process)</a></li>
<li><a href="#_使用_businessprocessscoped_bean_working_with_businessprocessscoped_beans">16.2.4. 使用@BusinessProcessScoped bean (Working with @BusinessProcessScoped beans)</a></li>
<li><a href="#_注入流程变量_injecting_process_variables">16.2.5. 注入流程变量 Injecting Process Variables</a></li>
<li><a href="#_接收流程事件_receiving_process_events">16.2.6. 接收流程事件 Receiving Process Events</a></li>
<li><a href="#_额外功能_additional_features">16.2.7. 额外功能 Additional Features</a></li>
</ul>
</li>
<li><a href="#_已知限制_known_limitations">16.3. 已知限制 Known Limitations</a></li>
</ul>
</li>
<li><a href="#chapter_ldap">17. 集成LDAP (LDAP integration)</a>
<ul class="sectlevel2">
<li><a href="#ldap_usage">17.1. 使用 Usage</a></li>
<li><a href="#ldap_usecases">17.2. 用例 Use cases</a></li>
<li><a href="#ldap_configuration">17.3. 配置 Configuration</a></li>
<li><a href="#ldap_properties">17.4. 参数 Properties</a></li>
<li><a href="#lda-explorer">17.5. 在Explorer中集成LDAP (Integrate LDAP in Explorer)</a></li>
</ul>
</li>
<li><a href="#_高级_advanced">18. 高级 Advanced</a>
<ul class="sectlevel2">
<li><a href="#advanced_parseHandlers">18.1. 异步与作业执行器 Async and job executor</a>
<ul class="sectlevel3">
<li><a href="#_异步执行器的设计_async_executor_design">18.1.1. 异步执行器的设计 Async executor design</a></li>
<li><a href="#_作业执行器的设计_job_executor_design">18.1.2. 作业执行器的设计 Job executor design</a></li>
<li><a href="#_异步执行器的优点_advantages_of_the_async_executor">18.1.3. 异步执行器的优点 Advantages of the Async executor</a></li>
<li><a href="#_配置异步执行器_async_executor_configuration">18.1.4. 配置异步执行器 Async executor configuration</a></li>
</ul>
</li>
<li><a href="#_深入流程解析_hooking_into_process_parsing">18.2. 深入流程解析 Hooking into process parsing</a></li>
<li><a href="#advanced.uuid.generator">18.3. 高并发下使用的UUID id生成器 UUID id generator for high concurrency</a></li>
<li><a href="#advanced.tenancy">18.4. 多租户 Multitenancy</a></li>
<li><a href="#advanced.custom.sql.queries">18.5. 执行自定义SQL Execute custom SQL</a>
<ul class="sectlevel3">
<li><a href="#_基于注解的映射语句_annotation_based_mapped_statements">18.5.1. 基于注解的映射语句 Annotation based Mapped Statements</a></li>
<li><a href="#_基于xml的映射语句_xml_based_mapped_statements">18.5.2. 基于XML的映射语句 XML based Mapped Statements</a></li>
</ul>
</li>
<li><a href="#advanced.process.engine.configurators">18.6. 使用ProcessEngineConfigurator进行高级流程引擎配置  Advanced Process Engine configuration with a ProcessEngineConfigurator</a></li>
<li><a href="#advanced.task.query.switching">18.7. 高级查询API：在运行时与历史任务查询间无缝切换 Advanced query API: seamless switching between runtime and historic task querying</a></li>
<li><a href="#advanced.custom.session.manager">18.8. 通过覆盖标准SessionFactory自定义身份管理 Custom identity management by overriding standard SessionFactory</a></li>
<li><a href="#advanced.safe.bpmn.xml">18.9. 启用安全BPMN 2.0 XML (Enable safe BPMN 2.0 xml)</a></li>
<li><a href="#advanced.event.logging">18.10. 事件记录（试验性） Event logging (Experimental)</a></li>
<li><a href="#_禁用批量插入_disabling_bulk_inserts">18.11. 禁用批量插入 Disabling bulk inserts</a></li>
<li><a href="#advancedSecureScripting">18.12. 安全脚本 Secure Scripting</a></li>
</ul>
</li>
<li><a href="#_使用activiti_crystalball仿真_试验性_simulation_with_activiti_crystalball_experimental">19. 使用Activiti-Crystalball仿真（试验性） Simulation with Activiti-Crystalball (Experimental)</a>
<ul class="sectlevel2">
<li><a href="#crb-introduction">19.1. 介绍 Introduction</a>
<ul class="sectlevel3">
<li><a href="#crb-overview">19.1.1. 简介 Short overview</a></li>
<li><a href="#crb-unique">19.1.2. CrystalBall是独特的 CrystalBall is unique</a></li>
</ul>
</li>
<li><a href="#crb-inside">19.2. 深入CrystalBall (CrystalBall inside)</a></li>
<li><a href="#crb-history-analysis">19.3. 历史分析 History analysis</a>
<ul class="sectlevel3">
<li><a href="#crb-collectEvents">19.3.1. 历史中的事件 Events from the history.</a></li>
<li><a href="#crb-playback">19.3.2. 回放 PlayBack</a></li>
<li><a href="#crb-debug">19.3.3. 流程引擎调试 Process engine debugger</a></li>
<li><a href="#crb-replay">19.3.4. 重放 Replay</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Tooling">20. 工具 Tooling</a>
<ul class="sectlevel2">
<li><a href="#JMX">20.1. JMX</a>
<ul class="sectlevel3">
<li><a href="#jmxIntroduction">20.1.1. 介绍 Introduction</a></li>
<li><a href="#jmxQuickStart">20.1.2. 快速开始 Quick Start</a></li>
<li><a href="#_属性与操作_attributes_and_operations">20.1.3. 属性与操作 Attributes and operations</a></li>
<li><a href="#_配置_configuration_4">20.1.4. 配置 Configuration</a></li>
<li><a href="#_jmx服务url_jmx_service_url">20.1.5. JMX服务URL (JMX Service URL)</a></li>
</ul>
</li>
<li><a href="#mavenArchetypes">20.2. Maven原型 Maven archetypes</a>
<ul class="sectlevel3">
<li><a href="#_创建测试用例_create_test_case">20.2.1. 创建测试用例 Create Test Case</a></li>
</ul>
</li>
<li><a href="#docker">20.3. Docker镜像 Docker images</a>
<ul class="sectlevel3">
<li><a href="#dockerIntroduction">20.3.1. 介绍 Introduction</a></li>
<li><a href="#dockerSingleImage">20.3.2. 使用 Usage</a></li>
<li><a href="#dockerBuild">20.3.3. 构建docker镜像 Build docker image</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_简介">1. 简介</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="license">1.1. 协议</h3>
<div class="paragraph">
<p>Activiti使用 <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache V2</a> 协议开源。
Activiti Modeler（Web设计器）使用了另一个开源协议 <a href="http://opensource.org/licenses/LGPL-2.1">LGPL 2.1</a> 。</p>
</div>
</div>
<div class="sect2">
<h3 id="download">1.2. 下载</h3>
<div class="paragraph">
<p><a href="http://activiti.org/download.html"><a href="http://activiti.org/download.html" class="bare">http://activiti.org/download.html</a></a></p>
</div>
</div>
<div class="sect2">
<h3 id="sources">1.3. 源码</h3>
<div class="paragraph">
<p>Activiti的发布包里包含了大部分源码，这些源码是以jar压缩文件提供的。Activiti的源码可以通过以下链接获得：
<a href="https://github.com/Activiti/Activiti"><a href="https://github.com/Activiti/Activiti" class="bare">https://github.com/Activiti/Activiti</a></a></p>
</div>
</div>
<div class="sect2">
<h3 id="required.software">1.4. 必要的软件</h3>
<div class="sect3">
<h4 id="_jdk_6">1.4.1. JDK 6+</h4>
<div class="paragraph">
<p>Activiti需要JDK 6或以上版本。访问 <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Oracle Java SE 下载</a>，点击“下载JDK”按钮。这个页面上有安装指导。安装完成后，执行 <code>java -version</code> 校验安装是否成功。能看到JDK的版本信息就说明安装成功了。</p>
</div>
</div>
<div class="sect3">
<h4 id="_eclipse_indigo_和_juno">1.4.2. Eclipse Indigo 和 Juno</h4>
<div class="paragraph">
<p>到 <a href="http://www.eclipse.org/downloads/">the Eclipse 下载页面</a>选择Eclipse版本并下载。解压下载的文件，然后执行+eclipse+目录下的eclipse文件。手册后续有专门一章介绍如何<a href="#eclipseDesignerInstallation">安装我们的Eclipse Designer插件</a>。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="reporting.problems">1.5. 反馈问题</h3>
<div class="paragraph">
<p>每一个自重的开发者都应该先看看 <a href="http://www.catb.org/~esr/faqs/smart-questions.html">提问的智慧</a> 。</p>
</div>
<div class="paragraph">
<p>看完提问的智慧，你可以在 <a href="http://forums.activiti.org/en/viewforum.php?f=3">用户论坛</a> 提问和评论，也可以在<a href="https://activiti.atlassian.net">我们的 JIRA 问题追踪系统</a>创建问题。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>虽然Activiti托管在GitHub上，但是不建议使用GitHub的问题追踪系统。如果你想报告问题，不要创建GitHub问题（issue），应该使用<a href="https://activiti.atlassian.net">我们的JIRA</a>。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="experimental">1.6. 试验性功能</h3>
<div class="paragraph">
<p>标记<strong>[EXPERIMENTAL]</strong>的章节介绍的功能还不够稳定。</p>
</div>
<div class="paragraph">
<p><code>.impl.</code>包下的类都是内部实现类，不保证稳定。但是，在用户手册中，作为配置参数介绍的类，则是被官方支持的，可以保证稳定。</p>
</div>
</div>
<div class="sect2">
<h3 id="internal">1.7. 内部实现类</h3>
<div class="paragraph">
<p>在jar文件中，所有包名中包含<code>.impl.</code>的类（比如，<code>org.activiti.engine.impl.pvm.delegate</code>）都是内部实现类。实现类中的所有类或接口都不保证稳定。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_开始">2. 开始</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="demo.setup.one.minute.version">2.1. 一分钟入门</h3>
<div class="paragraph">
<p>从<a href="http://www.activiti.org">Activiti website</a>下载Activiti Explorer的WAR文件后，按照以下步骤使用默认设置运行demo。你需要已经安装<a href="http://java.sun.com/javase/downloads/index.jsp">Java runtime</a>与<a href="http://tomcat.apache.org/download-70.cgi">Apache Tomcat</a>（事实上，鉴于我们只使用servlet功能，任何web容器都可以运行。但我们主要在Tomcat上进行测试）。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>将下载的activiti-explorer.war复制到Tomcat的webapps文件夹下。</p>
</li>
<li>
<p>运行Tomcat的bin文件夹下的startup.bat或者startup.sh脚本启动Tomcat。</p>
</li>
<li>
<p>Tomcat启动后，打开浏览器访问<a href="http://localhost:8080/activiti-explorer"><a href="http://localhost:8080/activiti-explorer" class="bare">http://localhost:8080/activiti-explorer</a></a>。使用kermit/kermit登录。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>就是这样！Activiti Explorer应用默认使用H2内存数据库。如果你想使用其他数据库配置，请阅读<a href="#activiti.setup">较长版</a>。</p>
</div>
</div>
<div class="sect2">
<h3 id="activiti.setup">2.2. Activiti安装</h3>
<div class="paragraph">
<p>要安装Activiti, 你需要已经安装<a href="http://java.sun.com/javase/downloads/index.jsp">Java runtime</a>与<a href="http://tomcat.apache.org/download-70.cgi">Apache Tomcat</a>。同时确认 <em>JAVA_HOME</em> 环境变量已经设置正确。该环境变量的设置方法取决于你的操作系统。</p>
</div>
<div class="paragraph">
<p>要运行Activiti Explorer与REST web应用，将你从Activiti下载的WAR文件，复制到Tomcat安装目录下的 <code>webapps</code> 文件夹中。Explorer 应用默认使用内存数据库，示例流程、用户与组。</p>
</div>
<div class="paragraph">
<p>下表列出demo用户：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">用户账号</th>
<th class="tableblock halign-left valign-top">密码</th>
<th class="tableblock halign-left valign-top">安全角色</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kermit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kermit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gonzo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gonzo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">manager</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fozzie</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fozzie</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">user</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>现在你可以访问如下web应用：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Webapp名称</th>
<th class="tableblock halign-left valign-top">URL</th>
<th class="tableblock halign-left valign-top">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Activiti Explorer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:8080/activiti-explorer"><a href="http://localhost:8080/activiti-explorer" class="bare">http://localhost:8080/activiti-explorer</a></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程引擎的用户操作台。使用这个工具来启动新流程、分配任务、查看与接收任务等。这个工具同时可以管理Activiti引擎。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>请注意Activiti Explorer示例配置只是用尽可能简单快捷的方式展现Activiti的能力与功能。这*并不*意味着只有这一种使用Activiti的方式。Activiti只是一个jar，它可以被嵌入到任何Java环境中：swing、Tomcat、JBoss、 WebSphere，等等。你也可以将Activiti作为典型的、独立运行的的BPM服务器。任何在Java里可以做的事情，都可以在Activiti中做！</p>
</div>
</div>
<div class="sect2">
<h3 id="activiti.setup.database">2.3. Activiti数据库配置</h3>
<div class="paragraph">
<p>就像在一分钟示例配置中介绍的，Activiti Explorer默认运行在H2内存数据库上。要让Activiti Explorer使用独立运行的H2数据库或其他数据库，需要修改Activiti Explorer web应用下，WEB-INF/classes目录中的db.properties。</p>
</div>
<div class="paragraph">
<p>另外，请注意Activiti Explorer默认自动生成演示用户、组、流程定义与模型。要禁用这些设置，需要修改WEB-INF/classes目录下的engine.properties文件。要完全禁用示例设置，可以将所有设置项设为false。你也可以单独禁用或启用其中的某些设置。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties"># demo data properties
create.demo.users=true
create.demo.definitions=true
create.demo.models=true
create.demo.reports=true</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="getting.started.including.libs">2.4. 引入Activiti jar与依赖</h3>
<div class="paragraph">
<p>我们建议使用<a href="http://maven.apache.org/">Maven</a>(或者<a href="http://ant.apache.org/ivy/">Ivy</a>)来引入Activiti的jar与依赖库，因为它简化了我们之间的依赖管理。参考<a href="http://www.activiti.org/community.html#maven.repository" class="bare">http://www.activiti.org/community.html#maven.repository</a>中的介绍来将必要的jar引入你的项目。</p>
</div>
<div class="paragraph">
<p>如果不想使用Maven，你也可以自行将jar引入你的项目。从Activiti下载的zip包中的 <code>libs</code> 文件夹，包含所有Activiti的jar（包括源码jar）。依赖并没有通过这种方式发布。Activiti引擎的依赖列表如下（使用<code>mvn dependency:tree</code>生成）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>org.activiti:activiti-engine:jar:5.17.0
+- org.activiti:activiti-bpmn-converter:jar:5.17.0:compile
|  \- org.activiti:activiti-bpmn-model:jar:5.17.0:compile
|     +- com.fasterxml.jackson.core:jackson-core:jar:2.2.3:compile
|     \- com.fasterxml.jackson.core:jackson-databind:jar:2.2.3:compile
|        \- com.fasterxml.jackson.core:jackson-annotations:jar:2.2.3:compile
+- org.activiti:activiti-process-validation:jar:5.17.0:compile
+- org.activiti:activiti-image-generator:jar:5.17.0:compile
+- org.apache.commons:commons-email:jar:1.2:compile
|  +- javax.mail:mail:jar:1.4.1:compile
|  \- javax.activation:activation:jar:1.1:compile
+- org.apache.commons:commons-lang3:jar:3.3.2:compile
+- org.mybatis:mybatis:jar:3.2.5:compile
+- org.springframework:spring-beans:jar:4.0.6.RELEASE:compile
|  \- org.springframework:spring-core:jar:4.0.6.RELEASE:compile
+- joda-time:joda-time:jar:2.6:compile
+- org.slf4j:slf4j-api:jar:1.7.6:compile
+- org.slf4j:jcl-over-slf4j:jar:1.7.6:compile</pre>
</div>
</div>
<div class="paragraph">
<p>注意：只有使用了<a href="#bpmnEmailTask">邮件任务</a>才必须引入邮件依赖jar。</p>
</div>
<div class="paragraph">
<p>所有依赖可以在<a href="https://github.com/Activiti/Activiti">Activiti source code</a>的模块中使用<code>mvn dependency:copy-dependencies</code>下载。</p>
</div>
</div>
<div class="sect2">
<h3 id="getting.started.next.steps">2.5. 下一步</h3>
<div class="paragraph">
<p>使用<a href="#activitiExplorer">Activiti Explorer</a> web应用是一个熟悉Activiti概念与功能的好办法。然而，Activiti的主要目的是用来为你自己的应用添加强大的BPM与工作流功能。下面的章节会帮助你熟悉如何在你的环境中编程使用Activiti：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#configuration">配置章节</a>会教你如何设置Activiti，如何获得<code>ProcessEngine</code>类的实例，他是所有Activiti引擎功能的中心入口。</p>
</li>
<li>
<p><a href="#chapterApi">API章节</a>会带你了解构成Activiti API的服务。这些服务用简便但强大的方式提供了Activiti引擎的功能，可以使用在任何Java环境下。</p>
</li>
<li>
<p>对深入了解Activiti引擎中流程的编写格式，BPMN 2.0，感兴趣吗？请继续浏览<a href="#bpmn20">BPMN 2.0章节</a>。</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_配置_configuration">3. 配置 Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="configuration">3.1. 创建ProcessEngine Creating a ProcessEngine</h3>
<div class="paragraph">
<p>Activiti流程引擎通过名为<code>activiti.cfg.xml</code>的XML文件进行配置。请注意这种方式与<a href="#springintegration">使用Spring创建流程引擎</a><strong>不</strong>一样。</p>
</div>
<div class="paragraph">
<p>获取<code>ProcessEngine</code>，最简单的方式是使用<code>org.activiti.engine.ProcessEngines</code>类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine()</code></pre>
</div>
</div>
<div class="paragraph">
<p>这样会从classpath寻找<code>activiti.cfg.xml</code>，并用这个文件中的配置构造引擎。下面的代码展示了一个配置的例子。后续章节会对配置参数进行详细介绍。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans   http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;

  &lt;bean id="processEngineConfiguration" class="org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration"&gt;

    &lt;property name="jdbcUrl" value="jdbc:h2:mem:activiti;DB_CLOSE_DELAY=1000" /&gt;
    &lt;property name="jdbcDriver" value="org.h2.Driver" /&gt;
    &lt;property name="jdbcUsername" value="sa" /&gt;
    &lt;property name="jdbcPassword" value="" /&gt;

    &lt;property name="databaseSchemaUpdate" value="true" /&gt;

    &lt;property name="jobExecutorActivate" value="false" /&gt;
    &lt;property name="asyncExecutorEnabled" value="true" /&gt;
    &lt;property name="asyncExecutorActivate" value="false" /&gt;

    &lt;property name="mailServerHost" value="mail.my-corp.com" /&gt;
    &lt;property name="mailServerPort" value="5025" /&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意这个配置XML文件实际上是一个Spring配置文件。<strong>但这并不意味着Activiti只能用于Spring环境！</strong>我们只是简单利用Spring内部的解析与依赖注入功能来构造引擎。</p>
</div>
<div class="paragraph">
<p>也可以通过编程方式使用配置文件，来构造ProcessEngineConfiguration对象。也可以使用不同的bean id(例如第3行)。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ProcessEngineConfiguration.createProcessEngineConfigurationFromResourceDefault();
ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(String resource);
ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(String resource, String beanName);
ProcessEngineConfiguration.createProcessEngineConfigurationFromInputStream(InputStream inputStream);
ProcessEngineConfiguration.createProcessEngineConfigurationFromInputStream(InputStream inputStream, String beanName);</code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以不使用配置文件，基于默认创建配置（参考<a href="#configurationClasses">不同的支持类</a>获得更多信息）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ProcessEngineConfiguration.createStandaloneProcessEngineConfiguration();
ProcessEngineConfiguration.createStandaloneInMemProcessEngineConfiguration();</code></pre>
</div>
</div>
<div class="paragraph">
<p>所有的<code>ProcessEngineConfiguration.createXXX()</code>方法都返回<code>ProcessEngineConfiguration</code>，并可以继续按需调整。调用<code>buildProcessEngine()</code>后，生成一个<code>ProcessEngine</code>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ProcessEngine processEngine = ProcessEngineConfiguration.createStandaloneInMemProcessEngineConfiguration()
  .setDatabaseSchemaUpdate(ProcessEngineConfiguration.DB_SCHEMA_UPDATE_FALSE)
  .setJdbcUrl("jdbc:h2:mem:my-own-db;DB_CLOSE_DELAY=1000")
  .setAsyncExecutorEnabled(true)
  .setAsyncExecutorActivate(false)
  .buildProcessEngine();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configurationRoot">3.2. ProcessEngineConfiguration bean</h3>
<div class="paragraph">
<p><code>activiti.cfg.xml</code>文件中必须包含一个id为'processEngineConfiguration'的bean。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;bean id="processEngineConfiguration" class="org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个bean被用于构建<code>ProcessEngine</code>。有多个类可以用于定义<code>processEngineConfiguration</code>。这些类用于不同的环境，并各自设置一些默认值。最佳实践是选择（最）匹配你环境的类，以便减少配置引擎需要的参数。下面列出目前可以使用的类（后续版本会提供更多）：<a id="configurationClasses"></a></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration</strong>：流程引擎独立运行。Activiti自行处理事务。在默认情况下，数据库检查只在引擎启动时进行（如果Activiti表结构不存在或表结构版本不对，会抛出异常）。</p>
</li>
<li>
<p><strong>org.activiti.engine.impl.cfg.StandaloneInMemProcessEngineConfiguration</strong>：这是一个便于使用单元测试的类。Activiti自行处理事务。默认使用H2内存数据库。数据库会在引擎启动时创建，并在引擎关闭时删除。使用这个类时，很可能不需要更多的配置（除了使用任务执行器或邮件功能等时）。</p>
</li>
<li>
<p><strong>org.activiti.spring.SpringProcessEngineConfiguration</strong>：在流程引擎处于Spring环境时使用。查看<a href="#springintegration">Spring集成章节</a>获得更多信息。</p>
</li>
<li>
<p><strong>org.activiti.engine.impl.cfg.JtaProcessEngineConfiguration</strong>：用于引擎独立运行，并使用JTA事务的情况。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="databaseConfiguration">3.3. 数据库配置 Database configuration</h3>
<div class="paragraph">
<p>有两种方式配置Activiti引擎使用的数据库。第一种方式是定义数据库的JDBC参数：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>jdbcUrl</strong>: 数据库的JDBC URL。</p>
</li>
<li>
<p><strong>jdbcDriver</strong>: 特定数据库类型的驱动实现。</p>
</li>
<li>
<p><strong>jdbcUsername</strong>: 用于连接数据库的用户名。</p>
</li>
<li>
<p><strong>jdbcPassword</strong>: 用于连接数据库的密码。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>通过提供的JDBC参数构造的数据源，使用默认的<a href="http://www.mybatis.org/">MyBatis</a>连接池设置。可用下列属性调整这个连接池（来自MyBatis文档）：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>jdbcMaxActiveConnections</strong>: 连接池能够容纳的最大活动连接数量。默认值为10.</p>
</li>
<li>
<p><strong>jdbcMaxIdleConnections</strong>: 连接池能够容纳的最大空闲连接数量。</p>
</li>
<li>
<p><strong>jdbcMaxCheckoutTime</strong>: 连接从连接池“取出”后，被强制返回前的最大时间间隔，单位为毫秒。默认值为20000（20秒）。</p>
</li>
<li>
<p><strong>jdbcMaxWaitTime</strong>: 这是一个底层设置，在连接池获取连接的时间异常长时，打印日志并尝试重新获取连接（避免连接池配置错误造成的永久沉默失败。默认值为20000（20秒）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>数据库配置示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;property name="jdbcUrl" value="jdbc:h2:mem:activiti;DB_CLOSE_DELAY=1000" /&gt;
&lt;property name="jdbcDriver" value="org.h2.Driver" /&gt;
&lt;property name="jdbcUsername" value="sa" /&gt;
&lt;property name="jdbcPassword" value="" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以使用<code>javax.sql.DataSource</code>的实现（例如来自<a href="http://commons.apache.org/dbcp/">Apache Commons</a>的DBCP）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" &gt;
  &lt;property name="driverClassName" value="com.mysql.jdbc.Driver" /&gt;
  &lt;property name="url" value="jdbc:mysql://localhost:3306/activiti" /&gt;
  &lt;property name="username" value="activiti" /&gt;
  &lt;property name="password" value="activiti" /&gt;
  &lt;property name="defaultAutoCommit" value="false" /&gt;
&lt;/bean&gt;

&lt;bean id="processEngineConfiguration" class="org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration"&gt;

    &lt;property name="dataSource" ref="dataSource" /&gt;
    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意Activiti发布时不包括用于定义数据源的库。需要自行把库（例如来自DBCP）放在你的classpath中。</p>
</div>
<div class="paragraph">
<p>无论使用JDBC还是数据源方式配置，下列参数都可以使用：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>databaseType</strong>: 通常不需要专门设置这个参数，因为它可以从数据库连接信息中自动分析得出。只有在自动检测失败时才需要设置。可用值：{h2, mysql, oracle, postgres, mssql, db2}。<strong>不使用默认的H2数据库时需要设置这个参数。</strong>这个选项会决定创建、删除与查询时使用的脚本。查看<a href="#supporteddatabases">“支持的数据库”章节</a>了解我们支持哪些类型的数据库。</p>
</li>
<li>
<p><strong>databaseSchemaUpdate</strong>: 用于设置流程引擎启动关闭时使用的数据库表结构控制策略。</p>
<div class="ulist">
<ul>
<li>
<p><code>false</code> (默认): 当引擎启动时，检查数据库表结构的版本是否匹配库文件版本。版本不匹配时抛出异常。</p>
</li>
<li>
<p><code>true</code>: 构建引擎时，检查并在需要时更新表结构。表结构不存在则会创建。</p>
</li>
<li>
<p><code>create-drop</code>: 引擎创建时创建表结构，并在引擎关闭时删除表结构。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="jndiDatasourceConfig">3.4. JNDI数据源配置 JNDI Datasource Configuration</h3>
<div class="paragraph">
<p>默认情况下，Activiti的数据库配置保存在每个web应用WEB-INF/classes目录下的db.properties文件中。有时这样并不合适，因为这需要用户修改Activiti源码中的db.properties文件并重新编译war包，或者在部署后解开war包并修改db.properties文件。</p>
</div>
<div class="paragraph">
<p>通过使用JNDI（Java Naming and Directory Interface，Java命名和目录接口）获取数据库连接，连接完全由Servlet容器管理，配置也可以在war部署之外进行管理。同时也比db.properties提供了更多控制连接的参数。</p>
</div>
<div class="sect3">
<h4 id="jndi_usage">3.4.1. 使用 Usage</h4>
<div class="paragraph">
<p>要将Activiti Explorer与Activiti Rest web应用从db.properties配置切换至JNDI数据源配置，请打开Spring主配置文件(activiti-webapp-explorer2/src/main/webapp/WEB-INF/activiti-standalone-context.xml与activiti-webapp-rest2/src/main/resources/activiti-context.xml)，并删除名为"dbProperties" 与"dataSource"的bean。然后增加下列bean：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;bean id="dataSource" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
    &lt;property name="jndiName" value="java:comp/env/jdbc/activitiDB"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>接下来我们需要新增context.xml文件，其中包含默认的H2配置。也可以用你自己的的JNDI配置覆盖它。对于Activiti Explorer，用下列文件替换activiti-webapp-explorer2/src/main/webapp/META-INF/context.xml：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;Context antiJARLocking="true" path="/activiti-explorer2"&gt;
    &lt;Resource auth="Container"
              name="jdbc/activitiDB"
              type="javax.sql.DataSource"
              scope="Shareable"
              description="JDBC DataSource"
              url="jdbc:h2:mem:activiti;DB_CLOSE_DELAY=1000"
              driverClassName="org.h2.Driver"
              username="sa"
              password=""
              defaultAutoCommit="false"
              initialSize="5"
              maxWait="5000"
              maxActive="120"
              maxIdle="5"/&gt;
&lt;/Context&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于Activiti REST web应用，新增activiti-webapp-rest2/src/main/webapp/META-INF/context.xml文件，包含下列配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Context antiJARLocking="true" path="/activiti-rest2"&gt;
    &lt;Resource auth="Container"
              name="jdbc/activitiDB"
              type="javax.sql.DataSource"
              scope="Shareable"
              description="JDBC DataSource"
              url="jdbc:h2:mem:activiti;DB_CLOSE_DELAY=-1"
              driverClassName="org.h2.Driver"
              username="sa"
              password=""
              defaultAutoCommit="false"
              initialSize="5"
              maxWait="5000"
              maxActive="120"
              maxIdle="5"/&gt;
&lt;/Context&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>可选步骤，可以删除Activiti Explorer与Activiti REST web应用中无用的db.properties文件。</p>
</div>
</div>
<div class="sect3">
<h4 id="jndi_configuration">3.4.2. 配置 Configuration</h4>
<div class="paragraph">
<p>根据你使用的servlet容器应用不同，配置JNDI数据源的方式也不同。下面的介绍用于Tomcat，对于其他容器应用，请参考对应的文档。</p>
</div>
<div class="paragraph">
<p>Tomcat的JNDI资源配置在$CATALINA_BASE/conf/[enginename]/[hostname]/[warname].xml (对于Activiti Explorer通常会是$CATALINA_BASE/conf/Catalina/localhost/activiti-explorer.xml)。当应用第一次部署时，默认会从Activiti war包中复制context.xml。所以如果存在这个文件则需要替换。例如，如果需要将JNDI资源修改为应用连接MySQL而不是H2，按照下列修改文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
    &lt;Context antiJARLocking="true" path="/activiti-explorer2"&gt;
        &lt;Resource auth="Container"
            name="jdbc/activitiDB"
            type="javax.sql.DataSource"
            description="JDBC DataSource"
            url="jdbc:mysql://localhost:3306/activiti"
            driverClassName="com.mysql.jdbc.Driver"
            username="sa"
            password=""
            defaultAutoCommit="false"
            initialSize="5"
            maxWait="5000"
            maxActive="120"
            maxIdle="5"/&gt;
        &lt;/Context&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="supporteddatabases">3.5. 支持的数据库 Supported databases</h3>
<div class="paragraph">
<p>下面列出Activiti指定的数据库类型（区分大小写！）。</p>
</div>
<table id="databaseTypes" class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Activiti数据库类型</th>
<th class="tableblock halign-left valign-top">示例JDBC URL</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">h2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:h2:tcp://localhost/activiti</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">默认配置的数据库</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mysql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:mysql://localhost:3306/activiti?autoReconnect=true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">已使用mysql-connector-java数据库驱动测试</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">oracle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:oracle:thin:@localhost:1521:xe</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">postgres</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:postgresql://localhost:5432/activiti</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">db2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:db2://localhost:50000/activiti</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mssql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:sqlserver://localhost:1433;databaseName=activiti (jdbc.driver=com.microsoft.sqlserver.jdbc.SQLServerDriver) <em>OR</em> jdbc:jtds:sqlserver://localhost:1433/activiti (jdbc.driver=net.sourceforge.jtds.jdbc.Driver)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">已使用Microsoft JDBC Driver 4.0 (sqljdbc4.jar)与JTDS Driver测试</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="creatingDatabaseTable">3.6. 创建数据库表 Creating the database tables</h3>
<div class="paragraph">
<p>在你的数据库中创建标的最简单方法是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在classpath中增加activiti-engine jar</p>
</li>
<li>
<p>增加合适的数据库驱动</p>
</li>
<li>
<p>在classpath中增加Activiti配置文件(<em>activiti.cfg.xml</em>)，指向你的数据库(参考<a href="#databaseConfiguration">数据库配置</a>)</p>
</li>
<li>
<p>执行<em>DbSchemaCreate</em>类的main方法</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>然而，通常只有数据库管理员可以在数据库中执行DDL语句，在生产环境中这也是最明智的选择。DDL的SQL脚本可以在Activiti下载页面或Activiti发布目录中找到，位于<code>database</code>子目录。引擎jar (<em>activiti-engine-x.jar</em>)的<em>org/activiti/db/create</em>包中也有一份(<em>drop</em>目录存放删除脚本)。SQL文件的格式为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>activiti.{db}.{create|drop}.{type}.sql</pre>
</div>
</div>
<div class="paragraph">
<p><em>db</em>为<a href="#supporteddatabases">支持的数据库</a>，而<em>type</em>为</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>engine:</strong> 引擎执行所需的表，必需。</p>
</li>
<li>
<p><strong>identity:</strong> 存储用户、组、用户与组关系的表。这些表是可选的，但在使用引擎自带的默认身份管理时需要使用。</p>
</li>
<li>
<p><strong>history:</strong> 存储历史与审计信息的表。当历史级别设置为<em>none</em>时不需要。请注意不使用这些表会导致部分使用历史数据的功能失效（如任务备注）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>MySQL用户请注意：</strong>低于5.6.4的MySQL版本不支持timestamps或包含毫秒精度的日期。更糟的是部分版本会在创建类似的列时抛出异常，而另一些版本则不会。当使用自动创建/升级时，引擎在执行时会自动修改DDL语句。当使用DDL文件方式建表时，可以使用通用版本，或使用文件名包含<em>mysql55</em>的特殊版本（用于5.6.4以下的任何版本）。特殊版本的文件中不会使用毫秒精度的列类型。</p>
</div>
<div class="paragraph">
<p>具体地说，对于MySQL的版本：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>&lt;5.6:</strong> 不支持毫秒精度。可以使用DDL文件（使用包含<em>mysql55</em>的文件）。可以使用自动创建/升级。</p>
</li>
<li>
<p><strong>5.6.0 - 5.6.3:</strong> 不支持毫秒精度。<strong>不</strong>可以使用自动创建/升级。建议升级为较新版本的数据库。如果确实需要，可以使用包含<em>mysql55</em>的DDL文件。</p>
</li>
<li>
<p><strong>5.6.4+:</strong> 支持毫秒精度。可以使用DDL文件（默认的包含<em>mysql</em>的文件）。可以使用自动创建/升级。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>请注意在Activiti表已经创建/升级后，更新MySQL数据库，则需要手工修改列类型！</p>
</div>
</div>
<div class="sect2">
<h3 id="database.tables.explained">3.7. 数据库表名说明 Database table names explained</h3>
<div class="paragraph">
<p>Activiti的所有数据库表都以<strong>ACT_</strong>开头。第二部分是说明表用途的两字符标示符。服务API的命名也大略符合这个规则。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ACT_RE_</strong>*: 'RE&#8217;代表<code>repository</code>。带有这个前缀的表包含“静态”信息，例如流程定义与流程资源（图片、规则等）。</p>
</li>
<li>
<p><strong>ACT_RU_</strong>*: 'RU&#8217;代表<code>runtime</code>。这些表存储运行时信息，例如流程实例（process instance）、用户任务（user task）、变量（variable）、作业（job）等。Activiti只在流程实例运行中保存运行时数据，并在流程实例结束时删除记录。这样保证运行时表小和快。</p>
</li>
<li>
<p><strong>ACT_ID_</strong>*: 'ID&#8217;代表<code>identity</code>。这些表包含身份信息，例如用户、组等。</p>
</li>
<li>
<p><strong>ACT_HI_</strong>*: 'HI&#8217;代表<code>history</code>。这些表存储历史数据，例如已完成的流程实例、变量、任务等。</p>
</li>
<li>
<p><strong>ACT_GE_</strong>*: 通用数据。用于不同场景下。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="databaseUpgrade">3.8. 数据库升级 Database upgrade</h3>
<div class="paragraph">
<p>在升级前，请确保你已经（使用数据库的备份功能）备份了数据库。</p>
</div>
<div class="paragraph">
<p>默认情况下，每次流程引擎创建时会进行版本检查，通常是在你的应用或者Activiti web应用启动的时候。如果Activiti库发现库版本与Activiti数据库表版本不同，会抛出异常。</p>
</div>
<div class="paragraph">
<p>要进行升级，首先需要将下列配置参数放入你的activiti.cfg.xml配置文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;beans &gt;

  &lt;bean id="processEngineConfiguration" class="org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration"&gt;
    &lt;!-- ... --&gt;
    &lt;property name="databaseSchemaUpdate" value="true" /&gt;
    &lt;!-- ... --&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>同时，在classpath中加上合适的数据库驱动。</strong>升级你应用中的Activiti库，或者启动一个新版本的Activiti，并将它指向旧版本的数据库。将<code>databaseSchemaUpdate</code>设置为<code>true</code>。当Activiti发现库与数据库表结构不同步时，会自动将数据库表结构升级至新版本。</p>
</div>
<div class="paragraph">
<p><strong>你还可以直接运行升级DDL语句</strong>，也可以从Activiti下载页面获取升级数据库脚本并运行。</p>
</div>
</div>
<div class="sect2">
<h3 id="jobExecutorConfiguration">3.9. 作业执行器与异步执行器（从5.17.0版本起） Job Executor and Async Executor (since version 5.17.0)</h3>
<div class="paragraph">
<p>从5.17.0版本开始，在作业执行器之外，Activiti还提供了异步执行器。Activiti引擎可以通过它，以性能更好，也对数据库更友好的方式执行异步作业。</p>
</div>
<div class="paragraph">
<p>此外，如果在Java EE 7下运行，容器还可以使用符合JSR-236标准的<code>ManagedJobExecutor</code>与<code>ManagedAsyncJobExecutor</code>来管理线程。要启用这个功能，需要在配置中如下加入线程工厂：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;bean id="threadFactory" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
   &lt;property name="jndiName" value="java:jboss/ee/concurrency/factory/default" /&gt;
&lt;/bean&gt;

&lt;bean id="customJobExecutor" class="org.activiti.engine.impl.jobexecutor.ManagedJobExecutor"&gt;
   &lt;!-- ... --&gt;
   &lt;property name="threadFactory" ref="threadFactory" /&gt;
   &lt;!-- ... --&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果没有设置线程工厂，上述两个managedxx类都会退化为默认实现（非managed版本）。</p>
</div>
</div>
<div class="sect2">
<h3 id="_启用作业执行器_job_executor_activation">3.10. 启用作业执行器 Job executor activation</h3>
<div class="paragraph">
<p><code>JobExecutor</code>是管理一组线程的组件，这些线程用于触发定时器（包括后续的异步消息）。在单元测试场景下，使用多线程会很笨重。因此API提供<code>ManagementService.createJobQuery</code>用于查询，以及<code>ManagementService.executeJob</code>用于执行作业。这样作业的执行就可以在单元测试内部控制。为了避免作业执行器的干扰，可以将它关闭。</p>
</div>
<div class="paragraph">
<p>默认情况下，<code>JobExecutor</code>在流程引擎启动时激活。当你不希望<code>JobExecutor</code>随流程引擎启动时，设置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;property name="jobExecutorActivate" value="false" /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_启用异步执行器_async_executor_activation">3.11. 启用异步执行器 Async executor activation</h3>
<div class="paragraph">
<p><code>AsyncExecutor</code>是管理线程池的组件，这个线程池用于触发定时器与异步任务。</p>
</div>
<div class="paragraph">
<p>默认情况下，由于历史原因，当使用<code>JobExecutor</code>时，<code>AsyncExecutor</code>不生效。然而我们建议使用新的<code>AsyncExecutor</code>代替<code>JobExecutor</code>，通过定义两个参数实现</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;property name="asyncExecutorEnabled" value="true" /&gt;
&lt;property name="asyncExecutorActivate" value="true" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>asyncExecutorEnabled参数用于启用异步执行器，代替老的作业执行器。
第二个参数asyncExecutorActivate命令Activiti引擎在启动时启动异步执行器线程池。</p>
</div>
</div>
<div class="sect2">
<h3 id="mailServerConfiguration">3.12. 配置邮件服务器 Mail server configuration</h3>
<div class="paragraph">
<p>配置邮件服务器是可选的。Activiti支持在业务流程中发送电子邮件。发送电子邮件需要配置有效的SMTP邮件服务器。查看<a href="#bpmnEmailTaskServerConfiguration">电子邮件任务</a>了解配置选项。</p>
</div>
</div>
<div class="sect2">
<h3 id="historyConfiguration">3.13. 配置历史 History configuration</h3>
<div class="paragraph">
<p>可以选择自定义历史存储的配置。你可以通过调整配置影响<a href="#history">历史功能</a>。查看<a href="#historyConfig">历史配置</a>了解细节。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;property name="history" value="audit" /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="exposingConfigurationBeans">3.14. 配置在表达式与脚本中暴露的bean Exposing configuration beans in expressions and scripts</h3>
<div class="paragraph">
<p>默认情况下，所有通过<code>activiti.cfg.xml</code>或你自己的Spring配置文件声明的bean，都可以在表达式与脚本中使用。如果你希望限制配置文件中bean的可见性，可以使用流程引擎配置的<code>beans</code>参数。<code>ProcessEngineConfiguration</code>中的<code>beans</code>参数是一个map。当你配置这个参数时，只有在这个map中声明的bean可以在表达式与脚本中使用。bean会使用你在map中指定的名字暴露。</p>
</div>
</div>
<div class="sect2">
<h3 id="processDefinitionCacheConfiguration">3.15. 配置部署缓存 Deployment cache configuration</h3>
<div class="paragraph">
<p>鉴于流程定义信息不会改变，为了避免每次使用流程定义时都读取数据库，所有的流程定义都会（在解析后）被缓存。默认情况下，这个缓存没有限制。要限制流程定义缓存，加上如下的参数</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;property name="processDefinitionCacheLimit" value="10" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>设置这个参数，会将默认的hashmap替换为LRU缓存，以进行限制。当然，参数的“最佳”取值，取决于总的流程定义数量，以及实际使用的流程定义数量。</p>
</div>
<div class="paragraph">
<p>你也可以注入自己的缓存实现。它必须是一个实现了<code>org.activiti.engine.impl.persistence.deploy.DeploymentCache</code>接口的bean：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;property name="processDefinitionCache"&gt;
  &lt;bean class="org.activiti.MyCache" /&gt;
&lt;/property&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>配置规则缓存(rules cache)可以使用类似的名为<code>knowledgeBaseCacheLimit</code>与<code>knowledgeBaseCache</code>的参数。只有在流程中使用规则任务(rules task)时才需要设置。</p>
</div>
</div>
<div class="sect2">
<h3 id="loggingConfiguration">3.16. 日志 Logging</h3>
<div class="paragraph">
<p>自Activiti 5.12版本起，使用SLF4J作为日志框架，替代了之前使用的java.util.logging。所有日志(activiti, spring, mybatis, &#8230;&#8203;)通过SLF4J路由，并允许你自行选择日志实现。</p>
</div>
<div class="paragraph">
<p><strong>默认情况下，Activiti引擎依赖不会提供SFL4J绑定jar。你需要自行将其加入你的项目，以便使用所选的日志框架。</strong>如果没有加入实现jar，SLF4J会使用NOP-logger。这时除了一条警告外，任何日志都不会记录。可以从<a href="http://www.slf4j.org/codes.html#StaticLoggerBinder"><a href="http://www.slf4j.org/codes.html#StaticLoggerBinder" class="bare">http://www.slf4j.org/codes.html#StaticLoggerBinder</a></a>获取关于绑定的更多信息。</p>
</div>
<div class="paragraph">
<p>使用Maven可以添加类似这样（这里使用log4j）的依赖，请注意你还需要加上版本：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
  &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>activiti-explorer与activiti-rest web应用配置为使用Log4j绑定。所有的activiti-*模块运行测试时也会使用Log4j。</p>
</div>
<div class="paragraph">
<p><strong>重要提示：当使用classpath中带有commons-logging的容器时：</strong>为了将spring的日志路由至SLF4j，需要使用桥接（参考<a href="http://www.slf4j.org/legacy.html#jclOverSLF4J"><a href="http://www.slf4j.org/legacy.html#jclOverSLF4J" class="bare">http://www.slf4j.org/legacy.html#jclOverSLF4J</a></a>）。如果你的容器提供了commons-logging实现，请按照<a href="http://www.slf4j.org/codes.html#release"><a href="http://www.slf4j.org/codes.html#release" class="bare">http://www.slf4j.org/codes.html#release</a></a>页面的指示来保证稳定性。</p>
</div>
<div class="paragraph">
<p>使用Maven的示例（省略了版本）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
  &lt;artifactId&gt;jcl-over-slf4j&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="MDC">3.17. 映射诊断上下文 Mapped Diagnostic Contexts</h3>
<div class="paragraph">
<p>从5.13版本开始，Activiti支持SLF4J的映射诊断上下文特性。与需要日志记录的信息一起，下列基本信息也会传递给底层日志记录器：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>processDefinition Id 作为 mdcProcessDefinitionID</p>
</li>
<li>
<p>processInstance Id 作为 mdcProcessInstanceID</p>
</li>
<li>
<p>execution Id 作为 mdcExecutionId</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>默认情况下这些信息都不会被日志记录，但可以通过配置日志记录器，以使用想要的格式，与其他日志信息一起显示。例如在log4j中进行如下简单的布局定义，就可以让日志记录器显示上述信息：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties"> log4j.appender.consoleAppender.layout.ConversionPattern=ProcessDefinitionId=%X{mdcProcessDefinitionID} executionId=%X{mdcExecutionId} mdcProcessInstanceID=%X{mdcProcessInstanceID} mdcBusinessKey=%X{mdcBusinessKey} %m%n</code></pre>
</div>
</div>
<div class="paragraph">
<p>在系统任务很关键的情况下这很有用，可以通过例如日志分析器进行日志的严格检查。</p>
</div>
</div>
<div class="sect2">
<h3 id="eventDispatcher">3.18. 事件处理器 Event handlers</h3>
<div class="paragraph">
<p>Activiti 5.15引入了事件机制。它可以让你在引擎中发生多种事件的时候得到通知。查看<a href="#eventDispatcherEventTypes">所有支持的事件类型</a>了解可用的事件。</p>
</div>
<div class="paragraph">
<p>可以只为特定种类的事件注册监听器，而不是在任何类型的事件发送时都被通知。可以<a href="#eventDispatcherConfiguration">通过配置</a>增加引擎全局的事件监听器，<a href="#eventDispatcherConfigurationRuntime">在运行时通过API</a>增加引擎全局的事件监听器，也可以 <a href="#eventDispatcherConfigurationProcessDefinition">在BPMN XML文件为个别流程定义</a>增加事件监听器。.</p>
</div>
<div class="paragraph">
<p>所有被分发的事件都是<code>org.activiti.engine.delegate.event.ActivitiEvent</code>的子类。事件（在可用时）提供<code>type</code>, <code>executionId</code>, <code>processInstanceId</code>与<code>processDefinitionId</code>。部分事件含有关于发生事件的上下文信息。关于事件包含的附加信息，请参阅<a href="#eventDispatcherEventTypes">所有支持的事件类型</a>。</p>
</div>
<div class="sect3">
<h4 id="eventDispatcherListener">3.18.1. 事件监听器实现 Event listener implementation</h4>
<div class="paragraph">
<p>对事件监听器的唯一要求，是要实现<code>org.activiti.engine.delegate.event.ActivitiEventListener</code>接口。下面是一个监听器实现的例子，它将接收的所有事件打印至标准输出，并对作业执行相关的事件特别处理。：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class MyEventListener implements ActivitiEventListener {

  @Override
  public void onEvent(ActivitiEvent event) {
    switch (event.getType()) {

      case JOB_EXECUTION_SUCCESS:
        System.out.println("A job well done!");
        break;

      case JOB_EXECUTION_FAILURE:
        System.out.println("A job has failed...");
        break;

      default:
        System.out.println("Event received: " + event.getType());
    }
  }

  @Override
  public boolean isFailOnException() {
    // onEvent方法中的逻辑并不重要，日志失败异常可以被忽略……
    return false;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>isFailOnException()</code>方法决定了当事件分发后，<code>onEvent(..)</code>方法抛出异常时的行为。若返回<code>false</code>，忽略异常；返回<code>true</code>，异常不会被忽略而会被上抛，使当前执行的命令失败。如果事件是API调用（或其他事务操作，例如作业执行）的一部分，事务将被回滚。如果事件监听器中并不是重要的业务操作，建议返回<code>false</code>。</p>
</div>
<div class="paragraph">
<p>Activiti提供了少量基础实现，以简化常用的事件监听器用例。它们可以被用作监听器的示例或基类：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>org.activiti.engine.delegate.event.BaseEntityEventListener</strong>: 事件监听器基类，可用来监听实体（entity）相关事件，特定或所有实体的事件都可以。它隐藏了类型检测，提供了4个需要覆盖的方法：<code>onCreate(..)</code>, <code>onUpdate(..)</code>与<code>onDelete(..)</code>在实体创建、更新及删除时调用；对所有其他实体相关事件，<code>onEntityEvent(..)</code>会被调用。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="eventDispatcherConfiguration">3.18.2. 配置与安装 Configuration and setup</h4>
<div class="paragraph">
<p>在流程引擎中配置的事件监听器会在流程引擎启动时生效，引擎重启后也会保持有效。</p>
</div>
<div class="paragraph">
<p><code>eventListeners</code>参数配置为<code>org.activiti.engine.delegate.event.ActivitiEventListener</code>实例的列表(list)。与其他地方一样，你可以声明内联bean定义，也可以用<code>ref</code>指向已有的bean。下面的代码片段在配置中增加了一个事件监听器，无论任何类型的事件分发时，都会得到通知：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;bean id="processEngineConfiguration" class="org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration"&gt;
    ...
    &lt;property name="eventListeners"&gt;
      &lt;list&gt;
         &lt;bean class="org.activiti.engine.example.MyEventListener" /&gt;
      &lt;/list&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>要在特定类型的事件分发时得到通知，使用<code>typedEventListeners</code>参数，取值为map。map的key为逗号分隔的事件名字列表（或者一个事件的名字），取值为<code>org.activiti.engine.delegate.event.ActivitiEventListener</code>实例的列表。下面的代码片段在配置中增加了一个事件监听器，它会在作业执行成功或失败时得到通知：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;bean id="processEngineConfiguration" class="org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration"&gt;
    ...
    &lt;property name="typedEventListeners"&gt;
      &lt;map&gt;
        &lt;entry key="JOB_EXECUTION_SUCCESS,JOB_EXECUTION_FAILURE" &gt;
          &lt;list&gt;
            &lt;bean class="org.activiti.engine.example.MyJobEventListener" /&gt;
          &lt;/list&gt;
        &lt;/entry&gt;
      &lt;/map&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>事件分发的顺序由加入监听器的顺序决定。首先，所有普通(<code>eventListeners</code>参数定义的)事件监听器按照他们在<code>list</code>里的顺序被调用；之后，如果某类型的事件被分发，则该类型(<code>typedEventListeners</code> 参数定义的)监听器被调用。</p>
</div>
</div>
<div class="sect3">
<h4 id="eventDispatcherConfigurationRuntime">3.18.3. 在运行时增加监听器 Adding listeners at runtime</h4>
<div class="paragraph">
<p>可以使用API(<code>RuntimeService</code>)为引擎增加或删除额外的事件监听器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/**
 * 新增一个监听器，分发器会在所有事件分发时通知。
 * @param listenerToAdd 要新增的监听器
 */
void addEventListener(ActivitiEventListener listenerToAdd);

/**
 * 新增一个监听器，在给定类型的事件发生时被通知。
 * @param listenerToAdd 要新增的监听器
 * @param types 监听器需要监听的事件类型
 */
void addEventListener(ActivitiEventListener listenerToAdd, ActivitiEventType... types);

/**
 * 从分发器中移除给定监听器。该监听器不再被通知，无论该监听器注册为监听何种类型。
 * @param listenerToRemove 要移除的监听器
 */
 void removeEventListener(ActivitiEventListener listenerToRemove);</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，运行时新增的监听器<strong>在引擎重启后不会保持。</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="eventDispatcherConfigurationProcessDefinition">3.18.4. 为流程定义增加监听器 Adding listeners to process definitions</h4>
<div class="paragraph">
<p>可以为某一流程定义增加监听器。只有与该流程定义相关，或使用该流程定义启动的流程实例相关的事件，才会调用这个监听器。监听器实现可以用完全限定类名（fully qualified classname）定义；也可以定义为表达式，该表达式能被解析为实现监听器接口的bean；也可以配置为抛出消息（message）/信号（signal）/错误（error）的BPMN事件。</p>
</div>
<div class="sect4">
<h5 id="_执行用户定义逻辑的监听器_listeners_executing_user_defined_logic">执行用户定义逻辑的监听器 Listeners executing user-defined logic</h5>
<div class="paragraph">
<p>下面的代码片段为流程定义增加了2个监听器。第一个监听器接收任何类型的事件，使用完全限定类名定义。第二个监听器只在作业成功执行或失败时被通知，使用流程引擎配置中<code>beans</code>参数定义的bean作为监听器。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;process id="testEventListeners"&gt;
  &lt;extensionElements&gt;
    &lt;activiti:eventListener class="org.activiti.engine.test.MyEventListener" /&gt;
    &lt;activiti:eventListener delegateExpression="${testEventListener}" events="JOB_EXECUTION_SUCCESS,JOB_EXECUTION_FAILURE" /&gt;
  &lt;/extensionElements&gt;

  ...

&lt;/process&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>实体相关的事件也可以在流程定义中增加监听器，只有在特定实体类型的事件发生时得到通知。下面的代码片段展示了如何设置。可以使用实体的所有（第一个例子）事件，或只使用实体的特定类型（第二个例子）事件。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;process id="testEventListeners"&gt;
  &lt;extensionElements&gt;
    &lt;activiti:eventListener class="org.activiti.engine.test.MyEventListener" entityType="task" /&gt;
    &lt;activiti:eventListener delegateExpression="${testEventListener}" events="ENTITY_CREATED" entityType="task" /&gt;
  &lt;/extensionElements&gt;

  ...

&lt;/process&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>entityType</code>可用的值有：<code>attachment</code>（附件）, <code>comment</code>（备注）, <code>execution</code>（执行）, <code>identity-link</code>（认证关系）, <code>job</code>（作业）, <code>process-instance</code>（流程实例）, <code>process-definition</code>（流程定义）, <code>task</code>（任务）。</p>
</div>
</div>
<div class="sect4">
<h5 id="_抛出bpmn事件的监听器_listeners_throwing_bpmn_events">抛出BPMN事件的监听器 Listeners throwing BPMN events</h5>
<div class="paragraph">
<p><a href="#experimental">[EXPERIMENTAL]</a></p>
</div>
<div class="paragraph">
<p>处理分发的事件的另一个方法，是抛出BPMN事件。请牢记在心，只有特定种类的Activiti事件类型，抛出BPMN事件才合理。例如，在流程实例被删除时抛出BPMN事件，会导致错误。下面的代码片段展示了如何在流程实例中抛出信号，向外部流程（全局）抛出信号，在流程实例中抛出消息事件，以及在流程实例中抛出错误事件。这里不使用<code>class</code>或<code>delegateExpression</code>，而要使用<code>throwEvent</code>属性，以及一个附加属性，用于指定需要抛出的事件类型。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;process id="testEventListeners"&gt;
  &lt;extensionElements&gt;
    &lt;activiti:eventListener throwEvent="signal" signalName="My signal" events="TASK_ASSIGNED" /&gt;
  &lt;/extensionElements&gt;
&lt;/process&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;process id="testEventListeners"&gt;
  &lt;extensionElements&gt;
    &lt;activiti:eventListener throwEvent="globalSignal" signalName="My signal" events="TASK_ASSIGNED" /&gt;
  &lt;/extensionElements&gt;
&lt;/process&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;process id="testEventListeners"&gt;
  &lt;extensionElements&gt;
    &lt;activiti:eventListener throwEvent="message" messageName="My message" events="TASK_ASSIGNED" /&gt;
  &lt;/extensionElements&gt;
&lt;/process&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;process id="testEventListeners"&gt;
  &lt;extensionElements&gt;
    &lt;activiti:eventListener throwEvent="error" errorCode="123" events="TASK_ASSIGNED" /&gt;
  &lt;/extensionElements&gt;
&lt;/process&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果需要使用额外的逻辑判断是否需要抛出BPMN事件，可以扩展Activiti提供的监听器类。通过在你的子类中覆盖<code>isValidEvent(ActivitiEvent event)</code>，可以阻止抛出BPMN事件。相关的类为<code>org.activiti.engine.test.api.event.SignalThrowingEventListenerTest</code>, <code>org.activiti.engine.impl.bpmn.helper.MessageThrowingEventListener</code>与<code>org.activiti.engine.impl.bpmn.helper.ErrorThrowingEventListener</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_关于流程定义监听器的说明_notes_on_listeners_on_a_process_definition">关于流程定义监听器的说明 Notes on listeners on a process-definition</h5>
<div class="ulist">
<ul>
<li>
<p>事件监听器只能作为<code>extensionElements</code>的子元素，声明在<code>process</code>元素上。不能在个别节点（activity）上定义（事件）监听器。</p>
</li>
<li>
<p><code>delegateExpression</code>中的表达式，与其他表达式（例如在网关中的）不一样，不可以访问执行上下文。只能够引用在流程引擎配置中<code>beans</code>参数定义的bean，或是使用spring（且没有定义beans参数）时，引用任何实现了监听器接口的spring bean。</p>
</li>
<li>
<p>使用监听器的<code>class</code>属性时，只会创建唯一一个该类的实例。请确保监听器实现不依赖于成员变量，或确保多线程/上下文的使用安全。</p>
</li>
<li>
<p>如果<code>events</code>属性使用了不合法的事件类型，或者使用了不合法的<code>throwEvent</code>值，会在流程定义部署时抛出异常（导致部署失败）。如果<code>class</code>或<code>delegateExecution</code>指定了不合法的值（不存在的类，不存在的bean引用，或者代理类没有实现监听器接口），在流程启动（或该流程定义的第一个有效事件分发给这个监听器）时，会抛出异常。请确保引用的类在classpath中，并且保证表达式能够解析为有效的实例。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="eventDispatcherCustomEvents">3.18.5. 通过API分发事件 Dispatching events through API</h4>
<div class="paragraph">
<p>我们通过API提供事件分发机制，可以向任何在引擎中注册的监听器分发自定义事件。建议（但不强制）只分发类型为<code>CUSTOM</code>的<code>ActivitiEvents</code>。可以使用<code>RuntimeService</code>分发事件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/**
 * 将给定事件分发给所有注册监听器。
 * @param event 要分发的事件。
 *
 * @throws ActivitiException 当分发事件发生异常，或者{@link ActivitiEventDispatcher}被禁用。
 * @throws ActivitiIllegalArgumentException 当给定事件不可分发
 */
 void dispatchEvent(ActivitiEvent event);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="eventDispatcherEventTypes">3.18.6. 支持的事件类型 Supported event types</h4>
<div class="paragraph">
<p>下表列出引擎中的所有事件类型。每种类型对应<code>org.activiti.engine.delegate.event.ActivitiEventType</code>中的一个枚举值。</p>
</div>
<table id="eventTypes" class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Supported events</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Event name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Event classes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENGINE_CREATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">本监听器附着的流程引擎已经创建，并可以响应API调用。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENGINE_CLOSED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">本监听器附着的流程引擎已经关闭，不能再对该引擎的进行API调用。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENTITY_CREATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">新的实体已经创建。该实体包含在本事件里。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENTITY_INITIALIZED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">新的实体已经创建并完全初始化。如果任何子实体作为该实体的一部分被创建，本事件会在子实体创建/初始化后触发，与 <code>ENTITY_CREATE</code> 事件相反。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENTITY_UPDATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">实体已经更新。该实体包含在本事件里。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENTITY_DELETED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">实体已经删除。该实体包含在本事件里。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENTITY_SUSPENDED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">实体已经挂起。该实体包含在本事件里。会为ProcessDefinitions（流程定义）, ProcessInstances（流程实例）与Tasks（任务）分发本事件。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENTITY_ACTIVATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">实体已被激活。该实体包含在本事件里。会为ProcessDefinitions, ProcessInstances与Tasks分发本事件。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JOB_EXECUTION_SUCCESS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">作业已经成功执行。该作业包含在本事件里。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JOB_EXECUTION_FAILURE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">作业执行失败。该作业与异常包含在本事件里。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiEntityEvent</code> and <code>org.activiti&#8230;&#8203;ActivitiExceptionEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JOB_RETRIES_DECREMENTED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">作业重试次数已经由于执行失败而减少。该作业包含在本事件里。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TIMER_FIRED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定时器已经被触发。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JOB_CANCELED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">作业已经被取消。该作业包含在本事件里。作业会由于API调用取消，任务完成导致关联的边界定时器取消，也会由于新流程定义的部署而取消。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTIVITY_STARTED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">节点开始执行</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiActivityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTIVITY_COMPLETED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">节点成功完成</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiActivityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTIVITY_CANCELLED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">节点将要取消。节点的取消有三个原因（MessageEventSubscriptionEntity, SignalEventSubscriptionEntity, TimerEntity）。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiActivityCancelledEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTIVITY_SIGNALED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">节点收到了一个信号</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiSignalEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTIVITY_MESSAGE_RECEIVED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">节点收到了一个消息。事件在节点接收消息前分发。消息接收后，会为该节点分发 <code>ACTIVITY_SIGNAL</code> 或 <code>ACTIVITY_STARTED</code> 事件，取决于其类型（边界事件，或子流程启动事件）。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiMessageEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTIVITY_ERROR_RECEIVED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">节点收到了错误事件。在节点实际处理错误前分发。该事件的<code>activityId</code>含有处理错误的节点的引用。如果错误被成功传递，后续会为节点发送 <code>ACTIVITY_SIGNALLED</code> 或 <code>ACTIVITY_COMPLETE</code> 消息。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiErrorEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UNCAUGHT_BPMN_ERROR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">抛出了未捕获的BPMN错误。流程没有该错误的处理器。该事件的<code>activityId</code>为空。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiErrorEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTIVITY_COMPENSATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">节点将要被补偿。该事件包含将要执行补偿的节点id。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiActivityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARIABLE_CREATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">创建了流程变量。本事件包含变量名、取值与关联的执行和任务（若有）。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiVariableEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARIABLE_UPDATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">更新了已有变量。本事件包含变量名、取值与关联的执行和任务（若有）。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiVariableEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARIABLE_DELETED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">删除了已有变量。本事件包含变量名、最后取值与关联的执行和任务（若有）。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiVariableEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TASK_ASSIGNED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任务分派给了用户。该任务包含在本事件里。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TASK_CREATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任务已经创建。本事件在 <code>ENTITY_CREATE</code> 事件之后分发。若该任务是流程的一部分，本事件会在任务监听器执行前触发。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TASK_COMPLETED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任务已经结束。本事件在 <code>ENTITY_DELETE</code> 事件前分发。若该任务是流程的一部分，本事件会在流程前进之前触发，并且会跟随一个 <code>ACTIVITY_COMPLETE</code> 事件，指向代表该任务的节点。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PROCESS_COMPLETED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程完成。在最后一个节点的 <code>ACTIVITY_COMPLETED </code> 事件后分发。当流程实例没有任何路径可以继续时，流程结束。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PROCESS_CANCELLED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程已经被取消。在流程实例从运行时删除前分发。流程实例使用API调用<code>RuntimeService.deleteProcessInstance</code>取消。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiCancelledEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MEMBERSHIP_CREATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用户加入了一个组。本事件包含了相关的用户和组的id。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiMembershipEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MEMBERSHIP_DELETED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用户从一个组中移出。本事件包含了相关的用户和组的id。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiMembershipEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MEMBERSHIPS_DELETED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">组的所有用户将被移出。本事件在用户移出前抛出，因此关联关系仍然可以访问。因为性能原因，不会再为每个被移出的用户抛出 <code>MEMBERSHIP_DELETED</code> 事件。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.activiti&#8230;&#8203;ActivitiMembershipEvent</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>引擎中所有的 <code>ENTITY_\*</code> 事件都与实体关联。下表列出每个实体分发的实体事件：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>ENTITY_CREATED, ENTITY_INITIALIZED, ENTITY_DELETED</code></strong>: Attachment（附件）, Comment（备注）, Deployment（部署）, Execution（执行）, Group（组）, IdentityLink（身份关联）, Job（作业）, Model（模型）, ProcessDefinition（流程定义）, ProcessInstance（流程实例）, Task（任务）, User（用户）.</p>
</li>
<li>
<p><strong><code>ENTITY_UPDATED</code></strong>: Attachment, Deployment, Execution, Group, IdentityLink, Job, Model, ProcessDefinition, ProcessInstance, Task, User.</p>
</li>
<li>
<p><strong><code>ENTITY_SUSPENDED, ENTITY_ACTIVATED</code></strong>: ProcessDefinition, ProcessInstance/Execution, Task.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="eventDispatcherRemarks">3.18.7. 附加信息 Additional remarks</h4>
<div class="paragraph">
<p><strong>监听器只会被通知所在引擎分发的事件。</strong>因此如果你使用不同的引擎，在同一个数据库上运行，只有该监听器注册的引擎生成的事件，会分发给该监听器。其他引擎生成的事件不会分发给这个监听器，不论这些引擎是否运行在同一个JVM下。</p>
</div>
<div class="paragraph">
<p>某些事件类型（与实体相关）暴露了目标实体。按照事件类型的不同，有时实体不能被更新（例如实体已经被删除）。如果可能的话，请使用事件暴露的<code>EngineServices</code>安全操作引擎。即使这样，更新、操作事件中暴露的实体仍然需要小心。</p>
</div>
<div class="paragraph">
<p>历史不会分发实体事件，因为它们都有对应的运行时实体分发事件。</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chapterApi">4. The Activiti API</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="apiEngine">4.1. 流程引擎API与服务 The Process Engine API and services</h3>
<div class="paragraph">
<p>引擎API是与Activiti交互的最常用手段。中心入口是<code>ProcessEngine</code>，像<a href="#configuration">配置章节</a>中介绍的一样，可以使用多种方式创建。使用ProcessEngine，可以获得包含工作流/BPM方法的多种服务。ProcessEngine与服务对象都是线程安全的，因此可以在整个服务器中保存一份引用。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/api.services.png" alt="api.services">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();

RuntimeService runtimeService = processEngine.getRuntimeService();
RepositoryService repositoryService = processEngine.getRepositoryService();
TaskService taskService = processEngine.getTaskService();
ManagementService managementService = processEngine.getManagementService();
IdentityService identityService = processEngine.getIdentityService();
HistoryService historyService = processEngine.getHistoryService();
FormService formService = processEngine.getFormService();</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ProcessEngines.getDefaultProcessEngine()</code>在第一次被调用时将初始化并构建流程引擎，在之后的调用都会返回相同的流程引擎。流程引擎的创建通过<code>ProcessEngines.init()</code>实现，关闭由<code>ProcessEngines.destroy()</code>实现。</p>
</div>
<div class="paragraph">
<p>ProcessEngines会扫描所有<code>activiti.cfg.xml</code>与<code>activiti-context.xml</code>文件。对于所有的<code>activiti.cfg.xml</code>文件，流程引擎会以标准Activiti方式构建：<code>ProcessEngineConfiguration.createProcessEngineConfigurationFromInputStream(inputStream).buildProcessEngine()</code>。对于所有的<code>activiti-context.xml</code>文件，流程引擎会以Spring的方式构建：首先构建Spring应用上下文，然后从该上下文中获取流程引擎。</p>
</div>
<div class="paragraph">
<p>所有的服务都是无状态的。这意味着你可以很容易的在集群环境的多个节点上运行Activiti，使用同一个数据库，而不用担心上一次调用实际在哪台机器上执行。不论在哪里执行，对任何服务的任何调用都是幂等（idempotent）的。</p>
</div>
<div class="paragraph">
<p><strong>RepositoryService</strong>很可能是使用Activiti引擎要用的第一个服务。这个服务提供了管理与控制<code>deployments</code>（部署）与<code>process definitions</code>（流程定义）的操作。在这里简单说明一下，流程定义是BPMN 2.0流程的Java等价副本，展现流程中每一步的结构与行为。<code>deployment</code>是Activiti引擎中的包装单元，一个部署中可以包含多个BPMN 2.0 xml文件，以及其他资源。开发者可以决定在一个部署中包含的内容，可以是单各流程的BPMN 2.0 xml文件，也可以包含多个流程及其相关资源（如&#8217;hr-processes&#8217;部署可以包含所有与人力资源流程相关的的东西）。<code>RepositoryService</code>可用于<code>deploy</code>（部署）这样的包。部署意味着将它上传至引擎，引擎将在储存至数据库之前检查与分析所有的流程。从这里开始，系统知道了这个部署，部署中包含的所有流程都可以启动。</p>
</div>
<div class="paragraph">
<p>此外，这个服务还可以：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>查询引擎已知的部署与流程定义。</p>
</li>
<li>
<p>暂停或激活部署中的某些流程，或整个部署。暂停意味着不能再对它进行操作，激活是其反操作。</p>
</li>
<li>
<p>读取各种资源，比如部署中保存的文件，或者引擎自动生成的流程图。</p>
</li>
<li>
<p>读取POJO版本的流程定义。使用它可以用Java而不是xml的方式检查流程。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>RepositoryService</code>提供的是静态信息（也就是不会改变，至少不会经常改变的信息），而<strong>RuntimeService</strong>就完全相反。它可以启动流程定义的新流程实例。前面介绍过，<code>process definition</code>（流程定义）定义了流程中不同步骤的结构与行为。流程实例则是流程定义的实际执行。同一时刻，一个流程定义通常有多个运行中的实例。<code>RuntimeService</code>也用于读取与存储<code>process variables</code>（流程变量）。流程变量是给定流程持有的数据，可以在流程的许多构造中使用（例如排他网关exclusive gateway 经常使用流程变量决定流程下一步要选择的路径）。<code>RuntimeService</code>还可以用于查询流程实例与执行（execution）。执行代表了BPMN 2.0中的 <code>'token'</code> 概念。通常执行是指向流程实例当前位置的指针。最后，<code>RuntimeService</code>还可以在流程实例等待外部触发时使用，以便流程可以继续运行。流程有许多<code>wait states</code>（暂停状态），<code>RuntimeService</code>服务提供了许多操作用于“通知”流程实例，告知已经接收到外部触发，使流程实例可以继续运行。</p>
</div>
<div class="paragraph">
<p>对于像Activiti这样的BPM引擎来说，核心是需要人类用户实际操作的任务。所有任务相关的东西都组织在<strong>TaskService</strong>中，例如</p>
</div>
<div class="ulist">
<ul>
<li>
<p>查询分派给用户或组的任务</p>
</li>
<li>
<p>创建<em>standalone（独立运行）</em>任务。这是一种没有关联到流程实例的任务。</p>
</li>
<li>
<p>决定任务的执行用户（assignee），或者将用户通过某种方式与任务关联。</p>
</li>
<li>
<p>认领（claim）与完成（complete）任务。认领是指某人决定成为任务的执行用户，也即他将会完成这个任务。完成任务是指“做这个任务要求的工作”，通常是填写某种表单。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>IdentityService</strong>很简单。它用于管理（创建，更新，删除，查询……）组与用户。请重点注意，Activiti实际上在运行时并不做任何用户检查。例如任务可以分派给任何用户，而引擎并不会验证系统中是否存在该用户。这是因为Activiti有时要与LDAP、Active Directory等服务结合使用。</p>
</div>
<div class="paragraph">
<p><strong>FormService</strong>是可选服务。也就是说Activiti没有它也能很好地运行，而不必牺牲任何功能。这个服务引入了<em>start form（开始表单）</em>与<em>task form（任务表单）</em>的概念。 <em>开始表单</em>是在流程实例启动前显示的表单，而<em>任务表单</em>是用户完成任务时显示的表单。Activiti可以在BPMN 2.0流程定义中定义这些表单。表单服务通过简单的方式暴露这些数据。再次重申，表单不一定要嵌入流程定义，因此这个服务是可选的。</p>
</div>
<div class="paragraph">
<p><strong>HistoryService</strong>暴露所有Activiti引擎收集的历史数据。当执行流程时，引擎会保存许多数据（可以配置），例如流程实例启动时间，谁在执行哪个任务，完成任务花费的事件，每个流程实例的执行路径，等等。这个服务主要提供查询这些数据的能力。</p>
</div>
<div class="paragraph">
<p><strong>ManagementService</strong>通常在用Activiti编写用户应用时不需要使用。它可以用于读取数据库表与表原始数据的信息，也提供了对作业（job）的查询与管理操作。Activiti中很多地方都使用作业，例如定时器（timer），异步操作（asynchronous continuation），延时暂停/激活（delayed suspension/activation）等等。后续会详细介绍这些内容。</p>
</div>
<div class="paragraph">
<p>参考<a href="http://activiti.org/javadocs/index.html">javadocs</a>了解服务操作与引擎API的更多信息。</p>
</div>
</div>
<div class="sect2">
<h3 id="_异常策略_exception_strategy">4.2. 异常策略 Exception strategy</h3>
<div class="paragraph">
<p>Activiti的异常基类是<code>org.activiti.engine.ActivitiException</code>，是未检查异常（unchecked exception）。在任何API操作时都可能会抛出这个异常，<a href="http://activiti.org/javadocs/index.html">javadoc</a>记录了每个方法可能发生的异常。例如，从<code>TaskService</code>中摘录：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/**
 * 当任务成功执行时调用。
 * @param taskId 需要完成的任务id，不能为null。
 * @throws ActivitiObjectNotFoundException 若给定id找不到任务。
 */
 void complete(String taskId);</code></pre>
</div>
</div>
<div class="paragraph">
<p>在上例中，如果传递的id找不到任务，会抛出异常。并且，由于javadoc中<strong>明确要求taskId不能为null，因此如果传递了<code>null</code>值，会抛出<code>ActivitiIllegalArgumentException</code>异常</strong>。</p>
</div>
<div class="paragraph">
<p>尽管我们想避免过大的异常层次结构，我们还是添加了下述在特定情况下抛出的异常子类。所有流程执行与API调用中发生的错误，如果不符合下面列出的异常，会统一抛出<code>ActivitiExceptions</code>。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ActivitiWrongDbException</code>: 当Activiti引擎检测到数据库表结构版本与引擎版本不匹配时抛出。</p>
</li>
<li>
<p><code>ActivitiOptimisticLockingException</code>: 当对同一数据实体的并发访问，导致数据存储发生乐观锁时抛出。</p>
</li>
<li>
<p><code>ActivitiClassLoadingException</code>: 当需要载入的类（如JavaDelegates, TaskListeners, &#8230;&#8203;）无法找到，或载入时发生错误时抛出。</p>
</li>
<li>
<p><code>ActivitiObjectNotFoundException</code>: 当请求或要操作的对象不存在时抛出。</p>
</li>
<li>
<p><code>ActivitiIllegalArgumentException</code>: 这个异常说明调用Activiti API时使用了不合法的参数。可能是引擎配置中的不合法值，或者是API调用传递的不合法参数，也可能是流程定义中的不合法值。</p>
</li>
<li>
<p><code>ActivitiTaskAlreadyClaimedException</code>: 当调用<code>taskService.claim(&#8230;&#8203;)</code>，而该任务已经被认领时抛出。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="api.services">4.3. 使用Activiti services(Working with the Activiti services)</h3>
<div class="paragraph">
<p>如前所述，与Activiti引擎交互的方式，是使用<code>org.activiti.engine.ProcessEngine</code>类实例暴露的服务。下面的示例假定你已经有可运行的Activiti环境，也就是说，你可以访问有效的<code>org.activiti.engine.ProcessEngine</code>。如果你只是简单地想尝试下面的代码，可以下载或克隆<a href="https://github.com/Activiti/activiti-unit-test-template">Activiti单元测试模板</a>，导入你的IDE，在<code>org.activiti.MyUnitTest</code>单元测试中增加一个<code>testUserguideCode()</code>方法。</p>
</div>
<div class="paragraph">
<p>这段小教程的最终目标是生成一个业务流程，模拟公司中简单的请假流程：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/api.vacationRequest.png" alt="api.vacationRequest">
</div>
</div>
<div class="sect3">
<h4 id="api.services.deployment">4.3.1. 部署流程 Deploying the process</h4>
<div class="paragraph">
<p>所有有关“静态”数据（例如流程定义）的东西，都可以通过<strong>RepositoryService</strong>访问。从概念上说，所有这种静态数据，都是Activiti引擎“仓库（repository）”中的内容。</p>
</div>
<div class="paragraph">
<p>在<code>src/test/resources/org/activiti/test</code>资源目录（如果没有使用单元测试模板，也可以是其他任何地方）下创建名为<code>VacationRequest.bpmn20.xml</code>的xml文件，写入下列内容。请注意这个章节不会解释例子中用到的xml的结构。如果需要，请先阅读<a href="#bpmn20">BPMN 2.0章节 the BPMN 2.0 chapter</a>了解这种结构。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;definitions id="definitions"
             targetNamespace="http://activiti.org/bpmn20"
             xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:activiti="http://activiti.org/bpmn"&gt;

  &lt;process id="vacationRequest" name="Vacation request"&gt;

    &lt;startEvent id="request" activiti:initiator="employeeName"&gt;
      &lt;extensionElements&gt;
        &lt;activiti:formProperty id="numberOfDays" name="Number of days" type="long" value="1" required="true"/&gt;
        &lt;activiti:formProperty id="startDate" name="First day of holiday (dd-MM-yyy)" datePattern="dd-MM-yyyy hh:mm" type="date" required="true" /&gt;
        &lt;activiti:formProperty id="vacationMotivation" name="Motivation" type="string" /&gt;
      &lt;/extensionElements&gt;
    &lt;/startEvent&gt;
    &lt;sequenceFlow id="flow1" sourceRef="request" targetRef="handleRequest" /&gt;

    &lt;userTask id="handleRequest" name="Handle vacation request" &gt;
      &lt;documentation&gt;
        ${employeeName} would like to take ${numberOfDays} day(s) of vacation (Motivation: ${vacationMotivation}).
      &lt;/documentation&gt;
      &lt;extensionElements&gt;
         &lt;activiti:formProperty id="vacationApproved" name="Do you approve this vacation" type="enum" required="true"&gt;
          &lt;activiti:value id="true" name="Approve" /&gt;
          &lt;activiti:value id="false" name="Reject" /&gt;
        &lt;/activiti:formProperty&gt;
        &lt;activiti:formProperty id="managerMotivation" name="Motivation" type="string" /&gt;
      &lt;/extensionElements&gt;
      &lt;potentialOwner&gt;
        &lt;resourceAssignmentExpression&gt;
          &lt;formalExpression&gt;management&lt;/formalExpression&gt;
        &lt;/resourceAssignmentExpression&gt;
      &lt;/potentialOwner&gt;
    &lt;/userTask&gt;
    &lt;sequenceFlow id="flow2" sourceRef="handleRequest" targetRef="requestApprovedDecision" /&gt;

    &lt;exclusiveGateway id="requestApprovedDecision" name="Request approved?" /&gt;
    &lt;sequenceFlow id="flow3" sourceRef="requestApprovedDecision" targetRef="sendApprovalMail"&gt;
      &lt;conditionExpression xsi:type="tFormalExpression"&gt;${vacationApproved == 'true'}&lt;/conditionExpression&gt;
    &lt;/sequenceFlow&gt;

    &lt;task id="sendApprovalMail" name="Send confirmation e-mail" /&gt;
    &lt;sequenceFlow id="flow4" sourceRef="sendApprovalMail" targetRef="theEnd1" /&gt;
    &lt;endEvent id="theEnd1" /&gt;

    &lt;sequenceFlow id="flow5" sourceRef="requestApprovedDecision" targetRef="adjustVacationRequestTask"&gt;
      &lt;conditionExpression xsi:type="tFormalExpression"&gt;${vacationApproved == 'false'}&lt;/conditionExpression&gt;
    &lt;/sequenceFlow&gt;

    &lt;userTask id="adjustVacationRequestTask" name="Adjust vacation request"&gt;
      &lt;documentation&gt;
        Your manager has disapproved your vacation request for ${numberOfDays} days.
        Reason: ${managerMotivation}
      &lt;/documentation&gt;
      &lt;extensionElements&gt;
        &lt;activiti:formProperty id="numberOfDays" name="Number of days" value="${numberOfDays}" type="long" required="true"/&gt;
        &lt;activiti:formProperty id="startDate" name="First day of holiday (dd-MM-yyy)" value="${startDate}" datePattern="dd-MM-yyyy hh:mm" type="date" required="true" /&gt;
        &lt;activiti:formProperty id="vacationMotivation" name="Motivation" value="${vacationMotivation}" type="string" /&gt;
        &lt;activiti:formProperty id="resendRequest" name="Resend vacation request to manager?" type="enum" required="true"&gt;
          &lt;activiti:value id="true" name="Yes" /&gt;
          &lt;activiti:value id="false" name="No" /&gt;
        &lt;/activiti:formProperty&gt;
      &lt;/extensionElements&gt;
      &lt;humanPerformer&gt;
        &lt;resourceAssignmentExpression&gt;
          &lt;formalExpression&gt;${employeeName}&lt;/formalExpression&gt;
        &lt;/resourceAssignmentExpression&gt;
      &lt;/humanPerformer&gt;
    &lt;/userTask&gt;
    &lt;sequenceFlow id="flow6" sourceRef="adjustVacationRequestTask" targetRef="resendRequestDecision" /&gt;

    &lt;exclusiveGateway id="resendRequestDecision" name="Resend request?" /&gt;
    &lt;sequenceFlow id="flow7" sourceRef="resendRequestDecision" targetRef="handleRequest"&gt;
      &lt;conditionExpression xsi:type="tFormalExpression"&gt;${resendRequest == 'true'}&lt;/conditionExpression&gt;
    &lt;/sequenceFlow&gt;

     &lt;sequenceFlow id="flow8" sourceRef="resendRequestDecision" targetRef="theEnd2"&gt;
      &lt;conditionExpression xsi:type="tFormalExpression"&gt;${resendRequest == 'false'}&lt;/conditionExpression&gt;
    &lt;/sequenceFlow&gt;
    &lt;endEvent id="theEnd2" /&gt;

  &lt;/process&gt;

&lt;/definitions&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>你必须首先部署（deploy）流程，以使Activiti引擎可以识别它。部署意味着引擎会将BPMN 2.0 xml文件解析为可执行的东西，并为部署中包含的每个流程定义创建新的数据库记录。这样，引擎重启后，仍能获取已部署的流程：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();
RepositoryService repositoryService = processEngine.getRepositoryService();
repositoryService.createDeployment()
  .addClasspathResource("org/activiti/test/VacationRequest.bpmn20.xml")
  .deploy();

Log.info("Number of process definitions: " + repositoryService.createProcessDefinitionQuery().count());</code></pre>
</div>
</div>
<div class="paragraph">
<p>在<a href="#chDeployment">部署章节</a>阅读更多部署相关信息。</p>
</div>
</div>
<div class="sect3">
<h4 id="api.services.start.processinstance">4.3.2. 启动流程实例 Starting a process instance</h4>
<div class="paragraph">
<p>向Activiti引擎部署流程定义后，可以用它启动流程实例。每个流程定义都可以有多个流程实例。流程定义就像是“蓝图”，而流程实例在运行时执行它。</p>
</div>
<div class="paragraph">
<p>所有与流程运行时状态相关的东西都可以在<strong>RuntimeService</strong>中找到。启动流程实例有多种不同的方法。在下列代码片段中，使用流程定义xml中定义的key启动流程实例。在启动流程实例时，我们也设置了一些流程变量（process variables），因为第一个用户任务（user task）的描述（description）中的表达式（expression）需要用到它们。流程变量的使用很普遍，因为它们为流程定义的流程实例赋予了意义。流程变量使每个流程实例与其他实例不同。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Map&lt;String, Object&gt; variables = new HashMap&lt;String, Object&gt;();
variables.put("employeeName", "Kermit");
variables.put("numberOfDays", new Integer(4));
variables.put("vacationMotivation", "I'm really tired!");

RuntimeService runtimeService = processEngine.getRuntimeService();
ProcessInstance processInstance = runtimeService.startProcessInstanceByKey("vacationRequest", variables);

// Verify that we started a new process instance
Log.info("Number of process instances: " + runtimeService.createProcessInstanceQuery().count());</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="api.services.tasks">4.3.3. 完成任务 Completing tasks</h4>
<div class="paragraph">
<p>流程启动时，第一步是一个用户任务。这个步骤必须由系统用户操作。一般会提供“待办任务”列出所有需要该用户处理的任务。下面的代码片段展示如何进行这种列表的查询：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// 获取management组的所有任务
TaskService taskService = processEngine.getTaskService();
List&lt;Task&gt; tasks = taskService.createTaskQuery().taskCandidateGroup("management").list();
for (Task task : tasks) {
  Log.info("Task available: " + task.getName());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>我们需要结束这个任务才能使流程实例继续运行。对于Activiti引擎来说，就是<code>complete（完成）</code>这个任务。下面的代码片段展示了如何操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Task task = tasks.get(0);

Map&lt;String, Object&gt; taskVariables = new HashMap&lt;String, Object&gt;();
taskVariables.put("vacationApproved", "false");
taskVariables.put("managerMotivation", "We have a tight deadline!");
taskService.complete(task.getId(), taskVariables);</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在流程实例会继续向下一步进行。在这个例子里，下一步允许雇员填写一个表单，用来修改提交的请假申请。雇员可以重新提交请假申请，这会使流程从开始任务重新开始运行。</p>
</div>
</div>
<div class="sect3">
<h4 id="api.services.suspend">4.3.4. 暂停与激活流程 Suspending and activating a process</h4>
<div class="paragraph">
<p>可以暂停流程定义。当流程定义暂停后，不能再创建新的流程实例（会抛出异常）。使用<code>RepositoryService</code>暂停流程定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">repositoryService.suspendProcessDefinitionByKey("vacationRequest");
try {
  runtimeService.startProcessInstanceByKey("vacationRequest");
} catch (ActivitiException e) {
  e.printStackTrace();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>要重新激活流程定义，可以调用<code>repositoryService.activateProcessDefinitionXXX</code>方法。</p>
</div>
<div class="paragraph">
<p>也可以暂停流程实例。当流程实例暂停后，不能进行流程操作（例如完成任务会抛出异常），作业（如定时器）也不会执行。可以调用<code>runtimeService.suspendProcessInstance</code>暂停流程实例。调用<code>runtimeService.activateProcessInstanceXXX</code>重新激活流程实例。</p>
</div>
</div>
<div class="sect3">
<h4 id="api.services">4.3.5. 扩展阅读 Further reading</h4>
<div class="paragraph">
<p>在前面的章节，我们大致介绍了Acvtiviti的功能。我们会在未来扩展这些内容，覆盖更多的Activiti API。当然，与其他开源项目一样，最好的学习方法是研究代码与阅读Javadocs！</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="queryAPI">4.4. 查询API (Query API)</h3>
<div class="paragraph">
<p>从引擎中查询数据有两种方式：查询API与原生(native)查询。查询API可以使用链式API，通过编程方式进行类型安全的查询。你可以在查询中增加各种条件（所有条件都用做AND逻辑），也可以明确指定排序。下面是示例代码：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">List&lt;Task&gt; tasks = taskService.createTaskQuery()
    .taskAssignee("kermit")
    .processVariableValueEquals("orderId", "0815")
    .orderByDueDate().asc()
    .list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>有时你需要更强力的查询，例如使用OR操作符查询，或者使用查询API不能满足查询条件要求。我们为这种需求提供了原生查询，可以自己写SQL查询。返回类型由使用的查询对象决定，数据也会映射到正确的对象中，如Task, ProcessInstance, Execution&#8230;&#8203;.查询会在数据库中进行，因此你需要使用数据库中定义的表名与列名。这需要了解内部数据结构，因此建议小心使用原生查询。数据库表名可以通过API读取，这样可以将依赖关系减到最小。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">List&lt;Task&gt; tasks = taskService.createNativeTaskQuery()
  .sql("SELECT count(*) FROM " + managementService.getTableName(Task.class) + " T WHERE T.NAME_ = #{taskName}")
  .parameter("taskName", "gonzoTask")
  .list();

long count = taskService.createNativeTaskQuery()
  .sql("SELECT count(*) FROM " + managementService.getTableName(Task.class) + " T1, "
    + managementService.getTableName(VariableInstanceEntity.class) + " V1 WHERE V1.TASK_ID_ = T1.ID_")
  .count();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="apiVariables">4.5. 变量 Variables</h3>
<div class="paragraph">
<p>流程实例按步骤执行时，需要同时也使用一些数据。在Activiti中，这些数据称作<em>variables(变量)</em>，并会存储在数据库中。变量可以用在表达式中（例如在排他网关中用于选择正确的出口路径），用在java服务任务（java service task）中用于调用外部服务（例如为服务调用提供输入或结果存储），等等。</p>
</div>
<div class="paragraph">
<p>流程实例可以拥有变量（称作<em>process variables，流程变量</em>），<em>执行(executions)</em>——流程当前活动节点的指针，以及用户任务也可以拥有变量。流程实例可以持有任意数量的变量，每个变量都存储在<em>ACT_RU_VARIABLE</em>数据库表的一行中。</p>
</div>
<div class="paragraph">
<p>任何<em>startProcessInstanceXXX</em>方法都有一个可选参数，用于在流程实例创建并启动时设置变量。例如，在<em>RuntimeService</em>中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ProcessInstance startProcessInstanceByKey(String processDefinitionKey, Map&lt;String, Object&gt; variables);</code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以在流程执行中加入变量。例如(<em>RuntimeService</em>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">void setVariable(String executionId, String variableName, Object value);
void setVariableLocal(String executionId, String variableName, Object value);
void setVariables(String executionId, Map&lt;String, ? extends Object&gt; variables);
void setVariablesLocal(String executionId, Map&lt;String, ? extends Object&gt; variables);</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意可以为给定执行（请记住流程实例由一颗执行的树tree of executions组成）设置<em>local</em>（局部）变量。局部变量将只在该执行中可见，而对执行树的上层则不可见。这可以用于 数据不应该在流程实例级别传播，或者变量在流程实例的不同路径中有不同的值（例如使用并行路径时）的情况。</p>
</div>
<div class="paragraph">
<p>像下面展示的，可以读取变量。请注意<em>TaskService</em>中有类似的方法。这意味着任务与执行一样，可以持有局部变量，其生存期为任务持续的时间。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Map&lt;String, Object&gt; getVariables(String executionId);
Map&lt;String, Object&gt; getVariablesLocal(String executionId);
Map&lt;String, Object&gt; getVariables(String executionId, Collection&lt;String&gt; variableNames);
Map&lt;String, Object&gt; getVariablesLocal(String executionId, Collection&lt;String&gt; variableNames);
Object getVariable(String executionId, String variableName);
&lt;T&gt; T getVariable(String executionId, String variableName, Class&lt;T&gt; variableClass);</code></pre>
</div>
</div>
<div class="paragraph">
<p>变量通常用于<a href="#bpmnJavaServiceTask">Java代理（Java delegates）</a>, <a href="#apiExpressions">表达式（expressions）</a>, 执行（execution），任务监听器（tasklisteners），脚本（scripts）等等。在这些结构中，提供了当前的<em>execution</em>或<em>task</em>对象，可用于变量的设置、读取。简单示例如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">execution.getVariables();
execution.getVariables(Collection&lt;String&gt; variableNames);
execution.getVariable(String variableName);

execution.setVariables(Map&lt;String, object&gt; variables);
execution.setVariable(String variableName, Object value);</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意也可以使用上例中方法的<em>local</em>（局部变量）版本。</p>
</div>
<div class="paragraph">
<p>由于历史（与向后兼容的）原因，当调用上述任何方法时，引擎实际上会从数据库中取出<strong>所有</strong>变量。也就是说，如果你有10个变量，使用<em>getVariable("myVariable")</em>获取其中的一个，实际上其他9个变量也会从数据库取出并缓存。这并不坏，因为后续的调用可以不必再读取数据库。比如，你的流程定义包含三个连续的服务任务service task（因此它们在同一个数据库事务里），在第一个服务任务里通过一次调用获取全部变量，也许比在每个服务任务里分别获取需要的变量要好。请注意对读取与设置变量<strong>都是这样</strong>。</p>
</div>
<div class="paragraph">
<p>当然，如果使用大量变量，或者你希望精细控制数据库查询与流量，上述做法并不合适。从Activiti 5.17版本起，引入了可以更精细控制的方法。这个方法有一个可选的参数，告诉引擎是否需要在幕后将所有变量读取并缓存：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Map&lt;String, Object&gt; getVariables(Collection&lt;String&gt; variableNames, boolean fetchAllVariables);
Object getVariable(String variableName, boolean fetchAllVariables);
void setVariable(String variableName, Object value, boolean fetchAllVariables);</code></pre>
</div>
</div>
<div class="paragraph">
<p>当<em>fetchAllVariables</em>参数为<em>true</em>时，行为与上面描述的完全一样：读取或设置一个变量时，所有的变量都将被读取并缓存。</p>
</div>
<div class="paragraph">
<p>而在参数值为<em>false</em>时，会使用明确的查询，其他变量不会被读取或缓存。只有指定的变量的值会被缓存，用于后续使用。</p>
</div>
</div>
<div class="sect2">
<h3 id="apiExpressions">4.6. 表达式 Expressions</h3>
<div class="paragraph">
<p>Activiti使用UEL进行表达式解析。UEL代表<em>Unified Expression Language</em>，是EE6规范的一部分（查看<a href="http://docs.oracle.com/javaee/6/tutorial/doc/gjddd.html">EE6规范</a>了解更多信息）。为了在所有环境上支持UEL标准的所有最新特性，我们使用JUEL的修改版本。</p>
</div>
<div class="paragraph">
<p>表达式可以用于例如<a href="#bpmnJavaServiceTaskXML">Java服务任务 Java Service tasks</a>, <a href="#executionListeners">执行监听器 Execution Listeners</a>, <a href="#taskListeners">任务监听器 Task Listeners</a> 与 <a href="#conditionalSequenceFlowXml">条件流 Conditional sequence flows</a>。尽管有值表达式与方法表达式两种表达式，通过Activiti的抽象，使它们都可以在需要<code>expression</code>（表达式）的地方使用。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>值表达式 Value expression</strong>: 解析为一个值。默认情况下，所有流程变量都可以使用。（若使用Spring）所有的Spring bean也可以用在表达式里。例如：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>${myVar}
${myBean.myProperty}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>方法表达式 Method expression</strong>: 注入一个方法，可以带或不带参数。<strong>当注入不带参数的方法时，要确保在方法名后添加空括号（以避免与值表达式混淆）。</strong>传递的参数可以是字面值（literal value），也可以是表达式，它们会被自动解析。例如：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>${printer.print()}
${myBean.addNewOrder('orderName')}
${myBean.doSomething(myVar, execution)}</pre>
</div>
</div>
<div class="paragraph">
<p>请注意，表达式支持解析（包括比较）原始类型（primitive）、bean、list、array（数组）与map。</p>
</div>
<div class="paragraph">
<p>除了所有流程变量外，还有一些默认对象可在表达式中使用：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>execution</code>: 持有进行中执行（execution）额外信息的<code>DelegateExecution</code>。</p>
</li>
<li>
<p><code>task</code>: 持有当前任务（task）额外信息的<code>DelegateTask</code>。<strong>请注意：只在任务监听器的表达式中可用。</strong></p>
</li>
<li>
<p><code>authenticatedUserId</code>: 当前已验证的用户id。如果没有已验证的用户，该变量不可用。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>更多实际使用例子，请查看<a href="#springExpressions">Spring中的表达式 Expressions in Spring</a>, <a href="#bpmnJavaServiceTaskXML">Java服务任务 Java Service tasks</a>, <a href="#executionListeners">执行监听器 Execution Listeners</a>,  <a href="#taskListeners">任务监听器Task Listeners</a>或者<a href="#conditionalSequenceFlowXml">条件流 Conditional sequence flows</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="apiUnitTesting">4.7. 单元测试 Unit testing</h3>
<div class="paragraph">
<p>业务流程是软件项目的必要组成部分，也需要使用测试一般应用逻辑的方法，也就是单元测试，对它们进行测试。Activiti是嵌入式的Java引擎，因此为业务流程编写单元测试就与编写一般的单元测试一样简单。</p>
</div>
<div class="paragraph">
<p>Activiti支持JUnit版本3与4的单元测试风格。按照JUnit 3的风格，必须扩展（extended）<code>org.activiti.engine.test.ActivitiTestCase</code>。它通过保护（protected）成员变量提供对ProcessEngine与服务的访问。在测试的<code>setup()</code>中，processEngine会默认使用classpath中的<code>activiti.cfg.xml</code>资源初始化。如果要指定不同的配置文件，请覆盖<em>getConfigurationResource()</em>方法。当使用相同的配置资源时，流程引擎会静态缓存，用于多个单元测试。</p>
</div>
<div class="paragraph">
<p>通过扩展<code>ActivitiTestCase</code>，你可以使用<code>org.activiti.engine.test.Deployment</code>注解测试方法。在测试运行前，会部署与测试类在同一个包下的格式为<code>testClassName.testMethod.bpmn20.xml</code>的资源文件。在测试结束时，会删除这个部署，包括所有相关的流程实例，任务，等等。也可以使用<code>Deployment</code>注解显式指定,资源位置。查看该类以获得更多信息。</p>
</div>
<div class="paragraph">
<p>综上所述，JUnit 3风格的测试看起来类似：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class MyBusinessProcessTest extends ActivitiTestCase {

  @Deployment
  public void testSimpleProcess() {
    runtimeService.startProcessInstanceByKey("simpleProcess");

    Task task = taskService.createTaskQuery().singleResult();
    assertEquals("My Task", task.getName());

    taskService.complete(task.getId());
    assertEquals(0, runtimeService.createProcessInstanceQuery().count());
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>要使用JUnit 4的风格书写单元测试并达成同样的功能，必须使用<code>org.activiti.engine.test.ActivitiRule</code> Rule。这样能够通过它的getter获得流程引擎与服务。对于<code>ActivitiTestCase</code>（上例），包含<code>Rule</code>就可以使用<code>org.activiti.engine.test.Deployment</code>注解（参见上例解释其用途及配置），并且会自动在classpath中寻找默认配置文件。当使用相同的配置资源时，流程引擎会静态缓存，用于多个单元测试。</p>
</div>
<div class="paragraph">
<p>下面的代码片段展示了JUnit 4风格的测试与<code>ActivitiRule</code>的用法。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class MyBusinessProcessTest {

  @Rule
  public ActivitiRule activitiRule = new ActivitiRule();

  @Test
  @Deployment
  public void ruleUsageExample() {
    RuntimeService runtimeService = activitiRule.getRuntimeService();
    runtimeService.startProcessInstanceByKey("ruleUsage");

    TaskService taskService = activitiRule.getTaskService();
    Task task = taskService.createTaskQuery().singleResult();
    assertEquals("My Task", task.getName());

    taskService.complete(task.getId());
    assertEquals(0, runtimeService.createProcessInstanceQuery().count());
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="apiDebuggingUnitTest">4.8. Debug单元测试(Debugging unit tests)</h3>
<div class="paragraph">
<p>当使用H2内存数据库进行单元测试时，下面的介绍可以让你在debug过程中容易地检查Activiti数据库中的数据。截图来自Eclipse，但原理应该与其他IDE相似。</p>
</div>
<div class="paragraph">
<p>假设我们的单元测试的某处放置了<em>breakpoint</em>（断点）。在Eclipse里可以通过在代码左侧条上双击实现：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/api.test.debug.breakpoint.png" alt="api.test.debug.breakpoint">
</div>
</div>
<div class="paragraph">
<p>如果我们在<em>debug</em>模式（在测试类中右键，选择“Run as”，然后选择“JUnit test”）下运行单元测试，测试进程会在断点处暂停，这样我们就可以在右上窗口中查看测试中的变量。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/api.test.debug.view.png" alt="api.test.debug.view">
</div>
</div>
<div class="paragraph">
<p>要检查Activiti的数据，打开<em>Display</em>窗口（如果没有找到这个窗口，打开 Window&#8594;Show View&#8594;Other，然后选择<em>Display</em>），并键入（可以使用代码补全）<code>org.h2.tools.Server.createWebServer("-web").start()</code></p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/api.test.debug.start.h2.server.png" alt="api.test.debug.start.h2.server">
</div>
</div>
<div class="paragraph">
<p>选中刚键入的行并右键点击。然后选择&#8217;Display'（或者用快捷方式执行）</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/api.test.debug.start.h2.server.2.png" alt="api.test.debug.start.h2.server.2">
</div>
</div>
<div class="paragraph">
<p>现在打开浏览器并访问<a href="http://localhost:8082"><a href="http://localhost:8082" class="bare">http://localhost:8082</a></a>，填入内存数据库的JDBC URL（默认为<code>jdbc:h2:mem:activiti</code>），然后点击connect按钮。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/api.test.debug.h2.login.png" alt="api.test.debug.h2.login">
</div>
</div>
<div class="paragraph">
<p>现在你可以看到Activiti的数据，可以用来理解你的单元测试执行流程的方式是什么，以及为什么这样。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/api.test.debug.h2.tables.png" alt="api.test.debug.h2.tables">
</div>
</div>
</div>
<div class="sect2">
<h3 id="apiProcessEngineInWebApp">4.9. Web应用中的流程引擎 The process engine in a web application</h3>
<div class="paragraph">
<p><code>ProcessEngine</code>是线程安全的类，可以很容易地在多个线程间共享。在web应用中，这意味着可以在容器启动时创建引擎，并在容器关闭时关闭引擎。</p>
</div>
<div class="paragraph">
<p>下面的代码片段展示了如何在纯Servlet环境中，简单的通过<code>ServletContextListener</code>初始化与销毁流程引擎。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class ProcessEnginesServletContextListener implements ServletContextListener {

  public void contextInitialized(ServletContextEvent servletContextEvent) {
    ProcessEngines.init();
  }

  public void contextDestroyed(ServletContextEvent servletContextEvent) {
    ProcessEngines.destroy();
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>contextInitialized</code>方法委托给<code>ProcessEngines.init()</code>。它会在classpath中查找<code>activiti.cfg.xml</code>资源文件，并为每个配置分别创建<code>ProcessEngine</code>（例如多个jar都包含配置文件）。如果在classpath中有多个这样的资源文件，请确保它们都使用不同的名字。需要使用流程引擎时，可以获取通过</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ProcessEngines.getDefaultProcessEngine()</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ProcessEngines.getProcessEngine("myName");</code></pre>
</div>
</div>
<div class="paragraph">
<p>当然，就像<a href="#configuration">配置章节 configuration section</a>中介绍的，还可以使用各种不同的方式创建流程引擎。</p>
</div>
<div class="paragraph">
<p>context-listener的<code>contextDestroyed</code>方法委托给<code>ProcessEngines.destroy()</code>。它会妥善关闭所有已初始化的流程引擎。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="springintegration">5. 集成Spring (Spring integration)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>尽管完全可以脱离Spring使用Activiti，我们仍提供了很多非常好的集成特性，将在这一章节介绍。</p>
</div>
<div class="sect2">
<h3 id="_processenginefactorybean">5.1. ProcessEngineFactoryBean</h3>
<div class="paragraph">
<p><code>ProcessEngine</code>可以被配置为普通的Spring bean。入口是<code>org.activiti.spring.ProcessEngineFactoryBean</code>类。这个bean处理流程引擎配置，并创建流程引擎。这意味着在Spring中，创建与设置参数与<a href="#configuration">配置章节 configuration section</a>中介绍的一样。集成Spring的配置与引擎bean为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;bean id="processEngineConfiguration" class="org.activiti.spring.SpringProcessEngineConfiguration"&gt;
    ...
&lt;/bean&gt;

&lt;bean id="processEngine" class="org.activiti.spring.ProcessEngineFactoryBean"&gt;
  &lt;property name="processEngineConfiguration" ref="processEngineConfiguration" /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意<code>processEngineConfiguration</code> bean现在使用<code>org.activiti.spring.SpringProcessEngineConfiguration</code>类。</p>
</div>
</div>
<div class="sect2">
<h3 id="_事务_transactions">5.2. 事务 Transactions</h3>
<div class="paragraph">
<p>我们会一步一步地解释(Activiti)发行版里，Spring示例中的<code>SpringTransactionIntegrationTest</code>。下面是我们示例中使用的Spring配置文件（SpringTransactionIntegrationTest-context.xml）。下面的小节包含了dataSource（数据源），transactionManager（事务管理器），processEngine（流程引擎）与Activiti引擎服务。</p>
</div>
<div class="paragraph">
<p>将DataSource传递给<code>SpringProcessEngineConfiguration</code>（使用“dataSource”参数）时，Activiti会在内部使用<code>org.springframework.jdbc.datasource.TransactionAwareDataSourceProxy</code>对得到的数据源进行包装（wrap）。这是为了保证从数据源获取的SQL连接与Spring的事务可以协同工作。也就是说不需要在Spring配置中对数据源进行代理（proxy）。尽管仍然可以将<code>TransactionAwareDataSourceProxy</code>传递给<code>SpringProcessEngineConfiguration</code>——在这种情况下，不会再进行包装。</p>
</div>
<div class="paragraph">
<p><strong>请确保如果自行在Spring配置中声明了<code>TransactionAwareDataSourceProxy</code>，不会将它用在已经配置Spring事务的资源上（例如DataSourceTransactionManager与JPATransactionManager就需要未代理的数据源）。</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans   http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd
                           http://www.springframework.org/schema/tx      http://www.springframework.org/schema/tx/spring-tx-3.0.xsd"&gt;

  &lt;bean id="dataSource" class="org.springframework.jdbc.datasource.SimpleDriverDataSource"&gt;
    &lt;property name="driverClass" value="org.h2.Driver" /&gt;
    &lt;property name="url" value="jdbc:h2:mem:activiti;DB_CLOSE_DELAY=1000" /&gt;
    &lt;property name="username" value="sa" /&gt;
    &lt;property name="password" value="" /&gt;
  &lt;/bean&gt;

  &lt;bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt;
    &lt;property name="dataSource" ref="dataSource" /&gt;
  &lt;/bean&gt;

  &lt;bean id="processEngineConfiguration" class="org.activiti.spring.SpringProcessEngineConfiguration"&gt;
    &lt;property name="dataSource" ref="dataSource" /&gt;
    &lt;property name="transactionManager" ref="transactionManager" /&gt;
    &lt;property name="databaseSchemaUpdate" value="true" /&gt;
    &lt;property name="jobExecutorActivate" value="false" /&gt;
  &lt;/bean&gt;

  &lt;bean id="processEngine" class="org.activiti.spring.ProcessEngineFactoryBean"&gt;
    &lt;property name="processEngineConfiguration" ref="processEngineConfiguration" /&gt;
  &lt;/bean&gt;

  &lt;bean id="repositoryService" factory-bean="processEngine" factory-method="getRepositoryService" /&gt;
  &lt;bean id="runtimeService" factory-bean="processEngine" factory-method="getRuntimeService" /&gt;
  &lt;bean id="taskService" factory-bean="processEngine" factory-method="getTaskService" /&gt;
  &lt;bean id="historyService" factory-bean="processEngine" factory-method="getHistoryService" /&gt;
  &lt;bean id="managementService" factory-bean="processEngine" factory-method="getManagementService" /&gt;

...</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个Spring配置文件的余下部分包含了在这个示例中要用到的bean与配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;beans&gt;
  ...
  &lt;tx:annotation-driven transaction-manager="transactionManager"/&gt;

  &lt;bean id="userBean" class="org.activiti.spring.test.UserBean"&gt;
    &lt;property name="runtimeService" ref="runtimeService" /&gt;
  &lt;/bean&gt;

  &lt;bean id="printer" class="org.activiti.spring.test.Printer" /&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用任何Spring的方式创建应用上下文（application context）。在这个例子中，可以使用classpath中的XML资源配置来创建Spring应用上下文：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ClassPathXmlApplicationContext applicationContext = new ClassPathXmlApplicationContext(
	"org/activiti/examples/spring/SpringTransactionIntegrationTest-context.xml");</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者在单元测试中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@ContextConfiguration("classpath:org/activiti/spring/test/transaction/SpringTransactionIntegrationTest-context.xml")</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在就可以获取服务bean，并反射调用(invoke)它们的方法。ProcessEngineFactoryBean会为服务加上额外的拦截器(interceptor)，为Activiti服务方法设置Propagation.REQUIRED事务语义(transaction semantics)。因此，我们可以像这样使用repositoryService部署流程：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">RepositoryService repositoryService =
  (RepositoryService) applicationContext.getBean("repositoryService");
String deploymentId = repositoryService
  .createDeployment()
  .addClasspathResource("org/activiti/spring/test/hello.bpmn20.xml")
  .deploy()
  .getId();</code></pre>
</div>
</div>
<div class="paragraph">
<p>还有另一种方法也可以使用。在这个例子中，userBean.hello()方法被Spring事务包围，Activiti服务方法的调用会加入这个事务。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">UserBean userBean = (UserBean) applicationContext.getBean("userBean");
userBean.hello();</code></pre>
</div>
</div>
<div class="paragraph">
<p>UserBean看起来像这样。请记着在上面的Spring bean配置中，我们已经将repositoryService注入了userBean。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class UserBean {

  /** 已经由Spring注入 */
  private RuntimeService runtimeService;

  @Transactional
  public void hello() {
    // 这里可以在你的领域模型（domain model）中进行事务操作，
    // 它会与Activiti RuntimeService的startProcessInstanceByKey
    // 合并在同一个事务里
    runtimeService.startProcessInstanceByKey("helloProcess");
  }

  public void setRuntimeService(RuntimeService runtimeService) {
    this.runtimeService = runtimeService;
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="springExpressions">5.3. 表达式 Expressions</h3>
<div class="paragraph">
<p>当使用ProcessEngineFactoryBean时，默认BPMN流程中所有的<a href="#apiExpressions">表达式 expressions</a>都可以“看见”所有的Spring bean。通过可以配置的map，可以限制表达式能使用的bean，甚至可以完全禁止表达式使用bean。下面的例子只暴露了一个bean（printer），可以使用“printer”作为key访问。<strong>要完全禁止表达式使用bean，可以将SpringProcessEngineConfiguration的‘beans’参数设为空list。如果不设置‘beans’参数，则上下文中的所有bean都将可以使用。</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;bean id="processEngineConfiguration" class="org.activiti.spring.SpringProcessEngineConfiguration"&gt;
  ...
  &lt;property name="beans"&gt;
    &lt;map&gt;
      &lt;entry key="printer" value-ref="printer" /&gt;
    &lt;/map&gt;
  &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="printer" class="org.activiti.examples.spring.Printer" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在可以在表达式中使用这个暴露的bean了：例如，SpringTransactionIntegrationTest <code>hello.bpmn20.xml</code>展示了如何通过UEL方法表达式(method expression)注入Spring bean：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;definitions id="definitions"&gt;

  &lt;process id="helloProcess"&gt;

    &lt;startEvent id="start" /&gt;
    &lt;sequenceFlow id="flow1" sourceRef="start" targetRef="print" /&gt;

    &lt;serviceTask id="print" activiti:expression="#{printer.printMessage()}" /&gt;
    &lt;sequenceFlow id="flow2" sourceRef="print" targetRef="end" /&gt;

    &lt;endEvent id="end" /&gt;

  &lt;/process&gt;

&lt;/definitions&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>其中<code>Printer</code>为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class Printer {

  public void printMessage() {
    System.out.println("hello world");
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring bean配置（上面已经展示过）为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;beans&gt;
  ...

  &lt;bean id="printer" class="org.activiti.examples.spring.Printer" /&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_自动部署资源_automatic_resource_deployment">5.4. 自动部署资源 Automatic resource deployment</h3>
<div class="paragraph">
<p>集成Spring还提供了部署资源的特殊方式。在流程引擎配置中，可以指定一组资源。当流程引擎被创建时，这些资源都会被扫描并部署。有过滤器用于阻止重复部署。只有当资源确实发生变化时，才会重新部署至Activiti数据库。在Spring容器经常重启（例如测试时）的时候，这很有用。</p>
</div>
<div class="paragraph">
<p>这里有个例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;bean id="processEngineConfiguration" class="org.activiti.spring.SpringProcessEngineConfiguration"&gt;
  ...
  &lt;property name="deploymentResources"
    value="classpath*:/org/activiti/spring/test/autodeployment/autodeploy.*.bpmn20.xml" /&gt;
&lt;/bean&gt;

&lt;bean id="processEngine" class="org.activiti.spring.ProcessEngineFactoryBean"&gt;
  &lt;property name="processEngineConfiguration" ref="processEngineConfiguration" /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>默认情况下，这个配置会将符合这个过滤器的所有资源组织在一起，作为Activiti引擎的一个部署。重复检测过滤器将作用于整个部署，避免重复地部署未改变资源。有时这不是你想要的。例如，如果用这种方式部署了一组资源，即使只有其中的一个资源发生了改变，整个部署都会被认为已经改变，因此这个部署中所有的所有流程定义都会被重新部署。这将导致每个流程定义都会刷新版本号（流程定义id会变化），即使实际上只有一个流程发生了变化。</p>
</div>
<div class="paragraph">
<p>可以使用<code>SpringProcessEngineConfiguration</code>中的额外参数+deploymentMode+，定制部署的选择方式。这个参数定义了在一组符合过滤器的资源中，组织部署的方式。默认这个参数有3个可用值：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>default</code>: 将所有资源组织在一个部署中，整体用于重复检测过滤。这是默认值，在未设置这个参数时也会用这个值。</p>
</li>
<li>
<p><code>single-resource</code>: 为每个资源创建一个单独的部署，并用于重复检测过滤。当你希望单独部署每一个流程定义，并且在它发生变化时创建新的流程定义版本，应该使用这个值。</p>
</li>
<li>
<p><code>resource-parent-folder</code>: 为同一个目录下的资源创建一个单独的部署，并用于重复检测过滤。这个参数值可以为大多数资源创建独立的部署。同时仍可以通过将部分资源放在同一个目录下，将它们组织在一起。这里有一个将<code>deploymentMode</code>设置为<code>single-resource</code>的例子：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;bean id="processEngineConfiguration"
    class="org.activiti.spring.SpringProcessEngineConfiguration"&gt;
  ...
  &lt;property name="deploymentResources" value="classpath*:/activiti/*.bpmn" /&gt;
  &lt;property name="deploymentMode" value="single-resource" /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果上述<code>deploymentMode</code>的参数值不能满足要求，还可以自定义组织部署的行为。创建<code>SpringProcessEngineConfiguration</code>的子类，并覆盖<code>getAutoDeploymentStrategy(String deploymentMode)</code>方法。这个方法决定了对于给定的<code>deploymentMode</code>参数值，使用何种部署策略。</p>
</div>
</div>
<div class="sect2">
<h3 id="springUnitTest">5.5. 单元测试 Unit testing</h3>
<div class="paragraph">
<p>与Spring集成后，业务流程可以非常简单地使用标准的 <a href="#apiUnitTesting">Activiti测试工具 Activiti testing facilities</a>进行测试。下面的例子展示了如何通过典型的基于Spring的单元测试，对业务流程进行测试：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration("classpath:org/activiti/spring/test/junit4/springTypicalUsageTest-context.xml")
public class MyBusinessProcessTest {

  @Autowired
  private RuntimeService runtimeService;

  @Autowired
  private TaskService taskService;

  @Autowired
  @Rule
  public ActivitiRule activitiSpringRule;

  @Test
  @Deployment
  public void simpleProcessTest() {
    runtimeService.startProcessInstanceByKey("simpleProcess");
    Task task = taskService.createTaskQuery().singleResult();
    assertEquals("My Task", task.getName());

    taskService.complete(task.getId());
    assertEquals(0, runtimeService.createProcessInstanceQuery().count());

  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意要让这个例子可以正常工作，需要在Spring配置中定义<em>org.activiti.engine.test.ActivitiRule</em> bean（在上面的例子中通过auto-wiring注入）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;bean id="activitiRule" class="org.activiti.engine.test.ActivitiRule"&gt;
  &lt;property name="processEngine" ref="processEngine" /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_通过hibernate_4_2_x使用jpa_jpa_with_hibernate_4_2_x">5.6. 通过Hibernate 4.2.x使用JPA (JPA with Hibernate 4.2.x)</h3>
<div class="paragraph">
<p>要在Activiti引擎的服务任务或者监听器逻辑中使用Hibernate 4.2.x JPA，需要添加Spring ORM的额外依赖。对Hibernate 4.1.x或更低则不需要。需要添加的依赖为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.springframework&lt;/groupId&gt;
  &lt;artifactId&gt;spring-orm&lt;/artifactId&gt;
  &lt;version&gt;${org.springframework.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="springSpringBoot">5.7. Spring Boot</h3>
<div class="paragraph">
<p>Spring Boot是一个应用框架，按照<a href="http://projects.spring.io/spring-boot/">官网</a>的介绍，可以<em>轻松地创建独立运行的，生产级别的，基于Spring的应用，并且可以“直接运行”。坚持使用Spring框架与第三方库，使你可以轻松地开始使用。大多数Spring Boot应用只需要很少的Spring配置</em>。</p>
</div>
<div class="paragraph">
<p>要获得更多关于Spring Boot的信息，请查阅<a href="http://projects.spring.io/spring-boot/"><a href="http://projects.spring.io/spring-boot/" class="bare">http://projects.spring.io/spring-boot/</a></a></p>
</div>
<div class="paragraph">
<p>Activiti与Spring Boot的集成目前只是试验性的。我们已经与Spring的提交者共同开发，但为时尚早。我们欢迎试用并提供反馈。</p>
</div>
<div class="sect3">
<h4 id="_兼容性_compatibility">5.7.1. 兼容性 Compatibility</h4>
<div class="paragraph">
<p>Spring Boot需要JDK 7运行时环境。可以通过调整配置，在JDK6下运行。请查阅Spring Boot的文档。</p>
</div>
</div>
<div class="sect3">
<h4 id="_开始_getting_started">5.7.2. 开始 Getting started</h4>
<div class="paragraph">
<p>Spring Boot提倡约定大于配置。要开始工作，简单地在你的项目中添加<em>spring-boot-starters-basic</em>依赖。例如在Maven中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
	&lt;groupId&gt;org.activiti&lt;/groupId&gt;
	&lt;artifactId&gt;activiti-spring-boot-starter-basic&lt;/artifactId&gt;
	&lt;version&gt;${activiti.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>就这么简单。这个依赖会自动向classpath添加正确的Activiti与Spring依赖。现在你可以编写Spring Boot应用了：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.EnableAutoConfiguration;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;

@Configuration
@ComponentScan
@EnableAutoConfiguration
public class MyApplication {

    public static void main(String[] args) {
        SpringApplication.run(MyApplication.class, args);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Activiti需要数据库存储数据。如果你运行上面的代码，会得到提示性的异常信息，指出需要在classpath中添加数据库驱动依赖。现在添加H2数据库依赖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
	&lt;groupId&gt;com.h2database&lt;/groupId&gt;
	&lt;artifactId&gt;h2&lt;/artifactId&gt;
	&lt;version&gt;1.4.183&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>应用这次可以启动了。你会看到类似这样的输出：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::        (v1.1.6.RELEASE)

MyApplication                            : Starting MyApplication on ...
s.c.a.AnnotationConfigApplicationContext : Refreshing org.springframework.context.annotation.AnnotationConfigApplicationContext@33cb5951: startup date [Wed Dec 17 15:24:34 CET 2014]; root of context hierarchy
a.s.b.AbstractProcessEngineConfiguration : No process definitions were found using the specified path (classpath:/processes/**.bpmn20.xml).
o.activiti.engine.impl.db.DbSqlSession   : performing create on engine with resource org/activiti/db/create/activiti.h2.create.engine.sql
o.activiti.engine.impl.db.DbSqlSession   : performing create on history with resource org/activiti/db/create/activiti.h2.create.history.sql
o.activiti.engine.impl.db.DbSqlSession   : performing create on identity with resource org/activiti/db/create/activiti.h2.create.identity.sql
o.a.engine.impl.ProcessEngineImpl        : ProcessEngine default created
o.a.e.i.a.DefaultAsyncJobExecutor        : Starting up the default async job executor [org.activiti.spring.SpringAsyncExecutor].
o.a.e.i.a.AcquireTimerJobsRunnable       : {} starting to acquire async jobs due
o.a.e.i.a.AcquireAsyncJobsDueRunnable    : {} starting to acquire async jobs due
o.s.j.e.a.AnnotationMBeanExporter        : Registering beans for JMX exposure on startup
MyApplication                            : Started MyApplication in 2.019 seconds (JVM running for 2.294)</pre>
</div>
</div>
<div class="paragraph">
<p>只是在classpath中添加依赖，并使用<em>@EnableAutoConfiguration</em>注解，就会在幕后发生很多事情：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>自动创建了内存数据库（因为classpath中有H2驱动），并传递给Activiti流程引擎配置</p>
</li>
<li>
<p>创建并暴露了Activiti ProcessEngine bean</p>
</li>
<li>
<p>所有的Activiti服务都暴露为Spring bean</p>
</li>
<li>
<p>创建了Spring Job Executor</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>并且，<em>processes</em>目录下的任何BPMN 2.0流程定义都会被自动部署。创建<em>processes</em>目录，并在其中创建示例流程定义（命名为<em>one-task-process.bpmn20.xml</em>）:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;definitions
        xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
        xmlns:activiti="http://activiti.org/bpmn"
        targetNamespace="Examples"&gt;

    &lt;process id="oneTaskProcess" name="The One Task Process"&gt;
        &lt;startEvent id="theStart" /&gt;
        &lt;sequenceFlow id="flow1" sourceRef="theStart" targetRef="theTask" /&gt;
        &lt;userTask id="theTask" name="my task" /&gt;
        &lt;sequenceFlow id="flow2" sourceRef="theTask" targetRef="theEnd" /&gt;
        &lt;endEvent id="theEnd" /&gt;
    &lt;/process&gt;

&lt;/definitions&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后添加下列代码，以测试部署是否生效。<em>CommandLineRunner</em>是一个特殊的Spring bean，在应用启动时执行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Configuration
@ComponentScan
@EnableAutoConfiguration
public class MyApplication {

    public static void main(String[] args) {
        SpringApplication.run(MyApplication.class, args);
    }

    @Bean
    public CommandLineRunner init(final RepositoryService repositoryService,
                                  final RuntimeService runtimeService,
                                  final TaskService taskService) {

        return new CommandLineRunner() {
            @Override
            public void run(String... strings) throws Exception {
                System.out.println("Number of process definitions : "
                	+ repositoryService.createProcessDefinitionQuery().count());
                System.out.println("Number of tasks : " + taskService.createTaskQuery().count());
                runtimeService.startProcessInstanceByKey("oneTaskProcess");
                System.out.println("Number of tasks after process start: " + taskService.createTaskQuery().count());
            }
        };

    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>会得到这样的输出：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Number of process definitions : 1
Number of tasks : 0
Number of tasks after process start : 1</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_更换数据源与连接池_changing_the_database_and_connection_pool">5.7.3. 更换数据源与连接池 Changing the database and connection pool</h4>
<div class="paragraph">
<p>上面也提到过，Spring Boot的约定大于配置。默认情况下，如果classpath中只有H2，就会创建内存数据库，并传递给Activiti流程引擎配置。</p>
</div>
<div class="paragraph">
<p>可以简单地通过提供Datasource bean来覆盖默认配置，来更换数据源。我们在这里使用<em>DataSourceBuilder</em>类，这是Spring Boot的辅助类。如果classpath中有Tomcat, HikariCP 或者 Commons DBCP，就会（按照这个顺序，先是Tomcat）选择一个（作为连接池）。例如，要切换到MySQL数据库：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Bean
public DataSource database() {
    return DataSourceBuilder.create()
        .url("jdbc:mysql://127.0.0.1:3306/activiti-spring-boot?characterEncoding=UTF-8")
        .username("alfresco")
        .password("alfresco")
        .driverClassName("com.mysql.jdbc.Driver")
        .build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>从Maven依赖中移除H2，并为classpath添加MySQL驱动与Tomcat连接池：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
	&lt;groupId&gt;mysql&lt;/groupId&gt;
	&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
	&lt;version&gt;5.1.34&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
	&lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;
	&lt;artifactId&gt;tomcat-jdbc&lt;/artifactId&gt;
	&lt;version&gt;8.0.15&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>应用这次启动后，可以看到使用了MySQL作为数据库（也使用了Tomcat连接池框架）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>org.activiti.engine.impl.db.DbSqlSession   : performing create on engine with resource org/activiti/db/create/activiti.mysql.create.engine.sql
org.activiti.engine.impl.db.DbSqlSession   : performing create on history with resource org/activiti/db/create/activiti.mysql.create.history.sql
org.activiti.engine.impl.db.DbSqlSession   : performing create on identity with resource org/activiti/db/create/activiti.mysql.create.identity.sql</pre>
</div>
</div>
<div class="paragraph">
<p>多次重启应用，会发现任务的数量增加了（H2内存数据库在关闭后会丢失，而MySQL不会）。</p>
</div>
</div>
<div class="sect3">
<h4 id="_rest支持_rest_support">5.7.4. REST支持 (REST support)</h4>
<div class="paragraph">
<p>通常在嵌入的Activiti引擎之上，需要提供REST API（用于与公司的不同服务交互）。Spring Boot让这变得很容易。在classpath中添加下列依赖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
	&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
	&lt;version&gt;${spring.boot.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>创建一个新的Spring服务类，并创建两个方法：一个用于启动流程，另一个用于获得给定任务办理人的任务列表。在这里我们简单地包装了Activiti调用，但很明显在实际使用场景中会比这复杂得多。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Service
public class MyService {

    @Autowired
    private RuntimeService runtimeService;

    @Autowired
    private TaskService taskService;

	@Transactional
    public void startProcess() {
        runtimeService.startProcessInstanceByKey("oneTaskProcess");
    }

	@Transactional
    public List&lt;Task&gt; getTasks(String assignee) {
        return taskService.createTaskQuery().taskAssignee(assignee).list();
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在可以用<em>@RestController</em>来注解类，以创建REST端点（endpoint）。在这里我们简单地委派给了上面定义的服务。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@RestController
public class MyRestController {

    @Autowired
    private MyService myService;

    @RequestMapping(value="/process", method= RequestMethod.POST)
    public void startProcessInstance() {
        myService.startProcess();
    }

    @RequestMapping(value="/tasks", method= RequestMethod.GET, produces=MediaType.APPLICATION_JSON_VALUE)
    public List&lt;TaskRepresentation&gt; getTasks(@RequestParam String assignee) {
        List&lt;Task&gt; tasks = myService.getTasks(assignee);
        List&lt;TaskRepresentation&gt; dtos = new ArrayList&lt;TaskRepresentation&gt;();
        for (Task task : tasks) {
            dtos.add(new TaskRepresentation(task.getId(), task.getName()));
        }
        return dtos;
    }

    static class TaskRepresentation {

        private String id;
        private String name;

        public TaskRepresentation(String id, String name) {
            this.id = id;
            this.name = name;
        }

         public String getId() {
            return id;
        }
        public void setId(String id) {
            this.id = id;
        }
        public String getName() {
            return name;
        }
        public void setName(String name) {
            this.name = name;
        }

    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>自动组件扫描(<em>@ComponentScan</em>)会找到我们添加在应用类上的<em>@Service</em>与<em>@RestController</em>。再次运行应用类，现在可以与REST API交互了。例如使用cURL：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl http://localhost:8080/tasks?assignee=kermit
[]

curl -X POST  http://localhost:8080/process
curl http://localhost:8080/tasks?assignee=kermit
[{"id":"10004","name":"my task"}]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jpa支持_jpa_support">5.7.5. JPA支持 (JPA support)</h4>
<div class="paragraph">
<p>要为Spring Boot中的Activiti添加JPA支持，增加下列依赖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
	&lt;groupId&gt;org.activiti&lt;/groupId&gt;
	&lt;artifactId&gt;activiti-spring-boot-starter-jpa&lt;/artifactId&gt;
	&lt;version&gt;${activiti.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>这会加入Spring的配置，以及JPA用的bean。默认使用Hibernate作为JPA提供者。</p>
</div>
<div class="paragraph">
<p>创建一个简单的实体类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Entity
class Person {

    @Id
    @GeneratedValue
    private Long id;

    private String username;

    private String firstName;

    private String lastName;

    private Date birthDate;

    public Person() {
    }

    public Person(String username, String firstName, String lastName, Date birthDate) {
        this.username = username;
        this.firstName = firstName;
        this.lastName = lastName;
        this.birthDate = birthDate;
    }

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public String getFirstName() {
        return firstName;
    }

    public void setFirstName(String firstName) {
        this.firstName = firstName;
    }

    public String getLastName() {
        return lastName;
    }

    public void setLastName(String lastName) {
        this.lastName = lastName;
    }

    public Date getBirthDate() {
        return birthDate;
    }

    public void setBirthDate(Date birthDate) {
        this.birthDate = birthDate;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>默认情况下，如果没有使用内存数据库，不会自动创建数据库表。在classpath中创建__application.properties_文件并加入下列参数：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spring.jpa.hibernate.ddl-auto=update</pre>
</div>
</div>
<div class="paragraph">
<p>添加下列类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface PersonRepository extends JpaRepository&lt;Person, Long&gt; {

    Person findByUsername(String username);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这是一个Spring存储(repository)，提供了直接可用的增删改查。我们添加了通过username查找Person的方法。Spring会基于约定自动实现它（也就是使用names属性）。</p>
</div>
<div class="paragraph">
<p>现在进一步增强我们的服务：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在类上添加<em>@Transactional</em>。请注意，通过上面添加的JPA依赖，之前使用的DataSourceTransactionManager会自动替换为JpaTransactionManager。</p>
</li>
<li>
<p><em>startProcess</em>增加了任务办理人参数，用于查找Person，并将Person JPA对象作为流程变量存入流程实例。</p>
</li>
<li>
<p>添加了创建示例用户的方法。CommandLineRunner使用它打桩数据库。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Service
@Transactional
public class MyService {

    @Autowired
    private RuntimeService runtimeService;

    @Autowired
    private TaskService taskService;

    @Autowired
    private PersonRepository personRepository;

    public void startProcess(String assignee) {

        Person person = personRepository.findByUsername(assignee);

        Map&lt;String, Object&gt; variables = new HashMap&lt;String, Object&gt;();
        variables.put("person", person);
        runtimeService.startProcessInstanceByKey("oneTaskProcess", variables);
    }

    public List&lt;Task&gt; getTasks(String assignee) {
        return taskService.createTaskQuery().taskAssignee(assignee).list();
    }

    public void createDemoUsers() {
		 if (personRepository.findAll().size() == 0) {
            personRepository.save(new Person("jbarrez", "Joram", "Barrez", new Date()));
            personRepository.save(new Person("trademakers", "Tijs", "Rademakers", new Date()));
        }
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>CommandLineRunner现在为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Bean
public CommandLineRunner init(final MyService myService) {

	return new CommandLineRunner() {
    	public void run(String... strings) throws Exception {
        	myService.createDemoUsers();
        }
    };

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>RestController也有小改动（只展示新方法），以配合上面的改动。HTTP POST现在有了body，存有办理人用户名：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@RestController
public class MyRestController {

    @Autowired
    private MyService myService;

    @RequestMapping(value="/process", method= RequestMethod.POST)
    public void startProcessInstance(@RequestBody StartProcessRepresentation startProcessRepresentation) {
        myService.startProcess(startProcessRepresentation.getAssignee());
    }

   ...

    static class StartProcessRepresentation {

        private String assignee;

        public String getAssignee() {
            return assignee;
        }

        public void setAssignee(String assignee) {
            this.assignee = assignee;
        }
    }</pre>
</div>
</div>
<div class="paragraph">
<p>最后，为了试用Spring-JPA-Activiti集成，我们在流程定义中，将Person JPA对象的id指派为任务办理人：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;userTask id="theTask" name="my task" activiti:assignee="${person.id}"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在可以通过在POST body中提供用户名，启动一个新的流程实例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -H "Content-Type: application/json" -d '{"assignee" : "jbarrez"}' http://localhost:8080/process</pre>
</div>
</div>
<div class="paragraph">
<p>也可以使用Person id获取任务列表：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl http://localhost:8080/tasks?assignee=1

[{"id":"12505","name":"my task"}]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_扩展阅读_further_reading">5.7.6. 扩展阅读 Further Reading</h4>
<div class="paragraph">
<p>很明显还有很多Spring　Boot相关的内容还没有提及，例如简单的JTA集成，构建能在主流应用服务器上运行的war文件。还有很多关于Spring Boot集成的内容：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Actuator支持</p>
</li>
<li>
<p>Spring Integration支持</p>
</li>
<li>
<p>Rest API集成：启动Spring应用中嵌入的Activiti Rest API</p>
</li>
<li>
<p>Spring Security支持</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>目前这些领域都是初版，未来会不断演进。</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chDeployment">6. 部署 Deployment</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_业务存档_business_archives">6.1. 业务存档 Business archives</h3>
<div class="paragraph">
<p>要部署流程，需要将它们包装在业务存档里。业务存档是Activiti引擎的部署单元，也就是一个zip文件。可以包含BPMN 2.0流程，任务表单，规则，与其他类型的文件。总的来说，业务存档包含一组已命名的资源。</p>
</div>
<div class="paragraph">
<p>当部署业务存档时，会扫描具有<code>.bpmn20.xml</code>或<code>.bpmn</code>扩展名的BPMN文件。每一个这种文件都会被解析，并可以包含多个流程定义。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>业务存档中的Java类<strong>不会添加至classpath</strong>。业务存档中，所有流程定义使用的自定义类（例如Java服务任务service tasks或者事件监听器实现event listener implementations），都应该放在用于运行流程的activiti引擎的classpath下。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_编程方式部署_deploying_programmatically">6.1.1. 编程方式部署 Deploying programmatically</h4>
<div class="paragraph">
<p>从zip文件部署业务存档，可以这样做：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">String barFileName = "path/to/process-one.bar";
ZipInputStream inputStream = new ZipInputStream(new FileInputStream(barFileName));

repositoryService.createDeployment()
    .name("process-one.bar")
    .addZipInputStream(inputStream)
    .deploy();</code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以从不同资源构建部署。查看javadoc获取更多信息。</p>
</div>
</div>
<div class="sect3">
<h4 id="deploymentWithExplorer">6.1.2. 使用Activiti Exploreer部署 (Deploying with Activiti Explorer)</h4>
<div class="paragraph">
<p>Activiti Explorer web应用，可以通过web应用用户界面，上传bar文件（或者单独的<code>bpmn20.xml</code>文件）。选择<em>Management</em>页签并点击<em>Deployment</em>:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/deployment.explorer.png" alt="deployment.explorer">
</div>
</div>
<div class="paragraph">
<p>会弹出窗口，让你选择电脑中的文件，或者（如果你的浏览器支持）可以直接拖放文件到指定区域。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/deployment.explorer.2.png" alt="deployment.explorer.2">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_外部资源_external_resources">6.2. 外部资源 External resources</h3>
<div class="paragraph">
<p>流程定义保存在Activiti数据库中。这些流程定义，在使用服务任务、执行监听器或执行Activiti配置文件中定义的Spring bean时，可以引用委托类。这些类与Spring配置文件，需要对所有可能运行这个流程定义的流程引擎都可用。</p>
</div>
<div class="sect3">
<h4 id="_java类_java_classes">6.2.1. Java类 Java classes</h4>
<div class="paragraph">
<p>所有流程中用到的自定义类（例如服务任务、事件监听器、任务监听器等中，用到的JavaDelegate），在流程启动时，都需要存在于引擎的classpath中。</p>
</div>
<div class="paragraph">
<p>然而在业务存档部署时，classpath中不是必须要有这些类。这意味着使用Ant部署新业务存档时，你的代理类不必须放在classpath中。</p>
</div>
<div class="paragraph">
<p>当使用演示配置，且希望添加自定义类时，需要在activiti-explorer或activiti-rest web应用库中，添加包含有你的自定义类的jar。别忘了也要添加你的自定义类的依赖（若有）。或者，也可以将你的依赖添加到Tomcat的库文件夹，<code>${tomcat.home}/lib</code>中。</p>
</div>
</div>
<div class="sect3">
<h4 id="_在流程中使用spring_bean_using_spring_beans_from_a_process">6.2.2. 在流程中使用Spring bean (Using Spring beans from a process)</h4>
<div class="paragraph">
<p>当在表达式或脚本中使用Spring bean时，执行该流程定义的引擎需要可以使用这些bean。如果你自行构建web应用，并按照<a href="#springintegration">spinrg集成章节 the spring integration section</a>的介绍，在上下文中配置流程引擎，就可以直接使用。但也请牢记在心，如果使用Activiti rest web应用，就需要更新它的上下文配置。用包含你的Spring上下文配置的<code>activiti-context.xml</code>文件，替换<code>activiti-rest/lib/activiti-cfg.jar</code> jar文件中的<code>activiti.cfg.xml</code>。</p>
</div>
</div>
<div class="sect3">
<h4 id="_创建单独应用_creating_a_single_app">6.2.3. 创建单独应用 Creating a single app</h4>
<div class="paragraph">
<p>如果不想费心保证所有流程引擎都在classpath中含有所有需要的代理类，以及保证它们都使用了正确的Spring配置，也可以考虑将Activiti rest web应用嵌入你自己的web应用，也就是说只有一个单独的<code>ProcessEngine</code>。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="versioningOfProcessDefinitions">6.3. 流程定义的版本 Versioning of process definitions</h3>
<div class="paragraph">
<p>BPMN并没有版本的概念。这其实很好，因为可执行的BPMN流程文件很可能已经作为你的开发项目的一部分，保存在版本管理系统仓库中了（例如Subversion，Git，或者Mercurial）。流程定义的版本在部署时创建。在部署时，Activiti会在保存至Activiti数据库前，为<code>ProcessDefinition</code>指定版本。</p>
</div>
<div class="paragraph">
<p>对于业务存档中的每个流程定义，下列步骤都会执行，以初始化<code>key</code>，<code>version</code>，<code>name</code>与<code>id</code>参数：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>XML文件中的流程定义<code>id</code>属性作为流程定义的<code>key</code>参数。</p>
</li>
<li>
<p>XML文件中的流程定义<code>name</code>属性作为流程定义的<code>name</code>参数。如果未给定<code>name</code>属性，会使用id作为name。</p>
</li>
<li>
<p>当每个key的流程第一次部署时，指定版本为1。对其后所有使用相同key的流程定义，部署时版本会在该key当前已部署的最高版本号基础上加1。key参数用于区分流程定义。</p>
</li>
<li>
<p>id参数设置为{processDefinitionKey}:{processDefinitionVersion}:{generated-id}，其中<code>generated-id</code>是一个唯一数字，用以保证在集群环境下，流程定义缓存中，流程id的唯一性。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>以下面的流程为例</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;definitions id="myDefinitions" &gt;
  &lt;process id="myProcess" name="My important process" &gt;
    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>当部署这个流程定义时，数据库中的流程定义会是这个样子：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">key</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess:1:676</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>如果我们现在部署同一个流程的更新版本（例如改变部分用户任务），且保持流程定义的<code>id</code>不变，那么流程定义表中会包含下面的记录：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">key</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess:1:676</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess:2:870</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>当调用<code>runtimeService.startProcessInstanceByKey("myProcess")</code>时，会使用版本<code>2</code>的流程定义，因为这是这个流程定义的最新版本。</p>
</div>
<div class="paragraph">
<p>如果再创建第二个流程，如下定义并部署至Activiti，表中会增加第三行。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;definitions id="myNewDefinitions" &gt;
  &lt;process id="myNewProcess" name="My important process" &gt;
    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>表将显示类似：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">key</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess:1:676</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess:2:870</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">myNewProcess:1:1033</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myNewProcess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>请注意新流程的key与第一个流程的不同。即使name是相同的（我们可能本应该也改变它），Activiti也只用<code>id</code>属性来区分流程。因此新的流程部署时版本为1.</p>
</div>
</div>
<div class="sect2">
<h3 id="providingProcessDiagram">6.4. 提供流程图 Providing a process diagram</h3>
<div class="paragraph">
<p>部署可以添加流程图图片。这个图片将存储在Activiti数据库中，并可以使用API访问。这个图片可以用在Activiti Explorer中，使流程形象化。</p>
</div>
<div class="paragraph">
<p>如果在classpath中，有一个<code>org/activiti/expenseProcess.bpmn20.xml</code>流程，key为&#8217;expense'。则流程图图片会使用下列命名约定（按此顺序）：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果部署中有图片资源，并且它的名字为BPMN 2.0 XML文件名，加上流程key以及图片后缀，则使用这个图片。在我们的例子中，就是<code>org/activiti/expenseProcess.expense.png</code>（或者.jpg/gif）。如果一个BPMN 2.0 XML文件中有多个流程定义，这个方式就很合理，因为每一个流程图的文件名中都有流程key。</p>
</li>
<li>
<p>如果没有这种图片，就会寻找部署中匹配BPMN 2.0 XML文件名的图片资源。在我们的例子中，就是<code>org/activiti/expenseProcess.png</code>。请注意这就意味着同一个BPMN 2.0文件中的<strong>每一个流程定义</strong>，都会使用同一个流程图图片。很显然，如果每个BPMN 2.0 XML文件中只有一个流程定义，就没有问题。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>用编程方式部署的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">repositoryService.createDeployment()
  .name("expense-process.bar")
  .addClasspathResource("org/activiti/expenseProcess.bpmn20.xml")
  .addClasspathResource("org/activiti/expenseProcess.png")
  .deploy();</code></pre>
</div>
</div>
<div class="paragraph">
<p>图片资源可用下面的API获取：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ProcessDefinition processDefinition = repositoryService.createProcessDefinitionQuery()
  .processDefinitionKey("expense")
  .singleResult();

String diagramResourceName = processDefinition.getDiagramResourceName();
InputStream imageStream = repositoryService.getResourceAsStream(
    processDefinition.getDeploymentId(), diagramResourceName);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="generatingProcessDiagram">6.5. 生成流程图 Generating a process diagram</h3>
<div class="paragraph">
<p>如果部署时没有按<a href="#providingProcessDiagram">上小节</a>介绍的提供图片，且流程定义中包含必要的“图形交换（diagram interchange）”信息，Activiti引擎会生成流程图。</p>
</div>
<div class="paragraph">
<p>可以用与部署时<a href="#providingProcessDiagram">提供图片</a>完全相同的方法获取图片资源。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/deployment.image.generation.png" alt="deployment.image.generation">
</div>
</div>
<div class="paragraph">
<p>如果由于某种原因，不需要或不希望在部署时生成流程图，可以在流程引擎配置中设置<code>isCreateDiagramOnDeploy</code>参数：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;property name="createDiagramOnDeploy" value="false" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>这样就不会生成流程图了。</p>
</div>
</div>
<div class="sect2">
<h3 id="deploymentCategory">6.6. 类别 Category</h3>
<div class="paragraph">
<p>部署与流程定义都可以定义类别。流程定义的类别使用BPMN文件中的<code>&lt;definitions &#8230;&#8203; targetNamespace="yourCategory" &#8230;&#8203;/&gt;</code>设置。</p>
</div>
<div class="paragraph">
<p>部署的类别可用API如此设定：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">repositoryService
    .createDeployment()
    .category("yourCategory")
    ...
    .deploy();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bpmn20">7. BPMN 2.0介绍 BPMN 2.0 Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="whatIsBpmn">7.1. BPMN是什么？ What is BPMN?</h3>
<div class="paragraph">
<p>查看我们<a href="http://activiti.org/faq.html#WhatIsBpmn20">关于BPMN 2.0的FAQ条目</a>。</p>
</div>
</div>
<div class="sect2">
<h3 id="bpmnDefiningProcess">7.2. 定义流程 Defining a process</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>这个介绍的写作，基于使用<a href="http://eclipse.org/">Eclipse IDE</a>创建与编辑文件。但其实只有很少的部分使用了Eclipse的特性。可以使用你喜欢的任何其他工具创建包含BPMN 2.0的XML文件。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>创建一个新的XML文件（<em>在任意项目上右击，选择New&#8594;Other&#8594;XML-XML File</em>）并命名。确保该文件名<strong>以.bpmn20.xml或.bpmn结尾</strong>，因为只有这样，引擎才会在部署时选择这个文件。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/new.bpmn.procdef.png" alt="new.bpmn.procdef">
</div>
</div>
<div class="paragraph">
<p>BPMN 2.0概要（schema）的根元素（root element）是<code>definitions</code>元素。在这个元素中，可以定义多个流程定义（然而我们建议在每个文件中，只有一个流程定义。这样可以简化已部署流程的管理）。下面显示的是一个空流程定义。请注意<code>definitions</code>元素最少需要包含<code>xmlns</code>与<code>targetNamespace</code>声明。<code>targetNamespace</code>可以为空，用于对流程定义进行分类。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;definitions
  xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
  xmlns:activiti="http://activiti.org/bpmn"
  targetNamespace="Examples"&gt;

  &lt;process id="myProcess" name="My First Process"&gt;
    ..
  &lt;/process&gt;

&lt;/definitions&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>BPMN 2.0 XML概要，除了使用Eclipse中的XML分类配置，也可以使用在线概要。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.omg.org/spec/BPMN/20100524/MODEL
                    http://www.omg.org/spec/BPMN/2.0/20100501/BPMN20.xsd</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>process</code>元素有两个属性：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>id</strong>: <strong>必填</strong>属性，映射为Activiti <code>ProcessDefinition</code>对象的<strong>key</strong>参数。可以使用<code>RuntimeService</code>中的<code>startProcessInstanceByKey</code>方法，使用<code>id</code>来启动这个流程定义的新流程实例。这个方法总会使用流程定义的<strong>最后部署版本</strong>。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ProcessInstance processInstance = runtimeService.startProcessInstanceByKey("myProcess");</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>请注意这与调用<code>startProcessInstanceById</code>方法不同。<code>startProcessInstanceById</code>方法的参数为Activiti引擎在部署时生成的字符串id，可以通过调用<code>processDefinition.getId()</code>方法获取。生成id的格式为<strong><em>key:version</em></strong>，长度<strong>限制为64字符</strong>。如果有<code>ActivitiException</code>显示生成id过长，请限制流程<em>key</em>参数（即这个id字段）的文字长度。</p>
</li>
<li>
<p><strong>name</strong>: <strong>可选</strong>属性，映射为<code>ProcessDefinition</code>的<em>name</em>参数。引擎自己不会使用这个参数，可以用于例如，在用户界面上显示更用户友好的名字。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>[[10minutetutorial]]</p>
</div>
</div>
<div class="sect2">
<h3 id="_准备_十分钟教程_getting_started_10_minute_tutorial">7.3. 准备：十分钟教程 Getting started: 10 minute tutorial</h3>
<div class="paragraph">
<p>这个章节包含了一个（很简单的）业务流程，用于介绍一些基本的Activiti概念，以及Activiti API。</p>
</div>
<div class="sect3">
<h4 id="bpmn10MinuteTutorialPrerequisites">7.3.1. 先决条件 Prerequisites</h4>
<div class="paragraph">
<p>这个教程假设你已经<a href="#demo.setup.one.minute.version">运行了Activiti演示配置</a>，并使用独立的H2服务器。编辑<code>db.properties</code>并设置<code>jdbc.url=jdbc:h2:tcp://localhost/activiti</code>，然后按照<a href="http://www.h2database.com/html/tutorial.html#using_server">H2文档</a>的介绍运行独立服务器。</p>
</div>
</div>
<div class="sect3">
<h4 id="bpmn10MinuteTutorialGoal">7.3.2. 目标 Goal</h4>
<div class="paragraph">
<p>这个教程的目标是学习Activiti以及BPMN 2.0的一些基础概念。最后成果是一个简单的Java SE程序，部署了一个流程定义，并通过Activiti引擎API与流程进行交互。当然，在这个教程里学到的东西，也可以基于你的业务流程，用于构建你自己的web应用程序。</p>
</div>
</div>
<div class="sect3">
<h4 id="bpmnFirstExampleUseCase">7.3.3. 用例 Use case</h4>
<div class="paragraph">
<p>用例很直接：有一个公司，叫做BPMCorp。在BPMCorp中，每月需要为投资人撰写一份金融报告，由会计部门负责。在报告完成后，需要上层经理中的一位进行审核，然后才能发给所有投资人。</p>
</div>
</div>
<div class="sect3">
<h4 id="bpmnFirstExampleDiagram">7.3.4. 流程图 Process diagram</h4>
<div class="paragraph">
<p>上面描述的业务流程，可以使用<a href="#activitiDesigner">Activiti Designer</a>可视地画出。但是在这个教程里，我们自己写XML，这样可以学习更多。这个流程的图形化BPMN 2.0注记像是这样：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/financial.report.example.diagram.png" alt="financial.report.example.diagram">
</div>
</div>
<div class="paragraph">
<p>我们看到的是一个<a href="#bpmnNoneStartEvent">空启动事件 none Start Event</a>（左边的圆圈），接下来是两个<a href="#bpmnUserTask">用户任务 User Tasks</a>：<em>'Write monthly financial report（撰写月度金融报告）'</em>与<em>'Verify monthly financial report（审核月度金融报告）'</em>。最后是<a href="#bpmnNoneEndEvent">空结束事件 none end event</a>（右边的粗线条圆圈）。</p>
</div>
</div>
<div class="sect3">
<h4 id="bpmnFirstExampleXml">7.3.5. XML表现 XML representation</h4>
<div class="paragraph">
<p>这个业务流程的XML版本（<em>FinancialReportProcess.bpmn20.xml</em>）像下面显示的一样。很容易认出流程的主要元素（点击链接可以跳转到BPMN 2.0结构的详细章节）：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#bpmnNoneStartEvent">(空)开始事件 (none) start event</a>是流程的<em>入口点（entry point）</em>。</p>
</li>
<li>
<p><a href="#bpmnUserTask">用户任务 User Tasks</a>的声明表示了流程中的人工任务。请注意第一个任务分配给<em>accountancy</em>组，而第二个任务分配给<em>management</em>组。查看<a href="#bpmnUserTaskAssignment">用户任务分配章节 the section on user task assignment</a>了解关于用户与组如何分配用户任务的更多信息。</p>
</li>
<li>
<p>流程在到达<a href="#bpmnNoneEndEvent">空结束事件 none end event</a>时结束。</p>
</li>
<li>
<p>各元素间通过<a href="#bpmnSequenceFlow">顺序流 sequence flows</a>链接。顺序流用<code>source</code> 与<code>target</code>定义顺序流的<em>流向（direction）</em>。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;definitions id="definitions"
  targetNamespace="http://activiti.org/bpmn20"
  xmlns:activiti="http://activiti.org/bpmn"
  xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"&gt;

	&lt;process id="financialReport" name="Monthly financial report reminder process"&gt;

	  &lt;startEvent id="theStart" /&gt;

	  &lt;sequenceFlow id='flow1' sourceRef='theStart' targetRef='writeReportTask' /&gt;

	  &lt;userTask id="writeReportTask" name="Write monthly financial report" &gt;
	    &lt;documentation&gt;
	      Write monthly financial report for publication to shareholders.
	    &lt;/documentation&gt;
	    &lt;potentialOwner&gt;
	      &lt;resourceAssignmentExpression&gt;
	        &lt;formalExpression&gt;accountancy&lt;/formalExpression&gt;
	      &lt;/resourceAssignmentExpression&gt;
	    &lt;/potentialOwner&gt;
	  &lt;/userTask&gt;

	  &lt;sequenceFlow id='flow2' sourceRef='writeReportTask' targetRef='verifyReportTask' /&gt;

	  &lt;userTask id="verifyReportTask" name="Verify monthly financial report" &gt;
	    &lt;documentation&gt;
	      Verify monthly financial report composed by the accountancy department.
	      This financial report is going to be sent to all the company shareholders.
	    &lt;/documentation&gt;
	    &lt;potentialOwner&gt;
	      &lt;resourceAssignmentExpression&gt;
	        &lt;formalExpression&gt;management&lt;/formalExpression&gt;
	      &lt;/resourceAssignmentExpression&gt;
	    &lt;/potentialOwner&gt;
	  &lt;/userTask&gt;

	  &lt;sequenceFlow id='flow3' sourceRef='verifyReportTask' targetRef='theEnd' /&gt;

	  &lt;endEvent id="theEnd" /&gt;

	&lt;/process&gt;

&lt;/definitions&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnFirstExamplStartProcess">7.3.6. 启动流程实例 Starting a process instance</h4>
<div class="paragraph">
<p>现在我们已经创建了业务流程的<strong>流程定义</strong>。使用这样的流程定义，可以创建<strong>流程实例</strong>。在这个例子中，一个流程实例将对应一个特定月份的一次财经报告创建与审核工作。所有流程实例共享相同的流程定义。</p>
</div>
<div class="paragraph">
<p>要用给定的流程定义创建流程实例，需要首先<strong>部署（deploy）</strong>流程定义。部署流程定义意味着两件事：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>流程定义将会存储在Activiti引擎配置的持久化数据库中。因此通过部署业务流程，保证了引擎在重启后也能找到流程定义。</p>
</li>
<li>
<p>BPMN 2.0流程文件会解析为内存中的对象模型。这个模型可以通过Activiti API操纵。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>更多关于部署的信息可以在<a href="#chDeployment">部署专门章节中</a>找到。</p>
</div>
<div class="paragraph">
<p>与该章节的描述一样，部署有很多种方式。一种是通过下面展示的API。请注意所有与Activiti引擎的交互都要通过它的<em>服务（services）</em>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Deployment deployment = repositoryService.createDeployment()
  .addClasspathResource("FinancialReportProcess.bpmn20.xml")
  .deploy();</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在可以使用在流程定义中定义的<code>id</code>（参见XML文件中的流程元素）启动新流程实例。请注意这个<code>id</code>在Activiti术语中被称作<strong>key</strong>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ProcessInstance processInstance = runtimeService.startProcessInstanceByKey("financialReport");</code></pre>
</div>
</div>
<div class="paragraph">
<p>这会创建流程实例，并首先通过开始事件。在开始事件后，会沿着所有出口顺序流（在这个例子中只有一个）继续，并到达第一个任务（<em>撰写月度金融报告 write monthly financial report</em>）。这时，Activiti引擎会在持久化数据库中存储一个任务。同时，会解析这个任务附加的分配用户或组，也保存在数据库中。请注意，Activiti引擎会持续执行流程步骤，直到到达<em>等待状态 wait state</em>，例如用户任务。在这种等待状态时，流程实例的当前状态会存储在数据库中，并保持这个状态，直到用户决定完成任务。这时，引擎会继续执行，直到遇到新的等待状态，或者流程结束。如果在这期间引擎重启或崩溃，流程的状态也仍在数据库中安全并妥善的保存。</p>
</div>
<div class="paragraph">
<p>在任务创建后，<code>startProcessInstanceByKey</code>方法会返回，因为用户任务活动是一个<em>等待状态</em>。在这个例子里，这个任务分配给一个组。这意味着这个组的每一个成员都是处理这个任务的<strong>候选人 candidate</strong>。</p>
</div>
<div class="paragraph">
<p>现在可以将这些整合起来，创建一个简单的Java程序。创建一个新的Eclipse项目，在它的classpath中添加Activiti jar与依赖（可以在Activiti发行版的<em>libs</em>目录下找到）。在能够调用Activiti服务前，需要首先构建<code>ProcessEngine （流程引擎）</code>，用于访问服务。这里我们使用<em>'standalone 独立'</em>配置，这个配置会构建<code>ProcessEngine</code>，并使用与演示配置中相同的数据库。</p>
</div>
<div class="paragraph">
<p>可以从<a href="images/FinancialReportProcess.bpmn20.xml">这里</a>下载流程定义XML。这个文件包含了上面展示的XML，同时包含了必要的BPMN<a href="#generatingProcessDiagram">图形交互信息 diagram interchange information</a>，用于在Activiti的工具中可视化展示流程。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public static void main(String[] args) {

  // 创建Activiti流程引擎 Create Activiti process engine
  ProcessEngine processEngine = ProcessEngineConfiguration
    .createStandaloneProcessEngineConfiguration()
    .buildProcessEngine();

  // 获取Activiti服务 Get Activiti services
  RepositoryService repositoryService = processEngine.getRepositoryService();
  RuntimeService runtimeService = processEngine.getRuntimeService();

  // 部署流程定义 Deploy the process definition
  repositoryService.createDeployment()
    .addClasspathResource("FinancialReportProcess.bpmn20.xml")
    .deploy();

  // 启动流程实例 Start a process instance
  runtimeService.startProcessInstanceByKey("financialReport");
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnFirstExampleCandidateList">7.3.7. 任务列表 Task lists</h4>
<div class="paragraph">
<p>现在可以通过添加下列逻辑，获取这个任务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">List&lt;Task&gt; tasks = taskService.createTaskQuery().taskCandidateUser("kermit").list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意传递给这个操作的用户需要是<em>accountancy</em>组的成员，因为在流程定义中是这么声明的：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;potentialOwner&gt;
  &lt;resourceAssignmentExpression&gt;
    &lt;formalExpression&gt;accountancy&lt;/formalExpression&gt;
  &lt;/resourceAssignmentExpression&gt;
&lt;/potentialOwner&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以使用任务查询API，用组名查得相同结果。可以在代码中添加下列逻辑：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">TaskService taskService = processEngine.getTaskService();
List&lt;Task&gt; tasks = taskService.createTaskQuery().taskCandidateGroup("accountancy").list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>因为我们将<code>ProcessEngine</code>配置为使用与演示配置中相同的数据库，因此可以登录<a href="http://localhost:8080/activiti-explorer/">Activiti Explorer</a>。默认情况下，<em>accountancy</em>组中没有用户。使用kermit/kermit登录，点击Groups，然后"Create group (创建组)"。然后点击Users，并向组中添加fozzie。现在使用fozzie/fozzie登录，就会发现在选择了<em>Processes</em>页面，点击<em>'Monthly financial report （月度金融报告）'</em>的<em>'Actions'</em>栏的<em>'Start Process （开始流程）'</em>链接后，可以启动我们的业务流程。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.financial.report.example.start.process.png" alt="bpmn.financial.report.example.start.process">
</div>
</div>
<div class="paragraph">
<p>前面已经解释过，流程会执行到第一个用户任务。因为使用Fozzie登录，就可以看到在启动流程实例后，他有一个新的候选任务（candidate task）。选择<em>Tasks</em>页面来查看这个新任务。请注意即使流程是由其他人启动的，accountancy组中的每一个人仍然都能看到这个候选任务。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.financial.report.example.task.assigned.png" alt="bpmn.financial.report.example.task.assigned">
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnFirstExampleClaimTask">7.3.8. 申领任务 Claiming the task</h4>
<div class="paragraph">
<p>会计师（accountancy组的成员）现在需要<strong>申领任务</strong>。申领任务后，这个用户会成为任务的<strong>执行人 （assignee）</strong>，这个任务也会从accountancy组的其他成员的任务列表中消失。申领任务通过编程方式如下实现：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">taskService.claim(task.getId(), "fozzie");</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个任务现在在<strong>申领任务者的个人任务列表中</strong>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">List&lt;Task&gt; tasks = taskService.createTaskQuery().taskAssignee("fozzie").list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>在Activiti Explorer UI中，点击<em>claim</em>按钮会执行相同操作。这个任务会转移到登录用户的个人任务列表中。也可以看到任务执行人变更为当前登录用户。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.financial.report.example.claim.task.png" alt="bpmn.financial.report.example.claim.task">
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnFirstExampleCompleteTask">7.3.9. 完成任务 Completing the task</h4>
<div class="paragraph">
<p>会计师（accountancy组的成员）现在需要开始撰写金融报告了。一旦报告完成，他就可以<strong>完成任务</strong>。这意味着这个任务的所有工作都已经完成。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">taskService.complete(task.getId());</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于Activiti引擎来说，这是个外部信号，指示流程实例需要继续执行。任务本身会从运行时数据中移除，并继续这个任务唯一的出口转移（outgoing transition），将执行移至第二个任务（<em>'verification of the report 审核月度报告'</em>）。与上面介绍的第一个任务使用的相同的机制，会用于为第二个任务分配执行人。有一点小区别，这个任务会分配给<em>management</em>组。</p>
</div>
<div class="paragraph">
<p>在演示设置中，完成任务可以通过点击任务列表中的<em>complete</em>按钮。因为Fozzie不是经理，我们需要登出Activiti Explorer，并用<em>kermit</em>（他是经理）登录。第二个任务现在可以在未分配任务列表中看到。</p>
</div>
</div>
<div class="sect3">
<h4 id="bpmnFirstExampleEndingProcess">7.3.10. 结束流程 Ending the process</h4>
<div class="paragraph">
<p>与之前完全相同的方式，可以获取并申领审核任务。完成这个第二个任务，会将流程执行移至结束事件，并结束流程实例。这个流程实例与所有相关的运行时执行数据都会从数据库中移除。</p>
</div>
<div class="paragraph">
<p>登录至Activiti Explorer可以验证这一点，流程执行的存储表中找不到记录。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.financial.report.example.process.ended.png" alt="bpmn.financial.report.example.process.ended">
</div>
</div>
<div class="paragraph">
<p>也可以通过编程方式，使用<code>historyService</code>验证流程已经结束</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">HistoryService historyService = processEngine.getHistoryService();
HistoricProcessInstance historicProcessInstance =
historyService.createHistoricProcessInstanceQuery().processInstanceId(procId).singleResult();
System.out.println("Process instance end time: " + historicProcessInstance.getEndTime());</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnFirstExampleCode">7.3.11. 代码总结 Code overview</h4>
<div class="paragraph">
<p>将之前章节的所有代码片段整合起来，会得到类似这样的代码（这段代码考虑到了你可能已经使用Activiti Explorer UI启动了一些流程实例。代码中总是获取任务列表而不是一个任务，因此总能执行）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class TenMinuteTutorial {

  public static void main(String[] args) {

    // 创建Activiti流程引擎 Create Activiti process engine
    ProcessEngine processEngine = ProcessEngineConfiguration
      .createStandaloneProcessEngineConfiguration()
      .buildProcessEngine();

    // 获取Activiti服务 Get Activiti services
    RepositoryService repositoryService = processEngine.getRepositoryService();
    RuntimeService runtimeService = processEngine.getRuntimeService();

    // 部署流程定义 Deploy the process definition
    repositoryService.createDeployment()
      .addClasspathResource("FinancialReportProcess.bpmn20.xml")
      .deploy();

    // 启动流程实例 Start a process instance
    String procId = runtimeService.startProcessInstanceByKey("financialReport").getId();

    // 获取第一个任务 Get the first task
    TaskService taskService = processEngine.getTaskService();
    List&lt;Task&gt; tasks = taskService.createTaskQuery().taskCandidateGroup("accountancy").list();
    for (Task task : tasks) {
      System.out.println("Following task is available for accountancy group: " + task.getName());

      // 申领 claim it
      taskService.claim(task.getId(), "fozzie");
    }

    // 验证Fozzie获取了任务 Verify Fozzie can now retrieve the task
    tasks = taskService.createTaskQuery().taskAssignee("fozzie").list();
    for (Task task : tasks) {
      System.out.println("Task for fozzie: " + task.getName());

      // 完成任务 Complete the task
      taskService.complete(task.getId());
    }

    System.out.println("Number of tasks for fozzie: "
            + taskService.createTaskQuery().taskAssignee("fozzie").count());

    // 获取并申领第二个任务 Retrieve and claim the second task
    tasks = taskService.createTaskQuery().taskCandidateGroup("management").list();
    for (Task task : tasks) {
      System.out.println("Following task is available for management group: " + task.getName());
      taskService.claim(task.getId(), "kermit");
    }

    // 完成第二个任务并结束流程 Completing the second task ends the process
    for (Task task : tasks) {
      taskService.complete(task.getId());
    }

    // 验证流程已经结束 verify that the process is actually finished
    HistoryService historyService = processEngine.getHistoryService();
    HistoricProcessInstance historicProcessInstance =
      historyService.createHistoricProcessInstanceQuery().processInstanceId(procId).singleResult();
    System.out.println("Process instance end time: " + historicProcessInstance.getEndTime());
  }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnFirstExampleFutureEnhancements">7.3.12. 继续提高 Future enhancements</h4>
<div class="paragraph">
<p>可以看出这个业务流程太简单了，不能实际使用。然而，随着继续浏览Activiti中可用的BPMN 2.0结构，可以增强业务流程通过：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>定义<strong>网关 gateway</strong>执行选择。这样，经理可以驳回金融报告，并重新为会计师创建任务。</p>
</li>
<li>
<p>定义并使用<strong>变量 variables</strong>。这样可以存储或引用报告，并可以在表单中显示它。</p>
</li>
<li>
<p>在流程结束处定义<strong>服务任务 service task</strong>，将报告发送给每一个投资人。</p>
</li>
<li>
<p>等等。</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bpmnConstructs">8. BPMN 2.0 结构 BPMN 2.0 Constructs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>本章节包含了Activiti支持的BPMN 2.0结构，以及对BPMN标准的自定义扩展。</p>
</div>
<div class="sect2">
<h3 id="bpmnCustomExtensions">8.1. 自定义扩展 Custom extensions</h3>
<div class="paragraph">
<p>BPMN 2.0标准对流程的所有的参与者都是个好东西。最终用户不需要因为依赖专利解决方案，而被供应商“绑架”。Activiti之类的开源框架，也可以提供与大型供应商的解决方案相同（经常是更好;-）的实现。有了BPMN 2.0标准，从大型供应商解决方案向Activiti的转变，就变得简单平滑。</p>
</div>
<div class="paragraph">
<p>然而标准的缺点，是它通常是不同公司（不同观点）大量讨论与妥协的结果。作为阅读BPMN 2.0 XML流程定义的开发者，有时会觉得某些结构或做事方法太笨重了。Activiti将开发者的感受放在最高优先，因此引入了一些<strong><em>Activiti BPMN extensions（扩展）</em></strong>。这些“扩展”并不在BPMN 2.0规格中，有些是新结构，有些是对特定结构的简化。</p>
</div>
<div class="paragraph">
<p>尽管BPMN 2.0规格明确指出可以支持自定义扩展，我们仍做了如下保证：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>自定义扩展的前提是，<strong>做事情的标准方式</strong><strong>总</strong>可以进行更简化的改造。因此当你决定使用自定义扩展时，不用担心无路可退（仍然可以用标准方式）。</p>
</li>
<li>
<p>使用自定义扩展时，总是通过为新的XML元素、属性等提供<strong>activiti:</strong>命名空间前缀，明确标识出来。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>因此是否使用自定义扩展，完全取决于你自己。有些其他因素会影响选择（图形化编辑器的使用，公司策略，等等）。我们提供扩展，只是因为相信，标准中的某些地方可以用更简单或效率更高的方式处理。请不要吝啬给我们反馈对扩展的评价（正面的和/或负面的），也可以给我们提供关于自定义扩展的新想法。说不定某一天，你的想法会成为规范的一部分！</p>
</div>
</div>
<div class="sect2">
<h3 id="bpmnEvents">8.2. 事件 Events</h3>
<div class="paragraph">
<p>事件通常用于为流程生命周期中发生的事情建模。事件总是图形化为圆圈。在BPMN 2.0中，有两种主要的事件分类：<em>捕获（catching）</em>与<em>抛出（throwing）</em>事件。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>捕获:</strong> 当流程执行到达这个事件时，会等待直到触发器动作。触发器的类型，由其中的图标，或者说XML中的类型声明而定义。捕获事件与抛出事件显示上的区别，是其内部的图标没有填充（也就是说，是白色的）。</p>
</li>
<li>
<p><strong>抛出:</strong> 当流程执行到达这个事件时，会触发一个触发器。触发器的类型，由其中的图标，或者说XML中的类型声明而定义。抛出事件与捕获事件显示上的区别，是其内部的图标填充为黑色。</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="eventDefinitions">8.2.1. 事件定义 Event Definitions</h4>
<div class="paragraph">
<p>事件定义，定义了事件的语义。没有事件定义的话，事件就“不做什么特别的事情”。例如一个没有事件定义的开始事件，并不限定具体是什么启动了流程。如果为这个开始事件添加事件定义（例如定时器事件定义），就声明了启动流程的“类型”（例如对于定时器事件定义，就是到达了特定的时间点）。</p>
</div>
</div>
<div class="sect3">
<h4 id="timerEventDefinitions">8.2.2. 定时器事件定义 Timer Event Definitions</h4>
<div class="paragraph">
<p>定时器事件，是由定义的定时器触发的事件。可以用于<a href="#bpmnTimerStartEvent">开始事件 start event</a>，<a href="#bpmnIntermediateCatchingEvent">中间事件 intermediate event</a>，或<a href="#bpmnTimerBoundaryEvent">边界事件 boundary event</a>。定时器事件的行为，取决于所使用的业务日历（business calendar）。定时器事件有默认的业务日历，但也可以为每个定时器事件定义，定义业务日历。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;timerEventDefinition activiti:businessCalendarName="custom"&gt;
    ...
&lt;/timerEventDefinition&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>其中businessCalendarName指向流程引擎配置中的业务日历。如果省略业务日历定义，就使用默认业务日历。</p>
</div>
<div class="paragraph">
<p>定时器定义必须且只能使用下列的一种元素：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>timeDate</strong>。这个方式指定了<a href="http://en.wikipedia.org/wiki/ISO_8601#Dates">ISO 8601</a>格式的固定时间。
在这个时间点，会触发触发器。例如：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;timerEventDefinition&gt;
    &lt;timeDate&gt;2011-03-11T12:13:14&lt;/timeDate&gt;
&lt;/timerEventDefinition&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>timeDuration</strong>。要定义在触发前，定时器需要等待多长时间，可以用<em>timeDuration</em>作为<em>timerEventDefinition</em>的子元素来指定。使用<a href="http://en.wikipedia.org/wiki/ISO_8601#Durations">ISO 8601</a>格式（BPMN 2.0规范要求）。例如（等待10天）：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;timerEventDefinition&gt;
    &lt;timeDuration&gt;P10D&lt;/timeDuration&gt;
&lt;/timerEventDefinition&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>timeCycle</strong>。指定重复周期，可用于周期性启动流程，或者为超期用户任务多次发送提醒。这个元素可以使用两种格式。第一种是按照<a href="http://en.wikipedia.org/wiki/ISO_8601#Repeating_intervals">ISO 8601</a>标准定义的循环时间周期。例如（三次重复间隔，每次间隔为10小时）：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;timerEventDefinition&gt;
    &lt;timeCycle activiti:endDate="2015-02-25T16:42:11+00:00"&gt;R3/PT10H&lt;/timeCycle&gt;
&lt;/timerEventDefinition&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以指定<em>endDate</em>，作为<em>timeCycle</em>的可选属性，或者像这样直接写在时间表达式的结尾：<code>R3/PT10H/${EndDate}</code>。
当到达endDate时，应用会停止，并为该任务创建其他作业。
可以使用<a href="http://en.wikipedia.org/wiki/ISO_8601#Dates">ISO 8601</a>标准的静态值，比如<em>"2015-02-25T16:42:11+00:00"</em>。也可以使用变量<em>${EndDate}</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;timerEventDefinition&gt;
    &lt;timeCycle&gt;R3/PT10H/${EndDate}&lt;/timeCycle&gt;
&lt;/timerEventDefinition&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果同时使用了两种指定方式，则系统会使用属性方式定义的endDate。</p>
</div>
<div class="paragraph">
<p>目前只有<em>BoundaryTimerEvents</em>与<em>CatchTimerEvent</em>支持<em>EndDate</em>功能。</p>
</div>
<div class="paragraph">
<p>另外，也可以使用cron表达式指定定时周期。下面的例子展示了一个整点启动，每5分钟触发的触发器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>0 0/5 * * * ?</pre>
</div>
</div>
<div class="paragraph">
<p>请参考<a href="http://www.quartz-scheduler.org/docs/tutorials/crontrigger.html">这个教程</a>了解如何使用cron表达式。</p>
</div>
<div class="paragraph">
<p><strong>请注意:</strong> 与普通的Unix cron不同，第一个符号代表的是秒。</p>
</div>
<div class="paragraph">
<p>重复时间周期更适用于使用相对时间，也就是从某个特定时间点开始计算（比如用户任务开始的时间）。而cron表达式可以使用绝对时间，因此绝对适合用于<a href="#timerStartEventDescription">定时启动事件 timer start events</a>。</p>
</div>
<div class="paragraph">
<p>可以在定时事件定义中使用表达式，也就是使用流程变量调整定时器定义。这个流程变量必须是包含合适时间格式的字符串，ISO 8601（或者对于循环类型，cron）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;boundaryEvent id="escalationTimer" cancelActivity="true" attachedToRef="firstLineSupport"&gt;
  &lt;timerEventDefinition&gt;
    &lt;timeDuration&gt;${duration}&lt;/timeDuration&gt;
  &lt;/timerEventDefinition&gt;
&lt;/boundaryEvent&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>定时器只有在作业或者异步执行器启用时才能触发（也就是说，需要在<code>activiti.cfg.xml</code>中，将<em>jobExecutorActivate</em>或者<em>asyncExecutorActivate</em>设置为<code>true</code>。因为默认情况下，作业与异步执行器都是禁用的）。</p>
</div>
</div>
<div class="sect3">
<h4 id="bpmnErrorEventDefinition">8.2.3. 错误事件定义 Error Event Definitions</h4>
<div class="paragraph">
<p><strong>重要提示：</strong> BPMN错误与Java异常<strong>不</strong>是一回事。事实上，这两者毫无共同点。BPMN错误事件是建模<em>业务异常（business exceptions）</em>的方式。而Java异常使用<a href="#serviceTaskExceptionHandling">它们自己的方式</a>处理。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;endEvent id="myErrorEndEvent"&gt;
  &lt;errorEventDefinition errorRef="myError" /&gt;
&lt;/endEvent&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnSignalEventDefinition">8.2.4. 信号事件定义 Signal Event Definitions</h4>
<div class="paragraph">
<p>信号事件，是引用具名信号的事件。信号是全局范围（广播）的事件，并会被传递给所有激活的处理器（等待中的流程实例/捕获信号事件 catching signal events）。</p>
</div>
<div class="paragraph">
<p>信号事件定义使用<code>signalEventDefinition</code>元素声明。其<code>signalRef</code>属性引用一个<code>signal</code>元素，该<code>signal</code>元素需要声明为<code>definitions</code>根元素的子元素。下面摘录一个流程，使用中间事件（intermediate event）抛出与捕获信号事件。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;definitions... &gt;
	&lt;!-- 声明信号 --&gt;
	&lt;signal id="alertSignal" name="alert" /&gt;

	&lt;process id="catchSignal"&gt;
		&lt;intermediateThrowEvent id="throwSignalEvent" name="Alert"&gt;
			&lt;!-- 信号事件定义 --&gt;
			&lt;signalEventDefinition signalRef="alertSignal" /&gt;
		&lt;/intermediateThrowEvent&gt;
		...
		&lt;intermediateCatchEvent id="catchSignalEvent" name="On Alert"&gt;
			&lt;!-- 信号事件定义 --&gt;
			&lt;signalEventDefinition signalRef="alertSignal" /&gt;
		&lt;/intermediateCatchEvent&gt;
		...
	&lt;/process&gt;
&lt;/definitions&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>两个<code>signalEventDefinition</code>引用同一个<code>signal</code>元素。</p>
</div>
<div class="sect4">
<h5 id="bpmnSignalEventDefinitionThrow">抛出信号事件 Throwing a Signal Event</h5>
<div class="paragraph">
<p>信号可以由流程实例使用BPMN结构抛出，也可以通过编程方式使用Java API抛出。下面<code>org.activiti.engine.RuntimeService</code>中的方法可以用于编程方式抛出信号：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">RuntimeService.signalEventReceived(String signalName);
RuntimeService.signalEventReceived(String signalName, String executionId);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>signalEventReceived(String signalName);</code>与<code>signalEventReceived(String signalName, String executionId);</code>的区别，是前者在全局范围，为所有已订阅处理器抛出信号（广播），而后者只为指定的执行传递信号。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnSignalEventDefinitionCatch">捕获信号事件 Catching a Signal Event</h5>
<div class="paragraph">
<p>信号事件可用信号捕获中间事件（intermediate catch signal event）或者信号边界事件（signal boundary event）捕获。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnSignalEventDefinitionQuery">查询信号事件订阅 Querying for Signal Event subscriptions</h5>
<div class="paragraph">
<p>可以查询订阅了某一信号事件的所有执行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"> List&lt;Execution&gt; executions = runtimeService.createExecutionQuery()
      .signalEventSubscriptionName("alert")
      .list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用<code>signalEventReceived(String signalName, String executionId)</code>方法为这些执行传递这个信号。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnSignalEventDefinitionScope">信号事件范围 Signal event scope</h5>
<div class="paragraph">
<p>默认情况下，信号事件在<em>流程引擎全局广播</em>。这意味着你可以在一个流程实例中抛出一个信号事件，而不同流程定义的不同流程实例都会响应这个事件。</p>
</div>
<div class="paragraph">
<p>然而，有时也会希望只在<em>同一个流程实例</em>中响应信号事件。例如在流程实例中使用异步机制，而两个或多个活动彼此互斥的时候。</p>
</div>
<div class="paragraph">
<p>要限制信号事件的<em>范围（scope）</em>，在信号事件定义中添加（非BPMN 2.0标准！）<em>scope属性</em>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;signal id="alertSignal" name="alert" activiti:scope="processInstance"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个属性的默认值为<em>"global（全局）"</em>。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnSignalEventDefinitionExample">信号事件示例 Signal Event example(s)</h5>
<div class="paragraph">
<p>下面是一个关于两个不同的流程通过信号通信的例子。第一个流程在保险政策更新或变更时启动。在变更由人工审核之后，会抛出信号事件，指出政策已经发生了变更：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.signal.event.throw.png" alt="bpmn.signal.event.throw">
</div>
</div>
<div class="paragraph">
<p>这个事件可以被所有感兴趣的流程实例捕获。下面是一个订阅这个事件的流程的例子。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.signal.event.catch.png" alt="bpmn.signal.event.catch">
</div>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>要理解信号事件会广播给<strong>所有</strong>激活的处理器，这很重要。这意味着在上面的例子中，所有捕获这个信号的流程实例，都会接收这个信号。在这个例子中这就是我们期望的。然而，有的情况下，不希望使用广播方式。考虑下面的流程：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.signal.event.warning.1.png" alt="bpmn.signal.event.warning.1">
</div>
</div>
<div class="paragraph">
<p>Activiti不支持上面流程中描述的模式。理想情况是，在执行"do something"任务时抛出的错误，由错误边界事件捕获，并通过信号抛出事件传播至执行的并行分支，最终中断"do something in parallel"任务。到目前为止Activiti会按照预期效果执行。<strong>然而，由于信号的广播效应，它也会被传播至所有其他订阅了这个信号事件的流程实例。</strong>这可能并我们希望的效果。</p>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>信号事件与特定的流程实例无关，而是会广播给所有流程实例。如果你需要只为某一特定的流程实例传递信号，则需要使用<code>signalEventReceived(String signalName, String executionId)</code>手动建立关联，并使用适当的的<a href="#bpmnSignalEventDefinitionQuery">查询机制 query mechanisms</a>。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnMessageEventDefinition">8.2.5. 消息事件定义 Message Event Definitions</h4>
<div class="paragraph">
<p>消息事件，是指引用具名消息的事件。消息具有名字与载荷。与信号不同，消息事件只有一个接收者。</p>
</div>
<div class="paragraph">
<p>消息事件定义使用<code>messageEventDefinition</code>元素声明。其<code>messageRef</code>属性引用一个<code>message</code>元素，该<code>message</code>元素需要声明为<code>definitions</code>根元素的子元素。下面摘录一个流程，声明了两个消息事件，并由开始事件与消息捕获中间事件（intermediate catching message event）引用。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;definitions id="definitions"
  xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
  xmlns:activiti="http://activiti.org/bpmn"
  targetNamespace="Examples"
  xmlns:tns="Examples"&gt;

  &lt;message id="newInvoice" name="newInvoiceMessage" /&gt;
  &lt;message id="payment" name="paymentMessage" /&gt;

  &lt;process id="invoiceProcess"&gt;

    &lt;startEvent id="messageStart" &gt;
    	&lt;messageEventDefinition messageRef="newInvoice" /&gt;
    &lt;/startEvent&gt;
    ...
    &lt;intermediateCatchEvent id="paymentEvt" &gt;
    	&lt;messageEventDefinition messageRef="payment" /&gt;
    &lt;/intermediateCatchEvent&gt;
    ...
  &lt;/process&gt;

&lt;/definitions&gt;</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="bpmnMessageEventDefinitionThrow">抛出消息事件 Throwing a Message Event</h5>
<div class="paragraph">
<p>作为可嵌入的流程引擎，Activiti不关心实际接收消息。因为这可能与环境相关，并需要进行平台定义的操作，例如连接至JMS（Java Messaging Service，Java消息服务）队列（Queue）/主题（Topic），或者处理Webservice或者REST请求。因此接收消息需要作为应用的一部分，或者是流程引擎所嵌入的基础框架中的一部分，由你自行实现。</p>
</div>
<div class="paragraph">
<p>在应用中接收到消息后，需要决定如何处理它。如果这个消息需要启动新的流程实例，可以选择下面由runtime服务提供的方法中的一种：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ProcessInstance startProcessInstanceByMessage(String messageName);
ProcessInstance startProcessInstanceByMessage(String messageName, Map&lt;String, Object&gt; processVariables);
ProcessInstance startProcessInstanceByMessage(String messageName, String businessKey, Map&lt;String, Object&gt; processVariables);</code></pre>
</div>
</div>
<div class="paragraph">
<p>这些方法可以使用引用的消息启动流程实例。</p>
</div>
<div class="paragraph">
<p>如果需要由已有的流程实例接收消息，需要首先将消息与特定的流程实例关联（查看后续章节），然后触发等待中的执行，让其继续。runtime服务提供了下列方法，根据消息事件的订阅，触发执行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">void messageEventReceived(String messageName, String executionId);
void messageEventReceived(String messageName, String executionId, HashMap&lt;String, Object&gt; processVariables);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnMessageEventDefinitionQuery">查询消息事件订阅 Querying for Message Event subscriptions</h5>
<div class="ulist">
<ul>
<li>
<p>对于消息启动事件，消息事件的订阅与特定的<em>流程定义</em>相关。这种类型的消息订阅，可以使用<code>ProcessDefinitionQuery</code>查询：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ProcessDefinition processDefinition = repositoryService.createProcessDefinitionQuery()
      .messageEventSubscription("newCallCenterBooking")
      .singleResult();</code></pre>
</div>
</div>
<div class="paragraph">
<p>因为对于一个消息，只能有一个流程定义订阅，因此这个查询总是返回0或1个结果。如果流程定义更新了，只有该流程定义的最新版本会订阅这个消息事件。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>对于消息捕获中间事件（intermediate catch message event），消息事件的订阅与特定的<em>执行</em>相关。这种类型的消息订阅，可以使用<code>ExecutionQuery</code>查询：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Execution execution = runtimeService.createExecutionQuery()
      .messageEventSubscriptionName("paymentReceived")
      .variableValueEquals("orderId", message.getOrderId())
      .singleResult();</code></pre>
</div>
</div>
<div class="paragraph">
<p>这种查询通常有关联查询，并且通常需要了解流程（在这个例子里，对于给定的orderId，至多只有一个流程实例）。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnMessageEventDefinitionExample">消息事件示例 Message Event example(s)</h5>
<div class="paragraph">
<p>下面是一个流程的例子，可以使用两种不同的消息启动：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.start.message.event.example.1.png" alt="bpmn.start.message.event.example.1">
</div>
</div>
<div class="paragraph">
<p>在流程需要通过不同的方式响应不同的启动事件，但是后续使用统一的方式处理时，这就很有用。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnStartEvents">8.2.6. 启动事件 Start Events</h4>
<div class="paragraph">
<p>启动事件指明了流程的起点。启动事件的类型（流程在消息到达时启动，在指定的时间间隔后启动，等等），定义了流程<em>如何</em>启动，并显示为启动事件中的小图标。在XML中，类型由子元素声明来定义。</p>
</div>
<div class="paragraph">
<p>启动事件“随时捕获”：概念上，事件（随时）等候，直到特定的触发器被触发。</p>
</div>
<div class="paragraph">
<p>在启动事件中，可以使用下列Activiti专用参数：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>initiator</strong>: 指明保存认证用户（authenticated user）id用的变量名。在流程启动时，该id会使用这个变量名被保存。例如：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;startEvent id="request" activiti:initiator="initiator" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>认证用户必须通过<code>IdentityService.setAuthenticatedUserId(String)</code>方法，在try-finally块中设置，像这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">try {
  identityService.setAuthenticatedUserId("bono");
  runtimeService.startProcessInstanceByKey("someProcessKey");
} finally {
  identityService.setAuthenticatedUserId(null);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这段代码在集成在Activiti Explorer应用中。因此可以与<a href="#forms">表单</a>一起使用。</p>
</div>
</div>
<div class="sect3">
<h4 id="bpmnNoneStartEvent">8.2.7. 空启动事件 None Start Event</h4>
<div class="sect4">
<h5 id="noneStartEventDescription">描述 Description</h5>
<div class="paragraph">
<p>“空”启动事件，技术上指的是没有特别指定启动流程实例的触发器。这意味着引擎无法预知何时启动流程实例。空启动事件用于流程实例通过调用下列<em>startProcessInstanceByXXX</em> API方法启动的情况。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ProcessInstance processInstance = runtimeService.startProcessInstanceByXXX();</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>请注意：</em>子流程（subprocess）总是有空启动事件。</p>
</div>
</div>
<div class="sect4">
<h5 id="noneStartEventGraphicalNotation">图示 Graphical notation</h5>
<div class="paragraph">
<p>空启动事件用空心圆圈表示，中间没有图标（也就是说没有触发器）。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.none.start.event.png" alt="bpmn.none.start.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="noneStartEventXml">XML表示 XML representation</h5>
<div class="paragraph">
<p>空启动事件的XML表示格式，就是普通的启动事件声明，而没有任何子元素（其他种类的启动事件都有子元素，用于声明其类型）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;startEvent id="start" name="my start event" /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="noneStartEventCustomExtension">空启动事件的自定义扩展 Custom extensions for the none start event</h5>
<div class="paragraph">
<p><strong>formKey</strong>: 引用表单模板，用户需要在启动新流程实例时填写该表单。可以在<a href="#forms">表单章节</a>找到更多信息。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;startEvent id="request" activiti:formKey="org/activiti/examples/taskforms/request.form" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnTimerStartEvent">8.2.8. 定时器启动事件 Timer Start Event</h4>
<div class="sect4">
<h5 id="timerStartEventDescription">描述 Description</h5>
<div class="paragraph">
<p>定时器启动事件，用于在指定时间创建流程实例。在流程只需要启动一次，或者流程需要在特定的时间间隔重复启动时，都可以使用。</p>
</div>
<div class="paragraph">
<p><em>请注意：</em>子流程不能有定时器启动事件。</p>
</div>
<div class="paragraph">
<p><em>请注意：</em>定时器启动事件，在流程部署的同时就开始计时。不需要调用startProcessInstanceByXXX，尽管也不禁止使用启动流程的方法。调用startProcessInstanceByXXX时也会启动流程。</p>
</div>
<div class="paragraph">
<p><em>请注意：</em>当部署带有定时器启动事件的流程的新版本时，上一版本的定时器作业会被移除。这是因为通常并不希望旧版本的流程仍然自动启动新的流程实例。</p>
</div>
</div>
<div class="sect4">
<h5 id="timerStartEventGraphicalNotation">图示 Graphical notation</h5>
<div class="paragraph">
<p>定时器启动事件，用其中有一个钟表图标的圆圈来表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.clock.start.event.png" alt="bpmn.clock.start.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="timerStartEventXml">XML表示 XML representation</h5>
<div class="paragraph">
<p>定时器启动事件的XML表示格式，是普通的启动事件声明，加上定时器定义子元素。请参考<a href="#timerEventDefinitions">定时器定义</a>了解详细配置方法。</p>
</div>
<div class="paragraph">
<p>示例：流程会启动4次，间隔5分钟，从2011年3月11日，12:13开始</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;startEvent id="theStart"&gt;
  &lt;timerEventDefinition&gt;
    &lt;timeCycle&gt;R4/2011-03-11T12:13/PT5M&lt;/timeCycle&gt;
&lt;/timerEventDefinition&gt;
&lt;/startEvent&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>示例：流程会在选定的时间启动一次</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;startEvent id="theStart"&gt;
  &lt;timerEventDefinition&gt;
    &lt;timeDate&gt;2011-03-11T12:13:14&lt;/timeDate&gt;
  &lt;/timerEventDefinition&gt;
&lt;/startEvent&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnMessageStartEvent">8.2.9. 消息启动事件 Message Start Event</h4>
<div class="sect4">
<h5 id="messageStartEventDescription">描述 Description</h5>
<div class="paragraph">
<p><a href="#bpmnMessageEventDefinition">消息</a>启动事件，使用具名消息启动流程实例。它让我们可以使用消息名，有效地在一组可选的启动事件中<em>选择</em>正确的启动事件。</p>
</div>
<div class="paragraph">
<p>当<strong>部署</strong>具有一个或多个消息启动事件的流程定义时，会考虑下列因素：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>消息启动事件的名字，在给定流程定义中，必须是唯一的。一个流程定义不得包含多个同名的消息启动事件。如果流程定义中有两个或多个消息启动事件引用同一个消息，也即两个或多个消息启动事件引用了具有相同消息名字的消息，则Activiti在部署这个流程定义时，会抛出异常。</p>
</li>
<li>
<p>消息启动事件的名字，在所有已部署的流程定义中，必须是唯一的。如果流程定义中，一个或多个消息启动事件，引用了已经部署的另一流程定义中消息启动事件的消息名，则Activiti在部署这个流程定义时，会抛出异常。</p>
</li>
<li>
<p>流程版本：在部署流程定义的新版本时，会取消上一版本的消息订阅。即使新版本中并没有这个消息事件，仍然如此（取消上版本的消息订阅）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>当<strong>启动</strong>流程实例时，可以使用下列<code>RuntimeService</code>中的方法，触发消息启动事件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ProcessInstance startProcessInstanceByMessage(String messageName);
ProcessInstance startProcessInstanceByMessage(String messageName, Map&lt;String, Object&gt; processVariables);
ProcessInstance startProcessInstanceByMessage(String messageName, String businessKey, Map&lt;String, Object&lt; processVariables);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>messageName</code>是由<code>message</code>元素的<code>name</code>属性决定的名字。<code>message</code>元素被<code>messageEventDefinition</code>的<code>messageRef</code>属性引用。当<strong>启动</strong>流程实例时，请考虑下列因素：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>只有顶层流程（top-level process）才支持消息启动事件。嵌入式子流程不支持消息启动事件。</p>
</li>
<li>
<p>如果一个流程定义中有多个消息启动事件，<code>runtimeService.startProcessInstanceByMessage(&#8230;&#8203;)</code>允许选择合适的启动事件。</p>
</li>
<li>
<p>如果一个流程定义中有多个消息启动事件，与一个空启动事件，则<code>runtimeService.startProcessInstanceByKey(&#8230;&#8203;)</code>与<code>runtimeService.startProcessInstanceById(&#8230;&#8203;)</code>会使用空启动事件启动流程实例。</p>
</li>
<li>
<p>如果一个流程定义中有多个消息启动事件，而没有空启动事件，则<code>runtimeService.startProcessInstanceByKey(&#8230;&#8203;)</code>与<code>runtimeService.startProcessInstanceById(&#8230;&#8203;)</code>会抛出异常。</p>
</li>
<li>
<p>如果一个流程定义中只有一个消息启动事件，则<code>runtimeService.startProcessInstanceByKey(&#8230;&#8203;)</code>与<code>runtimeService.startProcessInstanceById(&#8230;&#8203;)</code>会使用这个消息启动事件启动新流程实例。</p>
</li>
<li>
<p>如果流程由调用活动（call activity）启动，则消息启动事件只有在下列情况下才被支持</p>
<div class="ulist">
<ul>
<li>
<p>除了消息启动事件，流程还有唯一的空启动事件</p>
</li>
<li>
<p>或者流程只有唯一的消息启动事件，而没有其他启动事件。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="messageStartEventGraphicalNotation">图示 Graphical notation</h5>
<div class="paragraph">
<p>消息启动事件，用其中有一个消息事件标志的圆圈表示。这个标志并未填充，用以表示捕获（接收）行为。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.start.message.event.png" alt="bpmn.start.message.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="messageStartEventXml">XML表示 XML representation</h5>
<div class="paragraph">
<p>消息启动事件的XML表示格式，为普通启动事件声明，加上messageEventDefinition子元素：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;definitions id="definitions"
  xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
  xmlns:activiti="http://activiti.org/bpmn"
  targetNamespace="Examples"
  xmlns:tns="Examples"&gt;

  &lt;message id="newInvoice" name="newInvoiceMessage" /&gt;

  &lt;process id="invoiceProcess"&gt;

    &lt;startEvent id="messageStart" &gt;
    	&lt;messageEventDefinition messageRef="tns:newInvoice" /&gt;
    &lt;/startEvent&gt;
    ...
  &lt;/process&gt;

&lt;/definitions&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnSignalStartEvent">8.2.10. 信号启动事件 Signal Start Event</h4>
<div class="sect4">
<h5 id="bpmnSignalStartEventDescription">描述 Description</h5>
<div class="paragraph">
<p><a href="#bpmnSignalEventDefinition">信号</a>启动事件，使用具名信号启动流程实例。这个信号可以由流程实例中的信号抛出中间事件（intermediary signal throw event），或者API（<em>runtimeService.signalEventReceivedXXX</em>方法）触发。这些情况下，所有拥有相同名字信号启动事件的流程定义都会被启动。</p>
</div>
<div class="paragraph">
<p>请注意这些情况下，都可以选择异步还是同步启动流程实例。</p>
</div>
<div class="paragraph">
<p>需要为API传递的<code>signalName</code>，是由<code>signal</code>元素的<code>name</code>属性决定的名字。<code>signal</code>元素被<code>signalEventDefinition</code>的<code>signalRef</code>属性所引用。</p>
</div>
</div>
<div class="sect4">
<h5 id="signalStartEventGraphicalNotation">图示 Graphical notation</h5>
<div class="paragraph">
<p>信号启动事件，用其中有一个信号事件标志的圆圈表示。这个标志并未填充，用以表示捕获（接收）行为。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.start.signal.event.png" alt="bpmn.start.signal.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="signalStartEventXml">XML表示 XML representation</h5>
<div class="paragraph">
<p>信号启动事件的XML表示格式，为普通启动事件声明，加上signalEventDefinition子元素：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;signal id="theSignal" name="The Signal" /&gt;

&lt;process id="processWithSignalStart1"&gt;
  &lt;startEvent id="theStart"&gt;
    &lt;signalEventDefinition id="theSignalEventDefinition" signalRef="theSignal"  /&gt;
  &lt;/startEvent&gt;
  &lt;sequenceFlow id="flow1" sourceRef="theStart" targetRef="theTask" /&gt;
  &lt;userTask id="theTask" name="Task in process A" /&gt;
  &lt;sequenceFlow id="flow2" sourceRef="theTask" targetRef="theEnd" /&gt;
	  &lt;endEvent id="theEnd" /&gt;
&lt;/process&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnErrorStartEvent">8.2.11. 错误启动事件 Error Start Event</h4>
<div class="sect4">
<h5 id="errorStartEventDescription">描述 Description</h5>
<div class="paragraph">
<p><a href="#bpmnErrorEventDefinition">错误</a>启动事件，可用于触发事件子流程（Event Sub-Process）。<strong>错误启动事件不能用于启动流程实例</strong>。</p>
</div>
<div class="paragraph">
<p>错误启动事件总是中断。</p>
</div>
</div>
<div class="sect4">
<h5 id="errorStartEventGraphicalNotation">图示 Graphical notation</h5>
<div class="paragraph">
<p>错误启动事件，用其中有一个错误事件标志的圆圈表示。这个标志并未填充，用以表示捕获（接收）行为。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.start.error.event.png" alt="bpmn.start.error.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="errorStartEventXml">XML表示 XML representation</h5>
<div class="paragraph">
<p>错误启动事件的XML表示格式，为普通启动事件声明，加上errorEventDefinition子元素：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;startEvent id="messageStart" &gt;
	&lt;errorEventDefinition errorRef="someError" /&gt;
&lt;/startEvent&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnEndEvent">8.2.12. 结束事件 End Events</h4>
<div class="paragraph">
<p>结束事件标志着（子）流程的（分支的）结束。结束事件<strong>总是抛出（型）事件</strong>。这意味着当流程执行到达结束事件时，会抛出一个<em>结果</em>。结果的类型由事件内部的黑色图标描绘。在XML表示中，类型由子元素声明给出。</p>
</div>
</div>
<div class="sect3">
<h4 id="bpmnNoneEndEvent">8.2.13. 空结束事件 None End Event</h4>
<div class="sect4">
<h5 id="noneEndEventDescription">描述 Description</h5>
<div class="paragraph">
<p>“空”结束事件，意味着当到达这个事件时，抛出的<em>结果</em>没有特别指定。因此，引擎除了结束当前执行分支之外，不会多做任何事情。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnNoneEndEventDescription">图示 Graphical notation</h5>
<div class="paragraph">
<p>空结束事件，用其中没有图标（没有结果类型）的粗圆圈表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.none.end.event.png" alt="bpmn.none.end.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnNoneStartEventXml">XML表示 XML representation</h5>
<div class="paragraph">
<p>空事件的XML表示格式，为普通结束事件声明，没有任何子元素（其它种类的结束事件都有子元素，用于声明其类型）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;endEvent id="end" name="my end event" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnErrorEndEvent">8.2.14. 错误结束事件 Error End Event</h4>
<div class="sect4">
<h5 id="bpmnErrorEndEventDescription">描述 Description</h5>
<div class="paragraph">
<p>当流程执行到达<strong>错误结束事件</strong>时，结束执行的当前分支，并抛出错误。这个错误可以<a href="#bpmnBoundaryErrorEvent">使用匹配的错误边界中间事件 intermediate boundary error event 捕获</a>。如果找不到匹配的错误边界事件，将会抛出异常。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnErrorEndEventGraphicalNotation">图示 Graphical notation</h5>
<div class="paragraph">
<p>错误结束事件事件，用内部有一个错误图标的标准结束事件（粗圆圈）表示。错误图标是全黑的，代表抛出的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.error.end.event.png" alt="bpmn.error.end.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnErrorEndEventXml">XML表示 XML representation</h5>
<div class="paragraph">
<p>错误结束事件，表示为结束事件，加上<em>errorEventDefinition</em>子元素：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;endEvent id="myErrorEndEvent"&gt;
  &lt;errorEventDefinition errorRef="myError" /&gt;
&lt;/endEvent&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>errorRef</em>属性可以引用在流程外定义的<em>error</em>元素：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;error id="myError" errorCode="123" /&gt;
...
&lt;process id="myProcess"&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>error</em>的<strong>errorCode</strong>用于查找匹配的错误捕获边界事件。如果<em>errorRef</em>不匹配任何已定义的<em>error</em>，则该<em>errorRef</em>会用做<em>errorCode</em>的快捷方式。这个快捷方式是Activiti特有的。下面的代码片段在功能上是相同的。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;error id="myError" errorCode="error123" /&gt;
...
&lt;process id="myProcess"&gt;
...
  &lt;endEvent id="myErrorEndEvent"&gt;
    &lt;errorEventDefinition errorRef="myError" /&gt;
  &lt;/endEvent&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>与下面的功能相同</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;endEvent id="myErrorEndEvent"&gt;
  &lt;errorEventDefinition errorRef="error123" /&gt;
&lt;/endEvent&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意<em>errorRef</em>必须遵从BPMN 2.0概要（schema），且必须是合法的QName。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnCancelEndEvent">8.2.15. 终止结束事件 Terminate End Event</h4>
<div class="sect4">
<h5 id="_描述_description">描述 Description</h5>
<div class="paragraph">
<p>当到达<em>终止结束事件</em>时，当前的流程实例或子流程会被终止。概念上说，当执行到达终止结束事件时，会判断第一个<em>范围 scope</em>（流程或子流程）并终止它。请注意在BPMN 2.0中，子流程可以是嵌入式子流程，调用活动，事件子流程，或事务子流程。有一条通用规则：当存在多实例的调用过程或嵌入式子流程时，只会终止一个实例，其他的实例与流程实例不会受影响。</p>
</div>
<div class="paragraph">
<p>可以添加一个可选属性<em>terminateAll</em>。当其为<em>true</em>时，无论该终止结束事件在流程定义中的位置，也无论它是否在子流程（甚至是嵌套子流程）中，都会终止（根）流程实例。</p>
</div>
</div>
<div class="sect4">
<h5 id="_图示_graphical_notation">图示 Graphical notation</h5>
<div class="paragraph">
<p>终止结束事件，用内部有一个全黑圆的标准结束事件（粗圆圈）表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.terminate.end.event.png" alt="bpmn.terminate.end.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_xml表示_xml_representation">XML表示 XML representation</h5>
<div class="paragraph">
<p>终止结束事件，表示为结束事件，加上<em>terminateEventDefinition</em>子元素。</p>
</div>
<div class="paragraph">
<p>请注意<em>terminateAll</em>属性是可选的（默认为<em>false</em>）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;endEvent id="myEndEvent &gt;
  &lt;terminateEventDefinition activiti:terminateAll="true"&gt;&lt;/terminateEventDefinition&gt;
&lt;/endEvent&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_取消结束事件_cancel_end_event">8.2.16. 取消结束事件 Cancel End Event</h4>
<div class="paragraph">
<p><a href="#experimental">[EXPERIMENTAL]</a><a id="bpmnCancelEndEventDescription"></a></p>
</div>
<div class="sect4">
<h5 id="_描述_description_2">描述 Description</h5>
<div class="paragraph">
<p>取消结束事件，只能与bpmn事务子流程（bpmn transaction subprocess）一起使用。当到达取消结束事件时，会抛出取消事件，且必须由取消边界事件（cancel boundary event）捕获。之后这个取消边界事件将取消事务，并触发补偿（compensation）。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCancelEndEventGraphicalNotation">图示 Graphical notation</h5>
<div class="paragraph">
<p>取消结束事件，用内部有一个取消图标的标准结束事件（粗圆圈）表示。取消图标是全黑的，代表抛出的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.cancel.end.event.png" alt="bpmn.cancel.end.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCancelEndEventXml">XML表示 XML representation</h5>
<div class="paragraph">
<p>取消结束事件，表示为结束事件，加上<em>cancelEventDefinition</em>子元素。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;endEvent id="myCancelEndEvent"&gt;
  &lt;cancelEventDefinition /&gt;
&lt;/endEvent&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnBoundaryEvent">8.2.17. 边界事件 Boundary Events</h4>
<div class="paragraph">
<p>边界事件是<em>捕获</em>（型）事件，依附在活动（activity）上（边界事件永远不会抛出）。这意味着当活动运行时，事件在<em>监听</em>特定类型的触发器。当事件<em>捕获</em>时，活动会被终止，并沿该事件的出口顺序流继续。</p>
</div>
<div class="paragraph">
<p>所有的边界事件都用相同的方式定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;boundaryEvent id="myBoundaryEvent" attachedToRef="theActivity"&gt;
      &lt;XXXEventDefinition/&gt;
&lt;/boundaryEvent&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>边界事件由下列（元素）定义：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>唯一标识符（流程范围）</p>
</li>
<li>
<p>通过<strong>attachedToRef</strong>属性定义的，对该事件所依附的活动的引用。请注意边界事件，与其所依附的活动，定义在相同级别（也就是说，边界事件并不包含在活动内部）。</p>
</li>
<li>
<p>定义了边界事件的类型的，<em>XXXEventDefinition</em>形式的XML子元素（例如<em>TimerEventDefinition</em>，<em>ErrorEventDefinition</em>，等等）。查阅特定边界事件类型，以了解更多细节。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="bpmnTimerBoundaryEvent">8.2.18. 定时器边界事件 Timer Boundary Event</h4>
<div class="sect4">
<h5 id="timerBoundaryEventDescription">描述 Description</h5>
<div class="paragraph">
<p>定时器边界事件的行为像是跑表与闹钟。当执行到达边界事件所依附的活动时，启动定时器。当定时器触发时（例如在特定事件间隔后），活动会被中断，沿着边界事件继续执行。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnTimerBoundaryEventGraphicalNotation">图示 Graphical Notation</h5>
<div class="paragraph">
<p>定时器边界事件，用内部有一个定时器图标的标准边界事件（圆圈）表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.boundary.timer.event.png" alt="bpmn.boundary.timer.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnTimerBoundaryEventXml">XML表示 XML Representation</h5>
<div class="paragraph">
<p>定时器边界事件与<a href="#bpmnBoundaryEvent">一般边界事件</a>一样定义。其中类型子元素为<strong>timerEventDefinition</strong>元素。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;boundaryEvent id="escalationTimer" cancelActivity="true" attachedToRef="firstLineSupport"&gt;
  &lt;timerEventDefinition&gt;
    &lt;timeDuration&gt;PT4H&lt;/timeDuration&gt;
  &lt;/timerEventDefinition&gt;
&lt;/boundaryEvent&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>请参考<a href="#timerEventDefinitions">定时器事件定义</a>了解定时器配置的细节。</p>
</div>
<div class="paragraph">
<p>上面的例子在图示中，圆圈画为虚线：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.non.interrupting.boundary.timer.event.png" alt="bpmn.non.interrupting.boundary.timer.event">
</div>
</div>
<div class="paragraph">
<p>其典型使用场景，是发送额外的升级邮件，但不中断正常的流程流向。</p>
</div>
<div class="paragraph">
<p>在BPMN 2.0中，中断与非中断定时器事件是不同的。默认为中断。非中断意味着最初的活动<strong>不会</strong>被中断，而会保留。并会创建额外的执行，用于处理事件的出口转移（outgoing transition）。在XML表示中，<em>cancelActivity</em>属性设置为false。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;boundaryEvent id="escalationTimer" cancelActivity="false" attachedToRef="firstLineSupport"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>定时器边界事件只有在作业或异步执行器启用时才能触发（也就是说，需要在<code>activiti.cfg.xml</code>中，将<em>jobExecutorActivate</em>或者<em>asyncExecutorActivate</em>设置为<code>true</code>。因为默认情况下，作业与异步执行器都是禁用的。）</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnKnownIssueBoundaryEvent">边界事件的已知问题 Known issue with boundary events</h5>
<div class="paragraph">
<p>所有类型的边界事件，都有一个关于并发的已知问题。不能在边界事件上附加多个出口顺序流（查看问题<a href="https://activiti.atlassian.net/browse/ACT-47">ACT-47</a>）。这个问题的解决方案，是使用一条出口顺序流，指向并行网关。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.known.issue.boundary.event.png" alt="bpmn.known.issue.boundary.event">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnBoundaryErrorEvent">8.2.19. 错误边界事件 Error Boundary Event</h4>
<div class="sect4">
<h5 id="bpmnBoundaryErrorEventDescription">描述 Description</h5>
<div class="paragraph">
<p>在活动边界上的错误<em>捕获</em>中间（事件），或简称<strong>错误边界事件</strong>，捕获其依附的活动范围内抛出的错误。</p>
</div>
<div class="paragraph">
<p>在<a href="#bpmnSubProcess">嵌入式子流程</a>或者<a href="#bpmnCallActivity">调用活动</a>上定义错误边界事件最有意义，因为子流程会为其中的所有活动创建范围。错误由<a href="#bpmnErrorEndEvent">错误结束事件</a>抛出。这样的错误会逐层向其上级父范围传播，直到找到一个错误边界事件的范围，该范围定义了匹配的错误事件定义。</p>
</div>
<div class="paragraph">
<p>当错误事件被捕获时，边界事件定义所在的活动会被销毁，同时销毁其中所有的当前执行（例如，并行活动，嵌套子流程，等等）。流程执行沿着边界事件的出口顺序流继续。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundaryErrorEventgraphicalNotation">图示 Graphical notation</h5>
<div class="paragraph">
<p>错误边界事件，用内部有一个错误图标的标准中间事件（两层圆圈）表示。错误图标是白色的，代表<em>捕获</em>的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.boundary.error.event.png" alt="bpmn.boundary.error.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundaryErrorEventXml">XML表示 Xml representation</h5>
<div class="paragraph">
<p>错误边界事件与标准<a href="#bpmnBoundaryEvent">边界事件</a>一样定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;boundaryEvent id="catchError" attachedToRef="mySubProcess"&gt;
  &lt;errorEventDefinition errorRef="myError"/&gt;
&lt;/boundaryEvent&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>在<a href="#bpmnBoundaryEvent">边界事件</a>中，<em>errorRef</em>引用一个流程元素外定义的错误：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;error id="myError" errorCode="123" /&gt;
...
&lt;process id="myProcess"&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>errorCode</strong>用于匹配捕获的错误：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果省略了<em>errorRef</em>，错误边界事件会捕获<strong>所有错误事件</strong>，无论<em>error</em>的errorCode是什么。</p>
</li>
<li>
<p>如果提供了<em>errorRef</em>，并且其引用了存在的<em>error</em>，则边界事件<strong>只会捕获相同错误代码的错误</strong>。</p>
</li>
<li>
<p>如果提供了<em>errorRef</em>，但BPMN 2.0文件中没有定义<em>error</em>，则<strong>errorRef会用作errorCode</strong>（与错误结束事件类似）。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundaryErrorEventExample">示例 Example</h5>
<div class="paragraph">
<p>下面的示例流程展示了如何使用错误结束事件。当<em>'Review profitability (审核盈利能力)'</em>用户任务完成，并指出提供的信息不足时，会抛出错误。当这个错误被子流程边界捕获时，<em>'Review sales lead (审核销售线索)'</em>子流程中的所有运行中活动都会被销毁（即使<em>'Review customer rating 审核客户等级'</em>还没有完成），并创建<em>'Provide additional details (提供更多信息)'</em>用户任务。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.boundary.error.example.png" alt="bpmn.boundary.error.example">
</div>
</div>
<div class="paragraph">
<p>这个流程作为演示配置的示例提供。可以在<em>org.activiti.examples.bpmn.event.error</em>包中找到流程XML与单元测试。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnBoundarySignalEvent">8.2.20. 信号边界事件 Signal Boundary Event</h4>
<div class="sect4">
<h5 id="bpmnBoundarySignalEventDescription">描述 Description</h5>
<div class="paragraph">
<p>依附在活动边界上的<a href="#bpmnSignalEventDefinition">信号</a>捕获中间（事件），或简称<strong>信号边界事件</strong>，捕获与其信号定义具有相同信号名的信号。</p>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>与其他事件例如错误边界事件不同的是，信号边界事件不只是捕获其所依附范围抛出的信号。信号边界事件为全局范围（广播）的，意味着信号可以从任何地方抛出，甚至是不同的流程实例。</p>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>与其他事件如错误事件不同，信号在被捕获后不会被消耗。如果有两个激活的信号边界事件，捕获相同的信号事件，则两个边界事件都会被触发，哪怕它们不在同一个流程实例里。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundarySignalEventGraphicalNotation">图示 Graphical notation</h5>
<div class="paragraph">
<p>信号边界事件，用内部有一个信号图标的标准中间事件（两层圆圈）表示。信号图标是白色的，代表<em>捕获</em>的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.boundary.signal.event.png" alt="bpmn.boundary.signal.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundarySignalEventXml">XML表示 XML representation</h5>
<div class="paragraph">
<p>信号边界事件与标准<a href="#bpmnBoundaryEvent">边界事件</a>一样定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;boundaryEvent id="boundary" attachedToRef="task" cancelActivity="true"&gt;
          &lt;signalEventDefinition signalRef="alertSignal"/&gt;
&lt;/boundaryEvent&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundarySignalEventExample">示例 Example</h5>
<div class="paragraph">
<p>查看<a href="#bpmnSignalEventDefinition">信号事件定义</a>章节内容。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnBoundaryMessageEvent">8.2.21. 消息边界事件 Message Boundary Event</h4>
<div class="sect4">
<h5 id="bpmnBoundaryMessageEventDescription">描述 Description</h5>
<div class="paragraph">
<p>在活动边界上的<a href="#bpmnMessageEventDefinition">消息</a><em>捕获</em>中间（事件），或简称<strong>消息边界事件</strong>，捕获与其消息定义具有相同消息名的消息。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundaryMessageEventGraphicalNotation">图示 Graphical notation</h5>
<div class="paragraph">
<p>消息边界事件，用内部有一个消息图标的标准中间事件（两层圆圈）表示。信号图标是白色的，代表<em>捕获</em>的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.boundary.message.event.png" alt="bpmn.boundary.message.event">
</div>
</div>
<div class="paragraph">
<p>请注意消息边界事件既可以是中断型的（右手边），也可以是非中断型的（左手边）。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundaryMessageEventXml">XML表示 XML representation</h5>
<div class="paragraph">
<p>消息边界事件与标准<a href="#bpmnBoundaryEvent">边界事件</a>一样定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;boundaryEvent id="boundary" attachedToRef="task" cancelActivity="true"&gt;
          &lt;messageEventDefinition messageRef="newCustomerMessage"/&gt;
&lt;/boundaryEvent&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundaryMessageEventExample">示例 Example</h5>
<div class="paragraph">
<p>查看<a href="#bpmnMessageEventDefinition">消息事件定义</a>章节内容。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnBoundaryCancelEvent">8.2.22. 取消边界事件 Cancel Boundary Event</h4>
<div class="paragraph">
<p><a href="#experimental">[EXPERIMENTAL]</a><a id="bpmnBoundaryCancelEventDescription"></a></p>
</div>
<div class="sect4">
<h5 id="_描述_description_3">描述 Description</h5>
<div class="paragraph">
<p>依附在事务子流程边界上的取消<em>捕获</em>中间（事件），或简称<strong>取消边界事件</strong>，在事务取消时触发。当取消边界事件触发时，首先会中断当前范围的所有活动执行。接下来，启动事务范围内所有有效的的补偿边界事件（compensation boundary event）。补偿会同步执行，也就是说在离开事务前，边界事件会等待补偿完成。当补偿完成时，使用取消边界事件的出口顺序流，离开事务子流程。</p>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>一个事务子流程只允许一个取消边界事件。</p>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>如果事务子流程中有嵌套的子流程，只有成功完成的子流程才会触发补偿。</p>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>如果取消边界事件放置在具有多实例特性的事务子流程上，如果一个实例触发了取消，则边界事件将取消所有实例。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundaryCancelEventGraphicalNotation">图示 Graphical notation</h5>
<div class="paragraph">
<p>取消边界事件，用内部有一个取消图标的标准中间事件（两层圆圈）表示。取消图标是白色的（未填充），代表<em>捕获</em>的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.boundary.cancel.event.png" alt="bpmn.boundary.cancel.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundarySignalEventXml">XML表示 XML representation</h5>
<div class="paragraph">
<p>取消边界事件与标准<a href="#bpmnBoundaryEvent">边界事件</a>一样定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;boundaryEvent id="boundary" attachedToRef="transaction" &gt;
          &lt;cancelEventDefinition /&gt;
&lt;/boundaryEvent&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>因为取消边界事件总是中断型的，因此不需要<code>cancelActivity</code>属性。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnBoundaryCompensationEvent">8.2.23. 补偿边界事件 Compensation Boundary Event</h4>
<div class="paragraph">
<p><a href="#experimental">[EXPERIMENTAL]</a><a id="bpmnBoundaryCompensationEventDescription"></a></p>
</div>
<div class="sect4">
<h5 id="_描述_description_4">描述 Description</h5>
<div class="paragraph">
<p>依附在活动边界上的补偿<em>捕获</em>中间（事件），或简称<strong>补偿边界事件</strong>，可以为活动附加补偿处理器。</p>
</div>
<div class="paragraph">
<p>补偿边界事件必须通过直接关联的方式，引用单个的补偿处理器。</p>
</div>
<div class="paragraph">
<p>补偿边界事件与其它边界事件的活动策略不同。其它边界事件，例如信号边界事件，当其依附的活动启动时激活；当离开该活动时，会被解除，并取消相应的事件订阅。而补偿边界事件不是这样。补偿边界事件在其依附的活动<strong>成功完成</strong>时激活，同时创建补偿事件的相应订阅。当补偿事件被触发，或者相应的流程实例结束时，才会移除订阅。请考虑下列因素：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>当补偿被触发时，补偿边界事件关联的补偿处理器会被调用，次数与其依附的活动成功完成的次数相同。</p>
</li>
<li>
<p>如果补偿边界事件依附在具有多实例特性的活动上，则会为每一个实例创建补偿事件订阅。</p>
</li>
<li>
<p>如果补偿边界事件依附在位于循环内部的活动上，则每次该活动执行时，都会创建一个补偿事件订阅。</p>
</li>
<li>
<p>如果流程实例结束，则取消补偿事件的订阅。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>嵌入式子流程不支持补偿边界事件。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundaryCompensationEventGraphicalNotation">图示 Graphical notation</h5>
<div class="paragraph">
<p>补偿边界事件，用内部有一个补偿图标的标准中间事件（两层圆圈）表示。补偿图标是白色的（未填充），代表<em>捕获</em>的含义。另外，补偿边界事件使用单向连接关联补偿处理器，如下图所示：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.boundary.compensation.event.png" alt="bpmn.boundary.compensation.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundaryCompensationEventXml">XML表示 XML representation</h5>
<div class="paragraph">
<p>补偿边界事件与标准<a href="#bpmnBoundaryEvent">边界事件</a>一样定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;boundaryEvent id="compensateBookHotelEvt" attachedToRef="bookHotel" &gt;
          &lt;compensateEventDefinition /&gt;
&lt;/boundaryEvent&gt;

&lt;association associationDirection="One" id="a1"  sourceRef="compensateBookHotelEvt" targetRef="undoBookHotel" /&gt;

&lt;serviceTask id="undoBookHotel" isForCompensation="true" activiti:class="..." /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>补偿边界事件在活动完成后才激活，因此不支持<code>cancelActivity</code>属性。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnIntermediateCatchingEvent">8.2.24. 捕获中间事件 Intermediate Catching Events</h4>
<div class="paragraph">
<p>所有的捕获中间事件都使用相同方式定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;intermediateCatchEvent id="myIntermediateCatchEvent" &gt;
      &lt;XXXEventDefinition/&gt;
&lt;/intermediateCatchEvent&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>捕获中间事件由下列（元素）定义</p>
</div>
<div class="ulist">
<ul>
<li>
<p>唯一标识符（流程范围）</p>
</li>
<li>
<p>定义了捕获中间事件类型的，<em>XXXEventDefinition</em>形式的XML子元素（例如<em>TimerEventDefinition</em>等）。查阅特定中间捕获事件类型，以了解更多细节。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="bpmnTimerIntermediateEvent">8.2.25. 定时器捕获中间事件 Timer Intermediate Catching Event</h4>
<div class="sect4">
<h5 id="bpmnTimerIntermediateEventDescription">描述 Description</h5>
<div class="paragraph">
<p>定时器捕获中间事件的行为像是跑表。当执行到达捕获事件活动（catching event activity）时，启动定时器；当定时器触发时（例如在一段时间间隔后），沿定时器中间事件的出口顺序流继续执行。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnTimerIntermediateEventGraphicalNotation">图示 Graphical Notation</h5>
<div class="paragraph">
<p>定时器中间事件，用内部有定时器图标的中间捕获事件表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.intermediate.timer.event.png" alt="bpmn.intermediate.timer.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnTimerIntermediateEventXml">XML表示 XML Representation</h5>
<div class="paragraph">
<p>定时器中间事件与<a href="#bpmnIntermediateCatchingEvent">捕获中间事件</a>一样定义。指定类型的子元素为<strong>timerEventDefinition</strong>元素。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;intermediateCatchEvent id="timer"&gt;
  &lt;timerEventDefinition&gt;
    &lt;timeDuration&gt;PT5M&lt;/timeDuration&gt;
  &lt;/timerEventDefinition&gt;
&lt;/intermediateCatchEvent&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>查看<a href="#timerEventDefinitions">定时器事件定义</a>了解详细配置。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnIntermediateSignalEvent">8.2.26. 信号捕获中间事件 Signal Intermediate Catching Event</h4>
<div class="sect4">
<h5 id="bpmnIntermediateSignalEventDescription">描述 Description</h5>
<div class="paragraph">
<p><a href="#bpmnSignalEventDefinition">信号</a><em>捕获</em>中间事件，捕获与其引用的信号定义具有相同信号名称的信号。</p>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>与其他事件如错误事件不同，信号在被捕获后不会被消耗。如果有两个激活的信号中间事件，捕获相同的信号事件，则两个中间事件都会被触发，哪怕它们不在同一个流程实例里。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateSignalEventGraphicalNotation">图示 Graphical notation</h5>
<div class="paragraph">
<p>信号捕获中间事件，用内部有信号图标的标准中间事件（两层圆圈）表示。信号图标是白色的（未填充），代表<em>捕获</em>的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.intermediate.signal.catch.event.png" alt="bpmn.intermediate.signal.catch.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateSignalEventXml">XML表示 XML representation</h5>
<div class="paragraph">
<p>信号中间事件与<a href="#bpmnIntermediateCatchingEvent">捕获中间事件</a>一样定义。指定类型的子元素为<strong>signalEventDefinition</strong>元素。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;intermediateCatchEvent id="signal"&gt;
  &lt;signalEventDefinition signalRef="newCustomerSignal" /&gt;
&lt;/intermediateCatchEvent&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateSignalEventExample">示例 Example</h5>
<div class="paragraph">
<p>查看<a href="#bpmnSignalEventDefinition">信号事件定义</a>章节。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnIntermediateMessageEvent">8.2.27. 消息捕获中间事件 Message Intermediate Catching Event</h4>
<div class="sect4">
<h5 id="bpmnIntermediateMessageEventDescription">描述 Description</h5>
<div class="paragraph">
<p><a href="#bpmnMessageEventDefinition">消息</a><em>捕获</em>中间事件，捕获特定名字的消息。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateMessageEventGraphicalNotation">图示 Graphical notation</h5>
<div class="paragraph">
<p>消息捕获中间事件，用内部有消息图标的标准中间事件（两层圆圈）表示。消息图标是白色的（未填充），代表<em>捕获</em>的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.intermediate.message.catch.event.png" alt="bpmn.intermediate.message.catch.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateSignalEventXml">XML表示 XML representation</h5>
<div class="paragraph">
<p>消息中间事件与<a href="#bpmnIntermediateCatchingEvent">捕获中间事件</a>一样定义。指定类型的子元素为<strong>messageEventDefinition</strong>元素。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;intermediateCatchEvent id="message"&gt;
  &lt;messageEventDefinition signalRef="newCustomerMessage" /&gt;
&lt;/intermediateCatchEvent&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateMessageEventExample">示例 Example</h5>
<div class="paragraph">
<p>查看<a href="#bpmnMessageEventDefinition">消息事件定义</a>章节。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnIntermediateThrowEvent">8.2.28. 抛出中间事件 Intermediate Throwing Event</h4>
<div class="paragraph">
<p>所有的抛出中间事件都使用相同方式定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;intermediateThrowEvent id="myIntermediateThrowEvent" &gt;
      &lt;XXXEventDefinition/&gt;
&lt;/intermediateThrowEvent&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>抛出中间事件由下列（元素）定义</p>
</div>
<div class="ulist">
<ul>
<li>
<p>唯一标识符（流程范围）</p>
</li>
<li>
<p>定义了抛出中间事件类型的，<em>XXXEventDefinition</em>形式的XML子元素（例如<em>signalEventDefinition</em>等）。查阅特定中间抛出事件类型，以了解更多细节。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="bpmnIntermediateThrowNoneEvent">8.2.29. 空抛出中间事件 Intermediate Throwing None Event</h4>
<div class="paragraph">
<p>下面的流程图展示了空中间事件的简单例子，其用于指示流程已经到达了某种状态。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.intermediate.none.event.png" alt="bpmn.intermediate.none.event">
</div>
</div>
<div class="paragraph">
<p>基本上添加一个<a href="#executionListeners">执行监听器 execution listener</a>后，空中间事件就可以成为很好的监视某些KPI（Key Performance Indicators 关键绩效指标）的钩子。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;intermediateThrowEvent id="noneEvent"&gt;
  &lt;extensionElements&gt;
    &lt;activiti:executionListener class="org.activiti.engine.test.bpmn.event.IntermediateNoneEventTest$MyExecutionListener" event="start" /&gt;
  &lt;/extensionElements&gt;
&lt;/intermediateThrowEvent&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>你也可以添加一些自己的代码，将部分事件发送给你的BAM（Business Activity Monitoring 业务活动监控）工具，或者DWH（Data Warehouse 数据仓库）。引擎本身不会在事件中做任何事情，只是从中穿过。</p>
</div>
</div>
<div class="sect3">
<h4 id="bpmnIntermediateThrowSignalEvent">8.2.30. 信号抛出中间事件 Signal Intermediate Throwing Event</h4>
<div class="sect4">
<h5 id="bpmnIntermediateThrowSignalEventDescription">描述 Description</h5>
<div class="paragraph">
<p><a href="#bpmnSignalEventDefinition">信号</a><em>抛出</em>中间事件，抛出已定义信号的信号事件。</p>
</div>
<div class="paragraph">
<p>在Activiti中，信号会广播至所有的激活的处理器（也就是说，所有的捕获信号事件）。信号可以同步或异步地发布。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在默认配置中，信号<strong>同步地</strong>传递。这意味着抛出（信号的）流程实例会等待，直到信号传递至所有的捕获（信号的）流程实例。所有的捕获流程实例也会在与抛出流程实例相同的事务中，也就是说如果收到通知的流程实例中，有一个实例产生了技术错误（抛出异常），则所有相关的实例都会失败。</p>
</li>
<li>
<p>信号也可以<strong>异步地</strong>传递。这是由到达抛出信号事件时，激活的是哪一个（发送）处理器来决定的。对于每个激活的处理器，JobExecutor会为其存储并传递一个异步通知消息，asynchronous notification message（作业 Job）。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateThrowSignalEventGraphicalNotation">图示 Graphical notation</h5>
<div class="paragraph">
<p>消息抛出中间事件，用内部有信号图标的标准中间事件（两层圆圈）表示。信号图标是黑色的（已填充），代表<em>抛出</em>的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.intermediate.signal.throw.event.png" alt="bpmn.intermediate.signal.throw.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateThrowSignalEventXml">XML表示 XML representation</h5>
<div class="paragraph">
<p>信号中间事件与<a href="#bpmnIntermediateThrowEvent">抛出中间事件</a>一样定义。指定类型的子元素为<strong>signalEventDefinition</strong>元素。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;intermediateThrowEvent id="signal"&gt;
  &lt;signalEventDefinition signalRef="newCustomerSignal" /&gt;
&lt;/intermediateThrowEvent&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>异步信号事件像这样定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;intermediateThrowEvent id="signal"&gt;
  &lt;signalEventDefinition signalRef="newCustomerSignal" activiti:async="true" /&gt;
&lt;/intermediateThrowEvent&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateSignalEventExample">示例 Example</h5>
<div class="paragraph">
<p>查看<a href="#bpmnSignalEventDefinition">信号事件定义</a>章节。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnIntermediateThrowCompensationEvent">8.2.31. 补偿抛出中间事件 Compensation Intermediate Throwing Event</h4>
<div class="paragraph">
<p><a href="#experimental">[EXPERIMENTAL]</a><a id="bpmnIntermediateThrowCompensationEventDescription"></a></p>
</div>
<div class="sect4">
<h5 id="_描述_description_5">描述 Description</h5>
<div class="paragraph">
<p>补偿<em>抛出</em>中间事件，可用于触发补偿。</p>
</div>
<div class="paragraph">
<p><strong>触发补偿：</strong>补偿既可以为设计的活动触发，也可以为补偿事件所在的范围触发。补偿由活动所关联的补偿处理器执行。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>抛出补偿时，活动关联的补偿处理器执行的次数，与活动成功完成的次数相同。</p>
</li>
<li>
<p>如果为当前范围抛出了补偿，则当前范围中所有的活动都会被补偿，包括并行分支上的活动。</p>
</li>
<li>
<p>补偿分层触发：如果将要被补偿的活动是一个子流程，则该子流程中所有的活动都会触发补偿。如果该子流程有嵌套的活动，则会递归地抛出补偿。然而，补偿不会传播至流程的<strong>上层</strong>：如果子流程中触发了补偿，该补偿不会传播至子流程范围外的活动。BPMN规范指出，补偿为“与子流程在相同级别”的活动触发。</p>
</li>
<li>
<p>在Activiti中，补偿按照执行的相反顺序运行。这意味着最后完成的活动会第一个补偿，等等。</p>
</li>
<li>
<p>补偿抛出中间事件，可用于补偿已经成功完成的事务子流程。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>如果抛出补偿的范围中有一个子流程，而该子流程包含有关联了补偿处理器的活动，则当抛出补偿时，只有当该子流程成功完成的情况，补偿才会传播至该子流程。如果子流程内嵌套的部分活动已经完成，并附加了补偿处理器，则如果包含这些活动的子流程还没有完成，这些补偿处理器不会执行。参考下面的例子：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.throw.compensation.example1.png" alt="bpmn.throw.compensation.example1">
</div>
</div>
<div class="paragraph">
<p>在这个流程中，有两个并行的执行。一个执行嵌入子流程，另一个执行“charge credit card（信用卡付款）”活动。假定两个执行都已开始，且第一个并行执行正等待用户完成“review bookings（检查预定）”任务。第二个执行进行了“charge credit card（信用卡付款）”活动的操作，抛出了一个错误，导致“cancel reservations（取消预订）”事件触发补偿。这时并行子流程还未完成，意味着补偿不会传播至该子流程，因此不会执行“cancel hotel reservation（取消酒店预订）”补偿处理器。而如果“cancel reservations（取消预订）”运行前，这个用户任务（因此该嵌入式子流程也）已经完成，则补偿会传播至该嵌入式子流程。</p>
</div>
<div class="paragraph">
<p><strong>流程变量：</strong>当补偿嵌入式子流程时，用于执行补偿处理器的执行，可以以变量在子流程完成时所处的状态，访问子流程的局部流程变量。围了实现这一点，会为范围执行（为执行子流程所创建的执行）所关联的流程变量，进行快照。意味着：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>子流程范围内创建的并行执行所添加的变量，补偿执行器无法访问。</p>
</li>
<li>
<p>上层的执行关联的流程变量（例如流程实例的执行关联的流程变量），不在该快照中：补偿处理器（本就）可以以其在抛出补偿时所处的状态，访问这些流程变量。</p>
</li>
<li>
<p>只会为嵌入式子流程，而不会为其他活动，进行变量快照。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>目前的限制：</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>目前不支持<code>waitForCompletion="false"</code>。当补偿抛出中间事件触发补偿时，只有在补偿成功完成时，才会离开该事件。</p>
</li>
<li>
<p>补偿现在由并行执行来运行。该并行执行按照补偿活动完成的逆序启动。Activiti的后续版本可能会添加选项，使补偿可以按（活动完成的）顺序运行。</p>
</li>
<li>
<p>补偿不会传播至调用活动（call activity）生成的子流程。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateThrowCompensationEventGraphicalNotation">图示 Graphical notation</h5>
<div class="paragraph">
<p>补偿抛出中间事件，用内部有补偿图标的标准中间事件（两层圆圈）表示。补偿图标是黑色的（已填充），代表<em>抛出</em>的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.intermediate.compensation.throw.event.png" alt="bpmn.intermediate.compensation.throw.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateThrowSignalEventXml">Xml representation</h5>
<div class="paragraph">
<p>补偿中间事件与<a href="#bpmnIntermediateThrowEvent">抛出中间事件</a>一样定义。指定类型的子元素为<strong>compensateEventDefinition</strong>元素。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;intermediateThrowEvent id="throwCompensation"&gt;
	&lt;compensateEventDefinition /&gt;
&lt;/intermediateThrowEvent&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>另外，<code>activityRef</code>可选项可用于为指定的范围/活动触发补偿：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;intermediateThrowEvent id="throwCompensation"&gt;
	&lt;compensateEventDefinition activityRef="bookHotel" /&gt;
&lt;/intermediateThrowEvent&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bpmnSequenceFlow">8.3. 顺序流 Sequence Flow</h3>
<div class="sect3">
<h4 id="sequenceFlowDescription">8.3.1. 描述 Description</h4>
<div class="paragraph">
<p>顺序流是流程中两个元素间的连接器。当流程执行中，一个元素被访问后，会沿着所有的出口顺序流继续。这意味着BPMN 2.0的默认性质是并行的：两个出口顺序流，会创建两个独立的，并行的执行路径。</p>
</div>
</div>
<div class="sect3">
<h4 id="sequenceFlowGraphicalNotation">8.3.2. 图示 Graphical notation</h4>
<div class="paragraph">
<p>顺序流，用从源元素指向目标元素的箭头表示。箭头总是指向目标元素。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.sequence.flow.png" alt="bpmn.sequence.flow">
</div>
</div>
</div>
<div class="sect3">
<h4 id="sequenceFlowXml">8.3.3. XML表示 XML representation</h4>
<div class="paragraph">
<p>顺序流需要有流程唯一的<strong>id</strong>，以及对存在的<strong>源</strong>与<strong>目标</strong>元素的引用。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;sequenceFlow id="flow1" sourceRef="theStart" targetRef="theTask" /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnConditionalSequenceFlow">8.3.4. 条件顺序流 Conditional sequence flow</h4>
<div class="sect4">
<h5 id="condSeqFlowDescription">描述 Description</h5>
<div class="paragraph">
<p>在顺序流上可以定义条件。当离开BPMN 2.0活动时，默认行为是计算其出口顺序流上的条件。当条件计算为<em>true</em>时，选择该出口顺序流。如果该方法选择了多条顺序流，则会生成多个<em>执行</em>，流程会以并行方式继续。</p>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>上面的介绍对BPMN 2.0活动（与事件）有效，但不适用于网关（gateway）。不同类型的网关，会用不同的方式处理带有条件的顺序流。</p>
</div>
</div>
<div class="sect4">
<h5 id="conditionalSequenceFlowGraphicalNotation">图示 Graphical notation</h5>
<div class="paragraph">
<p>条件顺序流，用起点带有小菱形的一般顺序流表示。条件表达式挨着顺序流显示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.conditional.sequence.flow.png" alt="bpmn.conditional.sequence.flow">
</div>
</div>
</div>
<div class="sect4">
<h5 id="conditionalSequenceFlowXml">XML表示 XML representation</h5>
<div class="paragraph">
<p>条件顺序流的XML表示格式，为含有<strong>conditionExpression（条件表达式）</strong>子元素的普通顺序流。请注意目前只支持<em>tFormalExpressions</em>。省略<em>xsi:type=""</em>定义会默认为唯一支持的表达式类型。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;sequenceFlow id="flow" sourceRef="theStart" targetRef="theTask"&gt;
  &lt;conditionExpression xsi:type="tFormalExpression"&gt;
    &lt;![CDATA[${order.price &gt; 100 &amp;&amp; order.price &lt; 250}]]&gt;
  &lt;/conditionExpression&gt;
&lt;/sequenceFlow&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>目前conditionalExpressions<strong>只能使用UEL</strong>，详细信息可以在<a href="#apiExpressions">表达式</a>章节找到。使用的表达式需要能解析为boolean值，否则当计算条件时会抛出异常。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>下面的例子，通过典型的JavaBean的方式，使用getter引用流程变量的数据。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;conditionExpression xsi:type="tFormalExpression"&gt;
  &lt;![CDATA[${order.price &gt; 100 &amp;&amp; order.price &lt; 250}]]&gt;
&lt;/conditionExpression&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>这个例子调用了一个解析为boolean值的方法。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;conditionExpression xsi:type="tFormalExpression"&gt;
  &lt;![CDATA[${order.isStandardOrder()}]]&gt;
&lt;/conditionExpression&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Activiti发行版中包含了下列示例流程，展示值表达式与方法表达式的使用（参见<em>org.activiti.examples.bpmn.expression</em>）。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.uel-expression.on.seq.flow.png" alt="bpmn.uel expression.on.seq.flow">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnDefaultSequenceFlow">8.3.5. 默认顺序流 Default sequence flow</h4>
<div class="sect4">
<h5 id="bpmnDefaultSequenceFlowDescription">描述 Description</h5>
<div class="paragraph">
<p>所有的BPMN 2.0任务与网关，都可以使用<strong>默认顺序流</strong>。这种顺序流只有当没有其他顺序流可以选择时，才会被选择为活动的出口顺序流。默认顺序流上的条件会被忽略。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnDefaultSequenceFlowGraphicalNotation">图示 Graphical notation</h5>
<div class="paragraph">
<p>默认顺序流，用起点带有“斜线”标记的一般顺序流表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.default.sequence.flow.png" alt="bpmn.default.sequence.flow">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnDefaultSequenceFlowXmlRepresentation">XML表示 XML representation</h5>
<div class="paragraph">
<p>活动的默认顺序流，由该活动的<strong>default属性</strong>定义。下面的XML片段展示了一个排他网关（exclusive gateway），带有默认顺序流<em>flow 2</em>。只有当<em>conditionA</em>与<em>conditionB</em>都计算为false时，默认顺序流才会被选择为网关的出口顺序流。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;exclusiveGateway id="exclusiveGw" name="Exclusive Gateway" default="flow2" /&gt;
&lt;sequenceFlow id="flow1" sourceRef="exclusiveGw" targetRef="task1"&gt;
  &lt;conditionExpression xsi:type="tFormalExpression"&gt;${conditionA}&lt;/conditionExpression&gt;
&lt;/sequenceFlow&gt;
&lt;sequenceFlow id="flow2" sourceRef="exclusiveGw" targetRef="task2"/&gt;
&lt;sequenceFlow id="flow3" sourceRef="exclusiveGw" targetRef="task3"&gt;
  &lt;conditionExpression xsi:type="tFormalExpression"&gt;${conditionB}&lt;/conditionExpression&gt;
&lt;/sequenceFlow&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>对应下面的图示：</p>
</div>
<div class="paragraph">
<p>（原图缺失）</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bpmnGateways">8.4. 网关 Gateways</h3>
<div class="paragraph">
<p>网关用于控制执行的流向（或者按BPMN 2.0描述的，执行的<em>token 标志</em>）。网关可以<em>消耗</em>与<em>生成</em>标志。</p>
</div>
<div class="paragraph">
<p>网关用其中带有图标的菱形表示。该图标显示了网关的类型。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.gateway.png" alt="bpmn.gateway">
</div>
</div>
<div class="sect3">
<h4 id="bpmnExclusiveGateway">8.4.1. 排他网关 Exclusive Gateway</h4>
<div class="sect4">
<h5 id="exclusiveGatewayDescription">描述 Description</h5>
<div class="paragraph">
<p>排他网关（也叫<em>异或网关 XOR gateway</em>，或者更专业的，<em>基于数据的排他网关 exclusive data-based gateway</em>），用于为流程中的<strong>决策</strong>建模。当执行到达这个网关时，所有出口顺序流会按照它们定义的顺序进行计算。条件计算为true的顺序流（当没有设置条件时，认为顺序流定义为<em>true</em>）会被选择用于继续流程。</p>
</div>
<div class="paragraph">
<p><strong>请注意这里出口顺序流的含义与BPMN 2.0中的一般情况不一样。一般情况下，所有条件计算为true的顺序流，都会被选择继续，并行执行。而使用排他网关时，只会选择一条顺序流。当多条顺序流的条件都计算为true时，其中在XML中定义的第一条（也只有这条）会被选择，用于继续流程。如果没有可选的顺序流，会抛出异常。</strong></p>
</div>
</div>
<div class="sect4">
<h5 id="exclusiveGatewayGraphNotation">图示 Graphical notation</h5>
<div class="paragraph">
<p>排他网关，用内部带有&#8217;X&#8217;图标的标准网关（菱形）表示，'X&#8217;图标代表<em>异或（XOR）</em>的含义。请注意内部没有图标的网关默认为排他网关。BPMN 2.0规范不允许在同一个流程中，混合使用带有及没有X的菱形标志。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.exclusive.gateway.notation.png" alt="bpmn.exclusive.gateway.notation">
</div>
</div>
</div>
<div class="sect4">
<h5 id="exclusiveGatewayXML">XML表示 XML representation</h5>
<div class="paragraph">
<p>排他网关的XML表示格式很直接：一行定义网关的XML，而条件表达式定义在出口顺序流上。查看<a href="#bpmnConditionalSequenceFlow">条件顺序流</a>章节了解这种表达式的可用选项。</p>
</div>
<div class="paragraph">
<p>以下面的模型为例：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.exclusive.gateway.png" alt="bpmn.exclusive.gateway">
</div>
</div>
<div class="paragraph">
<p>用XML表示如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;exclusiveGateway id="exclusiveGw" name="Exclusive Gateway" /&gt;

&lt;sequenceFlow id="flow2" sourceRef="exclusiveGw" targetRef="theTask1"&gt;
  &lt;conditionExpression xsi:type="tFormalExpression"&gt;${input == 1}&lt;/conditionExpression&gt;
&lt;/sequenceFlow&gt;

&lt;sequenceFlow id="flow3" sourceRef="exclusiveGw" targetRef="theTask2"&gt;
  &lt;conditionExpression xsi:type="tFormalExpression"&gt;${input == 2}&lt;/conditionExpression&gt;
&lt;/sequenceFlow&gt;

&lt;sequenceFlow id="flow4" sourceRef="exclusiveGw" targetRef="theTask3"&gt;
  &lt;conditionExpression xsi:type="tFormalExpression"&gt;${input == 3}&lt;/conditionExpression&gt;
&lt;/sequenceFlow&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnParallelGateway">8.4.2. 并行网关 Parallel Gateway</h4>
<div class="sect4">
<h5 id="bpmnParallelGatewayDescription">描述 Description</h5>
<div class="paragraph">
<p>网关也可以用于对流程中并行的建模。在流程模型中引入并行的最简单的网关，就是<strong>并行网关</strong>。它可以将执行<em>分支（fork）</em>为多条路径，也可以<em>合并（join）</em>执行的多条入口路径。</p>
</div>
<div class="paragraph">
<p>并行网关的功能，基于其入口与出口顺序流：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>分支：</strong>所有的出口顺序流都并行执行，为每一条顺序流创建一个并行执行。</p>
</li>
<li>
<p><strong>合并：</strong>所有到达并行网关的并行执行，都在网关处等待，直到每一条入口顺序流都有一个执行到达。然后流程经过该合并网关继续。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>请注意，如果并行网关同时具有多条入口与出口顺序流，可以<strong>同时具有分支与合并的行为</strong>。在这种情况下，网关首先合并所有入口顺序流，然后分裂为多条并行执行路径。</p>
</div>
<div class="paragraph">
<p><strong>与其他网关类型的重要区别，是并行网关不计算条件。如果连接到并行网关的顺序流上定义了条件，条件会被简单地忽略。</strong></p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnParallelGatewayGraphicalNotation">图示 Graphical Notation</h5>
<div class="paragraph">
<p>并行网关，用内部带有&#8217;加号&#8217;图标的网关（菱形）表示，代表<em>与（AND）</em>的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.parallel.gateway.png" alt="bpmn.parallel.gateway">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnParallelGatewayXML">XML表示 XML representation</h5>
<div class="paragraph">
<p>定义并行网关需要一行XML：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;parallelGateway id="myParallelGateway" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>实际行为（分支，合并或两者皆有），由连接到该并行网关的顺序流定义。</p>
</div>
<div class="paragraph">
<p>例如，上面的模型表现为下面的XML：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;startEvent id="theStart" /&gt;
&lt;sequenceFlow id="flow1" sourceRef="theStart" targetRef="fork" /&gt;

&lt;parallelGateway id="fork" /&gt;
&lt;sequenceFlow sourceRef="fork" targetRef="receivePayment" /&gt;
&lt;sequenceFlow sourceRef="fork" targetRef="shipOrder" /&gt;

&lt;userTask id="receivePayment" name="Receive Payment" /&gt;
&lt;sequenceFlow sourceRef="receivePayment" targetRef="join" /&gt;

&lt;userTask id="shipOrder" name="Ship Order" /&gt;
&lt;sequenceFlow sourceRef="shipOrder" targetRef="join" /&gt;

&lt;parallelGateway id="join" /&gt;
&lt;sequenceFlow sourceRef="join" targetRef="archiveOrder" /&gt;

&lt;userTask id="archiveOrder" name="Archive Order" /&gt;
&lt;sequenceFlow sourceRef="archiveOrder" targetRef="theEnd" /&gt;

&lt;endEvent id="theEnd" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的例子中，当流程启动后，会创建两个任务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ProcessInstance pi = runtimeService.startProcessInstanceByKey("forkJoin");
TaskQuery query = taskService.createTaskQuery()
                         .processInstanceId(pi.getId())
                         .orderByTaskName()
                         .asc();

List&lt;Task&gt; tasks = query.list();
assertEquals(2, tasks.size());

Task task1 = tasks.get(0);
assertEquals("Receive Payment", task1.getName());
Task task2 = tasks.get(1);
assertEquals("Ship Order", task2.getName());</code></pre>
</div>
</div>
<div class="paragraph">
<p>当这两个任务完成后，第二个并行网关会合并这两个执行，并且由于只有一条出口顺序流，不会再创建并行执行路径，只会激活<em>Archive Order(存档订单)</em>任务。</p>
</div>
<div class="paragraph">
<p>请注意并行网关不需要“平衡”（也就是说，对应的并行网关，其入口/出口顺序流的数量不需要匹配）。并行网关会简单地等待所有入口顺序流，并为每一条出口顺序流创建并行执行，不受流程模型中的其他结构影响。因此，下面的流程在BPMN 2.0中是合法的：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.unbalanced.parallel.gateway.png" alt="bpmn.unbalanced.parallel.gateway">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnInclusiveGateway">8.4.3. 包容网关 Inclusive Gateway</h4>
<div class="sect4">
<h5 id="bpmnInclusiveGatewayDescription">描述 Description</h5>
<div class="paragraph">
<p><strong>包容网关</strong>可被视作排他网关与并行网关的组合。与排他网关一样，可以在出口顺序流上定义条件，包容网关会计算它们。然而主要的区别是，包容网关与并行网关一样，可以选择多于一条（出口）顺序流。</p>
</div>
<div class="paragraph">
<p>包容网关的功能，基于其入口与出口顺序流：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>分支：</strong>所有出口顺序流的条件都会被计算，对于条件计算为true的顺序流，流程会并行地沿其继续，为每一条顺序流创建一个并行执行。</p>
</li>
<li>
<p><strong>合并：</strong>所有到达包容网关的并行执行，都会在网关处等待，直到每一条具有流程标志的入口顺序流，都有一个执行到达。这是与并行网关的重要区别。换句话说，包容网关只会等待将会被执行的入口顺序流。在合并后，流程穿过合并并行网关继续。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>请注意，如果包容网关同时具有多条入口与出口顺序流，可以<strong>同时具有分支与合并的行为</strong>。在这种情况下，网关首先合并所有具有流程标志的入口顺序流，然后为条件计算为true的出口顺序流，分裂为多条并行执行路径。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnInclusiveGatewayGraphicalNotation">图示 Graphical Notation</h5>
<div class="paragraph">
<p>包容网关，用内部带有&#8217;圆圈&#8217;图标的网关（菱形）表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.inclusive.gateway.png" alt="bpmn.inclusive.gateway">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnInclusiveGatewayXML">XML表示 XML representation</h5>
<div class="paragraph">
<p>定义包容网关需要一行XML：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;inclusiveGateway id="myInclusiveGateway" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>实际行为（分支，合并或两者皆有），由连接到该包容网关的顺序流定义。</p>
</div>
<div class="paragraph">
<p>例如，上面的模型表现为下面的XML：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;startEvent id="theStart" /&gt;
&lt;sequenceFlow id="flow1" sourceRef="theStart" targetRef="fork" /&gt;

&lt;inclusiveGateway id="fork" /&gt;
&lt;sequenceFlow sourceRef="fork" targetRef="receivePayment" &gt;
  &lt;conditionExpression xsi:type="tFormalExpression"&gt;${paymentReceived == false}&lt;/conditionExpression&gt;
&lt;/sequenceFlow&gt;
&lt;sequenceFlow sourceRef="fork" targetRef="shipOrder" &gt;
  &lt;conditionExpression xsi:type="tFormalExpression"&gt;${shipOrder == true}&lt;/conditionExpression&gt;
&lt;/sequenceFlow&gt;

&lt;userTask id="receivePayment" name="Receive Payment" /&gt;
&lt;sequenceFlow sourceRef="receivePayment" targetRef="join" /&gt;

&lt;userTask id="shipOrder" name="Ship Order" /&gt;
&lt;sequenceFlow sourceRef="shipOrder" targetRef="join" /&gt;

&lt;inclusiveGateway id="join" /&gt;
&lt;sequenceFlow sourceRef="join" targetRef="archiveOrder" /&gt;

&lt;userTask id="archiveOrder" name="Archive Order" /&gt;
&lt;sequenceFlow sourceRef="archiveOrder" targetRef="theEnd" /&gt;

&lt;endEvent id="theEnd" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的例子中，当流程启动后，如果流程变量paymentReceived == false且shipOrder == true，将会创建两个任务。如果只有一个流程变量等于true，则只会创建一个任务。如果没有条件计算为true，会抛出异常，并可通过指定默出口顺序流避免。在下面的例子中，只有ship order（传递订单）一个任务会被创建：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">HashMap&lt;String, Object&gt; variableMap = new HashMap&lt;String, Object&gt;();
          variableMap.put("receivedPayment", true);
          variableMap.put("shipOrder", true);
          ProcessInstance pi = runtimeService.startProcessInstanceByKey("forkJoin");
TaskQuery query = taskService.createTaskQuery()
                         .processInstanceId(pi.getId())
                         .orderByTaskName()
                         .asc();

List&lt;Task&gt; tasks = query.list();
assertEquals(1, tasks.size());

Task task = tasks.get(0);
assertEquals("Ship Order", task.getName());</code></pre>
</div>
</div>
<div class="paragraph">
<p>当这个任务完成后，第二个包容网关会合并这两个执行，并且由于只有一条出口顺序流，不会再创建并行执行路径，只会激活<em>Archive Order(存档订单)</em>任务。</p>
</div>
<div class="paragraph">
<p>请注意包容网关不需要“平衡”（也就是说，对应的包容网关，其入口/出口顺序流的数量不需要匹配）。包容网关会简单地等待所有入口顺序流，并为每一条出口顺序流创建并行执行，不受流程模型中的其他结构影响。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnEventbasedGateway">8.4.4. 基于事件的网关 Event-based Gateway</h4>
<div class="sect4">
<h5 id="eventBasedGatewayDescription">描述 Description</h5>
<div class="paragraph">
<p>基于事件的网关，允许基于事件做选择。网关的每一条出口顺序流，都需要连接至一个捕获中间事件。当流程执行到达基于事件的网关时，网关类似等待状态地动作：执行被暂停。并且，为每一条出口顺序流，创建一个事件订阅。</p>
</div>
<div class="paragraph">
<p>请注意基于事件的网关，其出口顺序流与一般的顺序流不同。这些顺序流从不实际<strong>被执行</strong>。相反，它们允许流程引擎决定，当执行到达一个基于事件的网关时，需要订阅什么事件。基于下列约束：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>一个基于事件的网关，必须有两条或更多的出口顺序流。</p>
</li>
<li>
<p>基于事件的网关，只能连接至<code>intermediateCatchEvent（捕获中间事件）</code>类型的元素（Activiti不支持基于事件的网关后，连接接收任务，Receive Task）。</p>
</li>
<li>
<p>连接至基于事件的网关的<code>intermediateCatchEvent</code>，必须只有一个入口顺序流。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="eventBasedGatewayGraphNotation">图示 Graphical notation</h5>
<div class="paragraph">
<p>基于事件的网关，用内部带有特殊图标的网关（菱形）表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.event.based.gateway.notation.png" alt="bpmn.event.based.gateway.notation">
</div>
</div>
</div>
<div class="sect4">
<h5 id="eventBasedGatewayXML">XML表示 XML representation</h5>
<div class="paragraph">
<p>用于定义基于事件的网关的XML元素为<code>eventBasedGateway</code>。</p>
</div>
</div>
<div class="sect4">
<h5 id="eventBasedGatewayExample">示例 Example(s)</h5>
<div class="paragraph">
<p>下面的流程，是带有基于事件的网关的流程的例子。当执行到达基于事件的网关时，流程执行被暂停。并且，流程实例订阅alert信号事件，并创建一个10分钟后触发的定时器。这使得流程引擎等待10分钟，并等待信号事件。如果信号在10分钟内触发，则定时器会被取消，执行沿着信号继续。如果信号未被触发，执行会在定时器到时后继续，并取消信号订阅。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.event.based.gateway.example.png" alt="bpmn.event.based.gateway.example">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;definitions id="definitions"
	xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
	xmlns:activiti="http://activiti.org/bpmn"
	targetNamespace="Examples"&gt;

	&lt;signal id="alertSignal" name="alert" /&gt;

	&lt;process id="catchSignal"&gt;

		&lt;startEvent id="start" /&gt;

		&lt;sequenceFlow sourceRef="start" targetRef="gw1" /&gt;

		&lt;eventBasedGateway id="gw1" /&gt;

		&lt;sequenceFlow sourceRef="gw1" targetRef="signalEvent" /&gt;
		&lt;sequenceFlow sourceRef="gw1" targetRef="timerEvent" /&gt;

		&lt;intermediateCatchEvent id="signalEvent" name="Alert"&gt;
			&lt;signalEventDefinition signalRef="alertSignal" /&gt;
		&lt;/intermediateCatchEvent&gt;

		&lt;intermediateCatchEvent id="timerEvent" name="Alert"&gt;
			&lt;timerEventDefinition&gt;
				&lt;timeDuration&gt;PT10M&lt;/timeDuration&gt;
			&lt;/timerEventDefinition&gt;
		&lt;/intermediateCatchEvent&gt;

		&lt;sequenceFlow sourceRef="timerEvent" targetRef="exGw1" /&gt;
		&lt;sequenceFlow sourceRef="signalEvent" targetRef="task" /&gt;

		&lt;userTask id="task" name="Handle alert"/&gt;

		&lt;exclusiveGateway id="exGw1" /&gt;

		&lt;sequenceFlow sourceRef="task" targetRef="exGw1" /&gt;
		&lt;sequenceFlow sourceRef="exGw1" targetRef="end" /&gt;

		&lt;endEvent id="end" /&gt;
&lt;/process&gt;
&lt;/definitions&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bpmnTask">8.5. 任务 Tasks</h3>
<div class="sect3">
<h4 id="bpmnUserTask">8.5.1. 用户任务 User Task</h4>
<div class="sect4">
<h5 id="bpmnUserTaskDescription">描述 Description</h5>
<div class="paragraph">
<p>“用户任务”用于建模需要人工执行的任务。当流程执行到达用户任务时，会为指派至该任务的用户或组的任务列表创建一个新任务。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnUserTaskGraphicalNotation">图示 Graphical notation</h5>
<div class="paragraph">
<p>用户任务，用左上角有一个小用户图标的标准任务（圆角矩形）表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.user.task.png" alt="bpmn.user.task">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnUserTaskXml">XML表示 XML representation</h5>
<div class="paragraph">
<p>用户任务在XML中如下定义。<em>id</em>是必须属性，<em>name</em>是可选属性。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;userTask id="theTask" name="Important task" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>一个用户任务也可以有一个描述（description）。事实上任何BPMN 2.0元素都可以有一个描述。描述使用附加的<strong>documentation</strong>元素定义。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;userTask id="theTask" name="Schedule meeting" &gt;
  &lt;documentation&gt;
	  Schedule an engineering meeting for next week with the new hire.
  &lt;/documentation&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>描述文本可以从任务中，使用标准Java方式获取：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">task.getDescription()</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnUserTaskDueDate">到期日期 Due Date</h5>
<div class="paragraph">
<p>每个任务都有一个字段，标志该任务的到期日期。可以使用查询API，查询在给定日期前或后到期的任务。</p>
</div>
<div class="paragraph">
<p>有一个Activiti的扩展，可以在任务定义中指定表达式，以在任务创建时，设定初始到期日期。该表达式<strong>必须解析为<code>java.util.Date</code>，<code>java.util.String (ISO8601格式)</code>，ISO8601时间长度（例如PT50M），或者<code>null</code></strong>。例如，可以使用在流程里前一个表单中输入的日期，或者由前一个服务任务计算出的日期。如果使用的是时间长度，则到期日期基于当前时间加上给定长度计算。例如当dueDate使用“PT30M”时，任务在从现在起30分钟后到期。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;userTask id="theTask" name="Important task" activiti:dueDate="${dateVariable}"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>任务的到期日期，也可以使用<code>TaskService</code>，或者在<code>TaskListener</code>中使用传递的<code>DelegateTask</code>修改。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnUserTaskAssignment">用户指派 User assignment</h5>
<div class="paragraph">
<p>一个用户任务可以直接指派给一个用户。可以通过定义<strong>humanPerformer</strong>子元素实现。这个<em>humanPerformer</em>定义需要<strong>resourceAssignmentExpression</strong>来实际定义用户。目前，只支持<strong>formalExpressions</strong>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;process &gt;

  ...

  &lt;userTask id='theTask' name='important task' &gt;
    &lt;humanPerformer&gt;
      &lt;resourceAssignmentExpression&gt;
        &lt;formalExpression&gt;kermit&lt;/formalExpression&gt;
      &lt;/resourceAssignmentExpression&gt;
    &lt;/humanPerformer&gt;
  &lt;/userTask&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>只有一个</strong>用户可被指定为任务的<em>humanPerformer</em>。在Activiti术语中，这个用户被称作<strong>办理人（assignee）</strong>。拥有办理人的任务，在其他人的任务列表中不可见，而可以在该办理人的<strong>个人任务列表</strong>中看到。</p>
</div>
<div class="paragraph">
<p>特定用户办理的任务，可以通过TaskService如下获取：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">List&lt;Task&gt; tasks = taskService.createTaskQuery().taskAssignee("kermit").list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>任务也可以放在用户的<strong>候选任务列表</strong>中。在这个情况下，需要使用<strong>potentialOwner（潜在用户）</strong>结构。用法与<em>humanPerformer</em>结构类似。请注意需要为表达式中的每一个元素指定其为用户还是组（引擎无法自行判断）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;process &gt;

  ...

  &lt;userTask id='theTask' name='important task' &gt;
    &lt;potentialOwner&gt;
      &lt;resourceAssignmentExpression&gt;
        &lt;formalExpression&gt;user(kermit), group(management)&lt;/formalExpression&gt;
      &lt;/resourceAssignmentExpression&gt;
    &lt;/potentialOwner&gt;
  &lt;/userTask&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>定义了<em>potential owner</em>结构的任务，可用如下方法获取（或类似于指派用户任务，使用<em>TaskQuery</em>查询）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"> List&lt;Task&gt; tasks = taskService.createTaskQuery().taskCandidateUser("kermit");</code></pre>
</div>
</div>
<div class="paragraph">
<p>将获取所有kermit作为<strong>候选用户</strong>的任务，也就是说，表达式含有<em>user(kermit)</em>的任务，也将获取所有<strong>指派给kermit为其成员的组</strong>的任务（例如<em>group(management)</em>，如果kermit是这个组的成员，并且使用Activiti身份组件）。组会在运行时解析，并可通过<a href="#apiEngine">IdentityService（身份服务）</a>管理。</p>
</div>
<div class="paragraph">
<p>如果并未指定给定字符串是用户还是组，引擎默认其为组。因此下列代码与<em>声明了group(accountancy)</em>一样。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;formalExpression&gt;accountancy&lt;/formalExpression&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnUserTaskUserAssignmentExtension">用于任务指派的Activiti扩展 Activiti extensions for task assignment</h5>
<div class="paragraph">
<p>很明显，当指派关系不复杂时，这种用户与组的指派方式十分笨重。为避免这种复杂性，可以在用户任务上使用<a href="#bpmnCustomExtensions">自定义扩展</a>。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>assignee（办理人）属性</strong>：这个自定义扩展用于直接将一个用户任务指派至一个给定用户。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;userTask id="theTask" name="my task" activiti:assignee="kermit" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>与使用<a href="#bpmnUserTaskAssignment">上面</a>定义的<strong>humanPerformer</strong>结构完全相同。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>candidateUsers（候选用户）属性</strong>：这个自定义扩展用于为一个任务指定候选用户。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;userTask id="theTask" name="my task" activiti:candidateUsers="kermit, gonzo" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>与使用<a href="#bpmnUserTaskAssignment">上面</a>定义的<strong>potentialOwner</strong>结构完全相同。请注意不需要像在<em>potential owner</em>中一样，使用<em>user(kermit)</em>的声明，因为这个属性只能用于用户。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>candidateGroups（候选组）attribute</strong>：这个自定义扩展用于为一个任务指定候选组。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;userTask id="theTask" name="my task" activiti:candidateGroups="management, accountancy" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>与使用<a href="#bpmnUserTaskAssignment">上面</a>定义的<strong>potentialOwner</strong>结构完全相同。请注意不需要像在<em>potential owner</em>中一样，使用<em>group(management)</em>的声明，因为这个属性只能用于组。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>candidateUsers</em>与<em>candidateGroups</em>可以定义在同一个用户任务上。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>请注意：尽管Activiti提供了身份管理组件，通过<a href="#apiEngine">IdentityService</a>暴露，但并不会检查给定的用户是否在身份组件中存在。这样Activiti在嵌入应用时，可以与已有的身份管理解决方案集成。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnUserTaskUserCustomIdentityLinkAssignmentExtension">自定义身份联系类型（试验特性） Custom identity link types (Experimental)</h5>
<div class="paragraph">
<p><a href="#experimental">[EXPERIMENTAL]</a></p>
</div>
<div class="paragraph">
<p>在<a href="#bpmnUserTaskAssignment">用户指派</a>中定义过，BPMN标准支持单个指派用户即<strong>hunamPerformer</strong>，或者一组用户构成<strong>potentialOwners</strong>潜在用户池。另外，Activiti为用户任务定义了<a href="#bpmnUserTaskUserAssignmentExtension">扩展属性元素</a>，代表任务的<strong>办理人</strong>或者<strong>候选用户</strong>。</p>
</div>
<div class="paragraph">
<p>Activiti支持的身份联系类型有：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class IdentityLinkType {
  /* Activiti原生角色 Activiti native roles */
  public static final String ASSIGNEE = "assignee";
  public static final String CANDIDATE = "candidate";
  public static final String OWNER = "owner";
  public static final String STARTER = "starter";
  public static final String PARTICIPANT = "participant";
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>BPMN标准与Activiti示例身份认证是<strong>用户</strong>与<strong>组</strong>。在前一章节提到过，Activiti的身份管理实现并不适用于生产环境，而需要在支持的认证概要下扩展。</p>
</div>
<div class="paragraph">
<p>如果需要添加额外的联系类型，可按照下列语法，使用自定义资源作为扩展元素：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;userTask id="theTask" name="make profit"&gt;
  &lt;extensionElements&gt;
    &lt;activiti:customResource activiti:name="businessAdministrator"&gt;
      &lt;resourceAssignmentExpression&gt;
        &lt;formalExpression&gt;user(kermit), group(management)&lt;/formalExpression&gt;
      &lt;/resourceAssignmentExpression&gt;
    &lt;/activiti:customResource&gt;
  &lt;/extensionElements&gt;
&lt;/userTask&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>自定义联系表达式添加至<em>TaskDefinition</em>类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">protected Map&lt;String, Set&lt;Expression&gt;&gt; customUserIdentityLinkExpressions =
      new HashMap&lt;String, Set&lt;Expression&gt;&gt;();
protected Map&lt;String, Set&lt;Expression&gt;&gt; customGroupIdentityLinkExpressions =
      new HashMap&lt;String, Set&lt;Expression&gt;&gt;();

public Map&lt;String,
         Set&lt;Expression&gt;&gt; getCustomUserIdentityLinkExpressions() {
  return customUserIdentityLinkExpressions;
}

public void addCustomUserIdentityLinkExpression(String identityLinkType,
      Set&lt;Expression&gt; idList)
  customUserIdentityLinkExpressions.put(identityLinkType, idList);
}

public Map&lt;String,
       Set&lt;Expression&gt;&gt; getCustomGroupIdentityLinkExpressions() {
  return customGroupIdentityLinkExpressions;
}

public void addCustomGroupIdentityLinkExpression(String identityLinkType,
       Set&lt;Expression&gt; idList) {
  customGroupIdentityLinkExpressions.put(identityLinkType, idList);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>并将会在运行时，由<em>UserTaskActivityBehavior handleAssignments</em>方法填写。</p>
</div>
<div class="paragraph">
<p>最后，需要扩展<em>IdentityLinkType</em>类，以支持自定义身份联系类型：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.yourco.engine.task;

public class IdentityLinkType
    extends org.activiti.engine.task.IdentityLinkType
{
    public static final String ADMINISTRATOR = "administrator";

    public static final String EXCLUDED_OWNER = "excludedOwner";
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnUserTaskUserCustomAssignmentTaskListeners">通过任务监听器自定义指派 Custom Assignment via task listeners</h5>
<div class="paragraph">
<p>如果上面的方式仍不能满足要求，可以在创建事件（create event）上使用<a href="#taskListeners">任务监听器</a>，代理自定义指派逻辑：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;userTask id="task1" name="My task" &gt;
  &lt;extensionElements&gt;
    &lt;activiti:taskListener event="create" class="org.activiti.MyAssignmentHandler" /&gt;
  &lt;/extensionElements&gt;
&lt;/userTask&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>传递至<code>TaskListener</code>实现的<code>DelegateTask</code>，可用于设置办理人与候选用户/组：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class MyAssignmentHandler implements TaskListener {

  public void notify(DelegateTask delegateTask) {
    // Execute custom identity lookups here

    // and then for example call following methods:
    delegateTask.setAssignee("kermit");
    delegateTask.addCandidateUser("fozzie");
    delegateTask.addCandidateGroup("management");
    ...
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>当使用Spring时，可以按上面章节的介绍使用自定义指派属性，并代理至使用<a href="#taskListeners">任务监听器</a>、带有<a href="#springExpressions">表达式</a>的Spring bean，监听任务<em>创建</em>事件。在下面的例子中，通过调用<code>ldapService</code> Spring bean的<code>findManagerOfEmployee</code>方法，设置办理人。传递的<em>emp</em>参数是一个流程变量。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;userTask id="task" name="My Task" activiti:assignee="${ldapService.findManagerForEmployee(emp)}"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以用于候选用户与组：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;userTask id="task" name="My Task" activiti:candidateUsers="${ldapService.findAllSales()}"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意调用方法的返回类型必须是<code>String</code>或<code>Collection&lt;String&gt;</code>（候选用户与组）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class FakeLdapService {

  public String findManagerForEmployee(String employee) {
    return "Kermit The Frog";
  }

  public List&lt;String&gt; findAllSales() {
    return Arrays.asList("kermit", "gonzo", "fozzie");
  }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnScriptTask">8.5.2. 脚本任务 Script Task</h4>
<div class="sect4">
<h5 id="bpmnScriptTaskDescription">描述 Description</h5>
<div class="paragraph">
<p>脚本任务是自动化的活动。当流程执行到达脚本任务时，会执行相应的脚本。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnScriptTaskGraphicalNotation">图示 Graphical Notation</h5>
<div class="paragraph">
<p>脚本任务，用左上角有一个小“脚本”图标的标准BPMN 2.0任务（圆角矩形）表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.scripttask.png" alt="bpmn.scripttask">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnScriptTaskXml">XML表示 XML representation</h5>
<div class="paragraph">
<p>脚本任务通过指定<strong>script</strong>与<strong>scriptFormat</strong>定义。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;scriptTask id="theScriptTask" name="Execute script" scriptFormat="groovy"&gt;
  &lt;script&gt;
    sum = 0
    for ( i in inputArray ) {
      sum += i
    }
  &lt;/script&gt;
&lt;/scriptTask&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>scriptFormat</strong>属性的值，必须是兼容<a href="http://jcp.org/en/jsr/detail?id=223">JSR-223</a>（Java平台脚本）的名字。默认情况下，JavaScript包含在每一个JDK中，因此不需要添加任何jar。如果想使用其它（兼容JSR-223的）脚本引擎，需要在classpath中添加相应的jar，并使用适当的名字。例如，Activiti单元测试经常使用Groovy，因为其语法与Java十分相似。</p>
</div>
<div class="paragraph">
<p>请注意Groovy脚本引擎与groovy-all jar捆绑在一起。在2.0版本以前，脚本引擎是Groovy jar的一部分。因此，现在必须添加如下依赖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
      &lt;groupId&gt;org.codehaus.groovy&lt;/groupId&gt;
      &lt;artifactId&gt;groovy-all&lt;/artifactId&gt;
      &lt;version&gt;2.x.x&lt;version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnScriptTaskVariables">脚本中的变量 Variables in scripts</h5>
<div class="paragraph">
<p>到达脚本引擎的执行可以访问的所有流程变量，都可以在脚本中使用。在这个例子里，脚本变量<em>'inputArray'</em>实际上就是一个流程变量（integer数组）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;script&gt;
    sum = 0
    for ( i in inputArray ) {
      sum += i
    }
&lt;/script&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以简单地调用<em>execution.setVariable("variableName", variableValue)</em>，在脚本中设置流程变量。默认情况下，变量不会自动储存（<strong>请注意，在Activiti 5.12以前是这样的！</strong>）。可以将<code>scriptTask</code>的<code>autoStoreVariables</code>参数设置为<code>true</code>，以自动保存任何在脚本中定义的变量（例如上例中的<em>sum</em>）。然而，<strong>最佳实践不是这么做，而是直接调用execution.setVariable()</strong>，因为在JDK近期的一些版本中，某些脚本语言不能自动保存变量。查看<a href="http://www.jorambarrez.be/blog/2013/03/25/bug-on-jdk-1-7-0_17-when-using-scripttask-in-activiti/">这个链接</a>了解更多信息。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;scriptTask id="script" scriptFormat="JavaScript" activiti:autoStoreVariables="false"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个参数的默认值为<code>false</code>，意味着这个参数将在脚本任务定义中忽略，所有声明的变量将只在脚本执行期间有效。</p>
</div>
<div class="paragraph">
<p>在脚本中设置变量的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;script&gt;
    def scriptVar = "test123"
    execution.setVariable("myVar", scriptVar)
&lt;/script&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意：下列名字被保留，<strong>不能用于</strong>变量名：<strong>out，out:print，lang:import，context，elcontext</strong>。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnScriptTaskResultValue">脚本结果 Script results</h5>
<div class="paragraph">
<p>脚本任务的返回值，可以通过为脚本任务定义的<em>'activiti:resultVariable'</em>属性设置流程变量名，指定为已经存在的，或者新的流程变量。指定的已有值的流程变量，会被脚本执行的结果值覆盖。当不指定结果变量名时，脚本结果值将被忽略。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;scriptTask id="theScriptTask" name="Execute script" scriptFormat="juel" activiti:resultVariable="myVar"&gt;
  &lt;script&gt;#{echo}&lt;/script&gt;
&lt;/scriptTask&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的例子中，脚本执行的结果（解析表达式<em>'#{echo}'</em>的值），将在脚本完成后，设置为名为<em>'myVar'</em>的流程变量。</p>
</div>
</div>
<div class="sect4">
<h5 id="_安全性_security">安全性 Security</h5>
<div class="paragraph">
<p>当使用<em>javascript</em>作为脚本语言时，可以使用<em>“安全脚本（secure scripting）”</em>。参见<a href="#advancedSecureScripting">安全脚本章节</a>。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnJavaServiceTask">8.5.3. Java服务任务 Java Service Task</h4>
<div class="sect4">
<h5 id="bpmnJavaServiceTaskDescription">描述 Description</h5>
<div class="paragraph">
<p>Java服务任务用于执行外部的Java类。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnJavaServiceTaskGraphicalNotation">图示 Graphical Notation</h5>
<div class="paragraph">
<p>服务任务，用左上角有一个小齿轮图标的圆角矩形表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.java.service.task.png" alt="bpmn.java.service.task">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnJavaServiceTaskXML">XML表示 XML representation</h5>
<div class="paragraph">
<p>有四种方法声明如何调用Java逻辑：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>指定实现了JavaDelegate或ActivityBehavior的类</p>
</li>
<li>
<p>对解析为代理对象的表达式求值</p>
</li>
<li>
<p>调用方法表达式</p>
</li>
<li>
<p>对值表达式求值</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>要指定流程执行时调用的类，需要使用<strong><em>activiti:class</em></strong>属性提供全限定类名（fully qualified classname）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="javaService"
             name="My Java Service Task"
             activiti:class="org.activiti.MyJavaDelegate" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>查看<a href="#bpmnJavaServiceTaskImplementation">实现章节</a>，了解关于如何使用这种类的更多信息。</p>
</div>
<div class="paragraph">
<p>也可以使用解析为对象的表达式。该对象必须遵循的规则，与使用<code>activiti:class</code>创建的对象规则相同（查看<a href="#bpmnJavaServiceTaskImplementation">更多</a>）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="serviceTask" activiti:delegateExpression="${delegateExpressionBean}" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>这里，<code>delegateExpressionBean</code>是一个实现了<code>JavaDelegate</code>接口的bean，在Spring容器中定义。</p>
</div>
<div class="paragraph">
<p>要指定需要计算的UEL方法表达式，使用<strong>activiti:expression</strong>属性。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="javaService"
             name="My Java Service Task"
             activiti:expression="#{printer.printMessage()}" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>将在名为<code>printer</code>的对象上调用<code>printMessage</code>方法（不带参数）。</p>
</div>
<div class="paragraph">
<p>也可以为表达式中使用的方法传递变量。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="javaService"
             name="My Java Service Task"
             activiti:expression="#{printer.printMessage(execution, myVar)}" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>将在名为<code>printer</code>的对象上调用<code>printMessage</code>方法。传递的第一个参数为<code>DelegateExecution</code>，名为<code>execution</code>，在表达式上下文中默认可用。传递的第二个参数，是当前执行中，名为<code>myVar</code>变量的值。</p>
</div>
<div class="paragraph">
<p>可以使用<strong>activiti:expression</strong>属性指定需要计算的UEL值表达式。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="javaService"
             name="My Java Service Task"
             activiti:expression="#{split.ready}" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>会调用名为<code>split</code>的bean的<code>ready</code>参数的getter方法，<code>getReady</code>（不带参数）。该对象会被解析为执行的流程变量或（如果可用的话）Spring上下文中的bean。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnJavaServiceTaskImplementation">实现 Implementation</h5>
<div class="paragraph">
<p>要实现可以在流程执行中调用的类，需要实现<em>org.activiti.engine.delegate.JavaDelegate</em>接口，并在<em>execute</em>方法中提供所需逻辑。当流程执行到达该活动时，会执行方法中定义的逻辑，并按照BPMN 2.0的默认方法离开活动。</p>
</div>
<div class="paragraph">
<p>让我们创建一个Java类的示例，可用于将流程变量String改为大写。这个类需要实现<em>org.activiti.engine.delegate.JavaDelegate</em>接口，因此需要实现<em>execute(DelegateExecution)</em>方法。这个方法就是引擎将调用的方法，需要实现业务逻辑。可以通过<a href="http://activiti.org/javadocs/org/activiti/engine/delegate/DelegateExecution.html">DelegateExecution</a>接口（点击链接获取该接口操作的详细Javadoc）访问流程实例信息，如流程变量等。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class ToUppercase implements JavaDelegate {

  public void execute(DelegateExecution execution) throws Exception {
    String var = (String) execution.getVariable("input");
    var = var.toUpperCase();
    execution.setVariable("input", var);
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意：<strong>只会为serviceTask上定义的Java类创建一个实例</strong>。所有流程实例共享同一个类实例，用于调用<em>execute(DelegateExecution)</em>。这意味着该类不能有任何成员变量，并需要是线程安全的，因为它可能会在不同线程中同时执行。这也影响了<a href="#serviceTaskFieldInjection">字段注入</a>的使用方法。（译者注：原文可能较老，不正确。5.21中，activiti:class指定的类，会在流程实例启动时，为每个活动，分别进行实例化。不过，当该活动在流程中重复执行，或者为多实例时，使用的都会是同一个类实例。）</p>
</div>
<div class="paragraph">
<p>在流程定义中（如通过<code>activiti:class</code>）引用的类，<strong>不会在部署时实例化</strong>。只有当流程执行第一次到达该类使用的地方时，才会创建该类的实例。如果找不到这个类，会抛出<code>ActivitiException</code>。这是因为部署时的环境（更准确的说<em>classpath</em>），与实际运行的环境经常不一样。例如当使用<em>ant</em>或者Activiti Explorer中业务存档上传的方式部署的流程，其classpath中并没有流程引用的类。</p>
</div>
<div class="paragraph">
<p><a href="#internal">[内部：非公有实现类]</a>也可以使用实现了<em>org.activiti.engine.impl.pvm.delegate.ActivityBehavior</em>接口的类。该实现可以访问更强大的<em>ActivityExecution</em>，可以例如影响流程的控制流程。请注意这并不是很好的实践，需要避免这么使用。因此，建议只有在高级使用场景下，并且你确知在做什么的时候，才使用<em>ActivityBehavior</em>接口。</p>
</div>
</div>
<div class="sect4">
<h5 id="serviceTaskFieldInjection">字段注入 Field Injection</h5>
<div class="paragraph">
<p>可以为代理类的字段注入值。支持下列注入方式：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>字符串常量</p>
</li>
<li>
<p>表达式</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>如果可以的话，会按照Java Bean命名约定（例如，<code>firstName</code>成员使用setter <code>setFirstName(&#8230;&#8203;)</code>），通过代理类的公有setter方法，注入变量。如果该字段没有可用的setter，会直接设置该代理类的私有成员的值。有的环境中，SecurityManagers不允许修改私有字段，因此为想要注入的字段，暴露一个公有setter方法，是更安全的做法。</p>
</div>
<div class="paragraph">
<p><strong>不论在流程定义中声明的是什么类型的值，注入对象的setter/私有字段的类型，总是<code>org.activiti.engine.delegate.Expression</code>。解析表达式后，可以被转型为合适的类型。</strong></p>
</div>
<div class="paragraph">
<p>当使用<em>'actviiti:class'</em>属性时，支持字段注入。也可以在使用<em>activiti:delegateExpression</em>属性时，进行字段注入，然而因为线程安全的考虑，需要有特殊的规则（参见下一章节）。</p>
</div>
<div class="paragraph">
<p>下面的代码片段展示了如何为类中声明的字段注入常量值。请注意按照BPMN 2.0 XML概要的要求，<strong>在实际字段注入声明前，需要先声明&#8217;extensionElements&#8217;XML元素</strong>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="javaService"
    name="Java service invocation"
    activiti:class="org.activiti.examples.bpmn.servicetask.ToUpperCaseFieldInjected"&gt;
    &lt;extensionElements&gt;
      &lt;activiti:field name="text" stringValue="Hello World" /&gt;
  &lt;/extensionElements&gt;
&lt;/serviceTask&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ToUpperCaseFieldInjected</code>类有一个字段<code>text</code>，为<code>org.activiti.engine.delegate.Expression</code>类型。当调用<code>text.getValue(execution)</code>时，会返回配置的字符串<code>Hello World</code>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class ToUpperCaseFieldInjected implements JavaDelegate {

  private Expression text;

  public void execute(DelegateExecution execution) {
    execution.setVariable("var", ((String)text.getValue(execution)).toUpperCase());
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>另外，对于较长文本（例如邮件内容），可以使用<em>'activiti:string'</em>子元素：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="javaService"
    name="Java service invocation"
    activiti:class="org.activiti.examples.bpmn.servicetask.ToUpperCaseFieldInjected"&gt;
  &lt;extensionElements&gt;
    &lt;activiti:field name="text"&gt;
        &lt;activiti:string&gt;
          This is a long string with a lot of words and potentially way longer even!
      &lt;/activiti:string&gt;
    &lt;/activiti:field&gt;
  &lt;/extensionElements&gt;
&lt;/serviceTask&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>要在运行时动态解析注入的值，可以使用表达式。这种表达式可以使用流程变量，或者Spring定义的bean（如果使用Spring）。像<a href="#bpmnJavaServiceTaskImplementation">服务任务实现</a>中提到的，当服务任务中使用<em>activiti:class</em>属性时，该Java类的实例在所有流程实例中共享。要动态地为字段注入值，可以在<code>org.activiti.engine.delegate.Expression</code>中注入值或方法表达式，它们会通过<code>execute</code>方法传递的<code>DelegateExecution</code>计算/调用。</p>
</div>
<div class="paragraph">
<p>下面的示例类，使用了注入的表达式，并使用当前的<code>DelegateExecution</code>解析它们。调用<em>generBean</em>方法时传递的是<em>gender</em>变量。完整的代码与测试可以在<code>org.activiti.examples.bpmn.servicetask.JavaServiceTaskTest.testExpressionFieldInjection</code>中找到</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="javaService" name="Java service invocation"
  activiti:class="org.activiti.examples.bpmn.servicetask.ReverseStringsFieldInjected"&gt;

  &lt;extensionElements&gt;
    &lt;activiti:field name="text1"&gt;
      &lt;activiti:expression&gt;${genderBean.getGenderString(gender)}&lt;/activiti:expression&gt;
    &lt;/activiti:field&gt;
    &lt;activiti:field name="text2"&gt;
       &lt;activiti:expression&gt;Hello ${gender == 'male' ? 'Mr.' : 'Mrs.'} ${name}&lt;/activiti:expression&gt;
    &lt;/activiti:field&gt;
  &lt;/ extensionElements&gt;
&lt;/ serviceTask&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class ReverseStringsFieldInjected implements JavaDelegate {

  private Expression text1;
  private Expression text2;

  public void execute(DelegateExecution execution) {
    String value1 = (String) text1.getValue(execution);
    execution.setVariable("var1", new StringBuffer(value1).reverse().toString());

    String value2 = (String) text2.getValue(execution);
    execution.setVariable("var2", new StringBuffer(value2).reverse().toString());
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>另外，为避免XML太过冗长，可以将表达式设置为属性，而不是子元素。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;activiti:field name="text1" expression="${genderBean.getGenderString(gender)}" /&gt;
&lt;activiti:field name="text1" expression="Hello ${gender == 'male' ? 'Mr.' : 'Mrs.'} ${name}" /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="serviceTaskFieldInjectionThreadSafety">字段注入与线程安全 Field injection and thread safety</h5>
<div class="paragraph">
<p>总的来说，在服务任务中使用Java代理与字段注入是线程安全的。然而，有些情况下不能保证线程安全，取决于设置，或Activiti运行所在的环境。</p>
</div>
<div class="paragraph">
<p>当使用<em>activiti:class</em>属性时，使用字段注入总是线程安全的（译者注：仍不完全安全，如对于多实例服务任务，使用的是同一个类实例）。对于引用了某个类的每一个服务任务，都会实例化新的实例，并且在创建实例时注入一次字段。在不同的任务或流程定义中多次使用同一个类没有问题。</p>
</div>
<div class="paragraph">
<p>当使用<em>activiti:expression</em>属性时，不能使用字段注入。只能通过方法调用传递变量，并且这总是线程安全的。</p>
</div>
<div class="paragraph">
<p>当使用<em>activiti:delegateExpression</em>属性时，代理实例的线程安全性，取决于表达式解析的方式。如果该代理表达式在多个任务与/或流程定义中重复使用，并且表达式总是返回相同的示例，则字段注入<strong>不是线程安全的</strong>。让我们看几个例子。</p>
</div>
<div class="paragraph">
<p>假设表达式为<em>${factory.createDelegate(someVariable)}</em>，其中factory为引擎可用的Java bean（例如使用Spring集成时的Spring bean），并在每次表达式解析时，创建新的实例。这种情况下，使用字段注入时，没有线程安全性问题：每次表达式解析时，新实例的字段都会注入。</p>
</div>
<div class="paragraph">
<p>然而，如果表达式为<em>${someJavaDelegateBean}</em>，解析为JavaDelegate的实现，并且在创建单例的环境（如Spring）中运行。当在不同的任务和/或流程定义中使用这个表达式时，表达式总会解析为相同的实例。这种情况下，使用字段注入不是线程安全的。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="serviceTask1" activiti:delegateExpression="${someJavaDelegateBean}"&gt;
    &lt;extensionElements&gt;
        &lt;activiti:field name="someField" expression="${input * 2}"/&gt;
    &lt;/extensionElements&gt;
&lt;/serviceTask&gt;

&lt;!-- other process definition elements --&gt;

&lt;serviceTask id="serviceTask2" activiti:delegateExpression="${someJavaDelegateBean}"&gt;
    &lt;extensionElements&gt;
        &lt;activiti:field name="someField" expression="${input * 2000}"/&gt;
    &lt;/extensionElements&gt;
&lt;/serviceTask&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>这段示例代码有两个服务任务，使用同一个代理表达式，但是<em>expression</em>字段填写不同的值。<strong>如果该表达式解析为相同的实例，就会在并发场景下，注入<em>someField</em>字段时出现竞争条件</strong>。</p>
</div>
<div class="paragraph">
<p>最简单的解决方案，为</p>
</div>
<div class="ulist">
<ul>
<li>
<p>重写Java代理，以使用表达式，并将所需数据通过方法参数传递给代理。</p>
</li>
<li>
<p>或者，在每次代理表达式解析时，返回代理类的新实例。这意味着这个bean的scope（范围）必须是<strong>prototype（原型）</strong>（例如在代理类上加上@Scope(SCOPE_PROTOTYPE)注解）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在Activiti 5.21版本中，可以通过配置流程引擎配置，禁用在代理表达式上使用字段注入。需要设置<em>delegateExpressionFieldInjectionMode</em>参数（取<em>org.activiti.engine.imp.cfg.DelegateExpressionFieldInjectionMode</em>枚举中的值）。</p>
</div>
<div class="paragraph">
<p>可使用下列选项：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>DISABLED（禁用）</strong>：当使用代理表达式时，完全禁用字段注入。不会再尝试进行字段注入。这是最安全的方式，保证线程安全。</p>
</li>
<li>
<p><strong>COMPATIBILITY（兼容）</strong>：在这个模式下，行为与5.21版本之前完全一样：可以在代理表达式中使用字段注入，如果代理类中没有定义该字段，会抛出异常。这是最不线程安全的模式，但可以保证历史版本兼容性，也可以在代理表达式只在一个任务中使用的时候（因此不会产生并发竞争条件），安全使用。</p>
</li>
<li>
<p><strong>MIXED（混合）</strong>：可以在使用代理表达式时注入，但当代理中没有定义字段时，不会抛出异常。这样可以在部分代理中使用注入（例如不是单例时），而在部分代理中不使用注入。</p>
</li>
<li>
<p><strong>Activiti 5.x版本的默认模式为COMPATIBILITY（兼容）</strong>。</p>
</li>
<li>
<p><strong>Activiti 6.x版本的默认模式为MIXED（混合）</strong>。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>例如，假设使用<em>MIXED</em>模式，并使用Spring集成，在Spring配置中定义了如下bean：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;bean id="singletonDelegateExpressionBean"
  class="org.activiti.spring.test.fieldinjection.SingletonDelegateExpressionBean" /&gt;

&lt;bean id="prototypeDelegateExpressionBean"
  class="org.activiti.spring.test.fieldinjection.PrototypeDelegateExpressionBean"
  scope="prototype" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>第一个bean是一般的Spring bean，因此是单例的。第二个的scope为<em>prototype</em>，因此每次请求这个bean时，Spring容器都会返回一个新实例。</p>
</div>
<div class="paragraph">
<p>在以下流程定义中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="serviceTask1" activiti:delegateExpression="${prototypeDelegateExpressionBean}"&gt;
  &lt;extensionElements&gt;
    &lt;activiti:field name="fieldA" expression="${input * 2}"/&gt;
    &lt;activiti:field name="fieldB" expression="${1 + 1}"/&gt;
    &lt;activiti:field name="resultVariableName" stringValue="resultServiceTask1"/&gt;
  &lt;/extensionElements&gt;
&lt;/serviceTask&gt;

&lt;serviceTask id="serviceTask2" activiti:delegateExpression="${prototypeDelegateExpressionBean}"&gt;
  &lt;extensionElements&gt;
    &lt;activiti:field name="fieldA" expression="${123}"/&gt;
    &lt;activiti:field name="fieldB" expression="${456}"/&gt;
    &lt;activiti:field name="resultVariableName" stringValue="resultServiceTask2"/&gt;
  &lt;/extensionElements&gt;
&lt;/serviceTask&gt;

&lt;serviceTask id="serviceTask3" activiti:delegateExpression="${singletonDelegateExpressionBean}"&gt;
  &lt;extensionElements&gt;
    &lt;activiti:field name="fieldA" expression="${input * 2}"/&gt;
    &lt;activiti:field name="fieldB" expression="${1 + 1}"/&gt;
    &lt;activiti:field name="resultVariableName" stringValue="resultServiceTask1"/&gt;
  &lt;/extensionElements&gt;
&lt;/serviceTask&gt;

&lt;serviceTask id="serviceTask4" activiti:delegateExpression="${singletonDelegateExpressionBean}"&gt;
  &lt;extensionElements&gt;
    &lt;activiti:field name="fieldA" expression="${123}"/&gt;
    &lt;activiti:field name="fieldB" expression="${456}"/&gt;
    &lt;activiti:field name="resultVariableName" stringValue="resultServiceTask2"/&gt;
  &lt;/extensionElements&gt;
&lt;/serviceTask&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>有四个服务任务，第一、二个使用<em>${prototypeDelegateExpressionBean}</em>代理表达式，第三、四个使用<em>${singletonDelegateExpressionBean}</em>代理表达式。</p>
</div>
<div class="paragraph">
<p>先看原型bean：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class PrototypeDelegateExpressionBean implements JavaDelegate {

  public static AtomicInteger INSTANCE_COUNT = new AtomicInteger(0);

  private Expression fieldA;
  private Expression fieldB;
  private Expression resultVariableName;

  public PrototypeDelegateExpressionBean() {
    INSTANCE_COUNT.incrementAndGet();
  }

  @Override
  public void execute(DelegateExecution execution) throws Exception {

    Number fieldAValue = (Number) fieldA.getValue(execution);
    Number fieldValueB = (Number) fieldB.getValue(execution);

    int result = fieldAValue.intValue() + fieldValueB.intValue();
    execution.setVariable(resultVariableName.getValue(execution).toString(), result);
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在运行上面流程定义的一个流程实例后，检查<em>INSTANCE_COUNT</em>，会得到<em>2</em>。这是因为每次<em>${prototypeDelegateExpressionBean}</em>解析时，都会创建新实例。可以看到三个<em>Expression</em>成员字段的注入没有任何问题。</p>
</div>
<div class="paragraph">
<p>而在原型bean中，有一点区别：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class SingletonDelegateExpressionBean implements JavaDelegate {

  public static AtomicInteger INSTANCE_COUNT = new AtomicInteger(0);

  public SingletonDelegateExpressionBean() {
    INSTANCE_COUNT.incrementAndGet();
  }

  @Override
  public void execute(DelegateExecution execution) throws Exception {

    Expression fieldAExpression = DelegateHelper.getFieldExpression(execution, "fieldA");
    Number fieldA = (Number) fieldAExpression.getValue(execution);

    Expression fieldBExpression = DelegateHelper.getFieldExpression(execution, "fieldB");
    Number fieldB = (Number) fieldBExpression.getValue(execution);

    int result = fieldA.intValue() + fieldB.intValue();

    String resultVariableName = DelegateHelper.getFieldExpression(execution, "resultVariableName").getValue(execution).toString();
    execution.setVariable(resultVariableName, result);
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>INSTANCE_COUNT</em>总是<em>1</em>，因为是单例模式。在这个代理中，没有<em>Expression</em>成员字段。因为我们使用的是<em>MIXED</em>模式，可以这样用。而在<em>COMPATIBILITY</em>模式下，就会抛出异常，因为需要有成员字段。这个bean也可以使用<em>DISABLED</em>模式，但会禁用上面进行了字段注入的原型bean。</p>
</div>
<div class="paragraph">
<p>在代理的代码里，使用了<strong>org.activiti.engine.delegate.DelegateHelper</strong>。它提供了一些有用的工具方法，用于执行相同的逻辑，并且在单例中是线程安全的。与注入<em>Expression</em>不同，它通过<em>getFieldExpression</em>读取。这意味着在服务任务的XML里，字段定义与单例bean完全相同。查看上面的XML代码，可以看到定义是相同的，只是实现逻辑不同。</p>
</div>
<div class="paragraph">
<p>（技术提示：<em>getFieldExpression</em>直接读取BpmnModel，并在方法执行时创建表达式，因此是线程安全的）。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在Activiti 5.x版本中，（由于架构缺陷）不能在<em>ExecutionListener</em>或<em>TaskListener</em>中使用DelegateHelper。要保证监听器的线程安全，仍需使用表达式，或确保每次解析代理表达式时，都创建新实例。</p>
</li>
<li>
<p>在Activiti 6.x版本中，在<em>ExecutionListener</em>或<em>TaskListener</em>中可以使用DelegateHelper。例如在6.x版本中，下列代码可以使用<strong>DelegateHelper</strong>：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;extensionElements&gt;
  &lt;activiti:executionListener
      delegateExpression="${testExecutionListener}" event="start"&gt;
    &lt;activiti:field name="input" expression="${startValue}" /&gt;
    &lt;activiti:field name="resultVar" stringValue="processStartValue" /&gt;
  &lt;/activiti:executionListener&gt;
&lt;/extensionElements&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>其中<em>testExecutionListener</em>解析为ExecutionListener接口的一个实现的实例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Component("testExecutionListener")
public class TestExecutionListener implements ExecutionListener {

  @Override
  public void notify(DelegateExecution execution) {
    Expression inputExpression = DelegateHelper.getFieldExpression(execution, "input");
    Number input = (Number) inputExpression.getValue(execution);

    int result = input.intValue() * 100;

    Expression resultVarExpression = DelegateHelper.getFieldExpression(execution, "resultVar");
    execution.setVariable(resultVarExpression.getValue(execution).toString(), result);
  }

}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="serviceTaskResultValue">服务任务的结果 Service task results</h5>
<div class="paragraph">
<p>服务执行的返回值（仅对使用表达式的服务任务），可以通过为脚本任务定义的<em>'activiti:resultVariable'</em>属性设置流程变量名，指定为已经存在的，或者新的流程变量。指定的已有值的流程变量，会被服务执行的结果值覆盖。当不指定结果变量名时，服务执行的结果值将被忽略。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="aMethodExpressionServiceTask"
    activiti:expression="#{myService.doSomething()}"
    activiti:resultVariable="myVar" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>在上例中，服务执行的结果（流程变量或Spring bean中，使用<em>'myService'</em>名字获取的对象，调用<em>'doSomething()'</em>方法的返回值），在服务执行完成后，会设置为名为<em>'myVar'</em>的流程变量。</p>
</div>
</div>
<div class="sect4">
<h5 id="serviceTaskExceptionHandling">处理异常 Handling exceptions</h5>
<div class="paragraph">
<p>当执行自定义逻辑时，通常需要捕获特定的业务异常，并在流程中处理。Activiti提供了不同的方法。</p>
</div>
<div class="sect5">
<h6 id="serviceTaskBpmnErrors">抛出BPMN错误 Throwing BPMN Errors</h6>
<div class="paragraph">
<p>可以在服务任务或脚本任务的用户代码中抛出BPMN错误。要这么做，可以在Java代理、脚本、表达式与代理表达式中，抛出特殊的ActivitiException，叫做<em>BpmnError</em>。引擎会捕获这个异常，并将其转发至合适的错误处理器，例如异常边界事件，或者错误事件子程序。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class ThrowBpmnErrorDelegate implements JavaDelegate {

  public void execute(DelegateExecution execution) throws Exception {
    try {
      executeBusinessLogic();
    } catch (BusinessException e) {
      throw new BpmnError("BusinessExceptionOccurred");
    }
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>构造函数的参数是错误代码，将被用于决定处理这个错误的错误处理器。参见<a href="#bpmnBoundaryErrorEvent">错误边界事件</a>了解如何捕获BPMN错误。</p>
</div>
<div class="paragraph">
<p>这个机制<strong>只应该用于业务错误</strong>，需要通过流程中定义的错误边界事件或错误事件子流程处理。技术错误应该通过其他异常类型表现，并且通常不在流程内部处理。</p>
</div>
</div>
<div class="sect5">
<h6 id="exceptionMapping">异常映射 Exception mapping</h6>
<div class="paragraph">
<p>也可以使用<code>mapException</code>扩展，直接将Java异常映射至业务异常（错误）。单一映射是最简单的格式：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="servicetask1" name="Service Task" activiti:class="..."&gt;
  &lt;extensionElements&gt;
    &lt;activiti:mapException
          errorCode="myErrorCode1"&gt;org.activiti.SomeException&lt;/activiti:mapException&gt;
  &lt;/extensionElements&gt;
&lt;/serviceTask&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的代码中，如果服务任务抛出了<code>org.activiti.SomeException</code>的实例，则会被捕获，并被转换为带有给定errorCode的BPMN异常（错误）。从这里开始，可以与普通BPMN异常（错误）完全一样地处理。</p>
</div>
<div class="paragraph">
<p>其他异常会依照没有映射被处理，将传播至API调用者。</p>
</div>
<div class="paragraph">
<p>也可以在一行中，使用<code>includeChildExceptions</code>属性，映射特定异常的所有子异常。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="servicetask1" name="Service Task" activiti:class="..."&gt;
  &lt;extensionElements&gt;
    &lt;activiti:mapException errorCode="myErrorCode1"
           includeChildExceptions="true"&gt;org.activiti.SomeException&lt;/activiti:mapException&gt;
  &lt;/extensionElements&gt;
&lt;/serviceTask&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的代码中，Activiti会将任何直接或间接的<code>SomeException</code>的子类，转换为带有给定错误代码的BPMN错误。当未指定<code>includeChildExceptions</code>时，视为“false”。</p>
</div>
<div class="paragraph">
<p>最普通的是默认映射。默认映射是一个没有类的映射，可以匹配任何Java异常：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="servicetask1" name="Service Task" activiti:class="..."&gt;
  &lt;extensionElements&gt;
    &lt;activiti:mapException errorCode="myErrorCode1"/&gt;
  &lt;/extensionElements&gt;
&lt;/serviceTask&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>映射会按照顺序检查，从上至下，使用第一个匹配的映射，除了默认映射。默认映射将只在所有映射都不能成功匹配时使用。只有第一个没有类的映射会当做默认映射处理。默认映射忽略<code>includeChildExceptions</code>。</p>
</div>
</div>
<div class="sect5">
<h6 id="serviceTaskExceptionSequenceFlow">异常顺序流 Exception Sequence Flow</h6>
<div class="paragraph">
<p><a href="#internal">[内部：非公有实现类]</a></p>
</div>
<div class="paragraph">
<p>也可以选择在发生异常时，将流程执行路由至另一条路径。下面的例子展示了如何做。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="javaService"
  name="Java service invocation"
  activiti:class="org.activiti.ThrowsExceptionBehavior"&gt;
&lt;/serviceTask&gt;

&lt;sequenceFlow id="no-exception" sourceRef="javaService" targetRef="theEnd" /&gt;
&lt;sequenceFlow id="exception" sourceRef="javaService" targetRef="fixException" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这里，这个服务任务具有两条出口顺序流，分别称为<code>exception</code>与<code>no-exception</code>。这些顺序流id会在发生异常时，用于控制流程流向：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class ThrowsExceptionBehavior implements ActivityBehavior {

  public void execute(ActivityExecution execution) throws Exception {
    String var = (String) execution.getVariable("var");

    PvmTransition transition = null;
    try {
      executeLogic(var);
      transition = execution.getActivity().findOutgoingTransition("no-exception");
    } catch (Exception e) {
      transition = execution.getActivity().findOutgoingTransition("exception");
    }
    execution.take(transition);
  }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="serviceTaskCallActivitiService">在JavaDelegate中使用Activiti服务 Using an Activiti service from within a JavaDelegate</h5>
<div class="paragraph">
<p>有的时候，需要在Java服务任务中使用Activiti服务（例如当调用活动不符合需求时，通过RuntimeService启动流程实例）。<em>org.activiti.engine.delegate.DelegateExecution</em>可以方便地通过<em>org.activiti.engine.EngineServices</em>接口使用这些服务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class StartProcessInstanceTestDelegate implements JavaDelegate {

  public void execute(DelegateExecution execution) throws Exception {
    RuntimeService runtimeService = execution.getEngineServices().getRuntimeService();
    runtimeService.startProcessInstanceByKey("myProcess");
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>通过这个接口可以访问所有Activiti服务API。</p>
</div>
<div class="paragraph">
<p>使用这些API调用造成的所有数据变更，都处在当前事务中。在具有依赖注入的环境，如Spring或CDI中，使用或不使用激活JTA的数据源，也都可以使用。例如，下面的代码片段与上面的代码具有相同功能，但RuntimeService是通过注入而不是通过<em>org.activiti.engine.EngineServices</em>接口获得的。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Component("startProcessInstanceDelegate")
public class StartProcessInstanceTestDelegateWithInjection {

    @Autowired
    private RuntimeService runtimeService;

    public void startProcess() {
      runtimeService.startProcessInstanceByKey("oneTaskProcess");
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>重要技术提示：</strong>在当前事务中进行的服务调用，产生或修改的数据是在服务任务执行<em>前</em>完成的，因此更改还未刷入数据库。所有API调用都通过处理数据库数据而生效，这意味着这些未提交的修改在服务任务的API调用中“不可见”。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnWebserviceTask">8.5.4. Web服务任务 Web Service Task</h4>
<div class="paragraph">
<p><a href="#experimental">[EXPERIMENTAL]</a><a id="bpmnWebserviceTaskDescription"></a></p>
</div>
<div class="sect4">
<h5 id="_描述_description_6">描述 Description</h5>
<div class="paragraph">
<p>Web服务任务用于同步调用外部的Web服务。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnWebserviceTaskGraphicalNotation">图示 Graphical Notation</h5>
<div class="paragraph">
<p>Web服务任务，与Java服务任务显示地一样。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.web.service.task.png" alt="bpmn.web.service.task">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnWebserviceTaskXML">XML表示 XML representation</h5>
<div class="paragraph">
<p>要使用Web服务，需要导入其操作，以及复杂的类型。通过使用指向Web服务的WSDL的导入标签（import tag），可以自动完成这些：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;import importType="http://schemas.xmlsoap.org/wsdl/"
	location="http://localhost:63081/counter?wsdl"
	namespace="http://webservice.activiti.org/" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的声明告知Activiti导入定义，但并不创建条目定义（item definition）与消息。假设我们需要调用一个名为&#8217;prettyPrint&#8217;的方法，我们需要为请求与回复消息，创建相应的消息与条目定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;message id="prettyPrintCountRequestMessage" itemRef="tns:prettyPrintCountRequestItem" /&gt;
&lt;message id="prettyPrintCountResponseMessage" itemRef="tns:prettyPrintCountResponseItem" /&gt;

&lt;itemDefinition id="prettyPrintCountRequestItem" structureRef="counter:prettyPrintCount" /&gt;
&lt;itemDefinition id="prettyPrintCountResponseItem" structureRef="counter:prettyPrintCountResponse" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>在声明服务任务前，需要定义实际引用Web服务的BPMN接口与操作。基本上，是定义“接口”与所需的“操作”。我们对每一个操作都重复使用之前定义的传入与传出消息。例如，下面的声明定义了“counter”接口，与“prettyPrintCountOperation”操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;interface name="Counter Interface" implementationRef="counter:Counter"&gt;
	&lt;operation id="prettyPrintCountOperation" name="prettyPrintCount Operation"
			implementationRef="counter:prettyPrintCount"&gt;
		&lt;inMessageRef&gt;tns:prettyPrintCountRequestMessage&lt;/inMessageRef&gt;
		&lt;outMessageRef&gt;tns:prettyPrintCountResponseMessage&lt;/outMessageRef&gt;
	&lt;/operation&gt;
&lt;/interface&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在可以通过使用##WebService实现，声明Web服务任务，并引用Web服务操作。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="webService"
	name="Web service invocation"
	implementation="##WebService"
	operationRef="tns:prettyPrintCountOperation"&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnWebserviceTaskIOSpecification">Web服务任务IO规范 Web Service Task IO Specification</h5>
<div class="paragraph">
<p>除非使用简化方法处理输入与输出数据关联（见下），否则需要为每个Web服务任务声明IO规范，指出任务的输入与输出是什么。这个方法很简单，也兼容BPMN 2.0。在prettyPrint例子中，根据之前声明的条目定义，定义输入与输出：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;ioSpecification&gt;
	&lt;dataInput itemSubjectRef="tns:prettyPrintCountRequestItem" id="dataInputOfServiceTask" /&gt;
	&lt;dataOutput itemSubjectRef="tns:prettyPrintCountResponseItem" id="dataOutputOfServiceTask" /&gt;
	&lt;inputSet&gt;
		&lt;dataInputRefs&gt;dataInputOfServiceTask&lt;/dataInputRefs&gt;
	&lt;/inputSet&gt;
	&lt;outputSet&gt;
		&lt;dataOutputRefs&gt;dataOutputOfServiceTask&lt;/dataOutputRefs&gt;
	&lt;/outputSet&gt;
&lt;/ioSpecification&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnWebserviceTaskDataInputAssociation">Web服务任务数据输入关联 Web Service Task data input associations</h5>
<div class="paragraph">
<p>有两种指定数据输入关联的方式：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>使用表达式</p>
</li>
<li>
<p>使用简化方法</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>要使用表达式指定数据输入关联，需要定义条目的源与目标，并指定每个条目字段的关联。下面的例子中我们指定了条目的prefix与suffix字段：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dataInputAssociation&gt;
	&lt;sourceRef&gt;dataInputOfProcess&lt;/sourceRef&gt;
	&lt;targetRef&gt;dataInputOfServiceTask&lt;/targetRef&gt;
	&lt;assignment&gt;
		&lt;from&gt;${dataInputOfProcess.prefix}&lt;/from&gt;
		&lt;to&gt;${dataInputOfServiceTask.prefix}&lt;/to&gt;
	&lt;/assignment&gt;
	&lt;assignment&gt;
		&lt;from&gt;${dataInputOfProcess.suffix}&lt;/from&gt;
		&lt;to&gt;${dataInputOfServiceTask.suffix}&lt;/to&gt;
	&lt;/assignment&gt;
&lt;/dataInputAssociation&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>另一方面，也可以使用简化方法。'sourceRef&#8217;元素是一个Activiti变量名，而&#8217;targetRef&#8217;是条目定义的参数。在下面的例子里，将&#8217;PrefixVariable&#8217;变量的值关联至&#8217;prefix&#8217;字段，并将&#8217;SuffixVariable&#8217;变量的值关联至&#8217;suffix&#8217;字段。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dataInputAssociation&gt;
	&lt;sourceRef&gt;PrefixVariable&lt;/sourceRef&gt;
	&lt;targetRef&gt;prefix&lt;/targetRef&gt;
&lt;/dataInputAssociation&gt;
&lt;dataInputAssociation&gt;
	&lt;sourceRef&gt;SuffixVariable&lt;/sourceRef&gt;
	&lt;targetRef&gt;suffix&lt;/targetRef&gt;
&lt;/dataInputAssociation&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnWebserviceTaskDataOutputAssociation">Web服务任务数据输出关联 Web Service Task data output associations</h5>
<div class="paragraph">
<p>有两种指定数据输出关联的方式：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>使用表达式</p>
</li>
<li>
<p>使用简化方法</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>要使用表达式指定数据输出关联，需要定义目标变量与源表达式。这种方法很直接，与数据输入关联类似：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dataOutputAssociation&gt;
	&lt;targetRef&gt;dataOutputOfProcess&lt;/targetRef&gt;
	&lt;transformation&gt;${dataOutputOfServiceTask.prettyPrint}&lt;/transformation&gt;
&lt;/dataOutputAssociation&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>另一方面，也可以使用简化方法。'sourceRef&#8217;是条目定义的参数，而&#8217;targetRef&#8217;元素是一个Activiti变量名。这种方法很直接，与数据输入关联类似：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dataOutputAssociation&gt;
	&lt;sourceRef&gt;prettyPrint&lt;/sourceRef&gt;
	&lt;targetRef&gt;OutputVariable&lt;/targetRef&gt;
&lt;/dataOutputAssociation&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnBusinessRuleTask">8.5.5. 业务规则任务 Business Rule Task</h4>
<div class="paragraph">
<p><a href="#experimental">[EXPERIMENTAL]</a><a id="bpmnBusinessRuleTaskDescription"></a></p>
</div>
<div class="sect4">
<h5 id="_描述_description_7">描述 Description</h5>
<div class="paragraph">
<p>业务规则任务用于同步执行一条或多条规则。Activiti使用名为Drools Expert的Drools规则引擎执行业务规则。目前，业务规则中包含的.drl文件，必须与定义了业务规则服务并执行规则的流程定义，一起部署。这意味着流程中使用的所有.drl文件都需要打包在流程BAR文件中，与任务表单类似。要了解为Drools Expert创建业务规则的更多信息，请访问位于<a href="http://www.jboss.org/drools/documentation">JBoss Drools</a>的Drools文档。</p>
</div>
<div class="paragraph">
<p>如果想要插入自己的规则任务实现，例如，希望通过不同方法使用Drools，或者想使用完全不同的规则引擎，则可以使用BusinessRuleTask的class或expression属性。这样它会与<a href="#bpmnJavaServiceTask">服务任务</a>的行为完全相同。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBusinessRuleTaskGraphicalNotation">图示 Graphical Notation</h5>
<div class="paragraph">
<p>业务规则任务，显示为带有表格图标的圆角矩形。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.business.rule.task.png" alt="bpmn.business.rule.task">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBusinessRuleTaskXML">XML表示 XML representation</h5>
<div class="paragraph">
<p>要执行一条或多条，与流程定义在同一个BAR文件中部署的业务规则，需要定义输入与结果变量。输入变量可以用流程变量的列表定义，使用逗号分隔。输出变量只能有一个变量名，将执行业务规则数处对象存储至流程变量。请注意结果变量会包含对象的list。如果没有指定结果变量名，会使用默认的org.activiti.engine.rules.OUTPUT。</p>
</div>
<div class="paragraph">
<p>下面的业务规则任务，执行与流程定义一起部署的所有业务规则：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;process id="simpleBusinessRuleProcess"&gt;

  &lt;startEvent id="theStart" /&gt;
  &lt;sequenceFlow sourceRef="theStart" targetRef="businessRuleTask" /&gt;

  &lt;businessRuleTask id="businessRuleTask" activiti:ruleVariablesInput="${order}"
      activiti:resultVariable="rulesOutput" /&gt;

  &lt;sequenceFlow sourceRef="businessRuleTask" targetRef="theEnd" /&gt;

  &lt;endEvent id="theEnd" /&gt;

&lt;/process&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以将业务规则任务配置为只执行部署的.drl文件中的一组规则。要做到这一点，需要指定规则名字的列表，用逗号分隔。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;businessRuleTask id="businessRuleTask" activiti:ruleVariablesInput="${order}"
      activiti:rules="rule1, rule2" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个例子中只会执行rule1与rule2。</p>
</div>
<div class="paragraph">
<p>也可以定义需要从执行中排除的规则列表。 execution.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;businessRuleTask id="businessRuleTask" activiti:ruleVariablesInput="${order}"
      activiti:rules="rule1, rule2" exclude="true" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个例子中与流程定义一起部署在同一个BAR文件中的所有规则都会被执行，除了rule1与rule2.</p>
</div>
<div class="paragraph">
<p>前面提到过，还可以自行处理BusinessRuleTask的实现：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;businessRuleTask id="businessRuleTask" activiti:class="${MyRuleServiceDelegate}" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>这样业务规则任务与服务任务的行为完全一样，但仍保持业务规则任务的图标，显示在这里处理业务规则。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnEmailTask">8.5.6. 邮件任务 Email Task</h4>
<div class="paragraph">
<p>Activiti可以通过自动邮件服务任务，增强业务流程。可以向一个或多个收信人发送邮件，支持cc，bcc，HTML内容，等等。请注意邮件任务<strong>不是</strong>BPMN 2.0规范的“官方”任务（因此也没有专用图标）。因此，在Activiti中，邮件任务实现为一种特殊的服务任务。</p>
</div>
<div class="sect4">
<h5 id="bpmnEmailTaskServerConfiguration">邮件服务器配置 Mail server configuration</h5>
<div class="paragraph">
<p>Activiti引擎通过支持SMTP的外部邮件服务器发送邮件。要发送邮件，引擎需要了解如何连接邮件服务器。可以在<em>activiti.cfg.xml</em>配置文件中设置下面的参数：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填?</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mailServerHost</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件服务器的主机名（如mail.mycorp.com）。默认为<code>localhost</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mailServerPort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是，如果不使用默认端口</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件服务器的SMTP端口。默认值为<em>25</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mailServerDefaultFrom</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">若用户没有提供地址，默认使用的邮件发件人地址。默认为<em>activiti@activiti.org</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mailServerUsername</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">若服务器需要</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部分邮件服务器发信时需要进行认证。默认为空。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mailServerPassword</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">若服务器需要</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部分邮件服务器发信时需要进行认证。默认为空。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mailServerUseSSL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">若服务器需要</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部分邮件服务器要求ssl通信。默认设置为false。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mailServerUseTLS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">若服务器需要</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部分邮件服务器要求TLS通信（例如gmail）。默认设置为false。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="bpmnEmailTaskUsage">定义邮件任务 Defining an Email Task</h5>
<div class="paragraph">
<p>邮件任务实现为特殊的<a href="#bpmnJavaServiceTask">服务任务</a>，通过将服务任务的<em>type</em>定义为<em>'mail'</em>设置。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="sendMail" activiti:type="mail"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>邮件任务通过<a href="#serviceTaskFieldInjection">字段注入</a>配置。这些参数的值可以使用EL表达式，将在流程执行运行时解析。可以设置下列参数：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填?</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">to</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件的收信人。可以使用逗号分隔的列表定义多个接收人</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">from</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件的发信人地址。如果不设置，会使用<a href="#bpmnEmailTaskServerConfiguration">默认配置</a>的地址</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件的抄送人。可以使用逗号分隔的列表定义多个接收人</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bcc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件的密送人。可以使用逗号分隔的列表定义多个接收人</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">charset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可以修改邮件的字符集，对许多非英语语言很必要。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">html</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件的HTML内容</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件的内容，普通非富文本的邮件。对于不支持富文本内容的客户端，可以与<em>html</em>一起使用。客户端会退回为纯文本格式。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">htmlVar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">存储邮件HTML内容的流程变量名。与html参数的最大区别，是这个参数会在邮件任务发送前，使用其内容进行表达式替换。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">textVar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">存储邮件纯文本内容的流程变量名。与text参数的最大区别，是这个参数会在邮件任务发送前，使用其内容进行表达式替换。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ignoreException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">处理邮件时的失败，是否抛出ActivitiException。默认设置为false。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">exceptionVariableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">当处理邮件时的失败，由于<em>ignoreException = true</em>设置而不会抛出异常，则使用给定名字的变量保存失败信息</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="bpmnEmailTaskExampleUsage">使用示例 Example usage</h5>
<div class="paragraph">
<p>下面的XML代码片段展示了使用邮件任务的示例。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="sendMail" activiti:type="mail"&gt;
  &lt;extensionElements&gt;
    &lt;activiti:field name="from" stringValue="order-shipping@thecompany.com" /&gt;
    &lt;activiti:field name="to" expression="${recipient}" /&gt;
    &lt;activiti:field name="subject" expression="Your order ${orderId} has been shipped" /&gt;
    &lt;activiti:field name="html"&gt;
      &lt;activiti:expression&gt;
        &lt;![CDATA[
          &lt;html&gt;
            &lt;body&gt;
              Hello ${male ? 'Mr.' : 'Mrs.' } ${recipientName},&lt;br/&gt;&lt;br/&gt;

              As of ${now}, your order has been &lt;b&gt;processed and shipped&lt;/b&gt;.&lt;br/&gt;&lt;br/&gt;

              Kind regards,&lt;br/&gt;

              TheCompany.
            &lt;/body&gt;
          &lt;/html&gt;
        ]]&gt;
      &lt;/activiti:expression&gt;
    &lt;/activiti:field&gt;
  &lt;/extensionElements&gt;
&lt;/serviceTask&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>产生如下结果：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/email.task.result.png" alt="email.task.result">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnMuleTask">8.5.7. Mule任务 Mule Task</h4>
<div class="paragraph">
<p>Mule任务可以向Mule发送消息，增强Activiti的集成特性。请注意Mule任务<strong>不是</strong>BPMN 2.0规范的“官方”任务（因此也没有专用图标）。因此，在Activiti中，Mule任务实现为一种特殊的服务任务。</p>
</div>
<div class="sect4">
<h5 id="bpmnMuleTaskUsage">定义Mule任务 Defining an Mule Task</h5>
<div class="paragraph">
<p>Mule任务实现为特殊的<a href="#bpmnJavaServiceTask">服务任务</a>，通过将服务任务的<em>type</em>定义为<em>'mule'</em>设置。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="sendMule" activiti:type="mule"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mule任务通过<a href="#serviceTaskFieldInjection">字段注入</a>配置。这些参数的值可以使用EL表达式，将在流程执行运行时解析。可以设置下列参数：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填?</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">endpointUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">希望调用的Mule终端（endpoint）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">language</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">计算payloadExpression字段所用的语言。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">payloadExpression</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">消息的载荷表达式</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resultVariable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">存储调用结果的变量名。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="bpmnMuleTaskExampleUsage">使用示例 Example usage</h5>
<div class="paragraph">
<p>下面的XML代码片段展示了使用Mule任务的示例。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;extensionElements&gt;
  &lt;activiti:field name="endpointUrl"&gt;
    &lt;activiti:string&gt;vm://in&lt;/activiti:string&gt;
  &lt;/activiti:field&gt;
  &lt;activiti:field name="language"&gt;
    &lt;activiti:string&gt;juel&lt;/activiti:string&gt;
  &lt;/activiti:field&gt;
  &lt;activiti:field name="payloadExpression"&gt;
    &lt;activiti:string&gt;"hi"&lt;/activiti:string&gt;
  &lt;/activiti:field&gt;
  &lt;activiti:field name="resultVariable"&gt;
    &lt;activiti:string&gt;theVariable&lt;/activiti:string&gt;
  &lt;/activiti:field&gt;
&lt;/extensionElements&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnCamelTask">8.5.8. Camel任务 Camel Task</h4>
<div class="paragraph">
<p>Camel任务可以向Mule发送与接收消息，增强Activiti的集成特性。请注意Camel任务<strong>不是</strong>BPMN 2.0规范的“官方”任务（因此也没有专用图标）。因此，在Activiti中，Camel任务实现为一种特殊的服务任务。还请注意要使用Camel任务功能，需要在项目中包含Activiti Camel模块。</p>
</div>
<div class="sect4">
<h5 id="bpmnCamelTaskUsage">定义Camel任务 Defining a Camel Task</h5>
<div class="paragraph">
<p>Camel任务实现为特殊的<a href="#bpmnJavaServiceTask">服务任务</a>，通过将服务任务的<em>type</em>定义为<em>'camel'</em>设置。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="sendCamel" activiti:type="camel"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>流程定义本身只需要在服务任务上定义Camel类型。集成逻辑都通过Camel容器代理。默认情况下Activiti引擎在Spring容器中查找camelContext bean。camelContext bean定义了由Camel容器装载的Camel路由。在下面的例子中，路由通过给定的Java包装载，但也可以自行在Spring配置中直接定义路由。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;camelContext id="camelContext" xmlns="http://camel.apache.org/schema/spring"&gt;
  &lt;packageScan&gt;
    &lt;package&gt;org.activiti.camel.route&lt;/package&gt;
  &lt;/packageScan&gt;
&lt;/camelContext&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以在<a href="http://camel.apache.org/">Camel网站</a>找到关于Camel路由的更多文档。这篇文档中只通过几个小例子展示基本概念。在第一个例子中，在Activiti工作流中进行最简单的Camel调用。叫做SimpleCamelCall。</p>
</div>
<div class="paragraph">
<p>如果想要定义多个Camel上下文bean，并且/或想使用不同的bean名字，可以在Camel任务定义中像这样覆盖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="serviceTask1" activiti:type="camel"&gt;
  &lt;extensionElements&gt;
    &lt;activiti:field name="camelContext" stringValue="customCamelContext" /&gt;
  &lt;/extensionElements&gt;
&lt;/serviceTask&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCamelTaskSimpleCamelCall">简单Camel调用示例 Simple Camel Call example</h5>
<div class="paragraph">
<p>这个例子相关的所有文件，都可以在activiti-camel模块的org.activiti.camel.examples.simpleCamelCall包中找到。目的是简单启动一个camel路由。首先需要一个配置了上面提到的路由的Spring上下文。下面的代码用做这个目的：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;camelContext id="camelContext" xmlns="http://camel.apache.org/schema/spring"&gt;
  &lt;packageScan&gt;
    &lt;package&gt;org.activiti.camel.examples.simpleCamelCall&lt;/package&gt;
  &lt;/packageScan&gt;
&lt;/camelContext&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class SimpleCamelCallRoute extends RouteBuilder {

  @Override
  public void configure() throws Exception {
    from("activiti:SimpleCamelCallProcess:simpleCall").to("log:org.activiti.camel.examples.SimpleCamelCall");
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>路由只是记录消息体，不做更多事情。请注意from终端的格式，包含三个部分：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">终端Url部分</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">activiti</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">引用Activiti终端</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SimpleCamelCallProcess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">simpleCall</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程中Camel服务的名字</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>现在路由已经正确配置，可以访问Camel。下面需要像这样定义工作流：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;process id="SimpleCamelCallProcess"&gt;
  &lt;startEvent id="start"/&gt;
  &lt;sequenceFlow id="flow1" sourceRef="start" targetRef="simpleCall"/&gt;

  &lt;serviceTask id="simpleCall" activiti:type="camel"/&gt;

  &lt;sequenceFlow id="flow2" sourceRef="simpleCall" targetRef="end"/&gt;
  &lt;endEvent id="end"/&gt;
&lt;/process&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCamelTaskPingPong">连通性测试 Ping Pong example</h5>
<div class="paragraph">
<p>示例已经可以工作，但实际上Camel与Activiti之间并没有通信，因此没有太多价值。在这个例子里，将试着从Camel接收与发送消息。将发送一个字符串，Camel在其上连接一些东西，并返回作为结果。发送部分比较普通，以变量的格式将信息发送给Camel服务。这是我们的调用代码：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Deployment
public void testPingPong() {
  Map&lt;String, Object&gt; variables = new HashMap&lt;String, Object&gt;();

  variables.put("input", "Hello");
  Map&lt;String, String&gt; outputMap = new HashMap&lt;String, String&gt;();
  variables.put("outputMap", outputMap);

  runtimeService.startProcessInstanceByKey("PingPongProcess", variables);
  assertEquals(1, outputMap.size());
  assertNotNull(outputMap.get("outputValue"));
  assertEquals("Hello World", outputMap.get("outputValue"));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>“input”变量是实际上是Camel路由的输入，而outputMap用于捕获Camel传回的结果。流程像是这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;process id="PingPongProcess"&gt;
  &lt;startEvent id="start"/&gt;
  &lt;sequenceFlow id="flow1" sourceRef="start" targetRef="ping"/&gt;
  &lt;serviceTask id="ping" activiti:type="camel"/&gt;
  &lt;sequenceFlow id="flow2" sourceRef="ping" targetRef="saveOutput"/&gt;
  &lt;serviceTask id="saveOutput"  activiti:class="org.activiti.camel.examples.pingPong.SaveOutput" /&gt;
  &lt;sequenceFlow id="flow3" sourceRef="saveOutput" targetRef="end"/&gt;
  &lt;endEvent id="end"/&gt;
&lt;/process&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意SaveOutput服务任务，将“Output”变量从上下文中取出，存储至上面提到的OutputMap。现在需要了解变量如何发送至Camel，以及如何返回。这就需要了解Camel行为（Behavior）的概念。变量与Camel通信的方式可以通过CamelBehavior配置。在这个例子里使用默认配置，其它配置在后面会进行简短介绍。下面的代码配置了期望的Camel行为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="serviceTask1" activiti:type="camel"&gt;
  &lt;extensionElements&gt;
    &lt;activiti:field name="camelBehaviorClass" stringValue="org.activiti.camel.impl.CamelBehaviorCamelBodyImpl" /&gt;
  &lt;/extensionElements&gt;
&lt;/serviceTask&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果不指定行为，则会设置为org.activiti.camel.impl.CamelBehaviorDefaultImpl。这个行为将以相同名字，将变量复制到Camel参数。对于返回值，无论选择什么行为，如果Camel消息体是一个map，则其中的每个元素都将复制为变量，否则整个对象将复制为名为"camelBody"的特定变量。了解这些后，Camel路由总结为第二个例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Override
public void configure() throws Exception {
  from("activiti:PingPongProcess:ping").transform().simple("${property.input} World");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个路由中，字符串"world"会在结尾连接上名为“input”的参数，结果作为消息体。可以通过Java服务任务检查"camelBody"变量，并复制到“outputMap”，并可通过测试用例检查。既然这个例子使用默认行为，就让我们看看还有什么其他选择。在每个Camel路由的开始处，流程实例id会复制为名为"PROCESS_ID_PROPERTY"的Camel参数。之后会用于将流程实例与Camel路由相关联，也可以在Camel路由中使用。</p>
</div>
<div class="paragraph">
<p>Activiti中有已经可以使用三种不同的行为。可以通过修改路由URL中特定的部分，覆写行为。这里有个在URL中重载已有行为的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">from("activiti:asyncCamelProcess:serviceTaskAsync2?copyVariablesToProperties=true").</code></pre>
</div>
</div>
<div class="paragraph">
<p>下表展示了三种可用的Camel行为：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">行为</th>
<th class="tableblock halign-left valign-top">Url中</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CamelBehaviorDefaultImpl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">copyVariablesToProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">将Activiti变量复制为Camel参数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CamelBehaviorCamelBodyImpl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">copyCamelBodyToBody</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只将名为"camelBody"的Activiti变量复制为Camel消息体</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CamelBehaviorBodyAsMapImpl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">copyVariablesToBodyAsMap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">将一个map中的所有Activiti变量复制为Camel消息体</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>上表解释了Activiti变量如何传递给Camel。下表解释了Camel变量如何返回至Activiti。只能在路由URL中配置。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Url</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果Camel消息体是一个map，则将其中每一对象复制为Activiti变量；否则将整个Camel消息体复制为"camelBody" Activiti变量</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">copyVariablesFromProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">将Camel参数以同名复制为Activiti变量</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">copyCamelBodyToBodyAsString</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">与default相同，但如果Camel消息体不是map，则首先将其转换为字符串，然后再复制为"camelBody"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">copyVariablesFromHeader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">额外将Camel头复制为Activiti的同名变量</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_返回变量_returning_back_the_variables">返回变量 Returning back the variables</h5>
<div class="paragraph">
<p>上面提到的传递变量，不论是从Camel到Activiti还是反过来，都只用于变量传递的开始侧。要特别注意，由于Activiti的非阻塞行为，Activiti不会自动向Camel返回变量。因此，提供了特殊的语法。可以在Camel路由URL中，以<code>var.return.someVariableName</code>的格式，使用一个或多个参数。与这些参数同名，但没有<code>var.return</code>部分的变量，会被认为是输出变量，因此将会以相同的名字复制回Camel参数。例如在如下路由中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>from("direct:start").to("activiti:process?var.return.exampleVar").to("mock:result");</pre>
</div>
</div>
<div class="paragraph">
<p>名为<code>exampleVar</code>的Activiti变量，将被认为是输出变量，因此会以同名复制回Camel参数。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCamelTaskAsyncPingPong">异步连通性测试 Asynchronous Ping Pong example</h5>
<div class="paragraph">
<p>上面的例子都是同步的。工作流停止，直到Camel路由结束并返回。有时，需要Activiti工作流继续运行。为了这个目的，Camel服务任务的异步功能就很有用。可以通过将Camel服务任务的异步参数设置为true，启用这个功能。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="serviceAsyncPing" activiti:type="camel" activiti:async="true"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>设置这个特性后，Camel路由会由Activiti作业执行器异步启动。如果定义了Camel路由队列，Activiti流程会继续执行Camel服务任务之后的活动。Camel路由会与流程执行完全异步地执行。如果需要在流程定义的某处等待Camel服务任务的响应，可以使用接收任务（receive task）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;receiveTask id="receiveAsyncPing" name="Wait State" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>流程实例会等待，直到接收到信号，例如来自Camel。在Camel中，可以通过向合适的Activiti终端发送消息，来为流程实例发送信号。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"> from("activiti:asyncPingProcess:serviceAsyncPing").to("activiti:asyncPingProcess:receiveAsyncPing");</code></pre>
</div>
</div>
<div class="paragraph">
<p>（译者注：原文如此。可能为缺失了的 to 终端的定义：）</p>
</div>
<div class="ulist">
<ul>
<li>
<p>“activiti”字符串常量</p>
</li>
<li>
<p>流程名</p>
</li>
<li>
<p>接收任务名</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCamelTaskAsyncPingPong">从Camel路由实例化工作流 Instantiate workflow from Camel route</h5>
<div class="paragraph">
<p>上面的所有例子，都是先启动Activiti工作流，然后在工作流中启动Camel路由。也可以反过来。可以在已经启动的Camel路由中实例化工作流。与为接收任务发送消息很类似，除了最后一部分。这是一个简单的路由：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">from("direct:start").to("activiti:camelProcess");</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以看到url有两部分，第一部分是“activiti”字符串常量，第二个名字是流程的名字。很明显流程需要已经部署，并且可以通过引擎配置启动。</p>
</div>
<div class="paragraph">
<p>也可以在Camel头中，将流程起动人设置为某个已认证用户id。要这么做，首先需要在流程定义中指定启动人变量：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;startEvent id="start" activiti:initiator="initiator" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后在Camel头中的<em>CamelProcessInitiatorHeader</em>指定用户id。Camel路由会如下定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">from("direct:startWithInitiatorHeader")
    .setHeader("CamelProcessInitiatorHeader", constant("kermit"))
    .to("activiti:InitiatorCamelCallProcess?processInitiatorHeaderName=CamelProcessInitiatorHeader");</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnManualTask">8.5.9. 手动任务 Manual Task</h4>
<div class="sect4">
<h5 id="bpmnManualTaskDescription">描述 Description</h5>
<div class="paragraph">
<p><em>手动任务</em>定义了在BPMN引擎外部的任务。用于建模引擎不需要了解的某项工作，或者其他系统或用户界面。对于引擎来说，手动任务将按<strong>直接穿过活动</strong>处理，在流程执行到达时，自动继续流程。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnManualTaskGraphicalNotation">图示 Graphical Notation</h5>
<div class="paragraph">
<p>手动任务，表现为左上角带有“手型”图标的圆角矩形。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.manual.task.png" alt="bpmn.manual.task">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnManualTaskXml">XML表示 XML representation</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;manualTask id="myManualTask" name="Call client for more information" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnReceiveTask">8.5.10. Java接收任务 Java Receive Task</h4>
<div class="sect4">
<h5 id="bpmnReceiveTaskDescription">描述 Description</h5>
<div class="paragraph">
<p>接收任务，是等待特定消息到达的简单任务。目前，我们只为这个任务实现了Java语义。当流程执行到达接收任务时，流程状态将提交至持久化存储。这意味着流程将保持等待状态，直到引擎接收到特定的消息，并将触发流程通过接收任务。</p>
</div>
</div>
<div class="sect4">
<h5 id="_图示_graphical_notation_2">图示 Graphical notation</h5>
<div class="paragraph">
<p>接收任务，表现为右上角带有消息图标的任务（圆角矩形）。消息图标是白色的（黑色消息图标代表发送的含义）。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.receive.task.png" alt="bpmn.receive.task">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_xml表示_xml_representation_2">XML表示 XML representation</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;receiveTask id="waitState" name="wait" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>要使流程实例从当前的等待状态，如接收任务中继续，需要使用到达接收任务的执行id，调用<em>runtimeService.signal(executionId)</em>。下面的代码片段展示了如何操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ProcessInstance pi = runtimeService.startProcessInstanceByKey("receiveTask");
Execution execution = runtimeService.createExecutionQuery()
  .processInstanceId(pi.getId())
  .activityId("waitState")
  .singleResult();
assertNotNull(execution);

runtimeService.signal(execution.getId());</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnShellTask">8.5.11. Shell任务 Shell Task</h4>
<div class="sect4">
<h5 id="bpmnShellTaskDescription">描述 Description</h5>
<div class="paragraph">
<p>Shell任务可以运行Shell脚本与命令。请注意Shell任务<strong>不是</strong>BPMN 2.0规范的“官方”任务（因此也没有专用图标）。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnShellTaskUsage">定义Shell任务 Defining a shell task</h5>
<div class="paragraph">
<p>Shell任务实现为特殊的<a href="#bpmnJavaServiceTask">服务任务</a>，通过将服务任务的<em>type</em>定义为<em>'shell'</em>设置。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="shellEcho" activiti:type="shell"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Shell任务通过<a href="#serviceTaskFieldInjection">字段注入</a>配置。这些参数的值可以使用EL表达式，将在流程执行运行时解析。可以设置下列参数：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填?</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">command</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要执行的Shell命令。</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">arg0-5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参数0至参数5</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wait</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true/false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果可能，是否等待Shell进程终止。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">redirectError</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true/false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">将标准错误（standard error）并入标准输出（standard output）。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cleanEnv</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true/false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shell进程不继承当前环境。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">outputVariable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">保存输出的变量名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不会记录输出。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">errorCodeVariable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">保存结果错误代码的变量名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不会注册错误级别。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">directory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shell进程的默认目录</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">当前目录</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="bpmnShellTaskExampleUsage">使用示例 Example usage</h5>
<div class="paragraph">
<p>下面的XML代码片段展示了使用Shell任务的例子。会运行"cmd /c echo EchoTest" Shell脚本，等待其结束，并将结果放入resultVar。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="shellEcho" activiti:type="shell" &gt;
  &lt;extensionElements&gt;
    &lt;activiti:field name="command" stringValue="cmd" /&gt;
    &lt;activiti:field name="arg1" stringValue="/c" /&gt;
    &lt;activiti:field name="arg2" stringValue="echo" /&gt;
    &lt;activiti:field name="arg3" stringValue="EchoTest" /&gt;
    &lt;activiti:field name="wait" stringValue="true" /&gt;
    &lt;activiti:field name="outputVariable" stringValue="resultVar" /&gt;
  &lt;/extensionElements&gt;
&lt;/serviceTask&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="executionListeners">8.5.12. 执行监听器 Execution listener</h4>
<div class="paragraph">
<p><strong>兼容性提示：</strong>在5.3版本后，我们发现执行监听器、任务监听器（task listeners）与表达式仍然在非公开API中。这些类在<code>org.activiti.engine.impl&#8230;&#8203;</code>子包中。<code>org.activiti.engine.impl.pvm.delegate.ExecutionListener</code>，<code>org.activiti.engine.impl.pvm.delegate.TaskListener</code>与<code>org.activiti.engine.impl.pvm.el.Expression</code>已被废弃。从现在起，应该使用<code>org.activiti.engine.delegate.ExecutionListener</code>，<code>org.activiti.engine.delegate.TaskListener</code>与<code>org.activiti.engine.delegate.Expression</code>。在新的公开可用的API中，对<code>ExecutionListenerExecution.getEventSource()</code>的访问已被移除。除了编译器的废弃警告，现有代码可以正常运行。但是请考虑切换至新的公开API接口（包名中不带有.impl.）。</p>
</div>
<div class="paragraph">
<p>执行监听器可以在流程执行中发生特定的事件时，执行外部Java代码或计算表达式。可以被捕获的事件有：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>流程实例的start（启动）和end（结束）。</p>
</li>
<li>
<p>take（进行）转移（transition）。</p>
</li>
<li>
<p>活动的start和end。</p>
</li>
<li>
<p>网关的start和end。</p>
</li>
<li>
<p>中间事件的start和end。</p>
</li>
<li>
<p>启动事件的end，和结束事件的start。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>下面的流程定义包含了三个执行监听器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;process id="executionListenersProcess"&gt;

  &lt;extensionElements&gt;
    &lt;activiti:executionListener class="org.activiti.examples.bpmn.executionlistener.ExampleExecutionListenerOne" event="start" /&gt;
  &lt;/extensionElements&gt;

  &lt;startEvent id="theStart" /&gt;
  &lt;sequenceFlow sourceRef="theStart" targetRef="firstTask" /&gt;

  &lt;userTask id="firstTask" /&gt;
  &lt;sequenceFlow sourceRef="firstTask" targetRef="secondTask"&gt;
    &lt;extensionElements&gt;
      &lt;activiti:executionListener class="org.activiti.examples.bpmn.executionListener.ExampleExecutionListenerTwo" /&gt;
    &lt;/extensionElements&gt;
  &lt;/sequenceFlow&gt;

  &lt;userTask id="secondTask" &gt;
    &lt;extensionElements&gt;
      &lt;activiti:executionListener expression="${myPojo.myMethod(execution.event)}" event="end" /&gt;
    &lt;/extensionElements&gt;
  &lt;/userTask&gt;
  &lt;sequenceFlow sourceRef="secondTask" targetRef="thirdTask" /&gt;

  &lt;userTask id="thirdTask" /&gt;
  &lt;sequenceFlow sourceRef="thirdTask" targetRef="theEnd" /&gt;

  &lt;endEvent id="theEnd" /&gt;

&lt;/process&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>第一个执行监听器将在流程启动时得到通知。这个监听器是一个外部Java类（例如<code>ExampleExecutionListenerOne</code>），并且需要实现<code>org.activiti.engine.delegate.ExecutionListener</code>接口。当该事件发生时（这里是<code>start</code>事件），会调用<code>notify(ExecutionListenerExecution execution)</code>方法。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class ExampleExecutionListenerOne implements ExecutionListener {

  public void notify(ExecutionListenerExecution execution) throws Exception {
    execution.setVariable("variableSetInExecutionListener", "firstValue");
    execution.setVariable("eventReceived", execution.getEventName());
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以使用实现了<code>org.activiti.engine.delegate.JavaDelegate</code>接口的代理类。这些代理类也可以用于其他的结构，例如服务任务的代理。</p>
</div>
<div class="paragraph">
<p>第二个执行监听器在take（进行）转移时被调用。请注意<code>listener</code>元素并未定义<code>event</code>，因为在转移上只会触发<code>take</code>事件。<strong>当监听器定义在转移上时，<code>event</code>属性的值将被忽略。</strong></p>
</div>
<div class="paragraph">
<p>最后一个执行监听器在<code>secondTask</code>活动结束时被调用。监听器声明中没有使用<code>class</code>，而是定义了<code>expression</code>，并将在事件触发时计算/调用。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;activiti:executionListener expression="${myPojo.myMethod(execution.eventName)}" event="end" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>与其他表达式一样，可以使用与解析execution变量。因为execution实现对象有一个暴露事件名的参数，因此可以使用<code>execution.eventName</code>向你的方法传递事件名。</p>
</div>
<div class="paragraph">
<p>执行监听器也支持使用<code>delegateExpression</code>，<a href="#bpmnJavaServiceTaskXML">与服务任务类似</a>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;activiti:executionListener event="start" delegateExpression="${myExecutionListenerBean}" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>在Activiti 5.12中，我们也引入了新的执行监听器类型，org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener。这个脚本执行监听器，可以为一个执行监听器事件执行一段脚本逻辑。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;activiti:executionListener event="start" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener" &gt;
  &lt;activiti:field name="script"&gt;
    &lt;activiti:string&gt;
      def bar = "BAR";  // local variable
      foo = "FOO"; // pushes variable to execution context
      execution.setVariable("var1", "test"); // test access to execution instance
      bar // implicit return value
    &lt;/activiti:string&gt;
  &lt;/activiti:field&gt;
  &lt;activiti:field name="language" stringValue="groovy" /&gt;
  &lt;activiti:field name="resultVariable" stringValue="myVar" /&gt;
&lt;/activiti:executionListener&gt;</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="executionListenerFieldInjection">执行监听器上的字段注入 Field injection on execution listeners</h5>
<div class="paragraph">
<p>当使用通过<code>class</code>属性配置的执行监听器时，可以使用字段注入。与<a href="#serviceTaskFieldInjection">服务任务字段注入</a>使用完全相同的机制，可以在那里看到字段注入提供的各种可能用法。</p>
</div>
<div class="paragraph">
<p>下面的代码片段展示了简单的示例流程，有一个使用了字段注入的执行监听器。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;process id="executionListenersProcess"&gt;
  &lt;extensionElements&gt;
    &lt;activiti:executionListener class="org.activiti.examples.bpmn.executionListener.ExampleFieldInjectedExecutionListener" event="start"&gt;
      &lt;activiti:field name="fixedValue" stringValue="Yes, I am " /&gt;
      &lt;activiti:field name="dynamicValue" expression="${myVar}" /&gt;
    &lt;/activiti:executionListener&gt;
  &lt;/extensionElements&gt;

  &lt;startEvent id="theStart" /&gt;
  &lt;sequenceFlow sourceRef="theStart" targetRef="firstTask" /&gt;

  &lt;userTask id="firstTask" /&gt;
  &lt;sequenceFlow sourceRef="firstTask" targetRef="theEnd" /&gt;

  &lt;endEvent id="theEnd" /&gt;
&lt;/process&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class ExampleFieldInjectedExecutionListener implements ExecutionListener {

  private Expression fixedValue;

  private Expression dynamicValue;

  public void notify(ExecutionListenerExecution execution) throws Exception {
    execution.setVariable("var", fixedValue.getValue(execution).toString() + dynamicValue.getValue(execution).toString());
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ExampleFieldInjectedExecutionListener</code>类连接两个字段（一个是固定值，另一个是动态值），并将其存储在'<code>var</code>'流程变量中。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Deployment(resources = {"org/activiti/examples/bpmn/executionListener/ExecutionListenersFieldInjectionProcess.bpmn20.xml"})
public void testExecutionListenerFieldInjection() {
  Map&lt;String, Object&gt; variables = new HashMap&lt;String, Object&gt;();
  variables.put("myVar", "listening!");

  ProcessInstance processInstance = runtimeService.startProcessInstanceByKey("executionListenersProcess", variables);

  Object varSetByListener = runtimeService.getVariable(processInstance.getId(), "var");
  assertNotNull(varSetByListener);
  assertTrue(varSetByListener instanceof String);

  // Result is a concatenation of fixed injected field and injected expression
  assertEquals("Yes, I am listening!", varSetByListener);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，关于线程安全的规则与服务任务相同。请阅读<a href="#serviceTaskFieldInjectionThreadSafety">相应章节</a>了解更多信息。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="taskListeners">8.5.13. 任务监听器 Task listener</h4>
<div class="paragraph">
<p><em>任务监听器</em>用于在特定的任务相关事件发生时，执行自定义的Java逻辑或表达式。</p>
</div>
<div class="paragraph">
<p>任务监听器只能在流程定义中作为<a href="#bpmnUserTask">用户任务</a>的子元素。请注意，任务监听器是一个Activiti自定义结构，因此也需要作为<em>BPMN 2.0 extensionElements</em>，放在<em>activiti</em>命名空间下。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;userTask id="myTask" name="My Task" &gt;
  &lt;extensionElements&gt;
    &lt;activiti:taskListener event="create" class="org.activiti.MyTaskCreateListener" /&gt;
  &lt;/extensionElements&gt;
&lt;/userTask&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>任务监听器</em>支持下列属性：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>event（事件）</strong>（必填）：任务监听器将被调用的任务事件类型。可用的事件有：</p>
<div class="ulist">
<ul>
<li>
<p><strong>create（创建）</strong>：当任务已经创建，并且<strong>所有任务参数都已经设置</strong>时触发。</p>
</li>
<li>
<p><strong>assignment（指派）</strong>：当任务已经指派给某人时触发。请注意：当流程执行到达用户任务时，<em>create</em>事件触发<strong>前</strong>，首先触发<em>assignment</em>事件。这看起来不是自然顺序，但是有实际原因的：当收到<em>create</em>事件时，我们通常希望查看任务的所有参数，包括办理人。</p>
</li>
<li>
<p><strong>complete（完成）</strong>：当任务已经完成，从运行时数据中删除前触发。</p>
</li>
<li>
<p><strong>delete（删除）</strong>：在任务即将被删除前触发。请注意当任务通过completeTask正常完成时也会触发。</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>class</strong>：需要调用的代理类。这个类必须实现<code>org.activiti.engine.delegate.TaskListener</code>接口。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class MyTaskCreateListener implements TaskListener {

  public void notify(DelegateTask delegateTask) {
    // Custom logic goes here
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以使用<a href="#serviceTaskFieldInjection">字段注入</a>，为代理类传递流程变量或执行。请注意代理类的实例在流程部署时创建（与Activiti中其它的代理类一样），这意味着该实例会在所有流程实例执行中共享。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>expression</strong>：（不能与<em>class</em>属性一起使用）：指定在事件发生时要执行的表达式。可以为被调用的对象传递<code>DelegateTask</code>对象与事件名（使用<code>task.eventName</code>）作为参数。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">&lt;activiti:taskListener event="create" expression="${myObject.callMethod(task, task.eventName)}" /&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>delegateExpression</strong>：可以指定一个能够解析为<code>TaskListener</code>接口实现类对象的表达式。<a href="#bpmnJavaServiceTaskXML">与服务任务类似</a>。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;activiti:taskListener event="create" delegateExpression="${myTaskListenerBean}" /&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>在Activiti 5.12中，我们也引入了新的执行监听器类型，org.activiti.engine.impl.bpmn.listener.ScriptTaskListener。这个脚本任务监听器，可以为一个任务监听器事件执行一段脚本逻辑。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;activiti:taskListener event="complete" class="org.activiti.engine.impl.bpmn.listener.ScriptTaskListener" &gt;
  &lt;activiti:field name="script"&gt;
    &lt;activiti:string&gt;
      def bar = "BAR";  // local variable
      foo = "FOO"; // pushes variable to execution context
      task.setOwner("kermit"); // test access to task instance
      bar // implicit return value
    &lt;/activiti:string&gt;
  &lt;/activiti:field&gt;
  &lt;activiti:field name="language" stringValue="groovy" /&gt;
  &lt;activiti:field name="resultVariable" stringValue="myVar" /&gt;
&lt;/activiti:taskListener&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnMultiInstance">8.5.14. 多实例 Multi-instance (for each)</h4>
<div class="sect4">
<h5 id="bpmnMultiInstanceDescription">描述 Description</h5>
<div class="paragraph">
<p><em>多实例活动</em>是在业务流程中，为特定步骤定义重复的方式。在编程概念中，多实例匹配<strong>for each</strong>结构：可以为给定集合中的每一条目，<strong>顺序或并行地</strong>，执行特定步骤，甚至是整个子流程。</p>
</div>
<div class="paragraph">
<p><em>多实例</em>是一个普通活动，加上定义（被称作“<em>多实例</em>特性”）的额外参数，会使得活动在运行时被多次执行。下列活动可以成为<em>多实例活动：</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#bpmnUserTask">用户任务</a></p>
</li>
<li>
<p><a href="#bpmnScriptTask">脚本任务</a></p>
</li>
<li>
<p><a href="#bpmnJavaServiceTask">Java服务任务</a></p>
</li>
<li>
<p><a href="#bpmnWebserviceTask">Web服务任务</a></p>
</li>
<li>
<p><a href="#bpmnBusinessRuleTask">业务规则任务</a></p>
</li>
<li>
<p><a href="#bpmnEmailTask">邮件任务</a></p>
</li>
<li>
<p><a href="#bpmnManualTask">人工任务</a></p>
</li>
<li>
<p><a href="#bpmnReceiveTask">接收任务</a></p>
</li>
<li>
<p><a href="#bpmnSubProcess">（嵌入式）子流程</a></p>
</li>
<li>
<p><a href="#bpmnCallActivity">调用活动</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#bpmnGateways">网关</a>与<a href="#bpmnEvents">事件</a><strong>不能</strong>成为多实例。</p>
</div>
<div class="paragraph">
<p>按照规范的要求，所有用于为每个实例创建执行的父执行，都有下列变量：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>nrOfInstances</strong>：实例总数</p>
</li>
<li>
<p><strong>nrOfActiveInstances</strong>：当前活动的，也就是说未完成的，实例数量。对于顺序多实例，这个值总为1.</p>
</li>
<li>
<p><strong>nrOfCompletedInstances</strong>：已经完成的实例数量</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>可以通过调用<code>execution.getVariable(x)</code>方法，获取这些值。</p>
</div>
<div class="paragraph">
<p>另外，每个创建的执行，都有执行本地变量（也就是说，对其他执行不可见，也不存储在流程实例级别）：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>loopCounter</strong>：代表给定实例在<em>foreach循环中的index</em>。可以通过Activiti的<strong>elementIndexVariable</strong>属性为loopCounter变量重命名。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="bpmnMultiInstanceGraphicalNotation">图示 Graphical notation</h5>
<div class="paragraph">
<p>如果一个活动是多实例，将通过在该活动底部的三条短线表示。三条<em>竖</em>线代表实例会并行执行，而三条<em>横</em>线代表顺序执行。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.multi.instance.png" alt="bpmn.multi.instance">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnMultiInstanceXml">XML表示 Xml representation</h5>
<div class="paragraph">
<p>要将活动变成多实例，该活动的XML元素必须有<code>multiInstanceLoopCharacteristics</code>子元素</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;multiInstanceLoopCharacteristics isSequential="false|true"&gt;
 ...
&lt;/multiInstanceLoopCharacteristics&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>isSequential</strong>属性代表了活动的实例为顺序还是并行执行。</p>
</div>
<div class="paragraph">
<p>实例的数量<strong>在进入活动时，计算一次</strong>。有不同方法可以配置数量。一个方法是通过<strong>loopCardinality</strong>子元素，直接指定数字。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;multiInstanceLoopCharacteristics isSequential="false|true"&gt;
  &lt;loopCardinality&gt;5&lt;/loopCardinality&gt;
&lt;/multiInstanceLoopCharacteristics&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以使用解析为正整数的表达式：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;multiInstanceLoopCharacteristics isSequential="false|true"&gt;
  &lt;loopCardinality&gt;${nrOfOrders-nrOfCancellations}&lt;/loopCardinality&gt;
&lt;/multiInstanceLoopCharacteristics&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>另一个定义实例数量的方法，是使用<code>loopDataInputRef</code>子元素，指定一个集合流程变量的名字。对集合中的每一个条目，都会创建一个实例。可以使用<code>inputDataItem</code>子元素，将集合中的该条目设置给实例。在下面的XML示例中展示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;userTask id="miTasks" name="My Task ${loopCounter}" activiti:assignee="${assignee}"&gt;
  &lt;multiInstanceLoopCharacteristics isSequential="false"&gt;
    &lt;loopDataInputRef&gt;assigneeList&lt;/loopDataInputRef&gt;
    &lt;inputDataItem name="assignee" /&gt;
  &lt;/multiInstanceLoopCharacteristics&gt;
&lt;/userTask&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>假设变量<code>assigneeList</code>包含<code>[kermit, gonzo, fozzie]</code>。在上面的代码中，会并行创建三个用户任务。每一个执行都有一个名为<code>assignee</code>的流程变量，含有集合中的一个值，并在这个例子中被用于指派用户任务。</p>
</div>
<div class="paragraph">
<p><code>loopDataInputRef</code>与<code>inputDataItem</code>的缺点是 1)名字很难记 2)由于BPMN 2.0概要的限制，不能使用表达式。Activiti通过在<code>multiInstanceCharacteristics</code>上提供<strong>collection</strong>与<strong>elementVariable</strong>属性解决了这些问题：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;userTask id="miTasks" name="My Task" activiti:assignee="${assignee}"&gt;
  &lt;multiInstanceLoopCharacteristics isSequential="true"
     activiti:collection="${myService.resolveUsersForTask()}" activiti:elementVariable="assignee" &gt;
  &lt;/multiInstanceLoopCharacteristics&gt;
&lt;/userTask&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>多实例活动在所有实例都完成时结束。然而，也可以指定一个表达式，在每个实例结束时计算。当表达式计算为true时，销毁所有剩余的实例，并且结束多实例活动，继续流程。这个表达式必须通过<strong>completionCondition</strong>子元素定义。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;userTask id="miTasks" name="My Task" activiti:assignee="${assignee}"&gt;
  &lt;multiInstanceLoopCharacteristics isSequential="false"
     activiti:collection="assigneeList" activiti:elementVariable="assignee" &gt;
    &lt;completionCondition&gt;${nrOfCompletedInstances/nrOfInstances &gt;= 0.6 }&lt;/completionCondition&gt;
  &lt;/multiInstanceLoopCharacteristics&gt;
&lt;/userTask&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个例子里，会为<code>assigneeList</code>集合中的每个元素创建并行实例。然而，当60%的任务完成时，其他的任务将被删除，流程继续运行。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnMultiInstanceBoundaryEvent">边界事件与多实例 Boundary events and multi-instance</h5>
<div class="paragraph">
<p>多实例是普通活动，因此可以在其边界定义<a href="#bpmnBoundaryEvent">边界事件</a>。对于中断边界事件，当捕获事件时，活动中的<strong>所有实例</strong>都会被销毁。以下面的多实例子流程为例：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.multi.instance.boundary.event.png" alt="bpmn.multi.instance.boundary.event">
</div>
</div>
<div class="paragraph">
<p>当定时器触发时，子流程的所有实例都会被销毁，无论有多少实例，或者哪个内部活动还未完成。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCompensationHandlers">多实例与执行监听器 Multi instance and execution listeners</h5>
<div class="paragraph">
<p>（Activiti 5.18及以上版本可用）</p>
</div>
<div class="paragraph">
<p>有一个关于执行监听器与多实例一起使用的警告。以下面的BPMN 2.0 XML代码片段为例，其定义在<em>multiInstanceLoopCharacteristics</em> XML元素的相同级别：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;extensionElements&gt;
    &lt;activiti:executionListener event="start" class="org.activiti.MyStartListener"/&gt;
		&lt;activiti:executionListener event="end" class="org.activiti.MyEndListener"/&gt;
&lt;/extensionElements&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于普通的BPMN活动，会在活动开始于结束时调用一次监听器。</p>
</div>
<div class="paragraph">
<p>然而，当该活动为多实例时，行为有区别：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>当进入多实例活动时，在任何<em>内部</em>活动执行前，抛出启动事件。这时<em>loopCounter</em>变量还未设置（为null）。</p>
</li>
<li>
<p>每个实际执行的活动，抛出一个启动事件。这时<em>loopCounter</em>变量已经设置。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>对结束事件类似：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>当离开实际活动时，抛出一个结束事件。这时<em>loopCounter</em>变量已经设置。</p>
</li>
<li>
<p>当多实例活动整体完成时，抛出一个结束事件。这时<em>loopCounter</em>变量未设置。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;subProcess id="subprocess1" name="Sub Process"&gt;
  &lt;extensionElements&gt;
    &lt;activiti:executionListener event="start" class="org.activiti.MyStartListener"/&gt;
    &lt;activiti:executionListener event="end" class="org.activiti.MyEndListener"/&gt;
  &lt;/extensionElements&gt;
  &lt;multiInstanceLoopCharacteristics isSequential="false"&gt;
    &lt;loopDataInputRef&gt;assignees&lt;/loopDataInputRef&gt;
    &lt;inputDataItem name="assignee"&gt;&lt;/inputDataItem&gt;
  &lt;/multiInstanceLoopCharacteristics&gt;
  &lt;startEvent id="startevent2" name="Start"&gt;&lt;/startEvent&gt;
  &lt;endEvent id="endevent2" name="End"&gt;&lt;/endEvent&gt;
  &lt;sequenceFlow id="flow3" name="" sourceRef="startevent2" targetRef="endevent2"&gt;&lt;/sequenceFlow&gt;
&lt;/subProcess&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个例子中，假设<em>assignees</em>有三个条目。在运行时会发生如下事情：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>多实例整体抛出一个启动事件。调用一次<em>start</em>执行监听器，<em>loopCounter</em>与<em>assignee</em>变量均未设置（也就是说为null）。</p>
</li>
<li>
<p>每一个活动实例抛出一个启动事件。调用三次<em>start</em>执行监听器，<em>loopCounter</em>与<em>assignee</em>变量均已设置（也就是说不为null）。</p>
</li>
<li>
<p>因此启动执行监听器总共被调用四次。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>请注意当<em>multiInstanceLoopCharacteristics</em>不是定义在子元素上，也是如此。例如上面的简单用户任务的例子，也合理适用这一点。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_补偿处理器_compensation_handlers">8.5.15. 补偿处理器 Compensation Handlers</h4>
<div class="sect4">
<h5 id="bpmnCompensationHandlerDescription">描述 Description</h5>
<div class="paragraph">
<p><a href="#experimental">[EXPERIMENTAL]</a></p>
</div>
<div class="paragraph">
<p>如果一个活动要用于补偿另一个活动的影响，可以声明为补偿处理器。补偿处理器不在普通流程中，只在抛出补偿事件时才会执行。</p>
</div>
<div class="paragraph">
<p>补偿处理器不得有入口或出口顺序流。</p>
</div>
<div class="paragraph">
<p>补偿处理器必须通过单向连接，关联一个补偿边界事件。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCompensationHandlerGraphicalNotation">图示 Graphical notation</h5>
<div class="paragraph">
<p>如果一个活动是补偿处理器，则会在下部中间显示补偿事件图标。 下面摘录的流程图展示了一个带有补偿边界事件的服务任务，并关联至一个补偿处理器。请注意补偿处理器图标显示在"cancel hotel reservation（取消酒店预订）"服务任务的下部中间。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.boundary.compensation.event.png" alt="bpmn.boundary.compensation.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCompensationHandlerXml">XML表示 XML representation</h5>
<div class="paragraph">
<p>要将一个活动声明为补偿处理器，需要将isForCompensation属性设置为true：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="undoBookHotel" isForCompensation="true" activiti:class="..."&gt;
&lt;/serviceTask&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bpmnSubprocessAndCallActivity">8.6. 子流程与调用活动 Sub-Processes and Call Activities</h3>
<div class="sect3">
<h4 id="bpmnSubProcess">8.6.1. 子流程 Sub-Process</h4>
<div class="sect4">
<h5 id="bpmnSubProcessDescription">描述 Description</h5>
<div class="paragraph">
<p><em>子流程</em>是包含其他的活动、网关、事件等的活动。其本身构成一个流程，并作为更大流程的一部分。<em>子流程</em>完全在父流程中定义（这就是为什么经常被称作<em>嵌入式</em>子流程）。</p>
</div>
<div class="paragraph">
<p>子流程有两个主要的使用场景：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>子流程可以<strong>分层建模</strong>。很多建模工具都可以<em>折叠</em>子流程，隐藏子流程的所有细节，而只显示业务流程的高层端到端总览。</p>
</li>
<li>
<p>子流程创建了新的<strong>事件范围</strong>。在子流程执行中抛出的事件，可以通过子流程边界上的<a href="#bpmnBoundaryEvent">边界事件</a>捕获。因此为该事件创建了限制在子流程内的范围。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>使用子流程也要注意以下几点：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>子流程只能有<strong>一个空启动事件</strong>，而不允许有其他类型的启动事件。请注意BPMN 2.0规范允许省略子流程的启动与结束事件，然而当前的Activiti实现并不支持省略。</p>
</li>
<li>
<p><strong>顺序流不能跨越子流程边界。</strong></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="bpmnSubProcessGraphicalNotation">图示 Graphical Notation</h5>
<div class="paragraph">
<p>子流程表示为标准活动，即圆角矩形。若<em>折叠</em>了子流程，则只显示其名字与一个加号，提供了流程的高层概览：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.collapsed.subprocess.png" alt="bpmn.collapsed.subprocess">
</div>
</div>
<div class="paragraph">
<p>若<em>展开</em>了子流程，则子流程的所有步骤都在子流程边界内显示：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.expanded.subprocess.png" alt="bpmn.expanded.subprocess">
</div>
</div>
<div class="paragraph">
<p>使用子流程的一个主要原因，是为特定事件定义范围。下面的流程模型展示了这种用法：<em>investigate software/investigate hardware（调查硬件/调查软件）</em>两个任务需要并行执行，且需要在给定时限内，在<em>Level 2 support（二级支持）</em>响应前完成。在这里，定时器的范围（即需要按时完成的活动）通过子流程限制。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.subprocess.with.boundary.timer.png" alt="bpmn.subprocess.with.boundary.timer">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnSubProcessXML">XML表示 XML representation</h5>
<div class="paragraph">
<p>子流程通过<em>subprocess</em>元素定义。子流程中的所有活动、网关、事件等，都需要附在这个元素内。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;subProcess id="subProcess"&gt;

  &lt;startEvent id="subProcessStart" /&gt;

  ... other Sub-Process elements ...

  &lt;endEvent id="subProcessEnd" /&gt;

 &lt;/subProcess&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnEventSubprocess">8.6.2. 事件子流程 Event Sub-Process</h4>
<div class="sect4">
<h5 id="bpmnEventSubprocessDescription">描述 Description</h5>
<div class="paragraph">
<p>事件子流程是BPMN 2.0新定义的。事件子流程，是通过事件触发的子流程。可以在流程级别，或者任何子流程级别，添加事件子流程。用于触发事件子流程的事件，使用启动事件配置。因此可知，不能在事件子流程中使用空启动事件。事件子流程可以通过例如消息事件、错误事件、信号时间、定时器事件或补偿事件触发。对启动事件的订阅，在事件子流程的宿主范围（流程实例或子流程）创建时创建。当该范围销毁时，删除订阅。</p>
</div>
<div class="paragraph">
<p>事件子流程可以是中断或不中断的。中断的子流程将取消当前范围内的任何执行。非中断的事件子流程将创建新的并行执行。宿主范围内的每个活动，只能触发一个中断事件子流程，而非中断事件子流程可以多次触发。子流程是否是中断的，通过触发事件子流程的启动事件配置。</p>
</div>
<div class="paragraph">
<p>事件子流程不能有任何入口或出口顺序流。事件子流程是由事件触发的，因此入口顺序流不合逻辑。当事件子流程结束时，要么同时结束当前范围（中断事件子流程的情况），要么是非中断子流程创建的并行执行结束。</p>
</div>
<div class="paragraph">
<p><strong>目前的限制：</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Activiti只支持中断事件子流程。</p>
</li>
<li>
<p>Activiti只支持错误启动事件与消息启动事件触发事件子流程。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="bpmnEventSubprocessGraphicalNotation">图示 Graphical Notation</h5>
<div class="paragraph">
<p>事件子流程，表示为点线边框的<a href="#bpmnSubProcessGraphicalNotation">嵌入式子流程</a>。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.subprocess.eventSubprocess.png" alt="bpmn.subprocess.eventSubprocess">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnEventSubprocessXMLRepresentation">XML表示 XML representation</h5>
<div class="paragraph">
<p>事件子流程的XML表示格式，与嵌入式子流程相同。但需要将<code>triggeredByEvent</code>属性设置为<code>true</code>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;subProcess id="eventSubProcess" triggeredByEvent="true"&gt;
	...
&lt;/subProcess&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnEventSubprocessExample">示例 Example</h5>
<div class="paragraph">
<p>下面是使用错误启动事件触发事件子流程的例子。该事件子流程位与“流程级别”，即流程实例的范围：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.subprocess.eventSubprocess.example.1.png" alt="bpmn.subprocess.eventSubprocess.example.1">
</div>
</div>
<div class="paragraph">
<p>事件子流程在XML是这样的：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;subProcess id="eventSubProcess" triggeredByEvent="true"&gt;
	&lt;startEvent id="catchError"&gt;
		&lt;errorEventDefinition errorRef="error" /&gt;
	&lt;/startEvent&gt;
	&lt;sequenceFlow id="flow2" sourceRef="catchError" targetRef="taskAfterErrorCatch" /&gt;
	&lt;userTask id="taskAfterErrorCatch" name="Provide additional data" /&gt;
&lt;/subProcess&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>前面已经指出，事件子流程也可以添加到嵌入式子流程内。若添加到嵌入式子流程内，将可替代边界事件的功能。考虑下面两个流程图，嵌入式子流程都抛出错误事件，该错误事件都被捕获，并由用户任务处理。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.subprocess.eventSubprocess.example.2a.png" alt="bpmn.subprocess.eventSubprocess.example.2a">
</div>
</div>
<div class="paragraph">
<p>对比：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.subprocess.eventSubprocess.example.2b.png" alt="bpmn.subprocess.eventSubprocess.example.2b">
</div>
</div>
<div class="paragraph">
<p>两种情况下都执行相同的任务。然而，两种模型选择有如下不同：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>嵌入式（事件）子流程使用其宿主范围的执行来执行。这意味着嵌入式（事件）子流程可以访问其范围的局部变量。当使用边界事件时，创建用于执行嵌入式子流程的执行，将被边界事件的出口顺序流删除。这意味着嵌入式子流程创建的变量将不再可用。</p>
</li>
<li>
<p>使用事件子流程时，事件完全由其所在的子流程处理。当使用边界事件时，事件由其父流程处理。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这两个区别可以帮助你判断，使用边界事件还是嵌入式（事件）子流程，哪个更适合解决特定的流程建模/实现问题。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnTransactionSubprocess">8.6.3. 事务子流程 Transaction subprocess</h4>
<div class="paragraph">
<p><a href="#experimental">[EXPERIMENTAL]</a><a id="bpmnTransactionSubprocessDescription"></a></p>
</div>
<div class="sect4">
<h5 id="_描述_description_8">描述 Description</h5>
<div class="paragraph">
<p>事务子流程是一种嵌入式子流程，可用于将多个活动组织在一个事务里。事务是工作的逻辑单元，可以组织一组独立活动，使得它们可以一起成功或失败。</p>
</div>
<div class="paragraph">
<p><strong>事务的可能结果：</strong>事务有三种不同的结果：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>若未被取消，或被意外终止，则事务<em>成功</em>。若事务子流程成功，将使用出口顺序流离开。若流程后面抛出了补偿事件，成功的事务可以被补偿。<em>请注意：</em>与“普通”嵌入式子流程一样，可以使用补偿抛出中间事件，在事务成功完成后补偿。</p>
</li>
<li>
<p>若执行到达取消结束事件时，事务被<em>取消</em>。在这种情况下，所有执行都将被终止并移除。只会保留一个执行，设置为取消边界事件，并将触发补偿。在补偿完成后，事务子流程通过取消边界事件的出口顺序流离开。</p>
</li>
<li>
<p>若由于抛出了错误结束事件，且未被事务子流程所在的范围捕获，则事务会被<em>意外</em>终止（错误被事件子流程的边界捕获也一样）。在这种情况下，不会进行补偿。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>下面的流程图展示了三种不同的结果：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.transaction.subprocess.example.1.png" alt="bpmn.transaction.subprocess.example.1">
</div>
</div>
<div class="paragraph">
<p><strong>与ACID事务的关系：</strong>要注意不要将BPMN事务子流程与技术（ACID）事务混淆。BPMN事务子流程不是划分技术事务范围的方法。要理解Acitivit中的事务管理，请阅读<a href="#bpmnConcurrencyAndTransactions">并发与事务</a>章节。BPMN事务与技术事务有如下区别：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ACID事务技术上生存期短暂，而BPMN事务可以持续几小时，几天甚至几个月才完成。（考虑一个场景，事务包括的活动中有一个用户任务。通常人的响应时间要比程序长。或者，在另一个场景下，BPMN事务可能等待某些业务事件发生，像是特定订单的填写完成。）这些操作通常要比更新数据库字段，或者使用事务队列存储消息，花长得多的时间完成。</p>
</li>
<li>
<p>因为不可能将业务活动的持续时间限定为技术事务的范围，一个BPMN事务通常会生成多个ACID事务。</p>
</li>
<li>
<p>因为一个BPMN事务可以生成多个ACID事务，就不再使用ACID特性。例如，考虑上面的流程例子。假设"book hotel（预订酒店）"与"charge credit card（信用卡付款）"操作在分开的ACID事务中处理。再假设"book hotel（预订酒店）"活动已经成功。这时，因为已经进行了预订酒店操作，而还没有进行信用卡扣款，就处在中间不一致状态（intermediary inconsistent state）。在ACID事务中，会顺序进行不同的操作，因此也处在中间不一致状态。在这里不一样的是，不一致状态在事务范围外可见。例如，如果通过外部预订服务进行预定，则使用该预订服务的其他部分将能看到酒店已被预订。这意味着，当时用业务事务时，完全不使用隔离参数（的确，当使用ACID事务时，我们通常也释放隔离，以保证高并发级别。但可以细粒度地控制，而中间不一致状态也只会存在与一小段时间内）。</p>
</li>
<li>
<p>BPMN业务事务也不使用传统方式回滚。因为它生成多个ACID事务，在BPMN事务取消时，部分ACID事务可能已经提交。这样它们没法回滚。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>因为BPMN事务天生需要长时间运行，因此就需要区别处理缺乏隔离与回滚机制。在实际使用中，通常只能通过领域特定（domain specific）的方式解决这些问题：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>回滚通过补偿实现。如果在事务范围内抛出了取消事件，所有成功执行，并带有补偿处理器的活动，带来的影响，将被补偿。</p>
</li>
<li>
<p>缺乏隔离通常使用特定领域的解决方案来处理。例如，在上面的例子里，在我们确定第一个客户可以付款前，一个酒店房间可能被第二个客户预定。这可能不满足业务预期，预订服务可能会选择允许一定量的超量预定。</p>
</li>
<li>
<p>另外，由于事务可以由于意外而终止，预订服务需要处理这种情况，酒店房间已经预定，但从未付款（因为事务可能已经终止）。在这种情况下，预定服务可能选择这种策略，一个酒店房间有最大预留时间，若到时还未付款，则取消预订。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>总结一下：ACID事务提供了这些问题的通用解决方案（回滚，隔离级别，与探索输出 heuristic outcomes），但仍然需要在实现业务事务时，为这些问题寻找特定领域的解决方案。</p>
</div>
<div class="paragraph">
<p><strong>目前的限制：</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>BPMN规范要求，流程引擎响应底层事务协议提交的事务。例如在底层协议中发生了取消事件，则取消事务。作为可嵌入的引擎，Activiti当前不支持这点。（查看下面关于一致性的段落，了解其后果。）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>基于ACID事务与乐观锁（optimistic concurrency）的一致性：</strong>BPMN事务在如下情况保证一致性：所有活动都成功完成；或若部分活动不能执行，则所有已完成活动都被补偿。两种方法都可以得到一致性状态。然而，认识到这一点很重要：Activiti中，BPMN事务的一致性模型，位与流程执行的一致性模型之上。Activiti以事务的方式执行流程。通过乐观锁标记处理并发。在Activiti中，BPMN的错误、取消与补偿事件，都建立在相同的ACID事务与乐观锁之上。例如，只有在实际到达时，取消结束事件才能触发补偿。如果由于服务任务抛出了未检查异常，导致其未实际到达；或者，由于底层ACID事务中的其他操作，将事务设置为rollback-only（回滚）状态，导致补偿处理器的操作不能提交；或者，当两个并行执行到达一个取消结束事件时，补偿会被两次触发，并由于乐观锁异常而失败。所有这些都是想说明，当在Activiti中实现BPMN事务时，与实施“普通”流程与子流程，需要遵守相同的规则。因此要有效地保证一致性，需要将乐观锁、事务执行模型纳入考虑范围，以实现流程。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnEventSubprocessGraphicalNotation">图示 Graphical Notation</h5>
<div class="paragraph">
<p>事务子流程，使用带有两层边框的<a href="#bpmnSubProcessGraphicalNotation">嵌入式子流程</a>表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.transaction.subprocess.png" alt="bpmn.transaction.subprocess">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnEventSubprocessXMLRepresentation">XML表示 XML representation</h5>
<div class="paragraph">
<p>事务子流程，在XML中通过<code>transaction</code>标签表示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;transaction id="myTransaction" &gt;
	...
&lt;/transaction&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnEventSubprocessExample">示例 Example</h5>
<div class="paragraph">
<p>下面是一个事务子流程的例子：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.transaction.subprocess.example.2.png" alt="bpmn.transaction.subprocess.example.2">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnCallActivity">8.6.4. 调用活动（子流程） Call activity (subprocess)</h4>
<div class="sect4">
<h5 id="bpmnCallActivityDescription">描述 Description</h5>
<div class="paragraph">
<p>BPMN 2.0区分一般的<em><a href="#bpmnSubProcess">子流程</a></em>，通常也称作<em>嵌入式子流程</em>，与调用活动，尽管它们看起来很像。从概念上说，两者都在流程执行到达该活动时，调用一个子流程。</p>
</div>
<div class="paragraph">
<p>区别在于，调用活动引用一个流程定义外部的流程，而<em><a href="#bpmnSubProcess">subprocess</a></em>嵌入在原有流程定义内。调用活动的主要使用场景，是它有一个可重复使用的流程定义，可以在多个其他流程定义中调用。</p>
</div>
<div class="paragraph">
<p>当流程执行到达<em>call activity</em>时，会创建一个新的执行，作为到达调用活动的执行的子执行。这个子执行之后用于执行子流程，潜在地创建了类似普通流程的并行子执行。父执行将等待子流程完成，之后沿原流程继续执行。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCallActivityGraphicalNotation">图示 Graphical Notation</h5>
<div class="paragraph">
<p>调用过程，表现为带有粗边框（折叠与展开都是）的<a href="#bpmnSubProcessGraphicalNotation">子流程</a>。取决于建模工具，调用过程可以展开，但默认表现形式为折叠形式。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.collapsed.call.activity.png" alt="bpmn.collapsed.call.activity">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCallActivityXMLRepresentation">XML表现 XML representation</h5>
<div class="paragraph">
<p>调用活动是一个普通活动，需要有通过其<strong>key</strong>引用流程定义的<em>calledElement</em>。在实际使用中，这通常意味着在<em>calledElement</em>中使用<strong>流程的id</strong>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;callActivity id="callCheckCreditProcess" name="Check credit" calledElement="checkCreditProcess" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意子流程的流程定义<strong>在运行时解析</strong>。这意味着如果需要的话，子流程可以与调用流程分别部署。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCallActivityPassVariables">传递变量 Passing variables</h5>
<div class="paragraph">
<p>可以向子流程传递流程变量，反之亦然。数据将在子流程启动时复制到子流程，并在其结束时复制回主流程。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;callActivity id="callSubProcess" calledElement="checkCreditProcess" &gt;
  &lt;extensionElements&gt;
	  &lt;activiti:in source="someVariableInMainProcess" target="nameOfVariableInSubProcess" /&gt;
	  &lt;activiti:out source="someVariableInSubProcess" target="nameOfVariableInMainProcess" /&gt;
  &lt;/extensionElements&gt;
&lt;/callActivity&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用Activiti扩展，作为BPMN标准元素<em>dataInputAssociation</em>与<em>dataOutputAssociation</em>的扩展。它们需要按照BPMN 2.0标准的方式声明流程变量。</p>
</div>
<div class="paragraph">
<p>也可以在这里使用表达式：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;callActivity id="callSubProcess" calledElement="checkCreditProcess" &gt;
	&lt;extensionElements&gt;
	  &lt;activiti:in sourceExpression="${x+5}" target="y" /&gt;
	  &lt;activiti:out source="${y+5}" target="z" /&gt;
	&lt;/extensionElements&gt;
&lt;/callActivity&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>因此最终 z = y+5 = x+5+5</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCallActivityExample">示例 Example</h5>
<div class="paragraph">
<p>下面的流程图展示了简单的订单处理。因为检查客户的信用额度在许多其他流程中都常见，因此将<em>check credit step（检查信用额度步骤）</em>建模为调用活动。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.call.activity.super.process.png" alt="bpmn.call.activity.super.process">
</div>
</div>
<div class="paragraph">
<p>流程像是下面这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;startEvent id="theStart" /&gt;
&lt;sequenceFlow id="flow1" sourceRef="theStart" targetRef="receiveOrder" /&gt;

&lt;manualTask id="receiveOrder" name="Receive Order" /&gt;
&lt;sequenceFlow id="flow2" sourceRef="receiveOrder" targetRef="callCheckCreditProcess" /&gt;

&lt;callActivity id="callCheckCreditProcess" name="Check credit" calledElement="checkCreditProcess" /&gt;
&lt;sequenceFlow id="flow3" sourceRef="callCheckCreditProcess" targetRef="prepareAndShipTask" /&gt;

&lt;userTask id="prepareAndShipTask" name="Prepare and Ship" /&gt;
&lt;sequenceFlow id="flow4" sourceRef="prepareAndShipTask" targetRef="end" /&gt;

&lt;endEvent id="end" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>子流程像是下面这样：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.call.activity.sub.process.png" alt="bpmn.call.activity.sub.process">
</div>
</div>
<div class="paragraph">
<p>与子流程的流程定义相比没什么特别。也可以不通过其他流程调用而使用。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bpmnConcurrencyAndTransactions">8.7. 事务与并发 Transactions and Concurrency</h3>
<div class="sect3">
<h4 id="asyncContinuations">8.7.1. 异步延续 Asynchronous Continuations</h4>
<div class="paragraph">
<p>Activiti以事务方式执行流程，并可按照你的需求配置。让我们从Activiti一般如何为事务划分范围开始介绍。如果Activiti被触发（也就是说，启动流程，完成任务，为执行发送信号），Activiti将沿流程继续，直到到达每个执行路径的等待状态。更具体地说，它以深度优先方式搜索流程图，并在每个执行分支都到达等待状态时返回。等待状态是“之后”再执行的任务，意味着Activiti将当前执行持久化，并等待再次触发。触发可以来自外部来源，例如用户任务或消息接受任务，也可以来自Activiti自身，例如定时器事件。以下面的图片说明：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/activiti.async.example.no.async.PNG" alt="activiti.async.example.no.async">
</div>
</div>
<div class="paragraph">
<p>这是一个BPMN流程的片段，有一个用户任务，一个服务任务，与一个定时器事件。完成用户任务与验证地址（validate address）在同一个工作单元内，因此需要原子性地（atomically）成功或失败。这意味着如果服务任务抛出了异常，我们会想要回滚当前事务，以便执行返回到用户任务，而用户任务仍然存在于数据库中。这也是Activit的默认行为。在（1）中，应用或客户端线程完成任务。在相同的线程中，Activiti执行服务并继续，直到到达等待状态，在这个例子中，是定时器事件（2）。然后将控制权返回至调用者（3），同时提交事务（如果事务由Activiti开启）。</p>
</div>
<div class="paragraph">
<p>在有的情况下，这不是我们想要的。有时我们需要在流程中，自定义地控制事务边界，以便为工作的逻辑单元划分范围。这就需要使用异步延续。考虑下面的流程（片段）：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/activiti.async.example.async.PNG" alt="activiti.async.example.async">
</div>
</div>
<div class="paragraph">
<p>这次我们完成用户任务，生成发票，并将发票发送给客户。这次发票的生成不再是同一个工作单元的一部分，因此我们不希望当发票生成失败时，回滚用户任务。因此我们希望Activiti做的，是完成用户任务（1），提交事务，并将控制权返回给调用程序。然后我们希望在后台线程中，异步地生成发票。这个后台线程就是Activiti作业执行器（事实上是一个线程池），它周期性地将作业保存至数据库。因此在幕后，当到达"generate invoice（生成发票）"任务时，会为Activiti创建“消息”作业，以继续流程，并将其持久化到数据库中。这个作业之后会被作业执行器选中并执行。我们也会为本地的作业执行器进行提示，告知其有新作业到来，以提升性能。</p>
</div>
<div class="paragraph">
<p>要使用这个特性，可以使用<em>activiti:async="true"</em>扩展。因此，服务任务会像是这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="service1" name="Generate Invoice" activiti:class="my.custom.Delegate" activiti:async="true" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以为下列BPMN任务类型指定<em>activiti:async</em>：任务，服务任务，脚本任务，业务规则任务，发送任务，接收任务，用户任务，子流程，调用活动</p>
</div>
<div class="paragraph">
<p>对于用户任务，接收任务与其他等待状态来说，异步延续允许我们在一个独立的线程/事务中启动执行监听器。</p>
</div>
</div>
<div class="sect3">
<h4 id="failRetry">8.7.2. 失败重试 Fail Retry</h4>
<div class="paragraph">
<p>默认配置下，如果作业执行中有任何异常，Activiti将3次重试执行作业。对异步任务作业也是这样。有时需要更灵活的配置。可以配置两个参数：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>重试的次数</p>
</li>
<li>
<p>重试的间隔</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这两个参数可以通过<code>activiti:failedJobRetryTimeCycle</code>元素配置。这有一个简单的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="failingServiceTask" activiti:async="true" activiti:class="org.activiti.engine.test.jobexecutor.RetryFailingDelegate"&gt;
	&lt;extensionElements&gt;
		&lt;activiti:failedJobRetryTimeCycle&gt;R5/PT7M&lt;/activiti:failedJobRetryTimeCycle&gt;
	&lt;/extensionElements&gt;
&lt;/serviceTask&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>时间周期表达式遵循ISO 8601标准，与定时器事件表达式一样。上面的例子，让作业执行器重试5次，并在每次重试前等待7分钟。</p>
</div>
</div>
<div class="sect3">
<h4 id="exclusiveJobs">8.7.3. 排他作业 Exclusive Jobs</h4>
<div class="paragraph">
<p>从Activiti 5.9开始，JobExecutor确保同一个流程实例的作业永远不会并发执行。为什么这样？</p>
</div>
<div class="sect4">
<h5 id="_为什么排他作业_why_exclusive_jobs">为什么排他作业？ Why exclusive Jobs?</h5>
<div class="paragraph">
<p>考虑下面的流程定义：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.why.exclusive.jobs.png" alt="bpmn.why.exclusive.jobs">
</div>
</div>
<div class="paragraph">
<p>我们有一个并行网关，之后是三个服务任务，都使用异步延续执行。其结果是，数据库中添加了三个作业。当作业储存在数据库后，就可以使用JobExecutor处理。JobExecutor获取作业，并将其代理至工作线程的线程池，由它们实际执行作业。这意味着通过使用异步延续，可以将工作分发至线程池（在集群场景下，甚至是在集群中跨越多个线程池）。通常这都是好事。然而，也有固有问题：一致性。考虑服务任务后的并行合并。当服务任务的执行完成时，到达并行合并，并需要决定等待其他执行，还是需要继续向前。这意味着，对于每一个到达并行合并的分支，都需要选择继续执行，还是需要等待其他分支上的一个或多个其他执行。</p>
</div>
<div class="paragraph">
<p>为什么这是问题呢？这是因为服务任务配置为使用一步延续，有可能所有相应的作业都同时被作业执行器处理，并代理至不同的工作线程。结果是服务执行的事务，与到达并行合并的3个独立执行所在的事务，会发生重叠。如果这样，每一个独立事务都“看”不到，其他事物并发地到达了同样的并行合并，并因此判断需要等待其他事务。然而，如果每个事务都判断需要等待其他事务，在并行合并后不会有继续流程的事务，而流程实例也就会永远保持这个状态。</p>
</div>
<div class="paragraph">
<p>Activiti如何解决这个问题呢？Activiti使用乐观锁，基于数据进行判断，而数据可能不是当前值（因为其他事务可能在我们提交前修改了这个数据，我们确保会在每个事务中都增加同一个数据库记录行的版本号）。这样，无论哪个事务第一个提交，都将成功，而其他的会抛出乐观锁异常并失败。这解决了上面流程中讨论的问题：如果多个执行并发到达并行合并，它们都判断需要等待，增加其父执行（流程实例）的版本号，并尝试提交。无论哪个执行第一个提交，都可以成功提交，而其他的将会抛出乐观锁异常并失败。因为这些执行由作业触发，Activiti会在等待给定时间后，重试执行相同的作业，期望这一次通过这个同步的网关。</p>
</div>
<div class="paragraph">
<p>这是好的解决方案么？我们已经看到，乐观锁使Activiti能够避免不一致。它确保了我们不会“在合并网关卡住”，意味着：要么所有的执行都通过网关，要么数据库中的作业能确保可以重试通过它。然而，尽管这是一个持久化与一致性角度的完美解决方案，仍然不一定总是更高层次的理想行为：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Activiti只会为同一个作业，重试一个固定的最大次数（默认配置为'3&#8217;次）。在这之后，作业仍然保存在数据库中，但不会再重试。这意味着需要手动操作来触发作业。</p>
</li>
<li>
<p>如果一个作业有非事务性的副作用，将不会由于事务失败而回滚。例如，如果"book concert tickets（预定音乐会门票）"服务与Activiti不在同一个事务中，则如果重试执行作业，将预定多张票。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_什么是排他作业_what_are_exclusive_jobs">什么是排他作业？ What are exclusive jobs?</h5>
<div class="paragraph">
<p>排他作业不能与同一个流程实例中的其他排他作业同时执行。考虑上面展示的流程：如果我们将服务任务都声明为排他的，则JobExecutor将确保相关的作业都不会并发执行。相反，它将确保不论何时从特定流程实例中获取了排他作业，都将从同一个流程实例中获取所有其他的排他作业，并将它们代理至同一个工作线程。这保证了作业的顺序执行。</p>
</div>
<div class="paragraph">
<p>如何启用这个特性？从Activiti 5.9起，排他作业成为默认配置。所有异步延续与定时器事件，都因此默认成为排他的。另外，如果希望作业成为非排他的，可以使用<code>activiti:exclusive="false"</code>配置。例如，下面的服务任务是异步，但非排他的。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id="service" activiti:expression="${myService.performBooking(hotel, dates)}" activiti:async="true" activiti:exclusive="false" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>这是好的解决方案么？有很多人问我们这是否是好的解决方案。他们的顾虑是，这将阻止并行“操作”，因此会有性能问题。再一次，需要考虑以下两点：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果你是专家，并且知道你在做什么（并理解“为什么排他作业？”章节的内容），可以关掉排他。除此之外，对大多数用户来说，异步延续与定时器能够正常工作才更直观。</p>
</li>
<li>
<p>事实上不会有性能问题。只有在重负载下才会有性能问题。重负载意味着作业执行器的所有的工作线程都一直忙碌。对于排他作业，Activiti会简单的根据负载不同进行分配。排他作业意味着同一个流程实例的作业，都将在同一个线程中顺序执行。但是请想一下：有多于一个流程实例。而其他流程实例的作业将被代理至其他线程，并将并发执行。这意味着Activiti不会并发执行同一个流程实例的排他作业，但仍然并发执行多个实例。从总吞吐量角度来看，可以期望大多数场景下都将导致独立的实例更快地完成。此外，执行同一个流程实例中下一个作业所需的数据，将已经在执行集群节点中缓存。如果作业与节点没有这种关系，则数据可能需要重新从数据库中获取。</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="security">8.8. 流程启动认证 Process Initiation Authorization</h3>
<div class="paragraph">
<p>默认情况下，任何人都可以启动已部署流程定义的新流程实例。流程启动认证功能可以定义用户与组，这样Web客户端可以选择性的限制能够启动新流程实例的用户。请注意Activiti引擎<strong>不会</strong>用任何方式验证认证定义。这个功能只是为了开发人员可以简化Web客户端认证规则的实现。语法与为用户任务指派用户的语法类似。可以使用&lt;activiti:potentialStarter&gt;标签，将用户或组指派为流程的潜在启动者。这里有一个例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;process id="potentialStarter"&gt;
  &lt;extensionElements&gt;
    &lt;activiti:potentialStarter&gt;
       &lt;resourceAssignmentExpression&gt;
         &lt;formalExpression&gt;group2, group(group3), user(user3)&lt;/formalExpression&gt;
       &lt;/resourceAssignmentExpression&gt;
    &lt;/activiti:potentialStarter&gt;
  &lt;/extensionElements&gt;

  &lt;startEvent id="theStart"/&gt;
  ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面摘录的XML中，user(user3)直接引用用户user3，而group(group3)引用组group3。组没有默认标志。也可以使用&lt;process&gt;标签，名为&lt;activiti:candidateStarterUsers&gt;与&lt;activiti:candidateStarterGroups&gt;的属性。这里有一个例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;process id="potentialStarter" activiti:candidateStarterUsers="user1, user2"
                               activiti:candidateStarterGroups="group1"&gt;
      ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>这些属性可以同时使用。</p>
</div>
<div class="paragraph">
<p>在流程启动认证定义后，开发者可以使用下列方法获取该认证定义。这段代码获取可以由给定用户启动的流程定义列表：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">processDefinitions = repositoryService.createProcessDefinitionQuery().startableByUser("userxxx").list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以获取给定流程定义中，所有定义为潜在启动者的身份联系</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">identityLinks = repositoryService.getIdentityLinksForProcessDefinition("processDefinitionId");</code></pre>
</div>
</div>
<div class="paragraph">
<p>下面的例子展示了如何获取能够启动给定流程的用户列表：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">List&lt;User&gt; authorizedUsers =  identityService().createUserQuery().potentialStarter("processDefinitionId").list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>用完全相同的方法，可以获取配置为给定流程定义的潜在启动者的组列表：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">List&lt;Group&gt; authorizedGroups =  identityService().createGroupQuery().potentialStarter("processDefinitionId").list();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dataobjects">8.9. 数据对象 Data objects</h3>
<div class="paragraph">
<p><a href="#experimental">[EXPERIMENTAL]</a></p>
</div>
<div class="paragraph">
<p>BPMN提供了将数据对象定义为流程或子流程元素的一部分的可能性。根据BPMN规范，可以包含复杂的XML结构，并可以从XSD定义中引入。作为Activiti支持的第一批数据对象，支持下列XSD类型：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dataObject id="dObj1" name="StringTest" itemSubjectRef="xsd:string"/&gt;
&lt;dataObject id="dObj2" name="BooleanTest" itemSubjectRef="xsd:boolean"/&gt;
&lt;dataObject id="dObj3" name="DateTest" itemSubjectRef="xsd:datetime"/&gt;
&lt;dataObject id="dObj4" name="DoubleTest" itemSubjectRef="xsd:double"/&gt;
&lt;dataObject id="dObj5" name="IntegerTest" itemSubjectRef="xsd:int"/&gt;
&lt;dataObject id="dObj6" name="LongTest" itemSubjectRef="xsd:long"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>数据对象的定义，将使用&#8217;name&#8217;属性值作为新变量的名字，自动转换为流程变量。另外，Activiti也提供了扩展元素，用于为变量设置默认值。下面的BPMN代码片段提供了示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;process id="dataObjectScope" name="Data Object Scope" isExecutable="true"&gt;
  &lt;dataObject id="dObj123" name="StringTest123" itemSubjectRef="xsd:string"&gt;
    &lt;extensionElements&gt;
      &lt;activiti:value&gt;Testing123&lt;/activiti:value&gt;
    &lt;/extensionElements&gt;
  &lt;/dataObject&gt;
  ...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="forms">9. 表单 Forms</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Activiti提供了一个方便灵活的方法，为你的业务流程的人工步骤添加表单。我们支持两种使用表单的方式：表单参数的内置表单渲染，以及外部表单渲染。</p>
</div>
<div class="sect2">
<h3 id="formProperties">9.1. 表单参数 Form properties</h3>
<div class="paragraph">
<p>所有与业务流程相关的信息，要么包含在流程变量里，要么可以通过流程变量引用。Activiti支持将复杂的Java对象，以<code>Serializable</code>对象的方式存储为流程变量，而JPA实体或者整个XML文档将存储为<code>String</code>。</p>
</div>
<div class="paragraph">
<p>启动流程与完成用户任务是人参与流程的地方。与人交流需要使用某些用户界面技术渲染表单。为了简化多用户界面技术，流程定义可以包含转换逻辑，将流程变量中的复杂的Java对象转换为<strong><em>参数</em></strong>的<code>Map&lt;String,String&gt;</code>。</p>
</div>
<div class="paragraph">
<p>然后任何用户界面技术，都可以使用暴露这些参数信息的Activiti API方法，在这些参数的基础上构建表单。这些参数可以提供对流程变量的专门（也更受限）视图。用于显示表单的参数是<strong>FormData</strong>的返回值。例如</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">StartFormData FormService.getStartFormData(String processDefinitionId)</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">TaskFormdata FormService.getTaskFormData(String taskId)</code></pre>
</div>
</div>
<div class="paragraph">
<p>默认情况下，内建表单引擎能够“看到”参数与流程变量。因此如果任务表单参数1对1匹配流程变量，则不需要专门声明。例如，对于下列声明：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;startEvent id="start" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>当执行到达startEvent时，所有流程变量都可用。然而</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">formService.getStartFormData(String processDefinitionId).getFormProperties()</code></pre>
</div>
</div>
<div class="paragraph">
<p>将为空，因为并未指定映射。</p>
</div>
<div class="paragraph">
<p>在上面的例子中，所有提交的参数将被存储为流程变量。这意味着简单地在表单中添加输入框，就可以存储新变量。</p>
</div>
<div class="paragraph">
<p>参数从流程变量衍生出来，但不是必须存储为流程变量。例如，流程变量可以是类地址的JPA实体。而用户界面技术使用的<code>StreetName</code>表单参数，可以通过<code>#{address.street}</code>表达式连接。</p>
</div>
<div class="paragraph">
<p>类似的，表单中用户需要提交的参数可以存储为流程变量，也可以作为某个流程变量的嵌套参数，使用UEL值表达式，如<code>#{address.street}</code>。</p>
</div>
<div class="paragraph">
<p>提交的参数的默认行为，是存储为流程变量，除非使用<code>formProperty</code>声明指定。</p>
</div>
<div class="paragraph">
<p>流程也可以在表单参数与流程变量之间进行转换。</p>
</div>
<div class="paragraph">
<p>例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;userTask id="task"&gt;
  &lt;extensionElements&gt;
    &lt;activiti:formProperty id="room" /&gt;
    &lt;activiti:formProperty id="duration" type="long"/&gt;
    &lt;activiti:formProperty id="speaker" variable="SpeakerName" writable="false" /&gt;
    &lt;activiti:formProperty id="street" expression="#{address.street}" required="true" /&gt;
  &lt;/extensionElements&gt;
&lt;/userTask&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>room</code>表单参数将作为String，映射为<code>room</code>流程变量</p>
</li>
<li>
<p><code>duration</code>表单参数将作为java.lang.Long，映射为<code>duration</code>流程变量</p>
</li>
<li>
<p><code>speaker</code>表单参数将被映射为<code>SpeakerName</code>流程变量。将只在TaskFormData对象中可用。若提交了speaker参数，将抛出ActivitiException。类似的，使用<code>readable="false"</code>属性，可以将参数从FormData中排除，但仍然可以在提交时处理。</p>
</li>
<li>
<p><code>street</code>表单参数将作为String，映射为<code>address</code>流程变量的Java bean参数<code>street</code>。如果在提交时没有提供这个字段，required="true"将抛出异常。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>也可以提供类型元数据，作为<code>StartFormData FormService.getStartFormData(String processDefinitionId)</code>与<code>TaskFormdata FormService.getTaskFormData(String taskId)</code>方法返回的FormData的一部分</p>
</div>
<div class="paragraph">
<p>我们支持下列表单参数类型：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>string</code> (org.activiti.engine.impl.form.StringFormType</p>
</li>
<li>
<p><code>long</code> (org.activiti.engine.impl.form.LongFormType)</p>
</li>
<li>
<p><code>enum</code> (org.activiti.engine.impl.form.EnumFormType)</p>
</li>
<li>
<p><code>date</code> (org.activiti.engine.impl.form.DateFormType)</p>
</li>
<li>
<p><code>boolean</code> (org.activiti.engine.impl.form.BooleanFormType)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>对每个声明的表单参数，下列<code>FormProperty</code>信息都可以通过<code>List&lt;FormProperty&gt; formService.getStartFormData(String processDefinitionId).getFormProperties()</code>与<code>List&lt;FormProperty&gt; formService.getTaskFormData(String taskId).getFormProperties()</code>方法获取</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface FormProperty {
  /**
   * 在{@link FormService#submitStartFormData(String, java.util.Map)}
   * 或{@link FormService#submitTaskFormData(String, java.util.Map)}
   * 中提交参数时使用的key
   *
   * the key used to submit the property in {@link FormService#submitStartFormData(String, java.util.Map)}
   * or {@link FormService#submitTaskFormData(String, java.util.Map)} */
  String getId();

  /** 显示标签 the display label */
  String getName();

  /** 在本接口中定义的类型，例如{@link #TYPE_STRING}
   * one of the types defined in this interface like e.g. {@link #TYPE_STRING} */
  FormType getType();

  /** 这个参数需要显示的可选项
   * optional value that should be used to display in this property */
  String getValue();

  /** 这个参数是否需要读取用于在表单中显示，并可通过
   * {@link FormService#getStartFormData(String)}
   * 与{@link FormService#getTaskFormData(String)}
   * 方法访问。
   *
   * is this property read to be displayed in the form and made accessible with the methods
   * {@link FormService#getStartFormData(String)} and {@link FormService#getTaskFormData(String)}. */
  boolean isReadable();

  /** 用户提交表单时是否可以包含这个参数？ is this property expected when a user submits the form? */
  boolean isWritable();

  /** 输入框中是否必填这个参数 is this property a required input field */
  boolean isRequired();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;startEvent id="start"&gt;
  &lt;extensionElements&gt;
    &lt;activiti:formProperty id="speaker"
      name="Speaker"
      variable="SpeakerName"
      type="string" /&gt;

    &lt;activiti:formProperty id="start"
      type="date"
      datePattern="dd-MMM-yyyy" /&gt;

    &lt;activiti:formProperty id="direction" type="enum"&gt;
      &lt;activiti:value id="left" name="Go Left" /&gt;
      &lt;activiti:value id="right" name="Go Right" /&gt;
      &lt;activiti:value id="up" name="Go Up" /&gt;
      &lt;activiti:value id="down" name="Go Down" /&gt;
    &lt;/activiti:formProperty&gt;

  &lt;/extensionElements&gt;
&lt;/startEvent&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>所有这些信息都可以通过API获取。类型名可以通过<code>formProperty.getType().getName()</code>获取，日期格式可以通过<code>formProperty.getType().getInformation("datePattern")</code>获取，枚举值可以通过<code>formProperty.getType().getInformation("values")</code>获取。</p>
</div>
<div class="paragraph">
<p>Activiti Explorer支持表单参数，并会按照表单定义渲染表单。下面的XML代码片段</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;startEvent&gt;
  &lt;extensionElements&gt;
    &lt;activiti:formProperty id="numberOfDays" name="Number of days" value="${numberOfDays}" type="long" required="true"/&gt;
    &lt;activiti:formProperty id="startDate" name="First day of holiday (dd-MM-yyy)" value="${startDate}" datePattern="dd-MM-yyyy hh:mm" type="date" required="true" /&gt;
    &lt;activiti:formProperty id="vacationMotivation" name="Motivation" value="${vacationMotivation}" type="string" /&gt;
  &lt;/extensionElements&gt;
&lt;/userTask&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>当使用Activiti Explorer时，将会渲染为流程启动表单</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/forms.explorer.png" alt="forms.explorer">
</div>
</div>
</div>
<div class="sect2">
<h3 id="externalFormRendering">9.2. 外部表单渲染 External form rendering</h3>
<div class="paragraph">
<p>API也支持使用在Activiti引擎之外渲染的，你自己的任务表单。下面的步骤解释了在自行渲染任务表单时，可以使用的钩子。</p>
</div>
<div class="paragraph">
<p>本质上，渲染表单所需的所有数据，都组装在这两个方法之一中：<code>StartFormData FormService.getStartFormData(String processDefinitionId)</code>与<code>TaskFormdata FormService.getTaskFormData(String taskId)</code>。</p>
</div>
<div class="paragraph">
<p>提交表单参数可以通过<code>ProcessInstance FormService.submitStartFormData(String processDefinitionId, Map&lt;String,String&gt; properties)</code>与<code>void FormService.submitTaskFormData(String taskId, Map&lt;String,String&gt; properties)</code>完成。</p>
</div>
<div class="paragraph">
<p>要了解表单参数如何映射为流程变量，查看<a href="#formProperties">表单参数 Form properties</a></p>
</div>
<div class="paragraph">
<p>可以将任何表单模板资源，放在部署的业务存档中（如果希望将它们按版本与流程存储在一起）。作为部署中的资源，可以使用<code>String ProcessDefinition.getDeploymentId()</code>与++InputStream RepositoryService.getResourceAsStream(String deploymentId, String resourceName);+获取。这就是你的模板定义文件，可以用于在你的应用中渲染/显示表单。</p>
</div>
<div class="paragraph">
<p>除了任务表单，也可以为任何目的，使用访问部署资源的能力。</p>
</div>
<div class="paragraph">
<p><code>&lt;userTask activiti:formKey="&#8230;&#8203;"</code>属性，由API通过<code>String FormService.getStartFormData(String processDefinitionId).getFormKey()</code>与<code>String FormService.getTaskFormData(String taskId).getFormKey()</code>暴露。可以用它保存部署中模板的全名（如<code>org/activiti/example/form/my-custom-form.xml</code>），但并非必须。例如，也可以在表单参数中保存普通的key，并用算法或变换得到实际需要使用的模板。在你需要使用不同的用户界面技术，渲染不同的表单时很有用。例如，一个表单在普通屏幕尺寸的Web应用中使用，另一个表单在手机小屏幕中使用，甚至可以为IM表单或邮件表单提供模板。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jpa_java_persistence_api_java持久化api">10. JPA（Java Persistence API Java持久化API）</h2>
<div class="sectionbody">
<div class="paragraph">
<p>可以使用JPA实体作为流程变量，这样可以：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>基于流程变量更新已有JPA实体。流程变量可以在用户任务的表单中填写，或者通过服务任务生成。</p>
</li>
<li>
<p>重用已有的领域模型，而不需要写专门的服务用于读取与更新实体值。</p>
</li>
<li>
<p>基于已有实体做决策（网关）。</p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_需求_requirements">10.1. 需求 Requirements</h3>
<div class="paragraph">
<p>只能支持完全满足下列条件的实体：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>实体需要使用JPA注解配置，字段与参数访问器都支持。也可以使用映射的父类。</p>
</li>
<li>
<p>实体需要有使用<code>@Id</code>注解的主键，不支持复合主键（<code>@EmbeddedId</code>与<code>@IdClass</code>）。Id字段/参数可以是任何JPA规范支持的类型：原生类型与其包装器（除了boolean）、<code>String</code>、<code>BigInteger</code>、<code>BigDecimal</code>、<code>java.util.Date</code>与<code>java.sql.Date</code>。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="jpaconfiguration">10.2. 配置 Configuration</h3>
<div class="paragraph">
<p>要使用JPA实体，引擎必须引用<code>EntityManagerFactory</code>。可以通过配置引用，或者提供持久化单元名（Persistence Unit Name）来实现。用作变量的JPA实体将将被自动检测，并会按情况处理。</p>
</div>
<div class="paragraph">
<p>下面的示例配置使用jpaPersistenceUnitName：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;bean id="processEngineConfiguration"
  class="org.activiti.engine.impl.cfg.StandaloneInMemProcessEngineConfiguration"&gt;

&lt;!-- Database configurations --&gt;
&lt;property name="databaseSchemaUpdate" value="true" /&gt;
&lt;property name="jdbcUrl" value="jdbc:h2:mem:JpaVariableTest;DB_CLOSE_DELAY=1000" /&gt;

&lt;property name="jpaPersistenceUnitName" value="activiti-jpa-pu" /&gt;
&lt;property name="jpaHandleTransaction" value="true" /&gt;
&lt;property name="jpaCloseEntityManager" value="true" /&gt;

&lt;!-- job executor configurations --&gt;
&lt;property name="jobExecutorActivate" value="false" /&gt;

&lt;!-- mail server configurations --&gt;
&lt;property name="mailServerPort" value="5025" /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>下面的示例配置提供了我们自己定义的<code>EntityManagerFactory</code>（在这个例子里，是一个open-jpa实体管理器）。请注意这段代码只包含了与本例相关的bean，省略了其他的。带有open-jpa实体管理器的完整的可用示例，可以在activiti-spring-examples (<code>/activiti-spring/src/test/java/org/activiti/spring/test/jpa/JPASpringTest.java</code>)中找到。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"&gt;
  &lt;property name="persistenceUnitManager" ref="pum"/&gt;
  &lt;property name="jpaVendorAdapter"&gt;
    &lt;bean class="org.springframework.orm.jpa.vendor.OpenJpaVendorAdapter"&gt;
      &lt;property name="databasePlatform" value="org.apache.openjpa.jdbc.sql.H2Dictionary" /&gt;
    &lt;/bean&gt;
  &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="processEngineConfiguration" class="org.activiti.spring.SpringProcessEngineConfiguration"&gt;
  &lt;property name="dataSource" ref="dataSource" /&gt;
  &lt;property name="transactionManager" ref="transactionManager" /&gt;
  &lt;property name="databaseSchemaUpdate" value="true" /&gt;
  &lt;property name="jpaEntityManagerFactory" ref="entityManagerFactory" /&gt;
  &lt;property name="jpaHandleTransaction" value="true" /&gt;
  &lt;property name="jpaCloseEntityManager" value="true" /&gt;
  &lt;property name="jobExecutorActivate" value="false" /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以在编程构建引擎时，使用相同的配置，例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ProcessEngine processEngine = ProcessEngineConfiguration
.createProcessEngineConfigurationFromResourceDefault()
.setJpaPersistenceUnitName("activiti-pu")
.buildProcessEngine();</code></pre>
</div>
</div>
<div class="paragraph">
<p>配置参数：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>jpaPersistenceUnitName</code>：要使用的持久化单元的名字。（要确保该持久化单元在classpath中可用。根据规范，默认位置为<code>/META-INF/persistence.xml</code>）。<code>jpaEntityManagerFactory</code>与<code>jpaPersistenceUnitName</code>二选一。</p>
</li>
<li>
<p><code>jpaEntityManagerFactory</code>：对实现了<code>javax.persistence.EntityManagerFactory</code>的bean的引用，将用于载入实体，并刷入更新。<em>jpaEntityManagerFactory</em>与<em>jpaPersistenceUnitName</em>二选一。</p>
</li>
<li>
<p><code>jpaHandleTransaction</code>：标示引擎是否需要启动事务，并在使用<em>EntityManager</em>实例后提交/回滚。当使用<em>Java Transaction API (JTA)</em>时，设置为false。</p>
</li>
<li>
<p><code>jpaCloseEntityManager</code>：标示引擎是否需要关闭其从<code>EntityManagerFactory</code>获取的<code>EntityManager</code>实例。当<em>EntityManager</em>由容器管理时（例如，使用扩展持久化上下文 Extended Persistence Context时，不支持将范围限制为单一事务）设置为false。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_使用_usage">10.3. 使用 Usage</h3>
<div class="sect3">
<h4 id="_简单示例_simple_example">10.3.1. 简单示例 Simple Example</h4>
<div class="paragraph">
<p>可以在Activiti源代码的JPAVariableTest中找到使用JPA变量的例子。我们会一步一步解释<code>JPAVariableTest.testUpdateJPAEntityValues</code>。</p>
</div>
<div class="paragraph">
<p>首先，基于<code>META-INF/persistence.xml</code>，为我们的持久化单元创建一个<em>EntityManagerFactory</em>。它包含了需要包含在持久化单元内的类，以及一些厂商特定配置。</p>
</div>
<div class="paragraph">
<p>在这个测试里我们使用简单实体，它有一个id以及一个<code>String</code>值参数，用于持久化。在运行测试前，先创建一个实体并保存。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Entity(name = "JPA_ENTITY_FIELD")
public class FieldAccessJPAEntity {

  @Id
  @Column(name = "ID_")
  private Long id;

  private String value;

  public FieldAccessJPAEntity() {
    // JPA需要的空构造方法 Empty constructor needed for JPA
  }

  public Long getId() {
    return id;
  }

  public void setId(Long id) {
    this.id = id;
  }

  public String getValue() {
    return value;
  }

  public void setValue(String value) {
    this.value = value;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>启动一个新的流程实例，将这个实体加入变量。与其他变量一样，它们都会在引擎中持久化存储。当下一次请求这个变量时，将会根据存储的类与Id，从<code>EntityManager</code>载入。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Map&lt;String, Object&gt; variables = new HashMap&lt;String, Object&gt;();
variables.put("entityToUpdate", entityToUpdate);

ProcessInstance processInstance = runtimeService.startProcessInstanceByKey("UpdateJPAValuesProcess", variables);</code></pre>
</div>
</div>
<div class="paragraph">
<p>我们流程定义的第一个节点，是一个<code>服务任务</code>，将调用<code>entityToUpdate</code>上的<code>setValue</code>方法。它将解析为我们之前启动流程实例时设置的JPA变量，并使用当前引擎的上下文关联的++EntityManager+载入。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;serviceTask id='theTask' name='updateJPAEntityTask'
  activiti:expression="${entityToUpdate.setValue('updatedValue')}" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>当服务任务完成时，流程实例在流程定义中定义的用户任务处等待，让我们可以查看流程实例。在这时，<code>EntityManager</code>已经刷入，对实体的修改也已经存入数据库。当我们使用<code>entityToUpdate</code>变量的值时，将重新载入，我们会得到<code>value</code>参数设置为<code>updatedValue</code>的实体。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// 流程'UpdateJPAValuesProcess'中的服务任务应已设置了entityToUpdate的value。
// Servicetask in process 'UpdateJPAValuesProcess' should have set value on entityToUpdate.
Object updatedEntity = runtimeService.getVariable(processInstance.getId(), "entityToUpdate");
assertTrue(updatedEntity instanceof FieldAccessJPAEntity);
assertEquals("updatedValue", ((FieldAccessJPAEntity)updatedEntity).getValue());</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_查询jpa流程变量_query_jpa_process_variables">10.3.2. 查询JPA流程变量 Query JPA process variables</h4>
<div class="paragraph">
<p>可以查询以特定JPA实体作为变量值的<code>流程实例</code>与<code>执行</code>。<strong>请注意对于<code>ProcessInstanceQuery</code>与<code>ExecutionQuery</code>的JPA实体查询，只支持<code>variableValueEquals(name, entity)</code></strong>。而<code>variableValueNotEquals</code>、<code>variableValueGreaterThan</code>、<code>variableValueGreaterThanOrEqual</code>、<code>variableValueLessThan</code>与<code>variableValueLessThanOrEqual</code>方法都不支持，并会在值传递为JPA实体时，抛出<code>ActivitiException</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"> ProcessInstance result = runtimeService.createProcessInstanceQuery()
    .variableValueEquals("entityToQuery", entityToQuery).singleResult();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_使用spring_bean与jpa的高级示例_advanced_example_using_spring_beans_and_jpa">10.3.3. 使用Spring bean与JPA的高级示例 Advanced example using Spring beans and JPA</h4>
<div class="paragraph">
<p>可以在<code>activiti-spring-examples</code>中找到更高级的例子，<code>JPASpringTest</code>。它描述了下属简单用例：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>一个已有的Spring bean，使用已有的JPA实体，用于存储贷款申请。</p>
</li>
<li>
<p>使用Activiti，可以通过该bean获取该实体，并将其用作流程中的变量。流程定义如下步骤：</p>
<div class="ulist">
<ul>
<li>
<p>创建新的LoanRequest（贷款申请）的服务任务，使用已有的<code>LoanRequestBean</code>，并使用启动流程时接收的变量（例如，从启动表单）。创建的实体作为变量存储，使用<code>activiti:resultVariable</code>将表达式结果存储为变量。</p>
</li>
<li>
<p>让经理可以审核申请并批准/驳回的用户任务，该选择将会存储为boolean变量<code>approvedByManager</code>。</p>
</li>
<li>
<p>更新贷款申请实体的服务任务，以便其可以与流程同步。</p>
</li>
<li>
<p>依据<code>approved</code>实体参数的值，使用一个排他网关，选择下一步采用哪条路径：若申请被批准，结束流程；否则，产生一个额外任务（Send rejection letter 发送拒信），以便客户可以收到拒信得到通知。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>请注意这个流程不包含任何表单，因为它只用于单元测试。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/jpa.spring.example.process.png" alt="jpa.spring.example.process">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;definitions id="taskAssigneeExample"
  xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:activiti="http://activiti.org/bpmn"
  targetNamespace="org.activiti.examples"&gt;

  &lt;process id="LoanRequestProcess" name="Process creating and handling loan request"&gt;
    &lt;startEvent id='theStart' /&gt;
    &lt;sequenceFlow id='flow1' sourceRef='theStart' targetRef='createLoanRequest' /&gt;

    &lt;serviceTask id='createLoanRequest' name='Create loan request'
      activiti:expression="${loanRequestBean.newLoanRequest(customerName, amount)}"
      activiti:resultVariable="loanRequest"/&gt;
    &lt;sequenceFlow id='flow2' sourceRef='createLoanRequest' targetRef='approveTask' /&gt;

    &lt;userTask id="approveTask" name="Approve request" /&gt;
    &lt;sequenceFlow id='flow3' sourceRef='approveTask' targetRef='approveOrDissaprove' /&gt;

    &lt;serviceTask id='approveOrDissaprove' name='Store decision'
      activiti:expression="${loanRequest.setApproved(approvedByManager)}" /&gt;
    &lt;sequenceFlow id='flow4' sourceRef='approveOrDissaprove' targetRef='exclusiveGw' /&gt;

    &lt;exclusiveGateway id="exclusiveGw" name="Exclusive Gateway approval" /&gt;
    &lt;sequenceFlow id="endFlow1" sourceRef="exclusiveGw" targetRef="theEnd"&gt;
      &lt;conditionExpression xsi:type="tFormalExpression"&gt;${loanRequest.approved}&lt;/conditionExpression&gt;
    &lt;/sequenceFlow&gt;
    &lt;sequenceFlow id="endFlow2" sourceRef="exclusiveGw" targetRef="sendRejectionLetter"&gt;
      &lt;conditionExpression xsi:type="tFormalExpression"&gt;${!loanRequest.approved}&lt;/conditionExpression&gt;
    &lt;/sequenceFlow&gt;

    &lt;userTask id="sendRejectionLetter" name="Send rejection letter" /&gt;
    &lt;sequenceFlow id='flow5' sourceRef='sendRejectionLetter' targetRef='theOtherEnd' /&gt;

    &lt;endEvent id='theEnd' /&gt;
    &lt;endEvent id='theOtherEnd' /&gt;
  &lt;/process&gt;

&lt;/definitions&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>尽管上面的例子很简单，但也展示了组合使用JPA与Spring以及带参数方法表达式的威力。这个流程完全不需要自定义Java代码（当然除了Spring bean），大幅加速了开发。</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="history">11. 历史 History</h2>
<div class="sectionbody">
<div class="paragraph">
<p>历史是捕获流程执行过程中发生的事情，并将其永久存储的组件。与运行时数据相反，历史数据在流程实例完成以后，仍会保持在数据库中。</p>
</div>
<div class="paragraph">
<p>有5个历史实体：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>HistoricProcessInstance</code>保存当前与已结束流程实例的信息。</p>
</li>
<li>
<p><code>HistoricVariableInstance</code>保存流程变量或任务变量的最新值。</p>
</li>
<li>
<p><code>HistoricActivityInstance</code>保存活动（流程中的节点）的单一执行信息。</p>
</li>
<li>
<p><code>HistoricTaskInstance</code>保存当前与过去（完成并删除的）任务实例的信息。</p>
</li>
<li>
<p><code>HistoricDetail</code>保存与历史流程实例，活动实例或任务实例有关的多种信息。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>因为数据库为过去与当前进行中的实例都保存历史实体，因此你可能希望查询这些表，以减少访问运行时流程实例数据，并提高运行时执行性能。</p>
</div>
<div class="paragraph">
<p>之后，这些信息将在Activiti Explorer中暴露。并且，也将用于生成报告。</p>
</div>
<div class="sect2">
<h3 id="historyQuery">11.1. 查询历史 Querying history</h3>
<div class="paragraph">
<p>可以使用API查询全部5种历史实体，HistoryService暴露的<code>createHistoricProcessInstanceQuery()</code>、<code>createHistoricVariableInstanceQuery()</code>、<code>createHistoricActivityInstanceQuery()</code>、<code>createHistoricDetailQuery()</code>与<code>createHistoricTaskInstanceQuery()</code>方法。</p>
</div>
<div class="paragraph">
<p>下面是一些例子，展示了历史查询API的一些用法。关于各用法的全部描述可以在<a href="http://activiti.org/javadocs/index.html">javadoc</a>中找到，在<code>org.activiti.engine.history</code>包中。</p>
</div>
<div class="sect3">
<h4 id="historyQueryProcessInstance">11.1.1. 历史流程实例查询 HistoricProcessInstanceQuery</h4>
<div class="paragraph">
<p>取得所有流程中，前10个花费最多时间完成（最长持续时间）的，定义为&#8217;XXX'，已完成的<code>HistoricProcessInstances</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">historyService.createHistoricProcessInstanceQuery()
  .finished()
  .processDefinitionId("XXX")
  .orderByProcessInstanceDuration().desc()
  .listPage(0, 10);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="historyQueryVariableInstance">11.1.2. 历史变量实例查询 HistoricVariableInstanceQuery</h4>
<div class="paragraph">
<p>在已完成的，id为&#8217;XXX&#8217;的流程实例中，取得所有<code>HistoricVariableInstances</code>，以变量名排序。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">historyService.createHistoricVariableInstanceQuery()
  .processInstanceId("XXX")
  .orderByVariableName.desc()
  .list();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="historyQueryActivityInstance">11.1.3. 历史活动实例查询 HistoricActivityInstanceQuery</h4>
<div class="paragraph">
<p>取得最新的，服务任务类型的，已完成的，流程定义的id为XXX的，<code>HistoricActivityInstance</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">historyService.createHistoricActivityInstanceQuery()
  .activityType("serviceTask")
  .processDefinitionId("XXX")
  .finished()
  .orderByHistoricActivityInstanceEndTime().desc()
  .listPage(0, 1);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="historyQueryDetail">11.1.4. 历史详情查询 HistoricDetailQuery</h4>
<div class="paragraph">
<p>下一个例子，取得id为123的流程中，所有变量的更新记录。这个查询只会返回<code>HistoricVariableUpdate</code>。请注意有可能某个变量名有多个<code>HistoricVariableUpdate</code>实体，代表流程中的每一次变量更新。可以使用<code>orderByTime</code>（变量更新的时间）或<code>orderByVariableRevision</code>（运行时变量更新时的版本号），按其发生顺序排序。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">historyService.createHistoricDetailQuery()
  .variableUpdates()
  .processInstanceId("123")
  .orderByVariableName().asc()
  .list()</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个例子，取得流程id为"123"的，任何任务中或启动时提交的，所有<a href="#formProperties">表单参数</a>。这个查询只返回<code>HistoricFormProperties</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">historyService.createHistoricDetailQuery()
  .formProperties()
  .processInstanceId("123")
  .orderByVariableName().asc()
  .list()</code></pre>
</div>
</div>
<div class="paragraph">
<p>最后一个例子，取得id为"123"的任务进行的所有变量更新操作。将返回该任务设置的所有变量（任务局部变量）的<code>HistoricVariableUpdates</code>，而<strong>不会</strong>返回流程实例中设置的。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">historyService.createHistoricDetailQuery()
  .variableUpdates()
  .taskId("123")
  .orderByVariableName().asc()
  .list()</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以在<code>TaskListener</code>中使用<code>TaskService</code>或<code>DelegateTask</code>设置任务局部变量：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">taskService.setVariableLocal("123", "myVariable", "Variable value");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public void notify(DelegateTask delegateTask) {
  delegateTask.setVariableLocal("myVariable", "Variable value");
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="historyQueryTaskInstance">11.1.5. 历史任务示例查询  HistoricTaskInstanceQuery</h4>
<div class="paragraph">
<p>取得所有任务中，前10个花费最多时间完成（最长持续时间）的，已完成的<code>HistoricTaskInstance</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">historyService.createHistoricTaskInstanceQuery()
  .finished()
  .orderByHistoricTaskInstanceDuration().desc()
  .listPage(0, 10);</code></pre>
</div>
</div>
<div class="paragraph">
<p>取得删除原因包含"invalid"，最后一次指派给&#8217;kermit&#8217;用户的<code>HistoricTaskInstance</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">historyService.createHistoricTaskInstanceQuery()
  .finished()
  .taskDeleteReasonLike("%invalid%")
  .taskAssignee("kermit")
  .listPage(0, 10);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="historyConfig">11.2. 历史配置 History configuration</h3>
<div class="paragraph">
<p>可以使用org.activiti.engine.impl.history.HistoryLevel枚举（或在5.11版本前，<code>ProcessEngineConfiguration</code>中定义的<em>HISTORY</em>常量），以编程方式配置历史级别：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ProcessEngine processEngine = ProcessEngineConfiguration
  .createProcessEngineConfigurationFromResourceDefault()
  .setHistory(HistoryLevel.AUDIT.getKey())
  .buildProcessEngine();</code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以在activiti.cfg.xml或Spring上下文中配置级别：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;bean id="processEngineConfiguration" class="org.activiti.engine.impl.cfg.StandaloneInMemProcessEngineConfiguration"&gt;
  &lt;property name="history" value="audit" /&gt;
  ...
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以配置下列历史级别：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>none（无）</code>：跳过所有历史存档。对于运行时流程执行来说，是性能最高的配置，但是不会保存任何历史信息。</p>
</li>
<li>
<p><code>activity（活动）</code>：存档所有流程实例与活动实例。在流程实例结束时，顶级流程实例变量的最新值，将被复制为历史流程实例。不会存档细节。</p>
</li>
<li>
<p><code>audit（审计）</code>：默认级别。将存档所有流程实例，活动实例，并保持变量值以及所有提交的表单参数持续同步，以保证表单的所有用户操作都可追踪、可审计。</p>
</li>
<li>
<p><code>full（完全）</code>：历史存档的最高级别，因此也最慢。这个级别存储所有<code>audit</code>级别存储的信息，加上所有其他可用细节，主要是流程变量的更新。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>在Activiti 5.11版本以前，历史级别保存在数据库中（<code>ACT_GE_PROPERTY</code> 表，参数名为<code>historyLevel</code>）。从5.11开始，这个值不再使用，并从数据库中忽略/删除。现在历史可以在2个引擎的启动间切换，而不会由于前一个引擎启动修改了级别，而抛出异常。</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="historyFormAuditPurposes">11.3. 审计目的历史 History for audit purposes</h3>
<div class="paragraph">
<p>如果至少<a href="#historyConfig">配置</a>为<code>audit</code>级别，则通过<code>FormService.submitStartFormData(String processDefinitionId, Map&lt;String, String&gt; properties)</code>与<code>FormService.submitTaskFormData(String taskId, Map&lt;String, String&gt; properties)</code>方法提交的所有参数都将被记录。</p>
</div>
<div class="paragraph">
<p>表单参数可以通过查询API，像这样读取：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">historyService
      .createHistoricDetailQuery()
      .formProperties()
      ...
      .list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个情况下，只会返回<code>HistoricFormProperty</code>类型的历史详情。</p>
</div>
<div class="paragraph">
<p>如果在调用提交方法前，使用<code>IdentityService.setAuthenticatedUserId(String)</code>设置了认证用户，则该提交了表单的认证用户可以在历史中访问。对于启动表单使用<code>HistoricProcessInstance.getStartUserId()</code>，对于任务表单使用<code>HistoricActivityInstance.getAssignee()</code>。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="activitiDesigner">12. Eclipse Designer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Activiti提供了名为Activiti Eclipse Designer的Eclipse插件，可以用于图形化地建模、测试与部署BPMN 2.0流程。</p>
</div>
<div class="sect2">
<h3 id="eclipseDesignerInstallation">12.1. 安装 Installation</h3>
<div class="paragraph">
<p>下面的安装指导在<a href="http://www.eclipse.org/downloads/">Eclipse Kepler与Indigo</a>进行了验证。请注意<strong>不</strong>支持Eclipse Helios。</p>
</div>
<div class="paragraph">
<p>选择<strong>Help &#8594; Install New Software</strong>。在下图面板中，点击<em>Add</em>按钮，并填写下列字段：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>*Name:*Activiti BPMN 2.0 designer</p>
</li>
<li>
<p>*Location:*http://activiti.org/designer/update/</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.add.update.site.png" alt="designer.add.update.site">
</div>
</div>
<div class="paragraph">
<p>确保<strong>"Contact all updates sites.."</strong>复选框<strong>已选中</strong>，因为这样Eclipse就可以下载需要的所有插件。</p>
</div>
</div>
<div class="sect2">
<h3 id="eclipseDesignerEditorFeatures">12.2. Activiti Designer编辑器功能 Activiti Designer editor features</h3>
<div class="ulist">
<ul>
<li>
<p>创建Activiti项目与流程图（diagram）。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.create.activiti.project.png" alt="designer.create.activiti.project">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Activiti Designer在创建新的Activiti流程图时，会创建一个.bpmn文件。当使用Activiti Diagram Editor（Activiti流程图编辑器）视图打开时，将提供图形化的模型画布与画板。这个文件也可以使用XML编辑器打开，将显示流程定义的BPMN 2.0 XML元素。因此Activiti Designer只用一个文件，既是流程图，也是BPMN 2.0 XML。请注意在Activiti 5.9版本中，还不支持使用.bpmn扩展名作为流程定义的部署包。因此Activiti Designer的"create deployment artifacts（创建部署包）"功能，将生成一个BAR文件，与一个包含.bpmn文件内容的.bpmn20.xml文件。也可以方便的自己重命名。请注意，也可以使用Activiti Diagram Editor打开.bpmn20.xml文件。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.bpmn.file.png" alt="designer.bpmn.file">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>可以将BPMN 2.0 XML文件导入Activiti Designer，会自动创建流程图。只需要将BPMN 2.0 XML文件复制到项目中，并使用Activiti Diagram Editor视图打开它。Activiti Designer使用文件中的BPMN DI信息来创建流程图。如果BPMN 2.0 XML文件中没有BPMN DI信息，则不会创建流程图。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.open.importedfile.png" alt="designer.open.importedfile">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>要进行部署，可以使用Activiti Designer创建BAR文件，或JAR文件。在包浏览器中的Activiti项目上点击右键，在弹出菜单的下方选择<em>Create deployment artifacts（创建部署包）</em>选项。要了解关于Designer部署功能的更多信息，请查看<a href="#eclipseDesignerDeployment">部署</a>章节。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.create.deployment.png" alt="designer.create.deployment">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>生成单元测试（在包浏览器中的BPMN 2.0 XML文件上点击右键，选择<em>generate unit test 生成单元测试</em>）。将创建一个单元测试及运行在嵌入式H2数据库上的Activiti配置。这样就可以运行单元测试，来测试你的流程定义。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.unittest.generate.png" alt="designer.unittest.generate">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Activiti项目可以生成为Maven项目。要配置依赖，需要运行<em>mvn eclipse:eclipse</em>。请注意在流程设计时，不需要Maven依赖。只在运行单元测试时才需要依赖。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.project.maven.png" alt="designer.project.maven">
</div>
</div>
</div>
<div class="sect2">
<h3 id="eclipseDesignerBPMNFeatures">12.3. Activiti Designer BPMN功能 Activiti Designer BPMN features</h3>
<div class="ulist">
<ul>
<li>
<p>支持空启动事件，错误启动事件，定时器启动事件，空结束事件，错误结束事件，顺序流，并行网关，排他网关，包容网关，事件网关，嵌入式子流程，事件子流程，调用活动，泳池，泳道，脚本任务，用户任务，服务任务，邮件任务，手动任务，业务规则任务，接收任务，定时器边界事件，错误边界事件，信号边界事件，定时器捕获事件，信号捕获事件，信号抛出事件，空抛出事件，与四个Alfresco特有元素（用户，脚本，邮件任务与启动事件）。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.model.process.png" alt="designer.model.process">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>可以在元素上悬停并选择新的任务类型，快速改变任务的类型。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.model.quick.change.png" alt="designer.model.quick.change">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>可以在元素上悬停并选择新的元素类型，快速添加新的元素。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.model.quick.new.png" alt="designer.model.quick.new">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Java服务任务支持Java类，表达式或代理表达式配置。另外也可以配置字段扩展。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.servicetask.property.png" alt="designer.servicetask.property">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>支持泳池与泳道。但因为Activiti将不同的泳池认作不同的流程定义，因此最好只使用一个泳池。如果使用多个泳池，要小心不要在泳池间画顺序流，否则会在Activiti引擎中部署流程时发生错误。可以在一个泳池中添加任意多的泳道。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.model.poolandlanes.png" alt="designer.model.poolandlanes">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>可以通过填写name参数，为顺序流添加标签。可以决定放置标签的位置，位置将保存为BPMN 2.0 XML DI信息的一部分。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.model.labels.png" alt="designer.model.labels">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>支持事件子流程。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.model.eventsubprocess.png" alt="designer.model.eventsubprocess">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>支持展开嵌入式子流程。也可以在一个嵌入式子流程中加入另一个嵌入式子流程。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.embeddedprocess.canvas.png" alt="designer.embeddedprocess.canvas">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>支持在任务与嵌入式子流程上的定时器边界事件。然而，在Activiti Designer中，在用户任务或嵌入式子流程上使用定时器边界事件最合理。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.timerboundary.canvas.png" alt="designer.timerboundary.canvas">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>支持额外的Activiti扩展，例如邮件任务，用户任务的候选人配置，或脚本任务配置。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.mailtask.property.png" alt="designer.mailtask.property">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>支持Activiti执行与任务监听器。也可以为执行监听器添加字段扩展。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.listener.configuration.png" alt="designer.listener.configuration">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>支持在顺序流上添加条件。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.sequence.condition.png" alt="designer.sequence.condition">
</div>
</div>
</div>
<div class="sect2">
<h3 id="eclipseDesignerDeployment">12.4. Activiti Designer部署功能 Activiti Designer deployment features</h3>
<div class="paragraph">
<p>在Activiti引擎上部署流程定义与任务表单并不困难。需要有一个包含有流程定义BPMN 2.0 XML文件的BAR文件，与可选的用于在Activiti Explorer中查看的任务表单和流程图片。在Activiti Designer中，创建BAR文件十分简单。在完成流程实现后，只要在包浏览器中的Activiti项目上点击右键，在弹出菜单下方选择<strong>Create deployment artifacts（创建部署包）</strong>选项。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.create.deployment.png" alt="designer.create.deployment">
</div>
</div>
<div class="paragraph">
<p>然后就会创建一个部署目录，包含BAR文件，与可能的JAR文件。其中JAR文件包含Activiti项目中的Java类。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.deployment.dir.png" alt="designer.deployment.dir">
</div>
</div>
<div class="paragraph">
<p>这样就可以在Activiti Explorer的部署页签中，将这个文件上传至Activiti引擎。</p>
</div>
<div class="paragraph">
<p>如果项目包含Java类，部署时要多做一些工作。在这种情况下，Activiti Designer的<strong>Create deployment artifacts（创建部署包）</strong>操作也会创建包含编译后类的JAR文件。这个JAR文件必须部署在Activiti Tomcat安装目录的activiti-XXX/WEB-INF/lib目录下。这将为Activiti引擎的classpath添加这些类。</p>
</div>
</div>
<div class="sect2">
<h3 id="eclipseDesignerExtending">12.5. 扩展Activiti Designer (Extending Activiti Designer)</h3>
<div class="paragraph">
<p>可以扩展Activiti Designer提供的默认功能。这段文档介绍了可以使用哪些扩展，如何使用，并提供了一些例子。在建模业务流程时，如果默认功能不能满足需要，需要额外的功能，或有领域专门需求的时候，扩展Activiti Designer就很有用。扩展Activiti Designer分为两个不同领域，扩展画板与扩展输出格式。两种方式都需要专门的方法，与不同的技术知识。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>扩展Activiti Designer需要专业知识，更确切地说，Java编程的知识。取决于你想要创建的扩展类型，你可能需要熟悉Maven，Eclipse，OSGi，Eclipse扩展与SWT。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="eclipseDesignerCustomizingPalette">12.5.1. 自定义画板 Customizing the palette</h4>
<div class="paragraph">
<p>可以自定义为用户建模流程提供的画板。画板是形状的集合，显示在画布的右侧，可以将形状拖放至画布中的流程图上。在默认画板中可以看到，默认形状进行了分组（被称为“抽屉 drawer”），如事件，网关，等等。Activiti Designer提供了两种选择，用于自定义画板中的抽屉与形状：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>将你自己的形状/节点添加到已有或新建的抽屉</p>
</li>
<li>
<p>禁用Activiti Designer提供的部分或全部BPMN 2.0默认形状，除了连线与选择工具</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>要自定义画板，需要创建一个JAR文件，并加入Activiti Designer安装目录（后面介绍<a href="#eclipseDesignerApplyingExtension">如何做</a>）。这个JAR文件叫做<em>扩展（extension）</em>。通过编写扩展中包含的类，就能让Activiti Designer知道你需要自定义什么。要做到这个，你的类需要实现特定的接口。有一个集成类库，包含这些接口以及需要加入classpath的用于扩展的基类。</p>
</div>
<div class="paragraph">
<p>可以在下列地方找到代码示例：Activiti源码的<code>projects/designer</code>目录下的<code>examples/money-tasks</code>目录。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>可以使用你喜欢的任何工具设置项目，并使用你选择的构建工具构建JAR。在下面的介绍中，假设使用Eclipse Kepler或Indigo，并使用Maven（3.x）作为构建工具。但任何设置都可以创建相同的结果。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_设置扩展_extension_setup_eclipse_maven">设置扩展 Extension setup (Eclipse/Maven)</h5>
<div class="paragraph">
<p>下载并解压缩<a href="http://www.eclipse.org/downloads">Eclipse</a>（应该可以使用最新版本），与<a href="http://maven.apache.org/download.html">Apache Maven</a>近期的版本（3.x）。如果使用2.x版本的Maven，可能会在构建项目时遇到错误，因此请确保版本是最新的。我们假设你已经熟悉Eclipse中的基本功能以及Java编辑器。可以使用Eclipse的Maven功能，或直接从命令行运行Maven命令。</p>
</div>
<div class="paragraph">
<p>在Eclipse中创建一个新项目。可以是通用类型项目。在项目的根路径创建一个<code>pom.xml</code>文件，以包含Maven项目配置。同时创建<code>src/main/java</code>与<code>src/main/resources</code>目录，这是Maven约定的Java源文件与资源文件目录。打开<code>pom.xml</code>文件并添加下列行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project
  xmlns="http://maven.apache.org/POM/4.0.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;

  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

  &lt;groupId&gt;org.acme&lt;/groupId&gt;
  &lt;artifactId&gt;money-tasks&lt;/artifactId&gt;
  &lt;version&gt;1.0.0&lt;/version&gt;
  &lt;packaging&gt;jar&lt;/packaging&gt;
  &lt;name&gt;Acme Corporation Money Tasks&lt;/name&gt;
...
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以看到，这只是一个基础的pom.xml文件，为项目定义了一个<code>groupId</code>，<code>artifactId</code>与<code>version</code>。我们会创建一个定制项，包含一个money业务的自定义节点。</p>
</div>
<div class="paragraph">
<p>在<code>pom.xml</code>文件中添加这些依赖，将集成库添加至项目依赖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.activiti.designer&lt;/groupId&gt;
    &lt;artifactId&gt;org.activiti.designer.integration&lt;/artifactId&gt;
    &lt;version&gt;5.12.0&lt;/version&gt; &lt;!-- Use the current Activiti Designer version --&gt;
    &lt;scope&gt;compile&lt;/scope&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;
...
&lt;repositories&gt;
  &lt;repository&gt;
      &lt;id&gt;Activiti&lt;/id&gt;
      &lt;url&gt;https://maven.alfresco.com/nexus/content/groups/public/&lt;/url&gt;
   &lt;/repository&gt;
&lt;/repositories&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>最后，在<code>pom.xml</code>文件中，添加<code>maven-compiler-plugin</code>配置，设置Java源码级别为1.5以上（参见下面的代码片段）。要使用注解需要这个配置。也可以为Maven包含用于生成JAR的<code>MANIFEST.MF</code>文件。这不是必须的，但可以在这个manifest中使用特定参数，为你的扩展提供名字（这个名字可以在设计器的特定位置显示，主要用于在设计器中有多个扩展时使用）。如果想要这么做，在<code>pom.xml</code>中添加下列代码片段：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;build&gt;
  &lt;plugins&gt;
        &lt;plugin&gt;
      &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
      &lt;configuration&gt;
        &lt;source&gt;1.5&lt;/source&gt;
        &lt;target&gt;1.5&lt;/target&gt;
        &lt;showDeprecation&gt;true&lt;/showDeprecation&gt;
        &lt;showWarnings&gt;true&lt;/showWarnings&gt;
        &lt;optimize&gt;true&lt;/optimize&gt;
      &lt;/configuration&gt;
    &lt;/plugin&gt;
    &lt;plugin&gt;
      &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
      &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;
      &lt;version&gt;2.3.1&lt;/version&gt;
      &lt;configuration&gt;
        &lt;archive&gt;
          &lt;index&gt;true&lt;/index&gt;
          &lt;manifest&gt;
            &lt;addClasspath&gt;false&lt;/addClasspath&gt;
            &lt;addDefaultImplementationEntries&gt;true&lt;/addDefaultImplementationEntries&gt;
          &lt;/manifest&gt;
          &lt;manifestEntries&gt;
            &lt;ActivitiDesigner-Extension-Name&gt;Acme Money&lt;/ActivitiDesigner-Extension-Name&gt;
          &lt;/manifestEntries&gt;
        &lt;/archive&gt;
      &lt;/configuration&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>扩展的名字使用<code>ActivitiDesigner-Extension-Name</code>参数描述。现在只剩下让Eclipse按照<code>pom.xml</code>的指导设置项目。因此打开命令行，并转到Eclipse工作空间中你项目的根目录。然后执行下列Maven命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mvn eclipse:eclipse</pre>
</div>
</div>
<div class="paragraph">
<p>等待构建完成。刷新项目（使用项目上下文菜单（右键点击），并选择<code>Refresh 刷新</code>）。现在Eclipse项目中应该已经建立了<code>src/main/java</code>与<code>src/main/resources</code>源码目录。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>当然也可以使用<a href="http://www.eclipse.org/m2e">m2eclipse</a>插件，并简单地在项目的上下文菜单（右键点击）中启用Maven依赖管理。然后在项目的上下文菜单中选择<code>Maven</code> &gt; <code>Update project configuration（更新项目配置）</code>。这也将配置源代码目录。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>这就完成了配置。现在可以开始为Activiti Designer创建自定义项了！</p>
</div>
</div>
<div class="sect4">
<h5 id="eclipseDesignerApplyingExtension">在Activiti Designer中应用你的扩展 Applying your extension to Activiti Designer</h5>
<div class="paragraph">
<p>你也许想知道如何将你的扩展加入Activiti Designer，以便应用你的自定义项。需要这些步骤：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>创建扩展JAR（例如，使用Maven构建时，在项目中运行mvn install）后，需要将扩展传递至Activiti Designer安装的计算机；</p>
</li>
<li>
<p>将扩展存储在硬盘上，方便记忆的位置。<em>请注意：</em>必须保存在Activiti Designer的Eclipse工作空间之外——将扩展保存在工作空间内，会导致弹出错误消息弹框，扩展将不可用；</p>
</li>
<li>
<p>启动Activiti Designer，从菜单中，选择<code>Window</code> &gt; <code>Preferences</code></p>
</li>
<li>
<p>在Preferences界面，键入<code>user</code>作为关键字。将可以看到在Eclipse中<code>Java</code>段落内，<code>User Libraries</code>的选项。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.preferences.userlibraries.png" alt="designer.preferences.userlibraries">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>选择<code>User Libraries</code>选项，将在右侧显示树形界面，可以添加库。应该可以看到一个默认组，可以用于添加Activiti Designer的扩展（根据Eclipse安装不同，也可能看到几个其他的）。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.preferences.userlibraries.activiti.empty.png" alt="designer.preferences.userlibraries.activiti.empty">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>选择<code>Activiti Designer Extensions</code>组，并点击<code>Add JARs&#8230;&#8203;</code>按钮。跳转至存储扩展的目录，并选择希望添加的扩展文件。完成后，配置界面会将扩展作为<code>Activiti Designer Extensions</code>组的成员进行显示，像下面这样。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.preferences.userlibraries.activiti.moneytasks.png" alt="designer.preferences.userlibraries.activiti.moneytasks">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>点击<code>OK</code>按钮保存并关闭配置对话框。<code>Activiti Designer Extensions</code>会自动添加至你创建的新Activiti项目。可以在导航条或包管理器的项目树下的用户库条目中看到。如果工作空间中已经有了Activiti项目，也可以看到组中显示了新扩展，像下面这样。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.userlibraries.project.png" alt="designer.userlibraries.project">
</div>
</div>
<div class="paragraph">
<p>打开的流程图将在其画板上显示新扩展的图形（或者禁用部分图形，取决于扩展中的配置）。如果已经打开了流程图，关闭并重新打开就能在画板上看到变化。</p>
</div>
</div>
<div class="sect4">
<h5 id="_为画板添加图形_adding_shapes_to_the_palette">为画板添加图形 Adding shapes to the palette</h5>
<div class="paragraph">
<p>项目配置完后，可以很轻松的为画板添加图形。每个添加的图形都表现为JAR中的一个类。请注意这些类并不是Activiti引擎运行时会使用的类。在扩展中可以为每个图形描述Activiti Designer可用的参数。在这些图形中，也可以定义运行时特性，并将由引擎在流程实例到达该节点时使用。运行时特性可以使用任何Activiti对普通<code>ServiceTask</code>支持的选项。查看<a href="#eclipseDesignerConfiguringRuntime">这个章节</a>了解更多信息。</p>
</div>
<div class="paragraph">
<p>图形的类是简单的Java类，加上一些注解。这个类需要实现<code>CustomServiceTask</code>接口，但不应该直接实现这个接口，而应该扩展<code>AbstractCustomServiceTask</code>基类（目前必须直接扩展这个类，而不能在中间使用abstract类）。在这个类的Javadoc中，可以看到其默认提供的，与需要覆盖的方法介绍。覆盖可以实现很多功能，例如为画板及画布中的图形提供图标（两个可以不一样），或者指定你希望节点实现的基图形（活动，时间，网关）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/**
 * @author John Doe
 * @version 1
 * @since 1.0.0
 */
public class AcmeMoneyTask extends AbstractCustomServiceTask {
...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>需要实现<code>getName()</code>方法，来决定节点在画板上的名字。也可以将节点放在自己的抽屉中，并提供图标，只需要覆盖<code>AbstractCustomServiceTask</code>的对应方法就可以。如果希望提供图标，请确保放在JAR的<code>src/main/resources</code>包中，需要是16X16像素的JPEG或PNG格式图片。你要提供的路径是到这个目录的相对路径。</p>
</div>
<div class="paragraph">
<p>可以通过在类中添加成员，并使用<code>@Property</code>注解，来为形状添加参数。像这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Property(type = PropertyType.TEXT, displayName = "Account Number")
@Help(displayHelpShort = "提供一个账户编码 Provide an account number", displayHelpLong = HELP_ACCOUNT_NUMBER_LONG)
private String accountNumber;</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用多种<code>PropertyType</code>值，在<a href="#eclipseDesignerPropertyTypes">这个章节</a>中详细描述。可以通过将required属性设置为true，将一个字段设为必填。如果用户没有填写这个字段，将会提示消息，背景也会变红。</p>
</div>
<div class="paragraph">
<p>如果想要确保类中多个参数在参数界面上的显示顺序，需要指定<code>@Property</code>注解的order属性。</p>
</div>
<div class="paragraph">
<p>可以看到有个<code>@Help</code>注解，它用于为用户提供一些填写字段的指导。也可以在类本身上使用<code>@Help</code>注解——这个信息将在显示给用户的参数表格最上面显示。</p>
</div>
<div class="paragraph">
<p>下面是<code>MoneyTask</code>详细介绍的列表。添加了一个备注字段，也可以看到节点包含了一个图标。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/**
 * @author John Doe
 * @version 1
 * @since 1.0.0
 */
@Runtime(javaDelegateClass = "org.acme.runtime.AcmeMoneyJavaDelegation")
@Help(displayHelpShort = "创建一个新的账户 Creates a new account", displayHelpLong = "使用给定的账户编码，创建一个新的账户 Creates a new account using the account number specified")
public class AcmeMoneyTask extends AbstractCustomServiceTask {

  private static final String HELP_ACCOUNT_NUMBER_LONG = "提供一个可用作账户编码的编码。 Provide a number that is suitable as an account number.";

  @Property(type = PropertyType.TEXT, displayName = "Account Number", required = true)
  @Help(displayHelpShort = "提供一个账户编码 Provide an account number", displayHelpLong = HELP_ACCOUNT_NUMBER_LONG)
  private String accountNumber;

  @Property(type = PropertyType.MULTILINE_TEXT, displayName = "Comments")
  @Help(displayHelpShort = "提供备注 Provide comments", displayHelpLong = "可以为节点添加备注，以提供详细说明。 You can add comments to the node to provide a brief description.")
  private String comments;

  /*
   * (non-Javadoc)
   *
   * @see org.activiti.designer.integration.servicetask.AbstractCustomServiceTask #contributeToPaletteDrawer()
   */
  @Override
  public String contributeToPaletteDrawer() {
    return "Acme Corporation";
  }

  @Override
  public String getName() {
    return "Money node";
  }

  /*
   * (non-Javadoc)
   *
   * @see org.activiti.designer.integration.servicetask.AbstractCustomServiceTask #getSmallIconPath()
   */
  @Override
  public String getSmallIconPath() {
    return "icons/coins.png";
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果使用这个图形扩展Activiti Designer，画板与相应的图形将像是这样：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.palette.add.money.png" alt="designer.palette.add.money">
</div>
</div>
<div class="paragraph">
<p>money任务的参数界面在下面显示。请注意<code>accountNumber</code>字段的必填信息。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.palette.add.money.properties.required.png" alt="designer.palette.add.money.properties.required">
</div>
</div>
<div class="paragraph">
<p>在创建流程图、填写参数字段时，用户可以使用静态文本，或者使用流程变量的表达式（如"This little piggy went to ${piggyLocation}"）。一般来说，用户可以在text字段自由填写任何文本。如果你希望用户使用表达式，并（使用<code>@Runtime</code>）为<code>CustomServiceTask</code>添加运行时行为，请确保在代理类中使用<code>Expression</code>字段，以便表达式可以在运行时正确解析。可以在<a href="#eclipseDesignerConfiguringRuntime">这个章节</a>找到更多关于运行时行为的信息。</p>
</div>
<div class="paragraph">
<p>字段的帮助信息由每个参数右侧的按钮提供。点击该按钮将弹出显示下列内容。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.palette.add.money.help.png" alt="designer.palette.add.money.help">
</div>
</div>
<div class="sect5">
<h6 id="eclipseDesignerConfiguringRuntime">配置自定义服务任务的运行时执行 Configuring runtime execution of Custom Service Tasks</h6>
<div class="paragraph">
<p>当设置好字段，并将扩展应用至Designer后，用户就可以在建模流程时，配置服务任务的这些参数。在大多数情况下，会希望在Activiti执行流程时，使用这些用户配置参数。要做到这一点，必须告诉Activiti，当流程到达你<code>CustomServiceTask</code>时，需要使用哪个类。</p>
</div>
<div class="paragraph">
<p>有一个特别的注解，<code>@Runtime</code>，用于指定<code>CustomServiceTask</code>的运行时特性。这里有些如何使用的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Runtime(javaDelegateClass = "org.acme.runtime.AcmeMoneyJavaDelegation")</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用时，<code>CustomServiceTask</code>将会表现为流程建模BPMN中的一个普通的<code>ServiceTask</code>。Activiti提供了<a href="#bpmnJavaServiceTask">多种方法</a>定义<code>ServiceTask</code>的运行时特性。因此，<code>@Runtime</code>可以使用Activiti提供的三个属性中的一个：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>javaDelegateClass</code>在BPMN输出中映射为<code>activiti:class</code>。指定一个实现了<code>JavaDelegate</code>的类的全限定类名。</p>
</li>
<li>
<p><code>expression</code>在BPMN输出中映射为<code>activiti:expression</code>。指定一个需要执行的方法的表达式，例如一个Spring Bean中的方法。当使用这个选项时，<em>不应</em>在字段上指定任何<code>@Property</code>注解。下面有更详细的说明。</p>
</li>
<li>
<p><code>javaDelegateExpression</code>在BPMN输出中映射为<code>activiti:delegateExpression</code>。指定一个实现了<code>JavaDelegate</code>的类的表达式。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>如果在类中为Activiti提供了可以注入的成员，就可以将用户的参数至注入到运行时类中。名字需要与<code>CustomServiceTask</code>的成员名一致。查看用户手册的<a href="#serviceTaskFieldInjection">这个部分</a>了解更多信息。请注意从Designer的5.11.0版本开始，可以为动态字段值使用<code>Expression</code>接口。这意味着Activiti Designer中参数的值必须要是表达式，并且这个表达式将在之后注入<code>JavaDelegate</code>实现类的<code>Expression</code>参数中。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>可以在<code>CustomServiceTask</code>的成员上使用<code>@Property</code>注解，但如果使用<code>@Runtime</code>的<code>expression</code>属性，则<code>@Property</code>注解将不会生效。原因是指定的表达式将被Activiti尝试解析为<em>方法</em>，而不是类。因此，不会有对类的注入。如果在<code>@Runtime</code>注解中使用<code>expression</code>，则注解为<code>@Property</code>的成员将被Designer忽略。Designer不会将它们渲染为节点参数页面的可编辑字段，也不会为这些参数在流程的BPMN中生成输出。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>请注意不应该在你的扩展JAR中包括运行时类，因为它与Activiti库是分离的。Activiti需要在运行时能够找到它们，因此需要将其放在Activiti引擎的clsspath中。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Designer代码树中的示例项目包含了配置<code>@Runtime</code>的不同选项的例子。可以从查看money-tasks项目开始。引用代理类的示例在money-delegates项目中。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="eclipseDesignerPropertyTypes">参数类型 Property types</h5>
<div class="paragraph">
<p>这个章节介绍了<code>CustomServiceTask</code>能够使用的参数类型，可以将类型设置为<code>PropertyType</code>的值。</p>
</div>
<div class="sect5">
<h6 id="_propertytype_text">PropertyType.TEXT</h6>
<div class="paragraph">
<p>创建如下所示的单行文本字段。可以是必填字段，并将验证消息作为提示信息显示。验证失败会将字段的背景变为浅红色。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.text.invalid.png" alt="designer.property.text.invalid">
</div>
</div>
</div>
<div class="sect5">
<h6 id="_propertytype_multiline_text">PropertyType.MULTILINE_TEXT</h6>
<div class="paragraph">
<p>创建如下所示的多行文本字段（高度固定为80像素）。可以是必填字段，并将验证消息作为提示信息显示。验证失败会将字段的背景变为浅红色。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.multiline.text.invalid.png" alt="designer.property.multiline.text.invalid">
</div>
</div>
</div>
<div class="sect5">
<h6 id="_propertytype_period">PropertyType.PERIOD</h6>
<div class="paragraph">
<p>创建一个组合编辑框，可以使用转盘控件编辑每一个单位的数量，来指定一段时间长度，结果如下所示。可以是必填字段（含义是不能所有的值都是0，也就是至少有一个部分要有非零值），并将验证消息作为提示信息显示。验证失败会将整个字段的背景变为浅红色。字段的值保存为1y 2mo 3w 4d 5h 6m 7s格式的字符串，代表1年，2月，3周，4天，6分钟及7秒。即使有部分为0，也总是存储整个字符串。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.period.png" alt="designer.property.period">
</div>
</div>
</div>
<div class="sect5">
<h6 id="_propertytype_boolean_choice">PropertyType.BOOLEAN_CHOICE</h6>
<div class="paragraph">
<p>创建一个单独的boolean复选框，或者开关选择。请注意可以在<code>Property</code>注解上指定<code>required</code>属性，但不会生效，不然用户就无法选择是否选中复选框。流程图中存储的值为java.lang.Boolean.toString(boolean)，其结果为"true"或"false"。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.boolean.choice.png" alt="designer.property.boolean.choice">
</div>
</div>
</div>
<div class="sect5">
<h6 id="_propertytype_radio_choice">PropertyType.RADIO_CHOICE</h6>
<div class="paragraph">
<p>创建如下所示的一组单选按钮。选中任何一个单选按钮都自动排除任何其他的选择（也就是说，单选）。可以是必填字段，并将验证消息作为提示信息显示。验证失败会将组的背景变为浅红色。</p>
</div>
<div class="paragraph">
<p>这个参数类型需要注解的类成员同时使用<code>@PropertyItems</code>注解（例如如下所示）。可以使用这个额外的注解，以字符串数组的方式，指定条目的列表。需要为每一个条目添加两个数组项：第一个，用于显示的标签；第二个，用于存储的值。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Property(type = PropertyType.RADIO_CHOICE, displayName = "提款限额 Withdrawl limit", required = true)
@Help(displayHelpShort = "最大每日提款限额 The maximum daily withdrawl amount ", displayHelpLong = "选择从该账户中每日最大能提取的额度。 Choose the maximum daily amount that can be withdrawn from the account.")
@PropertyItems({ LIMIT_LOW_LABEL, LIMIT_LOW_VALUE, LIMIT_MEDIUM_LABEL, LIMIT_MEDIUM_VALUE, LIMIT_HIGH_LABEL, LIMIT_HIGH_VALUE })
private String withdrawlLimit;</code></pre>
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.radio.choice.png" alt="designer.property.radio.choice">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.radio.choice.invalid.png" alt="designer.property.radio.choice.invalid">
</div>
</div>
</div>
<div class="sect5">
<h6 id="_propertytype_combobox_choice">PropertyType.COMBOBOX_CHOICE</h6>
<div class="paragraph">
<p>创建如下所示的，带有固定选项的下拉框。可以是必填字段，并将验证消息作为提示信息显示。验证失败会将下拉框的背景变为浅红色。</p>
</div>
<div class="paragraph">
<p>这个参数类型需要注解的类成员同时使用<code>@PropertyItems</code>注解（例如如下所示）。可以使用这个额外的注解，以字符串数组的方式，指定条目的列表。需要为每一个条目添加两个数组项：第一个，用于显示的标签；第二个，用于存储的值。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Property(type = PropertyType.COMBOBOX_CHOICE, displayName = "账户类型 Account type", required = true)
@Help(displayHelpShort = "账户的类型 The type of account", displayHelpLong = "从选项列表中选择账户的类型 Choose a type of account from the list of options")
@PropertyItems({ ACCOUNT_TYPE_SAVINGS_LABEL, ACCOUNT_TYPE_SAVINGS_VALUE, ACCOUNT_TYPE_JUNIOR_LABEL, ACCOUNT_TYPE_JUNIOR_VALUE, ACCOUNT_TYPE_JOINT_LABEL,
  ACCOUNT_TYPE_JOINT_VALUE, ACCOUNT_TYPE_TRANSACTIONAL_LABEL, ACCOUNT_TYPE_TRANSACTIONAL_VALUE, ACCOUNT_TYPE_STUDENT_LABEL, ACCOUNT_TYPE_STUDENT_VALUE,
  ACCOUNT_TYPE_SENIOR_LABEL, ACCOUNT_TYPE_SENIOR_VALUE })
private String accountType;</code></pre>
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.combobox.choice.png" alt="designer.property.combobox.choice">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.combobox.choice.invalid.png" alt="designer.property.combobox.choice.invalid">
</div>
</div>
</div>
<div class="sect5">
<h6 id="_propertytype_date_picker">PropertyType.DATE_PICKER</h6>
<div class="paragraph">
<p>创建如下所示的日期选择控件。可以是必填字段，并将验证消息作为提示信息显示（请注意，这个控件会自动填入当前系统时间，因此值很难为空）。验证失败会将控件的背景变为浅红色。</p>
</div>
<div class="paragraph">
<p>这个参数类型需要注解的类成员同时使用<code>@DatePickerProperty</code>注解（例如如下所示）。可以使用这个额外的注解，指定在流程图中存储日期时使用的日期格式，以及要用于显示的日期选择类型。这些属性都是可选的，当没有指定时会使用默认值（<code>DatePickerProperty</code>注解的静态变量）。<code>dateTimePattern</code>属性应该使用<code>SimpleDateFormat</code>类支持的格式。当使用<code>swtStyle</code>属性时，应该指定<code>SWT</code>的<code>DateTime</code>控件支持的整形值，因为将使用这个控件渲染这个类型的参数。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Property(type = PropertyType.DATE_PICKER, displayName = "过期日期 Expiry date", required = true)
@Help(displayHelpShort = "账户过期的日期 The date the account expires ", displayHelpLong = "选择一个日期，如果账户未在该日期前展期，则将过期。 Choose the date when the account will expire if no extended before the date.")
@DatePickerProperty(dateTimePattern = "MM-dd-yyyy", swtStyle = 32)
private String expiryDate;</code></pre>
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.date.picker.png" alt="designer.property.date.picker">
</div>
</div>
</div>
<div class="sect5">
<h6 id="_propertytype_data_grid">PropertyType.DATA_GRID</h6>
<div class="paragraph">
<p>创建一个如下所示的数据表格控件。数据表格可以让用户输入任意行数据，并为每一行输入固定列数的值（每一组行列的组合代表一个单元格）。用户可以添加与删除行。</p>
</div>
<div class="paragraph">
<p>这个参数类型需要注解的类成员同时使用<code>@DataGridProperty</code>注解（例如如下所示）。可以使用这个额外的注解，指定数据表格的细节属性。需要用<code>itemClass</code>属性引用另一个类，来决定表格中有哪些列。Activiti Designer期望其成员类型为<code>List</code>。按照约定，可以将<code>itemClass</code>属性的类用作其泛型类型。如果，例如，在表格中编辑一个杂货清单，用<code>GroceryListItem</code>类定义表格的列。在<code>CustomServiceTask</code>中，可以这样引用它：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Property(type = PropertyType.DATA_GRID, displayName = "杂货清单 Grocery List")
@DataGridProperty(itemClass = GroceryListItem.class)
private List&lt;GroceryListItem&gt; groceryList;</code></pre>
</div>
</div>
<div class="paragraph">
<p>与<code>CustomServiceTask</code>一样，当使用数据表格时，"itemClass"可以使用相同的注解指定字段类型，目前支持<code>TEXT</code>，<code>MULTILINE_TEXT</code> 与<code>PERIOD</code>。你会注意到不论其<code>PropertyType</code>是什么，表格都会为每个字段创建一个单行文本控件。这是为了表格保持整洁与可读。如果考虑下<code>PERIOD</code>这种<code>PropertyType</code>的显示模式，就可以想象出它绝不适合在表格的单元格中显示。对于 <code>MULTILINE_TEXT</code> 与<code>PERIOD</code>，会为每个字段添加双击机制，并会为该<code>PropertyType</code>弹出更大的编辑器。数值将在用户点击OK后存储至字段，因此可以在表格中显示。</p>
</div>
<div class="paragraph">
<p>必选属性使用与普通<code>TEXT</code>字段类似的方式处理，当任何字段失去焦点时，会验证整个表格。验证失败的单元格，背景色将变为浅红色。</p>
</div>
<div class="paragraph">
<p>默认情况下，这个组件允许用户添加行，但不能决定行的顺序。如果希望允许排序，需要将<code>orderable</code>属性设置为true，这将在每一行末尾启用按钮，以将该行在表格内上移或下移。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>目前，这个参数类型不能正确注入运行时类。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.datagrid.png" alt="designer.property.datagrid">
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_在画板中禁用默认图形_disabling_default_shapes_in_the_palette">在画板中禁用默认图形 Disabling default shapes in the palette</h5>
<div class="paragraph">
<p>这种自定义需要在你的扩展中引入一个实现了<code>DefaultPaletteCustomizer</code>接口的类。不应该直接实现这个接口，而要扩展<code>AbstractDefaultPaletteCustomizer</code>基类。目前，这个类不提供任何功能，但<code>DefaultPaletteCustomizer</code>未来的版本中会提供更多功能，这样基类将提供更多合理的默认值，这样你的扩展将在未来的版本中更好用。</p>
</div>
<div class="paragraph">
<p>扩展<code>AbstractDefaultPaletteCustomizer</code>需要实现一个方法，<code>disablePaletteEntries()</code>，并必须返回一个<code>PaletteEntry</code>值的list。请注意如果从默认集合中移除图形，导致某个抽屉中没有图形，则该抽屉也会被移除。如果需要禁用所有的默认图形，只需要在结果中添加<code>PaletteEntry.ALL</code>。作为例子，下面的代码禁用了画板中的手动任务和脚本任务图形。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class MyPaletteCustomizer extends AbstractDefaultPaletteCustomizer {

  /*
   * (non-Javadoc)
   *
   * @see org.activiti.designer.integration.palette.DefaultPaletteCustomizer#disablePaletteEntries()
   */
  @Override
  public List&lt;PaletteEntry&gt; disablePaletteEntries() {
    List&lt;PaletteEntry&gt; result = new ArrayList&lt;PaletteEntry&gt;();
    result.add(PaletteEntry.MANUAL_TASK);
    result.add(PaletteEntry.SCRIPT_TASK);
    return result;
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>应用这个扩展的结果在下图显示。可以看到，在<code>Tasks</code>抽屉中不再显示手动任务与脚本任务图形。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.palette.disable.manual.and.script.png" alt="designer.palette.disable.manual.and.script">
</div>
</div>
<div class="paragraph">
<p>要禁用所有默认图形，需要使用类似下面的代码。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class MyPaletteCustomizer extends AbstractDefaultPaletteCustomizer {

  /*
   * (non-Javadoc)
   *
   * @see org.activiti.designer.integration.palette.DefaultPaletteCustomizer#disablePaletteEntries()
   */
  @Override
  public List&lt;PaletteEntry&gt; disablePaletteEntries() {
    List&lt;PaletteEntry&gt; result = new ArrayList&lt;PaletteEntry&gt;();
    result.add(PaletteEntry.ALL);
    return result;
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>结果像是这样（请注意画板中不再显示默认图形所在的抽屉）：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.palette.disable.all.png" alt="designer.palette.disable.all">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_验证流程图与输出为自定义格式_validating_diagrams_and_exporting_to_custom_output_formats">12.5.2. 验证流程图与输出为自定义格式 Validating diagrams and exporting to custom output formats</h4>
<div class="paragraph">
<p>除了自定义画板，也可以为Activiti Designer创建扩展，来进行流程图验证，以及将流程图的信息保存为Eclipse工作空间中的自定义资源。可以通过内建的扩展点实现 ，这个章节将介绍如何做。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>保存功能最近正在重构。我们仍在开发验证功能。下面的文档记录的是旧的情况，并将在新功能可用后更新。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Activiti Designer可以编写用于验证流程图的扩展。默认情况已经可以在工具中验证BPMN结构，但你也可以添加自己的，如果希望验证额外的条目，例如建模约定，或者<code>CustomServiceTask</code>中的参数值。这些扩展被称作<code>Process Validators</code>。</p>
</div>
<div class="paragraph">
<p>也可以在Activiti Designer保存流程图时，发布为其它格式。这些扩展被称作<code>Export Marshallers</code>，将在每次用户进行保存操作时，由Activiti Designer自动调用。这个行为可以在Eclipse配置对话框中，为每一种扩展检测出的格式，分别启用或禁用。Designer会根据用户的配置，确保在保存流程图时，调用你的<code>ExportMarshaller</code>。</p>
</div>
<div class="paragraph">
<p>通常，会想要将<code>ProcessValidator</code>与<code>ExportMarshaller</code>一起使用。例如有一些<code>CustomServiceTask</code>，带有一些希望在流程中使用的参数。然而，在生成流程前，希望验证其中一些值。联合使用<code>ProcessValidator</code>与<code>ExportMarshaller</code>是最佳的方式，Activiti Designer也允许你无缝拼接扩展。</p>
</div>
<div class="paragraph">
<p>要创建一个<code>ProcessValidator</code>或<code>ExportMarshaller</code>，需要创建与扩展画板不同的扩展类型。原因很简单：你的代码会需访问比集成库中提供的更多的API。特别是，会需要使用Eclipse的类。因此从一开始，就需要创建一个Eclipse插件（可以使用Eclipse的PDE支持完成），并将其打包为自定义Eclipse产品或特性。解释开发Eclipse插件的所有细节，已经不是本用户手册的范畴，因此下面的介绍仅限于扩展Activiti Designer的功能。</p>
</div>
<div class="paragraph">
<p>扩展包需要依赖下列库：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>org.eclipse.core.runtime</p>
</li>
<li>
<p>org.eclipse.core.resources</p>
</li>
<li>
<p>org.activiti.designer.eclipse</p>
</li>
<li>
<p>org.activiti.designer.libs</p>
</li>
<li>
<p>org.activiti.designer.util</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>可选的，如果希望在扩展中使用，可以通过Designer使用org.apache.commons.lang包。</p>
</div>
<div class="paragraph">
<p><code>ProcessValidator</code>与<code>ExportMarshaller</code>都是通过扩展基类创建的。这些基类从其父类<code>AbstractDiagramWorker</code>继承了一些有用的方法。使用这些方法，可以创建在Eclipse问题视图中显示的提示信息，警告，错误标记，以便用户了解错误与重要的信息。可以以<code>Resources</code>与<code>InputStreams</code>的格式获取流程图的信息，这些信息由<code>DiagramWorkerContext</code>提供，在<code>AbstractDiagramWorker</code>中可用。</p>
</div>
<div class="paragraph">
<p>不论是<code>ProcessValidator</code>还是<code>ExportMarshaller</code>中，做任何事情前最好调用<code>clearMarkers()</code>；这将清除任何已有的标记（标记自动连接至操作，清除一个操作的标记不会影响其他操作的标记）。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// 首先清除流程图的标记 Clear markers for this diagram first
clearMarkersForDiagram();</code></pre>
</div>
</div>
<div class="paragraph">
<p>也需要使用（<code>DiagramWorkerContext</code>中）提供的进度监控，将你的进度报告给用户，因为验证与/或保存操作可能花费很多时间，而用户只能等待。报告进度需要了解如何使用Eclipse的功能。查看<a href="http://www.eclipse.org/articles/Article-Progress-Monitors/article.html">这篇文章</a>了解详细概念与用法。</p>
</div>
<div class="sect4">
<h5 id="_创建processvalidator扩展_creating_a_processvalidator_extension">创建ProcessValidator扩展 Creating a ProcessValidator extension</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>审核中！</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>在你的<code>plugin.xml</code>文件中，创建一个<code>org.activiti.designer.eclipse.extension.validation.ProcessValidator</code>扩展点的扩展。这个扩展点需要扩展<code>AbstractProcessValidator</code>类。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?eclipse version="3.6"?&gt;
&lt;plugin&gt;
  &lt;extension
    point="org.activiti.designer.eclipse.extension.validation.ProcessValidator"&gt;
    &lt;ProcessValidator
      class="org.acme.validation.AcmeProcessValidator"&gt;
    &lt;/ProcessValidator&gt;
  &lt;/extension&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class AcmeProcessValidator extends AbstractProcessValidator {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>需要实现一些方法。最重要的是实现<code>getValidatorId()</code>，为验证器返回全局唯一ID。这将使你可以在<code>ExportMarshaller</code>中调用它，或者在其他<code>ExportMarshaller</code>中让其他人调用你的验证器。实现<code>getValidatorName()</code>，为验证器返回逻辑名字。这个名字将在对话框中显示给用户。<code>getFormatName()</code>可以返回这个验证器通常验证的流程图类型。</p>
</div>
<div class="paragraph">
<p>验证工作通过<code>validateDiagram()</code>方法实现。从这里开始，就是你自己的功能代码了。然而，通常你会想从获取流程中的所有节点开始，这样就可以迭代访问，收集、比较与验证数据了。这段代码展示了如何进行这些操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">final EList&lt;EObject&gt; contents = getResourceForDiagram(diagram).getContents();
for (final EObject object : contents) {
  if (object instanceof StartEvent ) {
  // 验证启动事件 Perform some validations for StartEvents
  }
  // 其它节点类型与验证 Other node types and validations
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>别忘了在验证过程中调用<code>addProblemToDiagram()</code>与/或<code>addWarningToDiagram()</code>等等。确保在结束时返回正确的boolean结果，以指示验证成功还是失败。可以由后续调用的<code>ExportMarshaller</code>判断下一步操作。</p>
</div>
</div>
<div class="sect4">
<h5 id="_创建exportmarshaller扩展_creating_an_exportmarshaller_extension">创建ExportMarshaller扩展 Creating an ExportMarshaller extension</h5>
<div class="paragraph">
<p>在你的<code>plugin.xml</code>文件中，创建一个<code>org.activiti.designer.eclipse.extension.ExportMarshaller</code>扩展点的扩展。这个扩展点需要扩展<code>AbstractExportMarshaller</code>类。这个基类提供了一些在保存为你自己的格式时有用的方法，但最重要的是提供了将资源保存至工作空间，以及调用验证器的功能。</p>
</div>
<div class="paragraph">
<p>Designer的示例目录下有一个示例实现。这个示例展示了如何使用基类中的方法完成基本操作，例如访问流程图的<code>InputStream</code>，使用其<code>BpmnModel</code>，以及将资源保存至工作空间。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?eclipse version="3.6"?&gt;
&lt;plugin&gt;
  &lt;extension
    point="org.activiti.designer.eclipse.extension.ExportMarshaller"&gt;
    &lt;ExportMarshaller
      class="org.acme.export.AcmeExportMarshaller"&gt;
    &lt;/ExportMarshaller&gt;
  &lt;/extension&gt;
  &lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class AcmeExportMarshaller extends AbstractExportMarshaller {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>需要实现一些方法，例如<code>getMarshallerName()</code>与<code>getFormatName()</code>。这些方法用来为用户显示选项，并在流程对话框中显示信息，因此请确保你返回的描述反映了正在进行的操作。</p>
</div>
<div class="paragraph">
<p>大部分工作主要在<code>doMarshallDiagram()</code>方法中进行。</p>
</div>
<div class="paragraph">
<p>如果需要先进行一些验证，可以直接从保存器中调用验证器。从验证器可以获得boolean结果，就可以知道验证是否成功。在大多数情况下，在流程图验证失败时不会想要进行保存，但你也可以选择仍然继续，甚至在验证失败时创建不同的资源。</p>
</div>
<div class="paragraph">
<p>一旦获取了所有需要的数据，就可以调用<code>saveResource()</code>方法创建保存有数据的文件。在一个保存器中，可以调用<code>saveResource()</code>任意多次；因此一个验证器可以创建多于一个输出文件。</p>
</div>
<div class="paragraph">
<p>可以使用<code>AbstractDiagramWorker</code>类的<code>saveResource()</code>方法构建输出资源的文件名。可以使用一些有用的变量用于创建文件名，例如_original-filename__my-format-name.xml。这些变量在Javadocs中描述，通过<code>ExportMarshaller</code>接口定义。如果希望自行解析保存位置，也可以在一个字符串（例如一个路径）上使用<code>resolvePlaceholders()</code>。<code>getURIRelativeToDiagram()</code>会为你调用它。</p>
</div>
<div class="paragraph">
<p>应该使用提供的进度监控将你的进度报告给用户。<a href="http://www.eclipse.org/articles/Article-Progress-Monitors/article.html">这个文章</a>描述了如何做。</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="activitiExplorer">13. Activiti Explorer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Activiti Explorer是一个web应用，包含在从Activiti网站上下载的Activiti中。Explorer不是一个完成的，最终用户可用的应用，而是用于实践与展示Activiti的功能。因此Explorer更像是一个示例，或者为在自己的应用中使用Activiti的用户提供灵感。另外，Explorer使用内存数据库，但也可以轻松切换至你自己的数据库（查看WEB-INF目录下的applicationContext文件）。</p>
</div>
<div class="paragraph">
<p>登录应用后，将看到这些大图标，展示了主要功能。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/explorer.tabs.png" alt="explorer.tabs">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Tasks</strong>: 任务管理功能。在这里可以看到指派给你的运行中用户任务的表单，或你可以申领的组任务。Explorer可以关联内容，将工作分为子任务，将人作为不同角色引入，等等。Explorer也可以创建不关联至任何流程的独立任务。</p>
</li>
<li>
<p><strong>Process</strong>: 展示已部署的流程定义，也可以启动新的流程实例。</p>
</li>
<li>
<p><strong>Reporting</strong>: 生成报告以及浏览之前保存的报告。查看<a href="#explorer.reporting">报告章节</a>了解更多细节。</p>
</li>
<li>
<p><strong>Manage</strong>: 只有当用户登陆为管理员权限时才可见。可以管理Activiti引擎：管理用户与组，执行与查看卡住的作业，查看数据库，以及部署新的流程定义。</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_配置_configuration_2">13.1. 配置 Configuration</h3>
<div class="paragraph">
<p>Activiti Explorer使用Spring Java配置启动Activiti引擎。可以修改WEB-INF/classes目录下的engine.properties文件，定义小部分参数。如果需要高级配置选项，可以修改同在WEB-INF/classes目录下的activiti-custom-context.xml文件，来定义Activiti流程引擎配置。该文件已经以注释形式提供了示例配置。</p>
</div>
</div>
<div class="sect2">
<h3 id="_流程图_process_diagram">13.2. 流程图 Process diagram</h3>
<div class="paragraph">
<p>Explorer包含了动态生成流程定义的总览的功能，使用<a href="http://raphaeljs.com/">Raphaël</a> JavaScript框架。这个流程图只能在流程定义XML中包含BPMN DI信息时才能生成。如果流程定义XML中没有BPMN DI信息，而部署中包含有流程定义图片，则会显示该图片。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/explorer.process.definition.image.png" alt="explorer.process.definition.image">
</div>
</div>
<div class="paragraph">
<p>如果不希望使用JavaScript流程定义总览，可以在ui.properties文件中禁用</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">activiti.ui.jsdiagram = false</code></pre>
</div>
</div>
<div class="paragraph">
<p>另外，要在Explorer中显示流程图，也可以在任何你想要的地方引入流程图。下面的URL将基于流程定义id，显示流程定义图：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/activiti-explorer/diagram-viewer/index.html?processDefinitionId=reviewSaledLead:1:36</pre>
</div>
</div>
<div class="paragraph">
<p>也可以通过添加processInstanceId请求参数，显示流程实例的当前状态，像是这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/activiti-explorer/diagram-viewer/index.html?processDefinitionId=reviewSaledLead:1:36&amp;processInstanceId=41</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_任务_tasks">13.3. 任务 Tasks</h3>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/explorer.tasks.png" alt="explorer.tasks">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Inbox:</strong> 展示指派给当前登录用户的任务。</p>
</li>
<li>
<p><strong>My tasks:</strong> 展示当前登录用户作为属主的任务。当创建独立任务时，当前用户自动成为该任务的属主。</p>
</li>
<li>
<p><strong>Queued:</strong> 展示你所在的不同组。这里的任务必须先进行申领，然后才能完成。</p>
</li>
<li>
<p><strong>Involved:</strong> 展示当前登陆用户作为下列角色之一的任务：(1)相关人员（也就是说候选用户或参与者），(2)办理人，或者(3)属主。</p>
</li>
<li>
<p><strong>Archived</strong> 包含过去（历史）的任务。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_启动流程实例_start_process_instances">13.4. 启动流程实例 Start process instances</h3>
<div class="paragraph">
<p><strong>Process definitions（流程定义）</strong>页签可以查看Activiti引擎中部署的所有流程定义。可以使用右上角的按钮启动新的流程实例。如果流程定义了启动<a href="#forms">表单</a>，则会在启动流程实例前显示该表单。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/explorer.process.definitions.png" alt="explorer.process.definitions">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_我的实例_my_instances">13.5. 我的实例 My instances</h3>
<div class="paragraph">
<p><strong>My instances</strong>页签，展示你当前有未完成用户任务的所有流程实例。同时也显示该流程实例的当前活动，以及存储的流程变量。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/explorer.my.instances.png" alt="explorer.my.instances">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_管理_administration">13.6. 管理 Administration</h3>
<div class="paragraph">
<p>管理功能只有在登录用户是安全组<em>admin</em>的成员时才可用。当点击<em>Manage</em>图标时，可用下列页签：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Database:</strong> 展示数据库内容。当部署流程或排错时十分有用。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/explorer.database.png" alt="explorer.database">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Deployments:</strong> 展示引擎当前的部署，并查看部署的内容（流程定义，图片，业务规则，等等）。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/explorer.deployments.png" alt="explorer.deployments">
</div>
</div>
<div class="paragraph">
<p>点击<em>deployment</em>页签也可以上传新的部署。选择电脑中的一个业务存档或者一个bpmn20.xml文件，或者简单地拖放至特定区域，就可以部署新的业务流程。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/explorer.upload.deployment.png" alt="explorer.upload.deployment">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Jobs:</strong> 在左侧展示当前的作业（定时器，等等），也可以手动执行它们（例如，在到时前触发定时器）。如果作业执行失败（例如邮件服务器无法连接），也会显示异常</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/explorer.jobs.png" alt="explorer.jobs">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Users and Groups:</strong> 管理用户与组：创建、编辑与删除用户与组。将用户关联至组，以赋予更多权限，或使他们可以查看分派给特定组的任务。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/explorer.users.png" alt="explorer.users">
</div>
</div>
</div>
<div class="sect2">
<h3 id="explorer.reporting">13.7. 报告 Reporting</h3>
<div class="paragraph">
<p>Activiti Explorer提供了一些报告的例子，也可以很容易地为系统添加新的报告。报告功能组织在<em>'Reports'</em>页签下。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/explorer.reporting.png" alt="explorer.reporting">
</div>
</div>
<div class="paragraph">
<p><strong>重要</strong>：要使报告能工作，Explorer需要配置为不是none的历史级别。默认配置满足这个要求。</p>
</div>
<div class="paragraph">
<p>报告页签目前有两个子页签：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Generate reports</strong>: 展示系统已有的所有报告类型的列表。可以运行来生成报告。</p>
</li>
<li>
<p><strong>Saved reports</strong>: 展示之前保存的所有报告的列表。请注意这些是个人保存的报告，不能查看其他人保存的报告。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>用于创建报告中列表与图表的数据由流程生成。虽然初看有些奇怪，但使用流程生成报告数据有几个优点</p>
</div>
<div class="ulist">
<ul>
<li>
<p>流程可以直接访问Activiti引擎内部，并可以直接访问引擎使用的数据库。</p>
</li>
<li>
<p>作业执行器可以用于任何其他流程。这意味着可以异步生成流程，或者同步地执行一些步骤。也意味着可以使用定时器，例如，在特定时间点生成报告。</p>
</li>
<li>
<p>可以使用已有工具与已有概念创建新报告。并且，不需要新的概念、服务或应用。部署或上传新的报告与部署一个新流程是一样的。</p>
</li>
<li>
<p>可以使用BPMN 2.0结构。这意味着所有的东西，比如并行步骤，基于数据做分支选择，或者甚至是生成过程中请求用户输入都可以使用。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>用于生成报告数据的流程定义需要是<strong>'activiti-report&#8217;类型的</strong>，这样才能在Explorer的已有报告列表中看到。“报告流程”可以简单，也可以任意复杂。唯一的要求，是流程要生成一个叫做<strong>reportData</strong>的变量，这个变量必须是一个表示JSON对象的字节数组。该变量存储在Activiti的历史表中（因此要求引擎必须启用历史），用于后续保存报告时获取。</p>
</div>
<div class="sect3">
<h4 id="explorer.reporting.json">13.7.1. 报告数据JSON （Report data JSON）</h4>
<div class="paragraph">
<p>报告流程必须生成一个<em>reportData</em>变量，这是一个代表了需要显示给用户的数据的JSON，要像下面这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "title": "My Report",
  "datasets": [
    {
      "type" : "lineChart",
      "description" : "My first chart",
      "xaxis" : "Year"
      "yaxis" : "Total sales"
      "data" :
      {
        "2010" : 50,
        "2011" : 33,
        "2012" : 17,
        "2013" : 87,
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个JSON将在Explorer运行时获取，并将用于生成图表或列表。JSON中的元素是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>title</strong>: 整个报告的总标题</p>
</li>
<li>
<p><strong>datasets</strong>: 与报告中各图表与列表对应的数据集的数组。</p>
</li>
<li>
<p><strong>type</strong>: 每个数据集都有一个类型。这个类型将用于决定如何渲染数据。目前支持的值有：<strong>pieChart，lineChart，barChart与list</strong>。</p>
</li>
<li>
<p><strong>description</strong>: 每个图表都可选一个描述，将显示在报告中。</p>
</li>
<li>
<p><strong>x与yaxis</strong>: 只对<em>lineChart</em>类型可用。描述图表坐标轴名字的可选参数。</p>
</li>
<li>
<p><strong>data</strong>: 实际的数据，是一个带有键值对元素的JSON对象。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="explorer.reporting.example">13.7.2. 实例流程 Example process</h4>
<div class="paragraph">
<p>下面的例子展示了一个&#8217;process instance overview （流程实例总览）'报告。流程本身十分简单，只有一个使用JavaScript生成JSON数据集的脚本任务（除了启动与结束）。尽管Explorer中所有的例子都使用脚本，但也完全可以使用Java服务任务。运行流程的结果就是包含数据的<em>reportData</em>变量。</p>
</div>
<div class="paragraph">
<p><strong>重要提示：</strong>下面的例子只能在JDK 7+使用。原因是旧JDK版本中的JavaScript引擎（<em>Rhino</em>）不够先进，不能使用类似下面使用的结构撰写脚本。之后有一个兼容JDK 6+的例子。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:activiti="http://activiti.org/bpmn"
    xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC"
    xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" typeLanguage="http://www.w3.org/2001/XMLSchema"
    expressionLanguage="http://www.w3.org/1999/XPath"
    targetNamespace="activiti-report"&gt;

    &lt;process id="process-instance-overview-report" name="Process Instance Overview" isExecutable="true"&gt;

        &lt;startEvent id="startevent1" name="Start" /&gt;
        &lt;sequenceFlow id="flow1" sourceRef="startevent1" targetRef="generateDataset" /&gt;

        &lt;scriptTask id="generateDataset" name="Execute script" scriptFormat="JavaScript" activiti:autoStoreVariables="false"&gt;
          &lt;script&gt;&lt;![CDATA[

               importPackage(java.sql);
               importPackage(java.lang);
               importPackage(org.activiti.explorer.reporting);

               var result = ReportingUtil.executeSelectSqlQuery("SELECT PD.NAME_, PD.VERSION_ , count(*) FROM ACT_HI_PROCINST PI inner join ACT_RE_PROCDEF PD on PI.PROC_DEF_ID_ = PD.ID_ group by PROC_DEF_ID_");

               var reportData = {};
               reportData.datasets = [];

               var dataset = {};
               dataset.type = "pieChart";
               dataset.description = "Process instance overview (" + new java.util.Date() + ")";
               dataset.data = {};

               while (result.next()) { // process results one row at a time
                 var name = result.getString(1);
                 var version = result.getLong(2)
                 var count = result.getLong(3);
                 dataset.data[name + " (v" + version + ")"] = count;
               }
               reportData.datasets.push(dataset);

               execution.setVariable("reportData", new java.lang.String(JSON.stringify(reportData)).getBytes("UTF-8"));
          ]]&gt;&lt;/script&gt;
        &lt;/scriptTask&gt;
        &lt;sequenceFlow id="flow3" sourceRef="generateDataset" targetRef="theEnd" /&gt;

        &lt;endEvent id="theEnd" /&gt;

    &lt;/process&gt;

&lt;/definitions&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>除了流程XML顶端的标准的XML行，主要的区别是<em>targetNamespace</em>设置为<strong>activiti-report</strong>，为部署的流程定义添加了同名的类型。</p>
</div>
<div class="paragraph">
<p>脚本的前几行是为了避免重复写包名而进行的引入。要关注的第一行是使用<em>ReportingUtil</em>查询Activiti数据库，其结果是生成了一个普通的<em>JDBC Resultset</em>。在查询下面的几行，JavaScript功能轻松地创建了要用的JSON。这个JSON按照<a href="#explorer.reporting.json">要求</a>生成。</p>
</div>
<div class="paragraph">
<p>脚本的最后一行看起来有些奇怪。首先是使用JavaScript函数<em>JSON.stringify()</em>将JSON对象转换为字符串，然后将这个字符串保存为一个字节数组变量。原因是技术性的：字节数组没有大小限制，而字符串有。这就是为什么JavaScript字符串必须要转换为Java字符串，因为这样就可以转换为字节形式。</p>
</div>
<div class="paragraph">
<p>兼容JDK 6（与更高）的相同流程看起来有点区别。不能使用原生的JSON功能，因此需要提供一些辅助类（<em>ReportData</em>与<em>Dataset</em>）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:activiti="http://activiti.org/bpmn"
    xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC"
    xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" typeLanguage="http://www.w3.org/2001/XMLSchema"
    expressionLanguage="http://www.w3.org/1999/XPath"
    targetNamespace="activiti-report"&gt;

    &lt;process id="process-instance-overview-report" name="Process Instance Overview" isExecutable="true"&gt;

        &lt;startEvent id="startevent1" name="Start" /&gt;
        &lt;sequenceFlow id="flow1" sourceRef="startevent1" targetRef="generateDataset" /&gt;

        &lt;scriptTask id="generateDataset" name="Execute script" scriptFormat="js" activiti:autoStoreVariables="false"&gt;
          &lt;script&gt;&lt;![CDATA[

               importPackage(java.sql);
               importPackage(java.lang);
               importPackage(org.activiti.explorer.reporting);

               var result = ReportingUtil.executeSelectSqlQuery("SELECT PD.NAME_, PD.VERSION_ , count(*) FROM ACT_HI_PROCINST PI inner join ACT_RE_PROCDEF PD on PI.PROC_DEF_ID_ = PD.ID_ group by PROC_DEF_ID_");


               var reportData = new ReportData;
               var dataset = reportData.newDataset();
               dataset.type = "pieChart";
               dataset.description = "Process instance overview (" + new java.util.Date() + ")"


               while (result.next()) { // process results one row at a time
                 var name = result.getString(1);
                 var version = result.getLong(2);
                 var count = result.getLong(3);
                 dataset.add(name + " (v" + version + ")", count);
               }

               execution.setVariable("reportData", reportData.toBytes());

          ]]&gt;&lt;/script&gt;
        &lt;/scriptTask&gt;
        &lt;sequenceFlow id="flow3" sourceRef="generateDataset" targetRef="theEnd" /&gt;

        &lt;endEvent id="theEnd" /&gt;

    &lt;/process&gt;

&lt;/definitions&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="explorer.reporting.start.form">13.7.3. 报告启动表单 Report start forms</h4>
<div class="paragraph">
<p>报告通过普通流程生成，因此可以使用普通的表单功能。简单的为启动事件添加启动表单，这样Explorer就将在生成流程前为用户显示表单。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;startEvent id="startevent1" name="Start"&gt;
  &lt;extensionElements&gt;
    &lt;activiti:formProperty id="processDefinition" name="Select process definition" type="processDefinition" required="true" /&gt;
      &lt;activiti:formProperty id="chartType" name="Chart type" type="enum" required="true"&gt;
        &lt;activiti:value id="pieChart" name="Pie chart" /&gt;
        &lt;activiti:value id="barChart" name="Bar chart" /&gt;
      &lt;/activiti:formProperty&gt;
  &lt;/extensionElements&gt;
&lt;/startEvent&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>为用户渲染的是一个典型的表单：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/explorer.reporting.start.form.png" alt="explorer.reporting.start.form">
</div>
</div>
<div class="paragraph">
<p>表单的参数将在流程启动时提交，与普通执行变量一样，可以在生成数据的脚本中使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"> var processDefinition = execution.getVariable("processDefinition");</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="explorer.reporting.examples">13.7.4. 示例流程 Example processes</h4>
<div class="paragraph">
<p>默认情况下，Explorer包含四个示例报告：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Employee productivity（雇员生产力）</strong>：这个报告演示了折线图的使用，并使用了启动表单。这个报告中使用的脚本也比其他例子中的复杂，因为获取的数据，在存储至报告数据前，会由脚本进行处理。</p>
</li>
<li>
<p><strong>Helpdesk - firstline vs escalated（帮助中心——一线对比升级）</strong>：展示了饼图的使用，并结合了两个不同数据库查询的结果。</p>
</li>
<li>
<p><strong>Process instance overview（流程实例总览）</strong>：使用多个数据集的示例报告。这个报告包含有一个饼图，以及相同数据的列表视图，这样展示了如何使用多个数据集生成一个带有多个图表的页面。</p>
</li>
<li>
<p><strong>Task duration（任务持续时间）</strong>：另一个使用了启动表单的例子，并使用了相应的数据动态建立SQL查询。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="explorer.change.database">13.8. 改变数据库 Changing the database</h3>
<div class="paragraph">
<p>要修改Explorer在演示配置中使用的数据库，需要修改<code>apps/apache-tomcat-6.x/webapps/activiti-explorer/WEB-INF/classes/db.properties</code>配置文件。并且，在classpath中放入合适的数据库驱动（Tomcat共享库，或放在<code>apps/apache-tomcat-6.x/webapps/activiti-explorer/WEB-INF/lib/</code>下）。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="activitiModeler">14. Activiti Modeler</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Activiti Modeler是一个BPMN web建模器组件，内置在<a href="#activitiExplorer">Activiti Explorer</a> web应用中。Modeler是 <a href="http://code.google.com/p/signavio-core-components/">Signavio核心组件</a>的分支项目。Activiti Modeler从5.17.0版本起基于Angular JS（之前是基于Ext-JS的应用）。Activiti Modeler的Angular JS部分基于LGPL协议发布。与之前版本的Activiti Modeler（Signavio核心组件）的主要区别，是新的Modeler作为Activiti项目的一部分维护与开发。Activiti Modeler的目标，是支持所有BPMN元素与Activiti支持的扩展。</p>
</div>
<div class="paragraph">
<p>使用默认配置运行Activiti Explorer时，在模型工作空间内将有一个示例流程。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/modeler.example.process.png" alt="modeler.example.process">
</div>
</div>
<div class="sect2">
<h3 id="_编辑模型_model_editing">14.1. 编辑模型 Model editing</h3>
<div class="paragraph">
<p>在模型工作空间点击edit按钮时，会在建模器中打开模型。屏幕的左侧是BPMN元素与Activiti扩展的画板。在需要时可以将新元素拖放至画布上。在屏幕底部可以填写选中元素的属性。在示例截图中选中了一个用户任务，可以填写用户任务属性，例如办理人，表单参数与到期日期。要返回Activiti Explorer，可以点击屏幕右上角的关闭按钮。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/modeler.editor.canvas.png" alt="modeler.editor.canvas">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_导入现有模型_importing_existing_models">14.2. 导入现有模型 Importing existing models</h3>
<div class="paragraph">
<p>也可以将现有模型导入模型工作空间，以在Activiti Modeler中编辑它们。点击import按钮，选择一个.bpmn或者.bpmn20.xml文件。请注意这个BPMN XML文件需要包含BPMN DI信息。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/modeler.import.png" alt="modeler.import">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_将已部署定义转换为可编辑模型_convert_deployed_definitions_to_a_editable_model">14.3. 将已部署定义转换为可编辑模型 Convert deployed definitions to a editable model</h3>
<div class="paragraph">
<p>已部署的流程定义可以转换为能够使用Activiti Modeler编辑的模型。请注意该流程定义需要包含BPMN DI信息。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/modeler.convert.png" alt="modeler.convert">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_将模型导出为bpmn_xml_export_model_to_bpmn_xml">14.4. 将模型导出为BPMN XML （Export model to BPMN XML）</h3>
<div class="paragraph">
<p>模型工作空间中的模型可以导出为BPMN XML文件。在模型动作选项框中选择导出选项。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/modeler.export.png" alt="modeler.export">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_将模型部署至activiti引擎_deploy_model_to_the_activiti_engine">14.5. 将模型部署至Activiti引擎 Deploy model to the Activiti Engine</h3>
<div class="paragraph">
<p>当模型包含了运行所需的所有参数，就可以部署至Activiti引擎。在模型动作选项框中选择部署选项。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/modeler.deploy.png" alt="modeler.deploy">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rest_api">15. REST API</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_activiti_rest一般原则_general_activiti_rest_principles">15.1. Activiti REST一般原则 General Activiti REST principles</h3>
<div class="sect3">
<h4 id="_安装与认证_installation_and_authentication">15.1.1. 安装与认证 Installation and Authentication</h4>
<div class="paragraph">
<p>Activiti在引擎中包含了REST API，可以通过在servlet容器如Apache Tomcat中，部署activiti-rest.war文件来安装。但是也可以在其他的web应用中使用，只要在你的应用中包含这些servlet与其映射，并在classpath中添加所有activiti-rest依赖即可。</p>
</div>
<div class="paragraph">
<p>默认情况下Activiti引擎连接至一个H2内存数据库。可以修改WEB-INF/classes文件夹下的db.properties文件中的数据库设置。REST API使用JSON格式 (<a href="http://www.json.org" class="bare">http://www.json.org</a>) ，基于Spring MVC (<a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/html/mvc.html" class="bare">http://docs.spring.io/spring/docs/current/spring-framework-reference/html/mvc.html</a>) 构建。</p>
</div>
<div class="paragraph">
<p>默认情况下，所有REST资源都需要有一个有效的的Activiti已认证用户，使用基础HTTP访问认证，因此在请求时，可以在HTTP头添加<code>Authorization: Basic &#8230;&#8203;==</code>，也可以在请求url中包含用户名与密码（例如<code><a href="http://username:password@localhost&#8230;&#8203" class="bare">http://username:password@localhost&#8230;&#8203</a>;</code>）。</p>
</div>
<div class="paragraph">
<p><strong>建议使用基础认证时，同时使用HTTPS。</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="_配置_configuration_3">15.1.2. 配置 Configuration</h4>
<div class="paragraph">
<p>Activiti REST web应用使用Spring Java Configuration来启动Activiti引擎、定义基础认证安全使用Spring security，以及为特定的变量处理定义变量转换。可以修改WEB-INF/classes目录下的engine.properties文件，定义少量参数。如果需要高级配置选项，可以在activiti-custom-context.xml文件中覆盖默认的Spring bean，这个文件也在WEB-INF/classes目录下。该文件中已经以注释形式提供了示例配置。也可以在这里通过定义一个新的命名为restResponsefactory的Spring bean，覆盖默认的RestResponseFactory，并使用自定义实现类。</p>
</div>
</div>
<div class="sect3">
<h4 id="restUsageInTomcat">15.1.3. 在Tomcat中使用 Usage in Tomcat</h4>
<div class="paragraph">
<p>由于<a href="http://tomcat.apache.org/tomcat-7.0-doc/security-howto.html">Tomcat中的默认安全参数</a>，<strong>默认不能使用已转义斜线符（<code>%2F</code>与<code>%5C</code>）（返回400结果）。</strong>这可能会影响部署资源与其数据URL，因为URL可能隐含已转义斜线符。</p>
</div>
<div class="paragraph">
<p><strong>当发现非预期的400结果时，设置下列系统参数 <code>-Dorg.apache.tomcat.util.buf.UDecoder.ALLOW_ENCODED_SLASH=true.</code> </strong></p>
</div>
<div class="paragraph">
<p>最佳实践是（post/put JSON时），在下面描述的HTTP请求中，永远将<strong>Accept</strong>与<strong>Content-Type</strong>头设置为<strong>application/json</strong>。</p>
</div>
</div>
<div class="sect3">
<h4 id="_方法与返回码_methods_and_return_codes">15.1.4. 方法与返回码 Methods and return-codes</h4>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. HTTP方法与相应操作</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">方法</th>
<th class="tableblock halign-left valign-top">操作</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">获取单个资源，或获取一组资源。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>POST</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">创建一个新资源。在查询结构太复杂，不能放入GET请求的查询URL中时，也用于执行资源查询。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PUT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">更新一个已有资源的参数。也用于在已有资源上的调用动作。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DELETE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">删除一个已有资源。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. HTTP方法响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>200 - Ok</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">操作成功，返回响应（<code>GET</code>与<code>PUT</code>请求）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>201 - 已创建</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">操作成功，已经创建了实体，并在响应体中返回（<code>POST</code>请求）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>204 - 无内容</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">操作成功，已经删除了实体，因此没有返回的响应体（<code>DELETE</code>请求）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>401 - 未认证</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">操作失败。操作要求设置认证头。如果请求中有认证头，则提供的鉴证并不合法，或者用户未被授权进行该操作。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>403 - 禁止</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">操作被禁止，且不应重试。这不是鉴证或授权的问题，而是说明不允许该操作。例如：删除一个运行中流程的任务是且永远是不允许的，无论该用户或流程/任务的状态。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>404 - 未找到</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">操作失败。请求的资源未找到。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>405 - 不允许的方法</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">操作失败。使用的方法不能用于该资源。例如，更新（PUT）部署资源将导致<code>405</code>状态。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>409 - 冲突</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">操作失败。该操作导致更新一个已被其他操作更新的资源，因此本更新不再有效。也可以表明正在为一个集合创建一个资源，但该集合中已经使用了该标识符。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>415 - 不支持的媒体类型</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">操作失败。请求提包含了不支持的媒体类型。也会发生在请求体JSON中包含了未知的属性或值，但没有正确的格式/类型来接受的情况下。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>500 - 服务器内部错误</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">操作失败。执行操作时发生了未知异常。响应体中包含了错误的细节。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>HTTP响应的media-type总是<code>application/json</code>，除非请求的是二进制内容（例如部署资源数据）。这时将使用内容的media-type。</p>
</div>
</div>
<div class="sect3">
<h4 id="_错误响应体_error_response_body">15.1.5. 错误响应体 Error response body</h4>
<div class="paragraph">
<p>当发生错误时（客户端与服务器端都可能，4XX及5XX状态码），响应体会包含一个描述了发生的错误的对象。任务未找到时的404状态的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "statusCode" : 404,
  "errorMessage" : "Could not find a task with id '444'."
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_请求参数_request_parameters">15.1.6. 请求参数 Request parameters</h4>
<div class="sect4">
<h5 id="_url片段_url_fragments">URL片段 URL fragments</h5>
<div class="paragraph">
<p>作为url的一部分的参数（例如，<code><a href="http://host/actviti-rest/service/repository/deployments/{deploymentId}" class="bare">http://host/actviti-rest/service/repository/deployments/{deploymentId}</a></code>中的deploymentId参数），如果包含特殊字符，则需要进行合适的转义（参见<a href="https://en.wikipedia.org/wiki/Percent-encoding">URL编码或百分号编码</a>）。大多数框架都内建了这个功能，但要记得考虑它。特别是对可能包含斜线符的段落（例如部署资源），就是必须的。</p>
</div>
</div>
<div class="sect4">
<h5 id="_rest_url查询参数_rest_url_query_parameters">Rest URL查询参数 Rest URL query parameters</h5>
<div class="paragraph">
<p>作为查询字符串添加在URL中的参数（例如<code><a href="http://host/activiti-rest/service/deployments?name=Deployment" class="bare">http://host/activiti-rest/service/deployments?name=Deployment</a></code>中的name参数）可以使用下列类型，也会在相应的REST-API文档中提到：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 4. URL查询参数类型</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">格式</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">纯文本参数。可以包含任何URL允许的合法字符。对于<code>XXXLike</code>参数，字符串可能会包含通配符<code>%</code>（需要进行URL编码）。可以进行like搜索，例如，'Tas%'将匹配所有以&#8217;Tas&#8217;开头的值。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">整形参数。只能包含数字型非十进制值（原文如此，下同），在-2.147.483.648至2.147.483.647之间。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">长整形参数。只能包含数字型非十进制值，在-9.223.372.036.854.775.808至9.223.372.036.854.775.807之间。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean型参数。可以为<code>true</code>或<code>false</code>。任何其他值都会导致'<code>405 - 错误请求</code>'响应。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">日期型参数。使用ISO-8601日期格式（参考<a href="http://en.wikipedia.org/wiki/ISO_8601">wikipedia中的ISO-8601</a>），使用时间与日期组分（例如<code>2013-04-03T23:45Z</code>）。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="restJsonBody">JSON体参数 JSON body parameters</h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 5. JSON参数类型</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">格式</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">纯文本参数。对于<code>XXXLike</code>参数，字符串可能会包含通配符<code>%</code>。可以进行like搜索。例如，'Tas%'将匹配所有以&#8217;Tas&#8217;开头的值。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">整形参数，使用JSON数字。只能包含数字型非十进制值（原文如此，下同），在-2.147.483.648至2.147.483.647之间。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">长整形参数，使用JSON数字。只能包含数字型非十进制值，在-9.223.372.036.854.775.808至9.223.372.036.854.775.807之间。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">日期型参数，使用JSON文本。使用ISO-8601日期格式（参考<a href="http://en.wikipedia.org/wiki/ISO_8601">wikipedia中的ISO-8601</a>），使用时间与日期组分（例如<code>2013-04-03T23:45Z</code>）。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="restPagingAndSort">分页与排序 Paging and sorting</h5>
<div class="paragraph">
<p>分页与排序参数可以作为查询字符串加入URL中（例如<code><a href="http://host/activiti-rest/service/deployments?sort=name" class="bare">http://host/activiti-rest/service/deployments?sort=name</a></code>中的name参数）。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 6. 查询变量参数</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">各查询实现不同</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">排序键的名字，在各查询实现中默认值与可用值都不同。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">order</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">排序顺序，可以是&#8217;asc'（顺序）或&#8217;desc'（逆序）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">start</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">对结果分页的参数。默认结果从0开始。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">对结果分页的参数。默认大小为10.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="restQueryVariable">JSON查询变量格式</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "name" : "variableName",
  "value" : "variableValue",
  "operation" : "equals",
  "type" : "string"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 7. JSON查询变量参数</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">包含在查询中的变量名。在有些使用'<code>equals</code>'的查询中可以为空，查询<strong>任意变量名</strong>为给定值的资源。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">包含在查询中的变量值，需要使用给定类型的正确格式。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询使用的操作，可以为下列值：<code>equals, notEquals, equalsIgnoreCase, notEqualsIgnoreCase, lessThan, greaterThan, lessThanOrEquals, greaterThanOrEquals, like</code>与<code>likeIgnoreCase</code>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">所用变量的类型。当省略时，会从<code>value</code>参数推理类型。任何JSON文本值都认为是<code>string</code>类型，JSON boolean值认为是<code>boolean</code>类型，JSON数字认为是<code>long</code>或<code>integer</code>，取决于数字的大小。建议在有疑惑时明确指定类型。其他支持的类型列在下面。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 8. 默认查询JSON类型</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">类型名</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值处理转换为<code>java.lang.String</code>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">short</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值处理转换为<code>java.lang.Integer</code>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值处理转换为<code>java.lang.Integer</code>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值处理转换为<code>java.lang.Long</code>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值处理转换为<code>java.lang.Double</code>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值处理转换为<code>java.lang.Boolean</code>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值处理转换为<code>java.util.Date</code>。JSON字符串将使用ISO-8601日期格式转换。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="restVariables">变量表示 Variable representation</h5>
<div class="paragraph">
<p>当使用变量时（执行/流程与任务），读取与写入时REST-api都使用一些通用原则与JSON格式。变量的JSON表示像是这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "name" : "variableName",
  "value" : "variableValue",
  "valueUrl" : "http://...",
  "scope" : "local",
  "type" : "string"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 9. 变量的JSON属性</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">变量名。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">变量的值。当写入变量且省略了<code>value</code>时，会使用<code>null</code>作为value。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">valueUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">当读取<code>binary</code>或<code>serializable</code>类型的变量时，这个属性将指向可用于获取原始二进制数据的URL。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">变量的范围。如果值为'<code>local</code><em>，则变量明确定义在其请求的资源上。如果值为</em><code>global</code>'，则变量定义在其父上（或者父树中的任意父）。当写入变量且省略了scope时，使用<code>global</code>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">变量的类型。查看下面的表格了解类型的更多信息。当写入变量且省略了这个值时，将使用请求的原始JSON属性类型推断，限制在<code>string</code>, <code>double</code>, <code>integer</code>与<code>boolean</code>中。建议总是包含类型，以确保不会错误推断类型。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 10. 变量类型</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">类型名</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值按照<code>java.lang.String</code>处理。写入变量时使用原始JSON文本。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值按照<code>java.lang.Integer</code>处理。按约定写入变量时使用JSON数字，失败则退回JSON文本。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">short</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值按照<code>java.lang.Short</code>处理。按约定写入变量时使用JSON数字，失败则退回JSON文本。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值按照<code>java.lang.Long</code>处理。按约定写入变量时使用JSON数字，失败则退回JSON文本。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值按照<code>java.lang.Double</code>处理。按约定写入变量时使用JSON数字，失败则退回JSON文本。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值按照<code>java.lang.Boolean</code>处理。按约定写入变量时使用JSON boolean。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值按照<code>java.util.Date</code>处理。写入变量时将转换为ISO-8601日期格式。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">binary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">二进制变量，按照字节数组处理。<code>value</code>属性为null，<code>valueUrl</code>包含指向原始二进制流的URL。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serializable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表序列化的Java对象。与<code>binary</code>类型一样，<code>value</code>属性为null，<code>valueUrl</code>包含指向原始二进制流的URL。所有可序列化的变量（不是上述任意类型的）将被暴露为这个类型的变量。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>可以使用自定义JSON表示，以支持额外的变量类型（既可以是简单值，也可以是复杂/嵌套的JSON对象）。通过扩展<code>org.activiti.rest.service.api.RestResponseFactory</code>的<code>initializeVariableConverters()</code>方法，可以添加额外的<code>org.activiti.rest.service.api.engine.variable.RestVariableConverter</code>类，来将你的POJO转换为适合通过REST传输的格式，以及将REST值转换为POJO。实际转换JSON使用Jackson。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_部署_deployment">15.2. 部署 Deployment</h3>
<div class="paragraph">
<p><strong>使用tomcat时，请阅读<a href="#restUsageInTomcat">在Tomcat中使用</a>。</strong></p>
</div>
<div class="sect3">
<h4 id="_部署的列表_list_of_deployments">15.2.1. 部署的列表 List of Deployments</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/deployments</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 11. URL查询参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定名字的部署。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回名字like给定名字的部署。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">category</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定分类的部署。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">categoryNotEquals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回不是给定分类的部署。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定tenantId的部署。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回tenantId like给定值的部署。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果值为<code>true</code>，则只返回没有设置tenantId的部署。如果值为<code>false</code>，则忽略<code>withoutTenantId</code>参数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>id</em>（默认）, <em>name</em>, <em>deploytime&#8217;或&#8217;tenantId</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于排序的参数，与&#8217;order&#8217;一起使用。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>可以在这个URL中使用通用<a href="#restPagingAndSort">分页与排序查询参数</a>。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 12. REST返回码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">返回码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求成功。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": [
    {
      "id": "10",
      "name": "activiti-examples.bar",
      "deploymentTime": "2010-10-13T14:54:26.750+02:00",
      "category": "examples",
      "url": "http://localhost:8081/service/repository/deployments/10",
      "tenantId": null
    }
  ],
  "total": 1,
  "start": 0,
  "sort": "id",
  "order": "asc",
  "size": 1
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_获取一个部署_get_a_deployment">15.2.2. 获取一个部署 Get a deployment</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/deployments/{deploymentId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 13. 获取一个部署 - URL参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取的部署的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 14. 获取一个部署 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到并返回部署。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的部署。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "id": "10",
  "name": "activiti-examples.bar",
  "deploymentTime": "2010-10-13T14:54:26.750+02:00",
  "category": "examples",
  "url": "http://localhost:8081/service/repository/deployments/10",
  "tenantId" : null
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_创建一个新部署_create_a_new_deployment">15.2.3. 创建一个新部署 Create a new deployment</h4>
<div class="listingblock">
<div class="content">
<pre>POST repository/deployments</pre>
</div>
</div>
<div class="paragraph">
<p><strong>请求体：</strong></p>
</div>
<div class="paragraph">
<p>请求体需要包含<em>multipart/form-data</em>类型的数据。请求中需要只有一个文件，多余的文件将被忽略。部署名是传入的文件字段的名字。如果要在一个部署中部署多个资源，需要将资源压缩为zip文件，并确保文件名以<code>.bar</code>或<code>.zip</code>结尾。</p>
</div>
<div class="paragraph">
<p>可以在请求体中传递名为<code>tenantId</code>的额外参数（表单字段）。这个字段的值将指定部署所在的租户（tenant）的id。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 15. 创建一个新部署 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表成功创建部署</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求体中没有内容，或部署不支持content的mime-type。状态描述中包含了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "id": "10",
  "name": "activiti-examples.bar",
  "deploymentTime": "2010-10-13T14:54:26.750+02:00",
  "category": null,
  "url": "http://localhost:8081/service/repository/deployments/10",
  "tenantId" : "myTenant"
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_删除一个部署_delete_a_deployment">15.2.4. 删除一个部署 Delete a deployment</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE repository/deployments/{deploymentId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 16. 删除一个部署 - URL参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要删除的部署的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 17. 删除一个部署 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到并删除了部署。响应体设置为空。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的部署。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_列表一个部署中的资源_list_resources_in_a_deployment">15.2.5. 列表一个部署中的资源 List resources in a deployment</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/deployments/{deploymentId}/resources</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 18. 列表一个部署中的资源 - URL参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取资源的部署的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 19. 列表一个部署中的资源 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到部署，并已返回资源的列表。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的部署。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
  {
    "id": "diagrams/my-process.bpmn20.xml",
    "url": "http://localhost:8081/activiti-rest/service/repository/deployments/10/resources/diagrams%2Fmy-process.bpmn20.xml",
    "contentUrl": "http://localhost:8081/activiti-rest/service/repository/deployments/10/resourcedata/diagrams%2Fmy-process.bpmn20.xml",
    "mediaType": "text/xml",
    "type": "processDefinition"
  },
  {
    "id": "image.png",
    "url": "http://localhost:8081/activiti-rest/service/repository/deployments/10/resources/image.png",
    "contentUrl": "http://localhost:8081/activiti-rest/service/repository/deployments/10/resourcedata/image.png",
    "mediaType": "image/png",
    "type": "resource"
  }
]</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mediaType</code>: 包含了资源的媒体类型。使用（可插入的）<code>MediaTypeResolver</code>解析，默认包含有限数量的媒体类型映射。</p>
</li>
<li>
<p><code>type</code>: 资源的类型，可用值为：</p>
<div class="ulist">
<ul>
<li>
<p><code>resource</code>: 原始资源。</p>
</li>
<li>
<p><code>processDefinition</code>: 包含一个或多个流程定义的资源。通过部署器挑选。</p>
</li>
<li>
<p><code>processImage</code>: 代表流程定义的图形化输出的资源。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>结果JSON中的contentUrl参数包含了获取该二进制资源的实际URL。</em></p>
</div>
</div>
<div class="sect3">
<h4 id="_获取一个部署资源_get_a_deployment_resource">15.2.6. 获取一个部署资源 Get a deployment resource</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/deployments/{deploymentId}/resources/{resourceId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 20. 获取一个部署资源 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">请求的资源所在的部署的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resourceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取的资源的id。<strong>请确保如果包含斜线符，需要对resourceId进行URL编码。例如，使用&#8217;diagrams%2Fmy-process.bpmn20.xml&#8217;代替&#8217;diagrams/Fmy-process.bpmn20.xml'。</strong></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 21. 获取一个部署资源 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到部署与资源，并已返回资源。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的部署，或者该部署中没有给定id的资源。状态描述包含了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "id": "diagrams/my-process.bpmn20.xml",
  "url": "http://localhost:8081/activiti-rest/service/repository/deployments/10/resources/diagrams%2Fmy-process.bpmn20.xml",
  "dataUrl": "http://localhost:8081/activiti-rest/service/repository/deployments/10/resourcedata/diagrams%2Fmy-process.bpmn20.xml",
  "mediaType": "text/xml",
  "type": "processDefinition"
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mediaType</code>: 包含了资源的媒体类型。使用（可插入的）<code>MediaTypeResolver</code>解析，默认包含有限数量的媒体类型映射。</p>
</li>
<li>
<p><code>type</code>: 资源的类型，可用值为：</p>
<div class="ulist">
<ul>
<li>
<p><code>resource</code>: 原始资源。</p>
</li>
<li>
<p><code>processDefinition</code>: 包含一个或多个流程定义的资源。通过部署器挑选。</p>
</li>
<li>
<p><code>processImage</code>: 代表流程定义的图形化输出的资源。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_获取一个部署资源的内容_get_a_deployment_resource_content">15.2.7. 获取一个部署资源的内容 Get a deployment resource content</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/deployments/{deploymentId}/resourcedata/{resourceId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 22. 获取一个部署资源的内容 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">请求的资源所在的部署的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resourceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取的资源的id。<strong>请确保如果包含斜线符，需要对resourceId进行URL编码。例如，使用&#8217;diagrams%2Fmy-process.bpmn20.xml&#8217;代替&#8217;diagrams/Fmy-process.bpmn20.xml'。</strong></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 23. 获取一个部署资源的内容 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到部署与资源，并已返回资源。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的部署，或者该部署中没有给定id的资源。状态描述包含了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="paragraph">
<p>响应体将包含所请求资源的二进制资源内容。响应的content-type与资源&#8217;mimeType&#8217;参数返回的类型相同。同时将设置content-disposition头，让浏览器可以下载文件而不是直接显示。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_流程定义_process_definitions">15.3. 流程定义 Process Definitions</h3>
<div class="sect3">
<h4 id="_流程定义的列表_list_of_process_definitions">15.3.1. 流程定义的列表 List of process definitions</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/process-definitions</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 24. 流程定义的列表 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定版本的流程定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定名字的流程定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回名字like给定名字的流程定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定key的流程定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">keyLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回key like给定key的流程定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resourceName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定资源名的流程定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resourceNameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回资源名like给定资源名的流程定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">category</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定分类的流程定义</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">categoryLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回分类名like给定名字的流程定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">categoryNotEquals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回不是给定分类的流程定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定id的部署中的流程定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">startableByUser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定用户可以启动的流程定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">latest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回流程定义的最新版本。只能与&#8217;key&#8217;及&#8217;keyLike&#8217;参数一起使用，同时使用任何其它参数都将导致400响应。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">suspended</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果值为<code>true</code>，则只返回暂停的流程定义。如果为值为<code>false</code>，则只返回活动的流程定义（未暂停的）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>name</em>（默认）, <em>id</em>, <em>key</em>, <em>category</em>, <em>deploymentId&#8217;与&#8217;version</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于排序的参数，与&#8217;order&#8217;一起使用。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>可以在这个URL中使用通用<a href="#restPagingAndSort">分页与排序查询参数</a>。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 25. 流程定义的列表 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求成功，并已返回流程定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表某个参数格式错误，或者&#8217;latest&#8217;与&#8217;key', 'keyLike&#8217;以外的其他参数一起使用。状态描述中包含了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": [
    {
      "id" : "oneTaskProcess:1:4",
      "url" : "http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4",
      "version" : 1,
      "key" : "oneTaskProcess",
      "category" : "Examples",
      "suspended" : false,
      "name" : "The One Task Process",
      "description" : "This is a process for testing purposes",
      "deploymentId" : "2",
      "deploymentUrl" : "http://localhost:8081/repository/deployments/2",
      "graphicalNotationDefined" : true,
      "resource" : "http://localhost:8182/repository/deployments/2/resources/testProcess.xml",
      "diagramResource" : "http://localhost:8182/repository/deployments/2/resources/testProcess.png",
      "startFormDefined" : false
    }
  ],
  "total": 1,
  "start": 0,
  "sort": "name",
  "order": "asc",
  "size": 1
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>graphicalNotationDefined</code>: 代表流程定义中包含有图形信息（BPMN DI）。</p>
</li>
<li>
<p><code>resource</code>: 包含实际部署的BPMN 2.0 XML。</p>
</li>
<li>
<p><code>diagramResource</code>: 包含流程的图形化表示。如果没有可用流程图则为null。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_获取一个流程定义">15.3.2. 获取一个流程定义</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/process-definitions/{processDefinitionId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 26. 获取一个流程定义 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取的流程定义的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 27. 获取一个流程定义 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到并已返回流程定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的流程定义。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "id" : "oneTaskProcess:1:4",
  "url" : "http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4",
  "version" : 1,
  "key" : "oneTaskProcess",
  "category" : "Examples",
  "suspended" : false,
  "name" : "The One Task Process",
  "description" : "This is a process for testing purposes",
  "deploymentId" : "2",
  "deploymentUrl" : "http://localhost:8081/repository/deployments/2",
  "graphicalNotationDefined" : true,
  "resource" : "http://localhost:8182/repository/deployments/2/resources/testProcess.xml",
  "diagramResource" : "http://localhost:8182/repository/deployments/2/resources/testProcess.png",
  "startFormDefined" : false
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>graphicalNotationDefined</code>: 代表流程定义中包含有图形信息（BPMN DI）。</p>
</li>
<li>
<p><code>resource</code>: 包含实际部署的BPMN 2.0 XML。</p>
</li>
<li>
<p><code>diagramResource</code>: 包含流程的图形化表示。如果没有可用流程图则为null。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_更新一个流程定义的分类_update_category_for_a_process_definition">15.3.3. 更新一个流程定义的分类 Update category for a process definition</h4>
<div class="listingblock">
<div class="content">
<pre>PUT repository/process-definitions/{processDefinitionId}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>JSON体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "category" : "updatedcategory"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 28. 更新一个流程定义的分类 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已修改流程的分类。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求体中未定义分类。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的流程定义。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong>参见<code>repository/process-definitions/{processDefinitionId}</code>的响应。</p>
</div>
</div>
<div class="sect3">
<h4 id="_获取一个流程定义资源的内容_get_a_process_definition_resource_content">15.3.4. 获取一个流程定义资源的内容 Get a process definition resource content</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/process-definitions/{processDefinitionId}/resourcedata</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 29. 获取一个流程定义资源的内容 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取资源的流程定义的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>响应：</strong></p>
</div>
<div class="paragraph">
<p>与<code>GET repository/deployment/{deploymentId}/resourcedata/{resourceId}</code>完全一样的响应码/响应体。</p>
</div>
</div>
<div class="sect3">
<h4 id="_获取一个流程定义的bpmn模型_get_a_process_definition_bpmn_model">15.3.5. 获取一个流程定义的BPMN模型 Get a process definition BPMN model</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/process-definitions/{processDefinitionId}/model</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 30. 获取一个流程定义的BPMN模型 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取模型的流程定义的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 31. 获取一个流程定义的BPMN模型 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到流程定义，并已返回模型。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的流程定义。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>响应体：</strong>响应体是一个代表了<code>org.activiti.bpmn.model.BpmnModel</code>的JSON，包含所有流程定义模型。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "processes":[
      {
         "id":"oneTaskProcess",
         "xmlRowNumber":7,
         "xmlColumnNumber":60,
         "extensionElements":{

         },
         "name":"The One Task Process",
         "executable":true,
         "documentation":"One task process description",

    ]
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_暂停一个流程定义_suspend_a_process_definition">15.3.6. 暂停一个流程定义 Suspend a process definition</h4>
<div class="listingblock">
<div class="content">
<pre>PUT repository/process-definitions/{processDefinitionId}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>JSON体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "action" : "suspend",
  "includeProcessInstances" : "false",
  "date" : "2013-04-15T00:42:12Z"
}</code></pre>
</div>
</div>
<table id="processDefinitionActionBodyParameters" class="tableblock frame-all grid-all spread">
<caption class="title">Table 32. 暂停一个流程定义 - JSON体参数</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必填</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">action</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要进行的操作，<code>activate</code>或<code>suspend</code>。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeProcessInstances</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否同时暂停/激活该流程定义的运行中流程实例。如果省略，则流程实例保持原有状态。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要进行暂停/激活操作的日期（ISO-8601）。如果省略，则暂停/激活立刻生效。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 33. 暂停一个流程定义 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已暂停流程。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的流程定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求的流程定义之前已经暂停。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong>参见<code>repository/process-definitions/{processDefinitionId}</code>的响应</p>
</div>
</div>
<div class="sect3">
<h4 id="_激活一个流程定义_activate_a_process_definition">15.3.7. 激活一个流程定义 Activate a process definition</h4>
<div class="listingblock">
<div class="content">
<pre>PUT repository/process-definitions/{processDefinitionId}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>JSON体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "action" : "activate",
  "includeProcessInstances" : "true",
  "date" : "2013-04-15T00:42:12Z"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>参见暂停流程定义的<a href="#processDefinitionActionBodyParameters">JSON体参数</a>。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 34. 激活一个流程定义 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已激活流程。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的流程定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求的流程定义之前已经激活。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong>参见<code>repository/process-definitions/{processDefinitionId}</code>的响应</p>
</div>
</div>
<div class="sect3">
<h4 id="_获取一个流程定义的所有候选启动者_get_all_candidate_starters_for_a_process_definition">15.3.8. 获取一个流程定义的所有候选启动者 Get all candidate starters for a process-definition</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/process-definitions/{processDefinitionId}/identitylinks</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 35. 获取一个流程定义的所有候选启动者 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取身份关联的流程定义的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 36. 获取一个流程定义的所有候选启动者 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到流程定义，并已返回请求的身份关联。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的流程定义。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
   {
      "url":"http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4/identitylinks/groups/admin",
      "user":null,
      "group":"admin",
      "type":"candidate"
   },
   {
      "url":"http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4/identitylinks/users/kermit",
      "user":"kermit",
      "group":null,
      "type":"candidate"
   }
]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_为一个流程定义添加一个候选启动者_add_a_candidate_starter_to_a_process_definition">15.3.9. 为一个流程定义添加一个候选启动者 Add a candidate starter to a process definition</h4>
<div class="listingblock">
<div class="content">
<pre>POST repository/process-definitions/{processDefinitionId}/identitylinks</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 37. 为一个流程定义添加一个候选启动者 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程定义的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>请求体（用户）：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "user" : "kermit"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>请求体（组）：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "group" : "sales"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 38. 为一个流程定义添加一个候选启动者 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到流程定义，并已添加身份关联。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的流程定义。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "url":"http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4/identitylinks/users/kermit",
  "user":"kermit",
  "group":null,
  "type":"candidate"
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_从一个流程定义中删除一个候选启动者_delete_a_candidate_starter_from_a_process_definition">15.3.10. 从一个流程定义中删除一个候选启动者 Delete a candidate starter from a process definition</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE repository/process-definitions/{processDefinitionId}/identitylinks/{family}/{identityId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 39. 从一个流程定义中删除一个候选启动者 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程定义的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">family</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">为<code>users</code>或<code>groups</code>，取决于身份关联的类型。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">identityId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要从候选启动者中移除的用户或组。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 40. 从一个流程定义中删除一个候选启动者 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到流程定义，并已移除该身份关联。响应体设置为空。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的流程定义，或者流程定义中并没有匹配url的身份关联。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "url":"http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4/identitylinks/users/kermit",
  "user":"kermit",
  "group":null,
  "type":"candidate"
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_从一个流程定义中获取一个候选启动者_get_a_candidate_starter_from_a_process_definition">15.3.11. 从一个流程定义中获取一个候选启动者 Get a candidate starter from a process definition</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/process-definitions/{processDefinitionId}/identitylinks/{family}/{identityId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 41. 从一个流程定义中获取一个候选启动者 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程定义的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">family</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">为<code>users</code>或<code>groups</code>，取决于身份关联的类型。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">identityId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">作为候选启动者的用户或组。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 42. 从一个流程定义中获取一个候选启动者 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到流程定义，并已返回身份关联。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的流程定义，或者流程定义中并没有匹配url的身份关联。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "url":"http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4/identitylinks/users/kermit",
  "user":"kermit",
  "group":null,
  "type":"candidate"
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_模型_models">15.4. 模型 Models</h3>
<div class="sect3">
<h4 id="_获取模型的列表_get_a_list_of_models">15.4.1. 获取模型的列表 Get a list of models</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/models</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 43. 获取模型的列表 - URL 查询参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定id的模型。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">category</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定分类的模型。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">categoryLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回分类like给定值的模型。使用<code>%</code>字符作为通配符。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">categoryNotEquals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回不是给定分类的模型。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定名字的模型。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回名字like给定值的模型。使用<code>%</code>字符作为通配符。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定key的模型。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回在给定部署中部署的模型。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定版本的模型。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">latestVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果值为<code>true</code>，则只返回最新版本的模型。最好与<code>key</code>联合使用。如果值为<code>false</code>，忽略本参数，返回所有版本。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果值为<code>true</code>，只返回已部署的模型。如果值为<code>false</code>，只返回未部署的模型（deploymentId为null）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定tenantId的模型。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回tenantId like给定值的模型。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果值为<code>true</code>，则只返回没有设置tenantId的模型。如果值为<code>false</code>，则忽略<code>withoutTenantId</code>参数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>id</em>（默认）, <em>category</em>, <em>createTime</em>, <em>key</em>, <em>lastUpdateTime</em>, <em>name</em>, <em>version&#8217;或&#8217;tenantId</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于排序的参数，与&#8217;order&#8217;一起使用。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>可以在这个URL中使用通用<a href="#restPagingAndSort">分页与排序查询参数</a>。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 44. 获取模型的列表 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表查询成功，并已返回模型。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表传递的参数格式错误。状态描述中包含了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "data":[
      {
         "name":"Model name",
         "key":"Model key",
         "category":"Model category",
         "version":2,
         "metaInfo":"Model metainfo",
         "deploymentId":"7",
         "id":"10",
         "url":"http://localhost:8182/repository/models/10",
         "createTime":"2013-06-12T14:31:08.612+0000",
         "lastUpdateTime":"2013-06-12T14:31:08.612+0000",
         "deploymentUrl":"http://localhost:8182/repository/deployments/7",
         "tenantId":null
      },

      ...

   ],
   "total":2,
   "start":0,
   "sort":"id",
   "order":"asc",
   "size":2
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_获取一个模型_get_a_model">15.4.2. 获取一个模型 Get a model</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/models/{modelId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 45. 获取一个模型 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取的模型的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 46. 获取一个模型 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到并返回模型。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的模型。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "id":"5",
   "url":"http://localhost:8182/repository/models/5",
   "name":"Model name",
   "key":"Model key",
   "category":"Model category",
   "version":2,
   "metaInfo":"Model metainfo",
   "deploymentId":"2",
   "deploymentUrl":"http://localhost:8182/repository/deployments/2",
   "createTime":"2013-06-12T12:31:19.861+0000",
   "lastUpdateTime":"2013-06-12T12:31:19.861+0000",
   "tenantId":null
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_更新一个模型_update_a_model">15.4.3. 更新一个模型 Update a model</h4>
<div class="listingblock">
<div class="content">
<pre>PUT repository/models/{modelId}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>请求体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "name":"Model name",
   "key":"Model key",
   "category":"Model category",
   "version":2,
   "metaInfo":"Model metainfo",
   "deploymentId":"2",
   "tenantId":"updatedTenant"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>所有的请求值都是可选的。例如，可以只在请求体的JSON对象中包含&#8217;name&#8217;属性，则只更新模型的名字，而不影响其它任何字段。若明确包含了一个属性，并设置为null，则模型值将更新为null。例如：<code>{"metaInfo" : null}</code>将清空模型的metaInfo。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 47. 更新一个模型 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到并更新了模型。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的模型。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "id":"5",
   "url":"http://localhost:8182/repository/models/5",
   "name":"Model name",
   "key":"Model key",
   "category":"Model category",
   "version":2,
   "metaInfo":"Model metainfo",
   "deploymentId":"2",
   "deploymentUrl":"http://localhost:8182/repository/deployments/2",
   "createTime":"2013-06-12T12:31:19.861+0000",
   "lastUpdateTime":"2013-06-12T12:31:19.861+0000",
   "tenantId":"updatedTenant"
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_创建一个模型_create_a_model">15.4.4. 创建一个模型 Create a model</h4>
<div class="listingblock">
<div class="content">
<pre>POST repository/models</pre>
</div>
</div>
<div class="paragraph">
<p><strong>请求体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "name":"Model name",
   "key":"Model key",
   "category":"Model category",
   "version":1,
   "metaInfo":"Model metainfo",
   "deploymentId":"2",
   "tenantId":"tenant"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>所有的请求值都是可选的。例如，可以只在请求体的JSON对象中包含&#8217;name&#8217;属性，则只设置模型的名字，其它所有字段都为null。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 48. 创建一个模型 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已创建模型。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "id":"5",
   "url":"http://localhost:8182/repository/models/5",
   "name":"Model name",
   "key":"Model key",
   "category":"Model category",
   "version":1,
   "metaInfo":"Model metainfo",
   "deploymentId":"2",
   "deploymentUrl":"http://localhost:8182/repository/deployments/2",
   "createTime":"2013-06-12T12:31:19.861+0000",
   "lastUpdateTime":"2013-06-12T12:31:19.861+0000",
   "tenantId":"tenant"
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_删除一个模型_delete_a_model">15.4.5. 删除一个模型 Delete a model</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE repository/models/{modelId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 49. 删除一个模型 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要删除的模型的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 50. 删除一个模型 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到并删除了模型。响应体设置为空。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的模型。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_获取一个模型的编辑器源码_get_the_editor_source_for_a_model">15.4.6. 获取一个模型的编辑器源码 Get the editor source for a model</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/models/{modelId}/source</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 51. 获取一个模型的编辑器源码 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">模型的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 52. 获取一个模型的编辑器源码 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到模型，并已返回源码。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的模型。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong>响应体包含了模型的原始编辑器源码。无论源码的content是什么，响应的content-type都设置为<code>application/octet-stream</code>。</p>
</div>
</div>
<div class="sect3">
<h4 id="_设置一个模型的编辑器源码_set_the_editor_source_for_a_model">15.4.7. 设置一个模型的编辑器源码 Set the editor source for a model</h4>
<div class="listingblock">
<div class="content">
<pre>PUT repository/models/{modelId}/source</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 53. 设置一个模型的编辑器源码 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">模型的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>请求体：</strong></p>
</div>
<div class="paragraph">
<p>请求需要是<code>multipart/form-data</code>类型的。需要有唯一的file-part，包含源码的二进制值。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 54. 设置一个模型的编辑器源码 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到模型，并已更新源码。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的模型。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong>响应体包含了模型的原始编辑器源码。无论源码的content是什么，响应的content-type都设置为<code>application/octet-stream</code>。</p>
</div>
</div>
<div class="sect3">
<h4 id="_获取一个模型的附加编辑器源码_get_the_extra_editor_source_for_a_model">15.4.8. 获取一个模型的附加编辑器源码 Get the extra editor source for a model</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/models/{modelId}/source-extra</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 55. 获取一个模型的附加编辑器源码 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">模型的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 56. 获取一个模型的附加编辑器源码 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到模型，并已返回源码。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的模型。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong>响应体包含了模型的原始编辑器源码。无论源码的content是什么，响应的content-type都设置为<code>application/octet-stream</code>。</p>
</div>
</div>
<div class="sect3">
<h4 id="_设置一个模型的附加编辑器源码_set_the_extra_editor_source_for_a_model">15.4.9. 设置一个模型的附加编辑器源码 Set the extra editor source for a model</h4>
<div class="listingblock">
<div class="content">
<pre>PUT repository/models/{modelId}/source-extra</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 57. 设置一个模型的附加编辑器源码 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">模型的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>请求体：</strong></p>
</div>
<div class="paragraph">
<p>请求需要是<code>multipart/form-data</code>类型的。需要有唯一的file-part，包含源码的二进制值。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 58. 设置一个模型的附加编辑器源码 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到模型，并已更新附加源码。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的模型。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong>响应体包含了模型的原始编辑器源码。无论源码的content是什么，响应的content-type都设置为<code>application/octet-stream</code>。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_流程实例_process_instances">15.5. 流程实例 Process Instances</h3>
<div class="sect3">
<h4 id="_获取一个流程实例_get_a_process_instance">15.5.1. 获取一个流程实例 Get a process instance</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/process-instances/{processInstanceId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 59. 获取一个流程实例 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取的流程实例的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 60. 获取一个流程实例 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到并已返回流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的流程实例。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "id":"7",
   "url":"http://localhost:8182/runtime/process-instances/7",
   "businessKey":"myBusinessKey",
   "suspended":false,
   "processDefinitionUrl":"http://localhost:8182/repository/process-definitions/processOne%3A1%3A4",
   "activityId":"processTask",
   "tenantId": null
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_删除一个流程实例_delete_a_process_instance">15.5.2. 删除一个流程实例 Delete a process instance</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE runtime/process-instances/{processInstanceId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 61. 删除一个流程实例 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要删除的流程实例的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 62. 删除一个流程实例 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到并删除了流程实例。响应体设置为空</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的流程实例。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_激活或暂停一个流程实例_activate_or_suspend_a_process_instance">15.5.3. 激活或暂停一个流程实例 Activate or suspend a process instance</h4>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/process-instances/{processInstanceId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 63. 激活或暂停一个流程实例 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要激活/暂停的流程实例的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>请求体（暂停）：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "action":"suspend"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>请求体（激活）：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "action":"activate"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 64. 激活或暂停一个流程实例 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到流程实例，并执行了操作。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表提供了非法的操作。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求的流程实例操作无法执行，因为流程实例之前已经激活/暂停了。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_启动一个流程实例_start_a_process_instance">15.5.4. 启动一个流程实例 Start a process instance</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/process-instances</pre>
</div>
</div>
<div class="paragraph">
<p><strong>请求体（通过流程定义id启动）：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "processDefinitionId":"oneTaskProcess:1:158",
   "businessKey":"myBusinessKey",
   "variables": [
      {
        "name":"myVar",
        "value":"This is a variable",
      }
   ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>请求体（通过流程定义key启动）：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "processDefinitionKey":"oneTaskProcess",
   "businessKey":"myBusinessKey",
   "tenantId": "tenant1",
   "variables": [
      {
        "name":"myVar",
        "value":"This is a variable",
      }
   ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>请求体（通过消息启动）：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "message":"newOrderMessage",
   "businessKey":"myBusinessKey",
   "tenantId": "tenant1",
   "variables": [
      {
        "name":"myVar",
        "value":"This is a variable",
      }
   ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>请求体中只能使用<code>processDefinitionId</code>、<code>processDefinitionKey</code>与<code>message</code>中的一个。<code>businessKey</code>、<code>variables</code>与<code>tenantId</code>参数是可选的。如果省略了<code>tenantId</code>，则将使用默认租户。关于变量格式的更多信息可以在<a href="#restVariables">REST变量章节</a>找到。请注意提供的变量范围将被忽略，流程变量总是<code>local</code>的。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 65. 启动一个流程实例 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已创建流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表（通过id或key）未找到流程定义，或者发送给定消息并未启动流程，或者传递了不合法的变量。状态描述中包含了关于错误的额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "id":"7",
   "url":"http://localhost:8182/runtime/process-instances/7",
   "businessKey":"myBusinessKey",
   "suspended":false,
   "processDefinitionUrl":"http://localhost:8182/repository/process-definitions/processOne%3A1%3A4",
   "activityId":"processTask",
   "tenantId" : null
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="restProcessInstancesGet">15.5.5. 流程实例的列表 List of process instances</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/process-instances</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 66. 流程实例的列表 - URL 查询参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定id的流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定流程定义key的流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定流程定义id的流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">businessKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定businessKey的流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">involvedUser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定用户参与的流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">suspended</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果值为<code>true</code>，则只返回暂停的流程实例。如果值为<code>false</code>，则只返回未暂停（激活）的流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">superProcessInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定父流程实例id的流程实例（使用调用活动的流程）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">subProcessInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定子流程实例id的流程实例（通过调用活动启动的流程）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludeSubprocesses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回不是子流程的流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeProcessVariables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否在结果中包含流程变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定tenantId的流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回tenantId like给定值的流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果值为<code>true</code>，则只返回没有设置tenantId的流程实例。如果值为<code>false</code>，则忽略<code>withoutTenantId</code>参数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">排序字段，需要是<code>id</code>（默认）, <code>processDefinitionId</code>, <code>tenantId</code>或<code>processDefinitionKey</code>中的一个。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>可以在这个URL中使用通用<a href="#restPagingAndSort">分页与排序查询参数</a>。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 67. 流程实例的列表 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求成功，并已返回流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表传递的参数格式错误。状态描述中包含了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "data":[
      {
         "id":"7",
         "url":"http://localhost:8182/runtime/process-instances/7",
         "businessKey":"myBusinessKey",
         "suspended":false,
         "processDefinitionUrl":"http://localhost:8182/repository/process-definitions/processOne%3A1%3A4",
         "activityId":"processTask",
         "tenantId" : null
      }


   ],
   "total":2,
   "start":0,
   "sort":"id",
   "order":"asc",
   "size":2
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_查询流程实例_query_process_instances">15.5.6. 查询流程实例 Query process instances</h4>
<div class="listingblock">
<div class="content">
<pre>POST query/process-instances</pre>
</div>
</div>
<div class="paragraph">
<p><strong>请求体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "processDefinitionKey":"oneTaskProcess",
  "variables":
  [
    {
        "name" : "myVariable",
        "value" : 1234,
        "operation" : "equals",
        "type" : "long"
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>请求体可以包含所有在<a href="#restProcessInstancesGet">流程实例的列表</a>URL查询中可用的过滤器。另外，也可以在查询中包含一个变量的数组，使用<a href="#restQueryVariable">这里描述</a>的格式。</p>
</div>
<div class="paragraph">
<p>可以在这个URL中使用通用<a href="#restPagingAndSort">分页与排序查询参数</a>。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 68. 查询流程实例 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求成功，并已返回流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表传递的参数格式错误。状态描述中包含了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "data":[
      {
         "id":"7",
         "url":"http://localhost:8182/runtime/process-instances/7",
         "businessKey":"myBusinessKey",
         "suspended":false,
         "processDefinitionUrl":"http://localhost:8182/repository/process-definitions/processOne%3A1%3A4",
         "activityId":"processTask",
         "tenantId" : null
      }


   ],
   "total":2,
   "start":0,
   "sort":"id",
   "order":"asc",
   "size":2
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_获取一个流程实例的流程图_get_diagram_for_a_process_instance">15.5.7. 获取一个流程实例的流程图 Get diagram for a process instance</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/process-instances/{processInstanceId}/diagram</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 69. 获取一个流程实例的流程图 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取流程图的流程实例的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 70. 获取一个流程实例的流程图 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到流程实例，并已返回流程图。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到请求的流程实例，但该流程未包含任何图形信息（BPMN：DI），因此不能创建流程图。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的流程实例。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "id":"7",
   "url":"http://localhost:8182/runtime/process-instances/7",
   "businessKey":"myBusinessKey",
   "suspended":false,
   "processDefinitionUrl":"http://localhost:8182/repository/process-definitions/processOne%3A1%3A4",
   "activityId":"processTask"
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_获取流程实例的参与人_get_involved_people_for_process_instance">15.5.8. 获取流程实例的参与人 Get involved people for process instance</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/process-instances/{processInstanceId}/identitylinks</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 71. 获取流程实例的参与人 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要查询关联的流程实例的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 72. 获取流程实例的参与人 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到流程实例，并已返回关联。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的流程实例。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
   {
      "url":"http://localhost:8182/runtime/process-instances/5/identitylinks/users/john/customType",
      "user":"john",
      "group":null,
      "type":"customType"
   },
   {
      "url":"http://localhost:8182/runtime/process-instances/5/identitylinks/users/paul/candidate",
      "user":"paul",
      "group":null,
      "type":"candidate"
   }
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意<code>group</code>永远为null，因为只有用户才能参与流程实例。</p>
</div>
</div>
<div class="sect3">
<h4 id="_为一个流程实例添加一个参与用户_add_an_involved_user_to_a_process_instance">15.5.9. 为一个流程实例添加一个参与用户 Add an involved user to a process instance</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/process-instances/{processInstanceId}/identitylinks</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 73. 为一个流程实例添加一个参与用户 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要添加关联的流程实例。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>请求体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "user":"kermit",
  "type":"participant"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>user</code>与<code>type</code>都是必填的。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 74. 为一个流程实例添加一个参与用户 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到流程实例，并已返回关联。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求体中未包含user或type。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的流程实例。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "url":"http://localhost:8182/runtime/process-instances/5/identitylinks/users/john/customType",
   "user":"john",
   "group":null,
   "type":"customType"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意<code>group</code>永远为null，因为只有用户才能参与流程实例。</p>
</div>
</div>
<div class="sect3">
<h4 id="_从一个流程实例中移除一个参与用户_remove_an_involved_user_to_from_process_instance">15.5.10. 从一个流程实例中移除一个参与用户 Remove an involved user to from process instance</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE runtime/process-instances/{processInstanceId}/identitylinks/users/{userId}/{type}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 75. 从一个流程实例中移除一个参与用户 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程实例的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要删除关联的用户的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要删除的关联的类型。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 76. 从一个流程实例中移除一个参与用户 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到流程实例，并已删除关联。响应体设置为空。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的流程实例，或者要删除的关联不存在。响应状态中包含了关于错误的额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "url":"http://localhost:8182/runtime/process-instances/5/identitylinks/users/john/customType",
   "user":"john",
   "group":null,
   "type":"customType"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意<code>group</code>永远为null，因为只有用户才能参与流程实例。</p>
</div>
</div>
<div class="sect3">
<h4 id="_一个流程实例的变量的列表_list_of_variables_for_a_process_instance">15.5.11. 一个流程实例的变量的列表 List of variables for a process instance</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/process-instances/{processInstanceId}/variables</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 77. 一个流程实例的变量的列表 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要列表变量的流程实例的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 78. 一个流程实例的变量的列表 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到流程实例，并已返回变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的流程实例。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
   {
      "name":"intProcVar",
      "type":"integer",
      "value":123,
      "scope":"local"
   },
   {
      "name":"byteArrayProcVar",
      "type":"binary",
      "value":null,
      "valueUrl":"http://localhost:8182/runtime/process-instances/5/variables/byteArrayProcVar/data",
      "scope":"local"
   }
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果变量是二进制变量或序列化值，则<code>valueUrl</code>指向获取原始值的URL。如果是一个简单变量，则在响应中显示值。请注意只会返回<code>local</code>范围的变量，因为流程实例变量没有<code>global</code>范围。</p>
</div>
</div>
<div class="sect3">
<h4 id="_获取一个流程实例的一个变量_get_a_variable_for_a_process_instance">15.5.12. 获取一个流程实例的一个变量 Get a variable for a process instance</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/process-instances/{processInstanceId}/variables/{variableName}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 79. 获取一个流程实例的一个变量 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取变量的流程实例的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取的变量的名字。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 80. 获取一个流程实例的一个变量 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到流程实例及变量，并已返回变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求体不完整，或者包含不合法值。状态描述中包含了关于错误的额外信息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的流程实例，或者流程实例中没有给定名字的变量。状态描述中包含了关于错误的额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">   {
      "name":"intProcVar",
      "type":"integer",
      "value":123,
      "scope":"local"
   }</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果变量是二进制变量或序列化值，则<code>valueUrl</code>指向获取原始值的URL。如果是一个简单变量，则在响应中显示值。请注意只会返回<code>local</code>范围的变量，因为流程实例变量没有<code>global</code>范围。</p>
</div>
</div>
<div class="sect3">
<h4 id="_为一个流程实例创建_或更新_变量_create_or_update_variables_on_a_process_instance">15.5.13. 为一个流程实例创建（或更新）变量 Create (or update) variables on a process instance</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/process-instances/{processInstanceId}/variables</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/process-instances/{processInstanceId}/variables</pre>
</div>
</div>
<div class="paragraph">
<p>当使用<code>POST</code>时，会创建所有传递的变量。如果流程实例中已经存在某个变量，则请求结果为错误（409 - 冲突）。当使用<code>PUT</code>时，会创建流程实例中不存在的变量；已存在变量的将会被覆盖，而没有错误。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 81. 为一个流程实例创建（或更新）变量 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要操作变量的流程实例的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>请求体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>[
   {
      "name":"intProcVar",
      "type":"integer",
      "value":123
   },

   ...
]</pre>
</div>
</div>
<div class="paragraph">
<p>请求体的数组中可以传递任意数量的变量。可以在<a href="#restVariables">REST变量章节</a>找到关于变量格式的更多信息。请注意范围将被忽略，流程实例中只能设置<code>local</code>变量。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 82. 为一个流程实例创建（或更新）变量 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到流程实例，并已创建变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求体不完整，或含有非法值。状态描述中包含了关于错误的额外信息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到流程实例，但其已包含了给定名字的变量（只在使用POST方法时抛出）。改用更新方法。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>[
   {
      "name":"intProcVar",
      "type":"integer",
      "value":123,
      "scope":"local"
   },

   ...

]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_为一个流程实例更新一个变量_update_a_single_variable_on_a_process_instance">15.5.14. 为一个流程实例更新一个变量 Update a single variable on a process instance</h4>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/process-instances/{processInstanceId}/variables/{variableName}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 83. 为一个流程实例更新一个变量 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要操作变量的流程实例的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要更新的变量的名字。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>请求体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json"> {
    "name":"intProcVar"
    "type":"integer"
    "value":123
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>请求体的数组中可以传递任意数量的变量。可以在<a href="#restVariables">REST变量章节</a>找到关于变量格式的更多信息。请注意范围将被忽略，流程实例中只能设置<code>local</code>变量。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 84. 为一个流程实例更新一个变量 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到流程实例与变量，并已更新变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的流程实例，或者流程实例中没有给定名字的变量。状态描述中包含了关于错误的额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "name":"intProcVar",
  "type":"integer",
  "value":123,
  "scope":"local"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果变量是二进制变量或序列化值，则<code>valueUrl</code>指向获取原始值的URL。如果是一个简单变量，则在响应中显示值。请注意只会返回<code>local</code>范围的变量，因为流程实例变量没有<code>global</code>范围。</p>
</div>
</div>
<div class="sect3">
<h4 id="_为一个流程实例创建一个新的二进制变量_create_a_new_binary_variable_on_a_process_instance">15.5.15. 为一个流程实例创建一个新的二进制变量 Create a new binary variable on a process-instance</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/process-instances/{processInstanceId}/variables</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 85. 为一个流程实例创建一个新的二进制变量 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要创建新变量的流程实例的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>请求体：</strong>请求需要是<code>multipart/form-data</code>类型的。需要有唯一的file-part，包含变量的二进制值。另外，也可以使用下列额外的form-fields：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: 变量需要的名字。</p>
</li>
<li>
<p><code>type</code>: 创建的变量的类型。如果省略，则使用<code>binary</code>，并且将请求中的二进制数据保存为字节数组。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "name" : "binaryVariable",
  "scope" : "local",
  "type" : "binary",
  "value" : null,
  "valueUrl" : "http://.../runtime/process-instances/123/variables/binaryVariable/data"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 86. 为一个流程实例创建一个新的二进制变量 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已创建变量，并已返回结果。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表缺少要创建的变量的名字。状态消息提供了额外信息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表流程实例中已经有给定名字的变量。改用PUT方法更新任务变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">415</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表序列化数据中包含了一个运行Activiti引擎的JVM中不存在的类的对象，因此不能反序列化。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_为一个流程实例更新一个已有的二进制变量_update_an_existing_binary_variable_on_a_process_instance">15.5.16. 为一个流程实例更新一个已有的二进制变量 Update an existing binary variable on a process-instance</h4>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/process-instances/{processInstanceId}/variables</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 87. 为一个流程实例更新一个已有的二进制变量 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要更新变量的流程实例的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>请求体：</strong>请求需要是<code>multipart/form-data</code>类型的。需要有唯一的file-part，包含变量的二进制值。另外，也可以使用下列额外的form-fields：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: 变量需要的名字。</p>
</li>
<li>
<p><code>type</code>: 创建的变量的类型。如果省略，则使用<code>binary</code>，并且将请求中的二进制数据保存为字节数组。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "name" : "binaryVariable",
  "scope" : "local",
  "type" : "binary",
  "value" : null,
  "valueUrl" : "http://.../runtime/process-instances/123/variables/binaryVariable/data"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 88. 为一个流程实例更新一个已有的二进制变量 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已更新变量，并已返回结果。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表缺少要更新的变量的名字。状态消息提供了额外信息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的流程实例，或者流程实例中没有给定名字的变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">415</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表序列化数据中包含了一个运行Activiti引擎的JVM中不存在的类的对象，因此不能反序列化。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_执行_executions">15.6. 执行 Executions</h3>
<div class="sect3">
<h4 id="_获取一个执行_get_an_execution">15.6.1. 获取一个执行 Get an execution</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/executions/{executionId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 89. 获取一个执行 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取的执行的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 90. 获取一个执行 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到并返回执行。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到执行</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "id":"5",
   "url":"http://localhost:8182/runtime/executions/5",
   "parentId":null,
   "parentUrl":null,
   "processInstanceId":"5",
   "processInstanceUrl":"http://localhost:8182/runtime/process-instances/5",
   "suspended":false,
   "activityId":null,
   "tenantId": null
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_对一个执行进行操作_execute_an_action_on_an_execution">15.6.2. 对一个执行进行操作 Execute an action on an execution</h4>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/executions/{executionId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 91. 对一个执行进行操作 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要进行操作的执行的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>请求体（为一个执行发信号）：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "action":"signal"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>请求体（为一个执行发信号接收事件）：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "action":"signalEventReceived",
  "signalName":"mySignal",
  "variables": [  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>通知执行：已经接收到了一个信号事件。要求有一个<code>signalName</code>参数。可以传递可选的<code>variables</code>，将在进行操作前设置到执行中。</p>
</div>
<div class="paragraph">
<p><strong>请求体（为一个执行发消息接收事件）：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "action":"messageEventReceived",
  "messageName":"myMessage",
  "variables": [  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>通知执行：已经接收到了一个消息事件。要求有一个<code>messageName</code>参数。可以传递可选的<code>variables</code>，将在进行操作前设置到执行中。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 92. 对一个执行进行操作 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到执行，并进行了操作。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到执行，进行了操作，该操作导致执行结束。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求了非法的操作，请求中缺少必要的参数，或者传递了非法的变量。状态描述中包含了关于错误的额外信息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到执行</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体（当执行并未因该操作结束时）：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "id":"5",
   "url":"http://localhost:8182/runtime/executions/5",
   "parentId":null,
   "parentUrl":null,
   "processInstanceId":"5",
   "processInstanceUrl":"http://localhost:8182/runtime/process-instances/5",
   "suspended":false,
   "activityId":null,
   "tenantId" : null
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_获取一个执行中的激活活动_get_active_activities_in_an_execution">15.6.3. 获取一个执行中的激活活动 Get active activities in an execution</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/executions/{executionId}/activities</pre>
</div>
</div>
<div class="paragraph">
<p>返回执行中与所有子执行中（以及它们的子执行，递归）激活的所有活动。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 93. 获取一个执行中的激活活动 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取活动的执行的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 94. 获取一个执行中的激活活动 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到执行，并已返回活动。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到执行</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
  "userTaskForManager",
  "receiveTask"
]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="restExecutionsGet">15.6.4. 执行的列表 List of executions</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/executions</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 95. 执行的列表 - URL 查询参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定id的执行。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">activityId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定activity id的执行。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定流程定义key的执行。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定流程定义id的执行。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定流程实例中的执行。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">messageEventSubscriptionName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回订阅了给定名字的消息的执行。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">signalEventSubscriptionName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回订阅了给定名字的信号的执行。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定执行的直接子执行。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定tenantId的执行。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回tenantId like给定值的执行。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果值为<code>true</code>，则只返回未设置tenantId的执行。如果值为<code>false</code>，则忽略<code>withoutTenantId</code>参数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">排序字段，需要为<code>processInstanceId</code>（默认）, <code>processDefinitionId</code>, <code>processDefinitionKey</code>或<code>tenantId</code>。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>可以在这个URL中使用通用<a href="#restPagingAndSort">分页与排序查询参数</a>。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 96. 执行的列表 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求成功，并已返回执行。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表传递的参数格式错误。状态描述中包含了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "data":[
      {
         "id":"5",
         "url":"http://localhost:8182/runtime/executions/5",
         "parentId":null,
         "parentUrl":null,
         "processInstanceId":"5",
         "processInstanceUrl":"http://localhost:8182/runtime/process-instances/5",
         "suspended":false,
         "activityId":null,
         "tenantId":null
      },
      {
         "id":"7",
         "url":"http://localhost:8182/runtime/executions/7",
         "parentId":"5",
         "parentUrl":"http://localhost:8182/runtime/executions/5",
         "processInstanceId":"5",
         "processInstanceUrl":"http://localhost:8182/runtime/process-instances/5",
         "suspended":false,
         "activityId":"processTask",
         "tenantId":null
      }
   ],
   "total":2,
   "start":0,
   "sort":"processInstanceId",
   "order":"asc",
   "size":2
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_查询执行_query_executions">15.6.5. 查询执行 Query executions</h4>
<div class="listingblock">
<div class="content">
<pre>POST query/executions</pre>
</div>
</div>
<div class="paragraph">
<p><strong>请求体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "processDefinitionKey":"oneTaskProcess",
  "variables":
  [
    {
        "name" : "myVariable",
        "value" : 1234,
        "operation" : "equals",
        "type" : "long"
    }
  ],
  "processInstanceVariables":
  [
    {
        "name" : "processVariable",
        "value" : "some string",
        "operation" : "equals",
        "type" : "string"
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>请求体可以包含所有在<a href="#restExecutionsGet">列表执行</a>URL查询中可用的过滤器。另外，也可以在查询中包含一个<code>variables</code>与<code>processInstanceVariables</code>的数组，使用<a href="#restQueryVariable">这里描述</a>的格式。</p>
</div>
<div class="paragraph">
<p>可以在这个URL中使用通用<a href="#restPagingAndSort">分页与排序查询参数</a>。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 97. 查询执行 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求成功，并已返回执行。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表传递的参数格式错误 . 状态描述中包含了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "data":[
      {
         "id":"5",
         "url":"http://localhost:8182/runtime/executions/5",
         "parentId":null,
         "parentUrl":null,
         "processInstanceId":"5",
         "processInstanceUrl":"http://localhost:8182/runtime/process-instances/5",
         "suspended":false,
         "activityId":null,
         "tenantId":null
      },
      {
         "id":"7",
         "url":"http://localhost:8182/runtime/executions/7",
         "parentId":"5",
         "parentUrl":"http://localhost:8182/runtime/executions/5",
         "processInstanceId":"5",
         "processInstanceUrl":"http://localhost:8182/runtime/process-instances/5",
         "suspended":false,
         "activityId":"processTask",
         "tenantId":null
      }
   ],
   "total":2,
   "start":0,
   "sort":"processInstanceId",
   "order":"asc",
   "size":2
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_一个执行中的变量的列表_list_of_variables_for_an_execution">15.6.6. 一个执行中的变量的列表 List of variables for an execution</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/executions/{executionId}/variables?scope={scope}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 98. 一个执行中的变量的列表 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要列表变量的执行的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可以为<code>local</code>或<code>global</code>。若省略，则同时返回本地与全局范围的变量。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 99. 一个执行中的变量的列表 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到执行，并已返回变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的执行。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
   {
      "name":"intProcVar",
      "type":"integer",
      "value":123,
      "scope":"global"
   },
   {
      "name":"byteArrayProcVar",
      "type":"binary",
      "value":null,
      "valueUrl":"http://localhost:8182/runtime/process-instances/5/variables/byteArrayProcVar/data",
      "scope":"local"
   }


]</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果变量是二进制变量或序列化值，则<code>valueUrl</code>指向获取原始值的URL。如果是一个简单变量，则在响应中显示值。</p>
</div>
</div>
<div class="sect3">
<h4 id="_获取一个执行的一个变量_get_a_variable_for_an_execution">15.6.7. 获取一个执行的一个变量 Get a variable for an execution</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/executions/{executionId}/variables/{variableName}?scope={scope}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 100. 获取一个执行的一个变量 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取变量的执行的id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取的变量的名字。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>local</code>或<code>global</code>。若省略，则（存在时）返回本地变量。不存在本地变量时，则（存在时）返回全局变量。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 101. 获取一个执行的一个变量 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到执行与变量，并已返回变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求体不完整，或者包含不合法值。状态描述中包含了关于错误的额外信息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的执行，或者在请求的范围内执行没有给定名字的变量（若省略了范围查询条件，则本地与全局范围中都没有该变量）。状态描述中包含了关于错误的额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">   {
      "name":"intProcVar",
      "type":"integer",
      "value":123,
      "scope":"local"
   }</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果变量是二进制变量或序列化值，则<code>valueUrl</code>指向获取原始值的URL。如果是一个简单变量，则在响应中显示值。</p>
</div>
</div>
<div class="sect3">
<h4 id="_为一个执行创建_或更新_变量_create_or_update_variables_on_an_execution">15.6.8. 为一个执行创建（或更新）变量 Create (or update) variables on an execution</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/executions/{executionId}/variables</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/executions/{executionId}/variables</pre>
</div>
</div>
<div class="paragraph">
<p>当使用<code>POST</code>时，会创建所有传递的变量。如果执行中已经存在某个变量，则请求结果为错误（409 - 冲突）。当使用<code>PUT</code>时，会创建执行中不存在的变量；已存在变量的将会被覆盖，而没有错误。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 102. 为一个执行创建（或更新）变量 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要操作变量的执行的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>请求体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
   {
      "name":"intProcVar",
      "type":"integer",
      "value":123,
      "scope":"local"
   }



]</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>请注意只能提供相同范围的变量。如果请求体数组中包含了不同范围的变量，则请求结果为错误（400 - 错误请求）。</strong>请求体的数组中可以传递任意数量的变量。可以在<a href="#restVariables">REST变量章节</a>找到关于变量格式的更多信息。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 103. 为一个执行创建（或更新）变量 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到执行，并已创建变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求体不完整，或者包含不合法值。状态描述中包含了关于错误的额外信息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的执行。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到执行，但其已包含了给定名字的变量（只在使用POST方法时抛出）。改用更新方法。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
   {
      "name":"intProcVar",
      "type":"integer",
      "value":123,
      "scope":"local"
   }



]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_为一个执行更新一个变量_update_a_variable_on_an_execution">15.6.9. 为一个执行更新一个变量 Update a variable on an execution</h4>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/executions/{executionId}/variables/{variableName}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 104. 为一个执行更新一个变量 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要更新变量的执行的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要更新的变量的名字。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>请求体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json"> {
    "name":"intProcVar"
    "type":"integer"
    "value":123,
    "scope":"global"
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以在<a href="#restVariables">REST变量章节</a>找到关于变量格式的更多信息。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 105. 为一个执行更新一个变量 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到执行与变量，并已更新变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的执行，或者执行没有给定名字的变量。状态描述中包含了关于错误的额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">   {
      "name":"intProcVar",
      "type":"integer",
      "value":123,
      "scope":"global"
   }</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果变量是二进制变量或序列化值，则<code>valueUrl</code>指向获取原始值的URL。如果是一个简单变量，则在响应中显示值。</p>
</div>
</div>
<div class="sect3">
<h4 id="_为一个执行创建一个新的二进制变量_create_a_new_binary_variable_on_an_execution">15.6.10. 为一个执行创建一个新的二进制变量 Create a new binary variable on an execution</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/executions/{executionId}/variables</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 106. 为一个执行创建一个新的二进制变量 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要创建新变量的执行的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>请求体：</strong>请求需要是<code>multipart/form-data</code>类型的。需要有唯一的file-part，包含变量的二进制值。另外，也可以使用下列额外的form-fields：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: 变量需要的名字。</p>
</li>
<li>
<p><code>type</code>: 创建的变量的类型。如果省略，则使用<code>binary</code>，并且将请求中的二进制数据保存为字节数组。</p>
</li>
<li>
<p><code>scope</code>: 创建变量的范围。如果省略，则使用<code>local</code>。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "name" : "binaryVariable",
  "scope" : "local",
  "type" : "binary",
  "value" : null,
  "valueUrl" : "http://.../runtime/executions/123/variables/binaryVariable/data"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 107. 为一个执行创建一个新的二进制变量 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已创建变量，并已返回结果。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表缺少要创建的变量的名字。状态消息提供了额外信息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的执行。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表执行已包含了给定名字的变量（只在使用POST方法时抛出）。改用PUT方法更新变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">415</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表序列化数据中包含了一个运行Activiti引擎的JVM中不存在的类的对象，因此不能反序列化。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_为一个执行更新一个已有二进制变量_update_an_existing_binary_variable_on_a_process_instance">15.6.11. 为一个执行更新一个已有二进制变量 Update an existing binary variable on a process-instance</h4>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/executions/{executionId}/variables/{variableName}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 108. 为一个执行更新一个已有二进制变量 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要更新变量的执行的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要更新的变量的名字。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>请求体：</strong>请求需要是<code>multipart/form-data</code>类型的。需要有唯一的file-part，包含变量的二进制值。另外，也可以使用下列额外的form-fields：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: 变量需要的名字。</p>
</li>
<li>
<p><code>type</code>: 创建的变量的类型。如果省略，则使用<code>binary</code>，并且将请求中的二进制数据保存为字节数组。</p>
</li>
<li>
<p><code>scope</code>: 创建变量的范围。如果省略，则使用<code>local</code>。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "name" : "binaryVariable",
  "scope" : "local",
  "type" : "binary",
  "value" : null,
  "valueUrl" : "http://.../runtime/executions/123/variables/binaryVariable/data"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 109. 为一个执行更新一个已有二进制变量 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已更新变量，并已返回结果。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表缺少要更新的变量的名字。状态消息提供了额外信息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的执行，或者执行中没有给定名字的变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">415</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表序列化数据中包含了一个运行Activiti引擎的JVM中不存在的类的对象，因此不能反序列化。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_任务_tasks_2">15.7. 任务 Tasks</h3>
<div class="sect3">
<h4 id="_获取一个任务_get_a_task">15.7.1. 获取一个任务 Get a task</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 110. 获取一个任务 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取的任务的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 111. 获取一个任务 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到并返回了任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "assignee" : "kermit",
  "createTime" : "2013-04-17T10:17:43.902+0000",
  "delegationState" : "pending",
  "description" : "Task description",
  "dueDate" : "2013-04-17T10:17:43.902+0000",
  "executionUrl" : "http://localhost:8182/runtime/executions/5",
  "executionId" : "5",
  "id" : "8",
  "name" : "My task",
  "owner" : "owner",
  "parentTaskUrl" : "http://localhost:8182/runtime/tasks/9",
  "parentTaskId" : "9",
  "priority" : 50,
  "processDefinitionUrl" : "http://localhost:8182/repository/process-definitions/oneTaskPr
ocess%3A1%3A4",
  "processDefinitionId" : "oneTaskProcess%3A1%3A4",
  "processInstanceUrl" : "http://localhost:8182/runtime/process-instances/5",
  "processInstanceId" : "5",
  "suspended" : false,
  "formKey" : null,
  "category": "examples",
  "taskDefinitionKey" : "theTask",
  "url" : "http://localhost:8182/runtime/tasks/8",
  "tenantId" : null
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>delegationState</code>: 任务的代理状态，可以为<code>null</code>、<code>"pending"</code>或<code>"resolved"</code>。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="restTasksGet">15.7.2. 任务的列表 List of tasks</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 112. 任务的列表 - URL 查询参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定名字的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回名字like给定名字的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定描述的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">priority</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定优先级的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">minimumPriority</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回优先级高于给定值的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maximumPriority</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回优先级低于给定值的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">assignee</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回指派至给定用户的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">assigneeLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回办理人like给定值的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">owner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回属主为给定用户的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ownerLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回属主like给定值的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unassigned</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回未指派的任务。如果传递<code>false</code>，则忽略本参数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">delegationState</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定代理状态的任务。可用值为<code>pending</code>与<code>resolved</code>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">candidateUser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回可以被给定用户申领的任务。包括用户为候选人，以及用户所在组为候选组的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">candidateGroup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回可以被给定组中的用户申领的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">candidateGroups</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回可以被给定组中的用户申领的任务。逗号分隔值。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">involvedUser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定用户参与的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskDefinitionKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定任务定义id的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskDefinitionKeyLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回任务定义id like给定值的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定id流程实例中的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceBusinessKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定businessKey流程实例中的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceBusinessKeyLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回businessKey like给定值的流程实例中的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定id的流程定义的流程实例中的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定key的流程定义的流程实例中的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionKeyLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回key like给定值的流程定义的流程实例中的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定名字的流程定义的流程实例中的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionNameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回名字like给定值的流程定义的流程实例中的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定id的执行中的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">createdOn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定日期创建的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">createdBefore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定日期之前创建的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">createdAfter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定日期之后创建的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dueOn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定日期到期的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dueBefore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定日期前到期的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dueAfter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定日期后到期的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutDueDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回没有到期日期的任务。如果值为<code>false</code>则忽略本参数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludeSubTasks</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回不是另一个任务的子任务的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">active</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果值为<code>true</code>，则只返回未暂停（要么所在流程未暂停，要么根本不在流程中）的任务。如果值为false，则只返回已暂停流程实例中的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeTaskLocalVariables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否在结果中包含本地变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeProcessVariables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否在结果中包含流程变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定tenantId的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回tenantId like给定值的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果值为<code>true</code>，则只返回未设置tenantId的任务。如果值为<code>false</code>，则忽略<code>withoutTenantId</code>参数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">candidateOrAssigned</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">选择已被申领，或已指派给用户，或等待用户（候选用户或组）申领的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">category</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">选择给定分类的任务。请注意这是任务的分类，而不是流程定义的分类（即BPMN Xml内的namespace）。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>可以在这个URL中使用通用<a href="#restPagingAndSort">分页与排序查询参数</a>。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 113. 任务的列表 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求成功，并已返回任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表传递的参数格式错误，或&#8217;delegationState&#8217;使用了不合法的值（不是&#8217;pending&#8217;与&#8217;resolved'）。状态描述中包含了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": [
    {
      "assignee" : "kermit",
      "createTime" : "2013-04-17T10:17:43.902+0000",
      "delegationState" : "pending",
      "description" : "Task description",
      "dueDate" : "2013-04-17T10:17:43.902+0000",
      "executionUrl" : "http://localhost:8182/runtime/executions/5",
      "executionId" : "5",
      "id" : "8",
      "name" : "My task",
      "owner" : "owner",
      "parentTaskUrl" : "http://localhost:8182/runtime/tasks/9",
      "parentTaskId" : "9",
      "priority" : 50,
      "processDefinitionUrl" : "http://localhost:8182/repository/process-definitions/oneTa
skProcess%3A1%3A4",
      "processDefinitionId" : "oneTaskProcess%3A1%3A4",
      "processInstanceUrl" : "http://localhost:8182/runtime/process-instances/5",
      "processInstanceId" : "5",
      "suspended" : false,
      "taskDefinitionKey" : "theTask",
      "url" : "http://localhost:8182/runtime/tasks/8",
      "formKey" : null,
      "category": "examples",
      "tenantId" : null
    }
  ],
  "total": 1,
  "start": 0,
  "sort": "name",
  "order": "asc",
  "size": 1
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_查询任务_query_for_tasks">15.7.3. 查询任务 Query for tasks</h4>
<div class="listingblock">
<div class="content">
<pre>POST query/tasks</pre>
</div>
</div>
<div class="paragraph">
<p><strong>请求体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "name" : "My task",
  "description" : "The task description",

  ...

  "taskVariables" : [
    {
      "name" : "myVariable",
      "value" : 1234,
      "operation" : "equals",
      "type" : "long"
    }
  ],

    "processInstanceVariables" : [
      {
         ...
      }
    ]
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>支持的JSON参数字段与<a href="#restTasksGet">获取任务集合</a>的参数一模一样（除了candidateGroupIn，只能在POST任务查询REST服务中使用），但是使用JSON体参数而不是URL参数，可以进行更高级的查询，也可以避免请求URI太长的错误。另外，查询可以通过任务与流程变量进行过滤。<code>taskVariables</code>与<code>processInstanceVariables</code>都是JSON数组，包含<a href="#restQueryVariable">这里描述</a>的格式的对象。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 114. 查询任务 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求成功，并已返回任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表传递的参数格式错误，或&#8217;delegationState&#8217;使用了不合法的值（不是&#8217;pending&#8217;与&#8217;resolved'）。状态描述中包含了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": [
    {
      "assignee" : "kermit",
      "createTime" : "2013-04-17T10:17:43.902+0000",
      "delegationState" : "pending",
      "description" : "Task description",
      "dueDate" : "2013-04-17T10:17:43.902+0000",
      "executionUrl" : "http://localhost:8182/runtime/executions/5",
      "executionId" : "5",
      "id" : "8",
      "name" : "My task",
      "owner" : "owner",
      "parentTaskUrl" : "http://localhost:8182/runtime/tasks/9",
      "parentTaskId" : "9",
      "priority" : 50,
      "processDefinitionUrl" : "http://localhost:8182/repository/process-definitions/oneTa
skProcess%3A1%3A4",
      "processDefinitionId" : "oneTaskProcess%3A1%3A4",
      "processInstanceUrl" : "http://localhost:8182/runtime/process-instances/5",
      "processInstanceId" : "5",
      "suspended" : false,
      "taskDefinitionKey" : "theTask",
      "url" : "http://localhost:8182/runtime/tasks/8",
      "formKey" : null,
      "category": "examples",
      "tenantId" : null
    }
  ],
  "total": 1,
  "start": 0,
  "sort": "name",
  "order": "asc",
  "size": 1
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_更新一个任务_update_a_task">15.7.4. 更新一个任务 Update a task</h4>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/tasks/{taskId}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>JSON体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "assignee" : "assignee",
  "delegationState" : "resolved",
  "description" : "New task description",
  "dueDate" : "2013-04-17T13:06:02.438+02:00",
  "name" : "New task name",
  "owner" : "owner",
  "parentTaskId" : "3",
  "priority" : 20
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>所有的请求值都是可选的。例如，可以只在请求体的JSON对象中包含&#8217;assignee&#8217;属性，则只更新任务的办理人，而不影响其它任何字段。若明确包含了一个属性，并设置为null，则任务值将更新为null。例如：<code>{"dueDate" : null}</code>将清空任务的到期日期。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 115. 更新一个任务 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表任务已被更新。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求的任务已经被并发同时更新。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong>参见<code>runtime/tasks/{taskId}</code>的响应。</p>
</div>
</div>
<div class="sect3">
<h4 id="_任务操作_task_actions">15.7.5. 任务操作 Task actions</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/tasks/{taskId}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>完成一个任务 - JSON 体:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "action" : "complete",
  "variables" : []
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>完成任务。可以使用<code>variables</code>参数传递可选的变量数组。可以在<a href="#restVariables">REST变量章节</a>找到关于变量格式的更多信息。请注意提供的变量范围将被忽略，变量将设置在父范围中，除非一个本地范围中存在该变量。这种情况下将会覆盖。与<code>TaskService.completeTask(taskId, variables)</code>调用的行为相同。</p>
</div>
<div class="paragraph">
<p><strong>申领一个任务 - JSON 体:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "action" : "claim",
  "assignee" : "userWhoClaims"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用给定办理人申领任务。如果办理人为<code>null</code>，则取消任务的指派，可以重新申领。</p>
</div>
<div class="paragraph">
<p><strong>代理一个任务 - JSON 体:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "action" : "delegate",
  "assignee" : "userToDelegateTo"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>将任务代理给给定办理人。办理人为必填。</p>
</div>
<div class="paragraph">
<p><strong>解决一个任务 - JSON 体:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "action" : "resolve"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>解决任务代理。任务指派回任务的属主（若有）。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 116. 任务操作 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已执行操作。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求体包含非法值，或者当操作需要时没有提供办理人。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表操作由于冲突无法执行。任务已被并发同时更新，或者在进行'<code>claim</code>'操作时，任务已被其他用户申领。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong>参见<code>runtime/tasks/{taskId}</code>的响应。</p>
</div>
</div>
<div class="sect3">
<h4 id="_删除一个任务_delete_a_task">15.7.6. 删除一个任务 Delete a task</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE runtime/tasks/{taskId}?cascadeHistory={cascadeHistory}&amp;deleteReason={deleteReason}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 117. 删除一个任务 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要删除的任务的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cascadeHistory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否在删除任务时，删除历史任务实例（如果可用）。如果未设置，则默认值为false。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deleteReason</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任务删除的原因。如果<code>cascadeHistory</code>值为true，则忽略本参数。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 118. 删除一个任务 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到并删除任务。响应体设置为空。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">403</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表由于请求的任务是工作流的一部分，无法删除。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_获取一个任务的所有变量_get_all_variables_for_a_task">15.7.7. 获取一个任务的所有变量 Get all variables for a task</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/variables?scope={scope}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 119. 获取一个任务的所有变量 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取变量的任务的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要返回的变量的范围。若值为'<code>local</code><em>，则只返回任务本地变量。若值为</em><code>global</code>'，则只返回任务的父执行树中的变量。若省略该参数，则本地与全局变量都会返回。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 120. 获取一个任务的所有变量 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到任务，并已返回请求的变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
  {
    "name" : "doubleTaskVar",
    "scope" : "local",
    "type" : "double",
    "value" : 99.99
  },
  {
    "name" : "stringProcVar",
    "scope" : "global",
    "type" : "string",
    "value" : "This is a ProcVariable"
  }



]</code></pre>
</div>
</div>
<div class="paragraph">
<p>变量作为一个JSON数组返回。在通用<a href="#restVariables">REST变量章节</a>中可以找到全部响应体的描述。</p>
</div>
</div>
<div class="sect3">
<h4 id="_从一个任务中获取一个变量_get_a_variable_from_a_task">15.7.8. 从一个任务中获取一个变量 Get a variable from a task</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/variables/{variableName}?scope={scope}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 121. 从一个任务中获取一个变量 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取变量的任务的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取的变量的名字。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要返回的变量的范围。若值为'<code>local</code><em>，则只返回任务本地变量。若值为</em><code>global</code>'，则只返回任务的父执行树中的变量。若省略该参数，如果存在本地变量就会返回，否则返回全局变量。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 122. 从一个任务中获取一个变量 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到任务，并已返回请求的变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务，或者任务（在给定范围中）没有给定名字的变量。状态消息提供了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "name" : "myTaskVariable",
  "scope" : "local",
  "type" : "string",
  "value" : "Hello my friend"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在通用<a href="#restVariables">REST变量章节</a>中可以找到全部响应体的描述。</p>
</div>
</div>
<div class="sect3">
<h4 id="_获取一个变量的二进制数据_get_the_binary_data_for_a_variable">15.7.9. 获取一个变量的二进制数据 Get the binary data for a variable</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/variables/{variableName}/data?scope={scope}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 123. 获取一个变量的二进制数据 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取变量的任务的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取数据的变量的名字。只能使用<code>binary</code>与<code>serializable</code>类型的变量。如果使用其它任何类型的变量，将返回<code>404</code>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要返回的变量的范围。若值为'<code>local</code><em>，则只返回任务本地变量。若值为</em><code>global</code>'，则只返回任务的父执行树中的变量。若省略该参数，如果存在本地变量就会返回，否则返回全局变量。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 124. 获取一个变量的二进制数据 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到任务，并已返回请求的变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务，或者任务（在给定范围中）没有给定名字的变量，或者变量没有可用的二进制流。状态消息提供了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong>响应体包含了变量的二进制值。如果变量是<code>binary</code>类型，则不论变量的content或者请求的accept-type头是什么，响应的content-type都将设置为<code>application/octet-stream</code>。如果变量是<code>serializable</code>类型，则content-type会使用<code>application/x-java-serialized-object</code>。</p>
</div>
</div>
<div class="sect3">
<h4 id="_为一个任务创建_或更新_变量_create_or_update_variables_on_a_task">15.7.10. 为一个任务创建（或更新）变量 Create (or update) variables on a task</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/tasks/{taskId}/variables</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/tasks/{taskId}/variables</pre>
</div>
</div>
<div class="paragraph">
<p>使用<code>POST</code>时，将创建所有传递的变量。如果其中有已经在任务中存在的变量，则请求结果为错误（409 - 冲突）。而在使用<code>PUT</code>时，会为任务创建不存在的变量，而已经存在的变量将被更新，不会报错。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 125. 为一个任务创建（或更新）变量 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要创建新变量的任务的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>创建简单（非二进制）变量的请求体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
  {
    "name" : "myTaskVariable",
    "scope" : "local",
    "type" : "string",
    "value" : "Hello my friend"
  },
  {

  }
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>请求体需要是一个数组，包含有一个或多个代表要创建的变量的JSON对象</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: 变量需要的名字。</p>
</li>
<li>
<p><code>scope</code>: 创建变量的范围。如果省略，则使用<code>local</code>。</p>
</li>
<li>
<p><code>type</code>: 创建的变量的类型。如果省略，则转换为原始JSON值的类型（string、boolean、integer或double）。</p>
</li>
<li>
<p><code>value</code>: 变量值。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>可以在<a href="#restVariables">REST变量章节</a>找到关于变量格式的更多信息。</p>
</div>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
  {
    "name" : "myTaskVariable",
    "scope" : "local",
    "type" : "string",
    "value" : "Hello my friend"
  },
  {

  }
]</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 126. 为一个任务创建（或更新）变量 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已创建变量，并已返回结果。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表缺少要创建的变量名，或者尝试为独立任务（未关联至流程）创建<code>global</code>变量，或者请求中包含了空的变量数组，或者请求中没有包含变量数组。状态消息提供了额外信息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表任务中已有给定名字的变量（仅在使用POST方法时抛出）。改用PUT方法更新任务变量。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_为一个任务创建一个新的二进制变量_create_a_new_binary_variable_on_a_task">15.7.11. 为一个任务创建一个新的二进制变量 Create a new binary variable on a task</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/tasks/{taskId}/variables</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 127. 为一个任务创建一个新的二进制变量 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要创建新变量的任务的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>请求体：</strong>请求需要是<code>multipart/form-data</code>类型的。需要有唯一的file-part，包含变量的二进制值。另外，也可以使用下列额外的form-fields：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: 变量需要的名字。</p>
</li>
<li>
<p><code>scope</code>: 创建变量的范围。如果省略，则使用<code>local</code>。</p>
</li>
<li>
<p><code>type</code>: 创建的变量的类型。如果省略，则使用<code>binary</code>，并且将请求中的二进制数据保存为字节数组。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "name" : "binaryVariable",
  "scope" : "local",
  "type" : "binary",
  "value" : null,
  "valueUrl" : "http://.../runtime/tasks/123/variables/binaryVariable/data"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 128. 为一个任务创建一个新的二进制变量 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已创建变量，并已返回结果。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表缺少要创建的变量名，或者尝试为独立任务（未关联至流程）创建<code>global</code>变量。状态消息提供了额外信息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表任务中已有给定名字的变量。改用PUT方法更新任务变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">415</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表序列化数据中包含了一个运行Activiti引擎的JVM中不存在的类的对象，因此不能反序列化。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_为一个任务更新一个已有变量_update_an_existing_variable_on_a_task">15.7.12. 为一个任务更新一个已有变量 Update an existing variable on a task</h4>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/tasks/{taskId}/variables/{variableName}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 129. 为一个任务更新一个已有变量 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要更新变量的任务的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要更新的变量的名字。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>更新简单（非二进制）变量的请求体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "name" : "myTaskVariable",
  "scope" : "local",
  "type" : "string",
  "value" : "Hello my friend"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>请求体需要是一个数组，包含有一个或多个代表要创建的变量JSON对象</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: 变量需要的名字。</p>
</li>
<li>
<p><code>scope</code>: 创建变量的范围。如果省略，则使用<code>local</code>。</p>
</li>
<li>
<p><code>type</code>: 创建的变量的类型。如果省略，则转换为原始JSON值的类型（string、boolean、integer或double）。</p>
</li>
<li>
<p><code>value</code>: 变量值。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>可以在<a href="#restVariables">REST变量章节</a>找到关于变量格式的更多信息。</p>
</div>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "name" : "myTaskVariable",
  "scope" : "local",
  "type" : "string",
  "value" : "Hello my friend"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 130. 为一个任务更新一个已有变量 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已更新变量，并已返回结果。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表缺少要创建的变量名，或者尝试为独立任务（未关联至流程）创建<code>global</code>变量。状态消息提供了额外信息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务，或者任务在给定范围中没有给定名字的变量。状态消息提供了额外信息。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_为一个任务更新一个二进制变量_updating_a_binary_variable_on_a_task">15.7.13. 为一个任务更新一个二进制变量 Updating a binary variable on a task</h4>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/tasks/{taskId}/variables/{variableName}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 131. 为一个任务更新一个二进制变量 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要更新变量的任务的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要更新的变量的名字。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>请求体：</strong>请求需要是<code>multipart/form-data</code>类型的。需要有唯一的file-part，包含变量的二进制值。另外，也可以使用下列额外的form-fields：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: 变量需要的名字。</p>
</li>
<li>
<p><code>scope</code>: 创建变量的范围。如果省略，则使用<code>local</code>。</p>
</li>
<li>
<p><code>type</code>: 创建的变量的类型。如果省略，则使用<code>binary</code>，并且将请求中的二进制数据保存为字节数组。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "name" : "binaryVariable",
  "scope" : "local",
  "type" : "binary",
  "value" : null,
  "valueUrl" : "http://.../runtime/tasks/123/variables/binaryVariable/data"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 132. 为一个任务更新一个二进制变量 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已更新变量，并已返回结果。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表缺少要创建的变量名，或者尝试为独立任务（未关联至流程）创建<code>global</code>变量。状态消息提供了额外信息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务，或者任务在给定范围中没有给定名字的变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">415</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表序列化数据中包含了一个运行Activiti引擎的JVM中不存在的类的对象，因此不能反序列化。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_为一个任务删除一个变量_delete_a_variable_on_a_task">15.7.14. 为一个任务删除一个变量 Delete a variable on a task</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE runtime/tasks/{taskId}/variables/{variableName}?scope={scope}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 133. 为一个任务删除一个变量 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要删除的变量所在任务的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要删除的变量的名字。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要删除的变量所在的范围。可以为<code>local</code>或<code>global</code>。若省略，则使用<code>local</code>。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 134. 为一个任务删除一个变量 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到并删除任务变量。响应体设置为空。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务，或者任务在给定范围中没有给定名字的变量。状态消息提供了额外信息。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_为一个任务删除所有本地变量_delete_all_local_variables_on_a_task">15.7.15. 为一个任务删除所有本地变量 Delete all local variables on a task</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE runtime/tasks/{taskId}/variables</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 135. 为一个任务删除所有本地变量 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要删除的变量所在任务的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 136. 为一个任务删除所有本地变量 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已删除所有本地任务变量。响应体设置为空。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_获取一个任务的所有身份关联_get_all_identity_links_for_a_task">15.7.16. 获取一个任务的所有身份关联 Get all identity links for a task</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/identitylinks</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 137. 获取一个任务的所有身份关联 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取身份关联的任务的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 138. 获取一个任务的所有身份关联 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到任务，并已返回请求的身份关联。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
  {
    "user" : "kermit",
    "group" : null,
    "type" : "candidate",
    "url" : "http://localhost:8081/activiti-rest/service/runtime/tasks/100/identitylinks/users/kermit/candidate"
  },
  {
    "user" : null,
    "group" : "sales",
    "type" : "candidate",
    "url" : "http://localhost:8081/activiti-rest/service/runtime/tasks/100/identitylinks/groups/sales/candidate"
  },

  ...
]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_获取一个任务的组或用户的所有身份关联_get_all_identitylinks_for_a_task_for_either_groups_or_users">15.7.17. 获取一个任务的组或用户的所有身份关联 Get all identitylinks for a task for either groups or users</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/identitylinks/users
GET runtime/tasks/{taskId}/identitylinks/groups</pre>
</div>
</div>
<div class="paragraph">
<p>只返回目标为用户或组的身份关联。响应体及状态码与获取一个任务的完整身份关联列表时完全相同。</p>
</div>
</div>
<div class="sect3">
<h4 id="_获取一个任务的一个身份关联_get_a_single_identity_link_on_a_task">15.7.18. 获取一个任务的一个身份关联 Get a single identity link on a task</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/identitylinks/{family}/{identityId}/{type}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 139. 获取一个任务的一个身份关联 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任务的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">family</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可以为<code>groups</code>或<code>users</code>，取决于身份目标的类型。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">identityId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">身份的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">身份关联的类型。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 140. 获取一个任务的一个身份关联 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到任务及身份关联，并已返回。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务，或者任务中没有请求的身份关联。状态消息提供了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "user" : null,
  "group" : "sales",
  "type" : "candidate",
  "url" : "http://localhost:8081/activiti-rest/service/runtime/tasks/100/identitylinks/groups/sales/candidate"
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_为一个任务创建一个身份关联_create_an_identity_link_on_a_task">15.7.19. 为一个任务创建一个身份关联 Create an identity link on a task</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/tasks/{taskId}/identitylinks</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 141. 为一个任务创建一个身份关联 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任务的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>响应体（用户）：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "user" : "kermit",
  "type" : "candidate",
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>响应体（组）：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "group" : "sales",
  "type" : "candidate",
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 142. 为一个任务创建一个身份关联 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到任务，并已创建身份关联。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到任务，或任务中没有请求的身份关联。状态消息提供了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "user" : null,
  "group" : "sales",
  "type" : "candidate",
  "url" : "http://localhost:8081/activiti-rest/service/runtime/tasks/100/identitylinks/groups/sales/candidate"
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_为一个任务删除一个身份关联_delete_an_identity_link_on_a_task">15.7.20. 为一个任务删除一个身份关联 Delete an identity link on a task</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE runtime/tasks/{taskId}/identitylinks/{family}/{identityId}/{type}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 143. 为一个任务删除一个身份关联 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任务的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">family</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可以为<code>groups</code>或<code>users</code>，取决于身份目标的类型。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">identityId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">身份的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">身份关联的类型。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 144. 为一个任务删除一个身份关联 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到任务与身份关联，并已删除身份关联。响应体设置为空。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到任务，或任务中没有请求的身份关联。状态消息提供了额外信息。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_为一个任务创建一个新备注_create_a_new_comment_on_a_task">15.7.21. 为一个任务创建一个新备注 Create a new comment on a task</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/tasks/{taskId}/comments</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 145. 为一个任务创建一个新备注 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要创建备注的任务的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>请求体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "message" : "This is a comment on the task.",
  "saveProcessInstanceId" : true
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>参数<code>saveProcessInstanceId</code>是可选的，如果为<code>true</code>，则在备注中保存任务的流程实例id。</p>
</div>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "id" : "123",
  "taskUrl" : "http://localhost:8081/activiti-rest/service/runtime/tasks/101/comments/123",
  "processInstanceUrl" : "http://localhost:8081/activiti-rest/service/history/historic-process-instances/100/comments/123",
  "message" : "This is a comment on the task.",
  "author" : "kermit",
  "time" : "2014-07-13T13:13:52.232+08:00",
  "taskId" : "101",
  "processInstanceId" : "100"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 146. 为一个任务创建一个新备注 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已创建备注，并已返回结果。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求中缺少备注。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_获取一个任务的所有备注_get_all_comments_on_a_task">15.7.22. 获取一个任务的所有备注 Get all comments on a task</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/comments</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 147. 获取一个任务的所有备注 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取备注的任务的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
  {
    "id" : "123",
    "taskUrl" : "http://localhost:8081/activiti-rest/service/runtime/tasks/101/comments/123",
    "processInstanceUrl" : "http://localhost:8081/activiti-rest/service/history/historic-process-instances/100/comments/123",
    "message" : "This is a comment on the task.",
    "author" : "kermit",
    "time" : "2014-07-13T13:13:52.232+08:00",
    "taskId" : "101",
    "processInstanceId" : "100"
  },
  {
    "id" : "456",
    "taskUrl" : "http://localhost:8081/activiti-rest/service/runtime/tasks/101/comments/456",
    "processInstanceUrl" : "http://localhost:8081/activiti-rest/service/history/historic-process-instances/100/comments/456",
    "message" : "This is another comment on the task.",
    "author" : "gonzo",
    "time" : "2014-07-13T13:13:52.232+08:00",
    "taskId" : "101",
    "processInstanceId" : "100"
  }
]</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 148. 获取一个任务的所有备注 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到任务，并已返回备注。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_获取一个任务的一个备注_get_a_comment_on_a_task">15.7.23. 获取一个任务的一个备注 Get a comment on a task</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/comments/{commentId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 149. 获取一个任务的一个备注 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取备注的任务的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">commentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">备注的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "id" : "123",
  "taskUrl" : "http://localhost:8081/activiti-rest/service/runtime/tasks/101/comments/123",
  "processInstanceUrl" : "http://localhost:8081/activiti-rest/service/history/historic-process-instances/100/comments/123",
  "message" : "This is a comment on the task.",
  "author" : "kermit",
  "time" : "2014-07-13T13:13:52.232+08:00",
  "taskId" : "101",
  "processInstanceId" : "100"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 150. 获取一个任务的一个备注 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到任务与备注，并已返回备注。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务，或任务没有给定ID的备注。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_为一个任务删除一个备注_delete_a_comment_on_a_task">15.7.24. 为一个任务删除一个备注 Delete a comment on a task</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE runtime/tasks/{taskId}/comments/{commentId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 151. 为一个任务删除一个备注 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要删除备注的任务的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">commentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">备注的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 152. 为一个任务删除一个备注 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到任务与备注，并已删除备注。响应体设置为空。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务，或任务没有给定id的备注。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_获取一个任务的所有事件_get_all_events_for_a_task">15.7.25. 获取一个任务的所有事件 Get all events for a task</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/events</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 153. 获取一个任务的所有事件 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取事件的任务的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
  {
    "action" : "AddUserLink",
    "id" : "4",
    "message" : [ "gonzo", "contributor" ],
    "taskUrl" : "http://localhost:8182/runtime/tasks/2",
    "time" : "2013-05-17T11:50:50.000+0000",
    "url" : "http://localhost:8182/runtime/tasks/2/events/4",
    "userId" : null
  }

]</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 154. 获取一个任务的所有事件 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到任务，并已返回事件。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_获取一个任务的一个事件_get_an_event_on_a_task">15.7.26. 获取一个任务的一个事件 Get an event on a task</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/events/{eventId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 155. 获取一个任务的一个事件 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取事件的任务的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eventId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">事件的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "action" : "AddUserLink",
  "id" : "4",
  "message" : [ "gonzo", "contributor" ],
  "taskUrl" : "http://localhost:8182/runtime/tasks/2",
  "time" : "2013-05-17T11:50:50.000+0000",
  "url" : "http://localhost:8182/runtime/tasks/2/events/4",
  "userId" : null
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 156. 获取一个任务的一个事件 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到任务与事件，并已返回事件。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务，或者任务中没有给定ID的事件。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_为一个任务创建一个新的附件_带有一个指向外部资源的链接_create_a_new_attachment_on_a_task_containing_a_link_to_an_external_resource">15.7.27. 为一个任务创建一个新的附件，带有一个指向外部资源的链接 Create a new attachment on a task, containing a link to an external resource</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/tasks/{taskId}/attachments</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 157. 为一个任务创建一个新的附件，带有一个指向外部资源的链接 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要创建附件的任务的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>请求体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "name":"Simple attachment",
  "description":"Simple attachment description",
  "type":"simpleType",
  "externalUrl":"http://activiti.org"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>要创建一个新的附件，只有附件名是必填的。</p>
</div>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "id":"3",
  "url":"http://localhost:8182/runtime/tasks/2/attachments/3",
  "name":"Simple attachment",
  "description":"Simple attachment description",
  "type":"simpleType",
  "taskUrl":"http://localhost:8182/runtime/tasks/2",
  "processInstanceUrl":null,
  "externalUrl":"http://activiti.org",
  "contentUrl":null
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 158. 为一个任务创建一个新的附件，带有一个指向外部资源的链接 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已创建附件，并已返回结果。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求中缺少附件名。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_为一个任务创建一个新的附件_带有附加文件_create_a_new_attachment_on_a_task_with_an_attached_file">15.7.28. 为一个任务创建一个新的附件，带有附加文件 Create a new attachment on a task, with an attached file</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/tasks/{taskId}/attachments</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 159. 为一个任务创建一个新的附件，带有附加文件 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要创建附件的任务的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>请求体：</strong>请求需要是<code>multipart/form-data</code>类型的。需要有唯一的file-part，包含变量的二进制值。另外，也可以使用下列额外的form-fields：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: 附件需要的名字。</p>
</li>
<li>
<p><code>description</code>: 附件的描述，可选。</p>
</li>
<li>
<p><code>type</code>: 附件的类型，可选。支持任意字符串或合法的HTTP content-type。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
	"id":"5",
	"url":"http://localhost:8182/runtime/tasks/2/attachments/5",
    "name":"Binary attachment",
    "description":"Binary attachment description",
    "type":"binaryType",
    "taskUrl":"http://localhost:8182/runtime/tasks/2",
    "processInstanceUrl":null,
    "externalUrl":null,
    "contentUrl":"http://localhost:8182/runtime/tasks/2/attachments/5/content"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 160. 为一个任务创建一个新的附件，带有附加文件 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已创建附件，并已返回结果。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求中缺少附件名，或者请求中没有文件。错误消息中包含了额外信息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_获取一个任务的所有附件_get_all_attachments_on_a_task">15.7.29. 获取一个任务的所有附件 Get all attachments on a task</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/attachments</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 161. 获取一个任务的所有附件 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取附件的任务的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
  {
    "id":"3",
    "url":"http://localhost:8182/runtime/tasks/2/attachments/3",
    "name":"Simple attachment",
    "description":"Simple attachment description",
    "type":"simpleType",
    "taskUrl":"http://localhost:8182/runtime/tasks/2",
    "processInstanceUrl":null,
    "externalUrl":"http://activiti.org",
    "contentUrl":null
  },
  {
    "id":"5",
    "url":"http://localhost:8182/runtime/tasks/2/attachments/5",
    "name":"Binary attachment",
    "description":"Binary attachment description",
    "type":"binaryType",
    "taskUrl":"http://localhost:8182/runtime/tasks/2",
    "processInstanceUrl":null,
    "externalUrl":null,
    "contentUrl":"http://localhost:8182/runtime/tasks/2/attachments/5/content"
  }
]</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 162. 获取一个任务的所有附件 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到任务，并已返回附件。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_获取一个任务的一个附件_get_an_attachment_on_a_task">15.7.30. 获取一个任务的一个附件 Get an attachment on a task</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/attachments/{attachmentId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 163. 获取一个任务的一个附件 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取附件的任务的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">attachmentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">附件的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "id":"5",
  "url":"http://localhost:8182/runtime/tasks/2/attachments/5",
  "name":"Binary attachment",
  "description":"Binary attachment description",
  "type":"binaryType",
  "taskUrl":"http://localhost:8182/runtime/tasks/2",
  "processInstanceUrl":null,
  "externalUrl":null,
  "contentUrl":"http://localhost:8182/runtime/tasks/2/attachments/5/content"
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>externalUrl - contentUrl:</code> 如果附件为外部资源，则<code>externalUrl</code>中包含外部内容的URL。如果附件内容保存在Activiti引擎中，则<code>contentUrl</code>中将包含可以流式获取二进制内容的URL。</p>
</li>
<li>
<p><code>type:</code> 可以是任意值。如果包含了合法格式的media-type（例如application/xml、text/plain），则二进制内容的HTTP响应的content-type将设置为给定值。</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 164. 获取一个任务的一个附件 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到任务与附件，并已返回附件。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务，或任务中没有给定ID的附件。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_获取一个附件的内容_get_the_content_for_an_attachment">15.7.31. 获取一个附件的内容 Get the content for an attachment</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/attachment/{attachmentId}/content</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 165. 获取一个附件的内容 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取附件数据的任务的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">attachmentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">附件的id。如果附件指向外部URL而不是保存在Activiti内部，则将返回<code>404</code>。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 166. 获取一个附件的内容 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到任务与附件，并已返回请求的内容。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务，或者任务中没有给定id的附件，或者附件没有可用的二进制流。状态消息提供了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="paragraph">
<p>响应体包含了二进制内容。默认情况下，响应的content-type设置为<code>application/octet-stream</code>，除非附件类型包含了合法的content-type。</p>
</div>
</div>
<div class="sect3">
<h4 id="_为一个任务删除一个附件_delete_an_attachment_on_a_task">15.7.32. 为一个任务删除一个附件 Delete an attachment on a task</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE runtime/tasks/{taskId}/attachments/{attachmentId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 167. 为一个任务删除一个附件 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要删除附件的任务的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">attachmentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">附件的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 168. 为一个任务删除一个附件 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到任务与附件，并已删除附件。响应体设置为空。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务，或者任务中没有给定ID的附件。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_历史_history">15.8. 历史 History</h3>
<div class="sect3">
<h4 id="_获取一个历史流程实例_get_a_historic_process_instance">15.8.1. 获取一个历史流程实例 Get a historic process instance</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-process-instances/{processInstanceId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 169. 获取一个历史流程实例 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表可以找到历史流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表找不到历史流程实例。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": [
    {
      "id" : "5",
      "businessKey" : "myKey",
      "processDefinitionId" : "oneTaskProcess%3A1%3A4",
      "processDefinitionUrl" : "http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4",
      "startTime" : "2013-04-17T10:17:43.902+0000",
      "endTime" : "2013-04-18T14:06:32.715+0000",
      "durationInMillis" : 86400056,
      "startUserId" : "kermit",
      "startActivityId" : "startEvent",
      "endActivityId" : "endEvent",
      "deleteReason" : null,
      "superProcessInstanceId" : "3",
      "url" : "http://localhost:8182/history/historic-process-instances/5",
      "variables": null,
      "tenantId":null
    }
  ],
  "total": 1,
  "start": 0,
  "sort": "name",
  "order": "asc",
  "size": 1
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="restHistoricProcessInstancesGet">15.8.2. 历史流程实例的列表 List of historic process instances</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-process-instances</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 170. 历史流程实例的列表 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史流程实例的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史流程实例的流程定义key。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史流程实例的流程定义id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">businessKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史流程实例的businessKey。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">involvedUser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史流程实例的参与用户。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">finished</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史流程实例是否已结束。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">superProcessInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选的历史流程实例的父流程的id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludeSubprocesses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回不是子流程的历史流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">finishedAfter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回在该日期之后完成的历史流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">finishedBefore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回在该日期之前完成的历史流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">startedAfter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回在该日期之后启动的历史流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">startedBefore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回在该日期之前启动的历史流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">startedBy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回由该用户启动的历史流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeProcessVariables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否也返回历史流程实例变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定tenantId的实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回tenantId like给定值的实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果值为<code>true</code>，则只返回未设置tenantId的实例。如果值为<code>false</code>，则忽略<code>withoutTenantId</code>参数。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>可以在这个URL中使用通用<a href="#restPagingAndSort">分页与排序查询参数</a>。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 171. 历史流程实例的列表 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表可以查询历史流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表传递的某个参数格式错误。状态描述中包含了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": [
    {
      "id" : "5",
      "businessKey" : "myKey",
      "processDefinitionId" : "oneTaskProcess%3A1%3A4",
      "processDefinitionUrl" : "http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4",
      "startTime" : "2013-04-17T10:17:43.902+0000",
      "endTime" : "2013-04-18T14:06:32.715+0000",
      "durationInMillis" : 86400056,
      "startUserId" : "kermit",
      "startActivityId" : "startEvent",
      "endActivityId" : "endEvent",
      "deleteReason" : null,
      "superProcessInstanceId" : "3",
      "url" : "http://localhost:8182/history/historic-process-instances/5",
      "variables": [
        {
          "name": "test",
          "variableScope": "local",
          "value": "myTest"
        }
      ],
      "tenantId":null
    }
  ],
  "total": 1,
  "start": 0,
  "sort": "name",
  "order": "asc",
  "size": 1
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_查询历史流程实例_query_for_historic_process_instances">15.8.3. 查询历史流程实例 Query for historic process instances</h4>
<div class="listingblock">
<div class="content">
<pre>POST query/historic-process-instances</pre>
</div>
</div>
<div class="paragraph">
<p><strong>请求体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "processDefinitionId" : "oneTaskProcess%3A1%3A4",


  "variables" : [
    {
      "name" : "myVariable",
      "value" : 1234,
      "operation" : "equals",
      "type" : "long"
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>支持的JSON参数字段与<a href="#restHistoricProcessInstancesGet">获取历史流程实例集合</a>的参数一模一样，但是使用JSON体参数而不是URL参数，可以进行更高级的查询，也可以避免请求URI太长的错误。另外，查询可以通过流程变量进行过滤。<code>variables</code>参数是一个JSON数组，包含<a href="#restQueryVariable">这里描述</a>的格式的对象。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 172. 查询历史流程实例 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求成功，并已返回实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表传递的某个参数格式错误。状态描述中包含了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": [
    {
      "id" : "5",
      "businessKey" : "myKey",
      "processDefinitionId" : "oneTaskProcess%3A1%3A4",
      "processDefinitionUrl" : "http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4",
      "startTime" : "2013-04-17T10:17:43.902+0000",
      "endTime" : "2013-04-18T14:06:32.715+0000",
      "durationInMillis" : 86400056,
      "startUserId" : "kermit",
      "startActivityId" : "startEvent",
      "endActivityId" : "endEvent",
      "deleteReason" : null,
      "superProcessInstanceId" : "3",
      "url" : "http://localhost:8182/history/historic-process-instances/5",
      "variables": [
        {
          "name": "test",
          "variableScope": "local",
          "value": "myTest"
        }
      ],
      "tenantId":null
    }
  ],
  "total": 1,
  "start": 0,
  "sort": "name",
  "order": "asc",
  "size": 1
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_删除一个历史流程实例_delete_a_historic_process_instance">15.8.4. 删除一个历史流程实例 Delete a historic process instance</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE history/historic-process-instances/{processInstanceId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 173. 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已删除该历史流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到该历史流程实例。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_获取一个历史流程实例的身份关联_get_the_identity_links_of_a_historic_process_instance">15.8.5. 获取一个历史流程实例的身份关联 Get the identity links of a historic process instance</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-process-instance/{processInstanceId}/identitylinks</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 174. 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求成功，并已返回身份关联。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到流程实例。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
 {
  "type" : "participant",
  "user" : "kermit",
  "group" : null,
  "taskId" : null,
  "taskUrl" : null,
  "processInstanceId" : "5",
  "processInstanceUrl" : "http://localhost:8182/history/historic-process-instances/5"
 }
]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_获取一个历史流程实例变量的二进制数据_get_the_binary_data_for_a_historic_process_instance_variable">15.8.6. 获取一个历史流程实例变量的二进制数据 Get the binary data for a historic process instance variable</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-process-instances/{processInstanceId}/variables/{variableName}/data</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 175. 获取一个历史流程实例变量的二进制数据 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到流程实例，并已返回请求的变量数据。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的流程实例，或者流程实例中没有给定名字的变量，或者给定名字的变量没有可用的二进制流。状态消息提供了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="paragraph">
<p>响应体包含了变量的二进制值。如果变量是<code>binary</code>类型，则不论变量的content或者请求的accept-type头是什么，响应的content-type都将设置为<code>application/octet-stream</code>。如果变量是<code>serializable</code>类型，则content-type会使用<code>application/x-java-serialized-object</code>。</p>
</div>
</div>
<div class="sect3">
<h4 id="_为一个历史流程实例创建一个新的备注_create_a_new_comment_on_a_historic_process_instance">15.8.7. 为一个历史流程实例创建一个新的备注 Create a new comment on a historic process instance</h4>
<div class="listingblock">
<div class="content">
<pre>POST history/historic-process-instances/{processInstanceId}/comments</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 176. 为一个历史流程实例创建一个新的备注 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要创建备注的流程实例的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>请求体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "message" : "This is a comment.",
  "saveProcessInstanceId" : true
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>参数<code>saveProcessInstanceId</code>是可选的，如果为<code>true</code>，则在备注中保存任务的流程实例id。</p>
</div>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "id" : "123",
  "taskUrl" : "http://localhost:8081/activiti-rest/service/runtime/tasks/101/comments/123",
  "processInstanceUrl" : "http://localhost:8081/activiti-rest/service/history/historic-process-instances/100/comments/123",
  "message" : "This is a comment on the task.",
  "author" : "kermit",
  "time" : "2014-07-13T13:13:52.232+08:00",
  "taskId" : "101",
  "processInstanceId" : "100"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 177. 为一个历史流程实例创建一个新的备注 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已创建备注，并已返回结果。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求中缺少备注。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的历史流程实例。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_获取一个历史流程实例的所有备注_get_all_comments_on_a_historic_process_instance">15.8.8. 获取一个历史流程实例的所有备注 Get all comments on a historic process instance</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-process-instances/{processInstanceId}/comments</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 178. 获取一个历史流程实例的所有备注 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取备注的流程实例的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
  {
    "id" : "123",
    "processInstanceUrl" : "http://localhost:8081/activiti-rest/service/history/historic-process-instances/100/comments/123",
    "message" : "This is a comment on the task.",
    "author" : "kermit",
    "time" : "2014-07-13T13:13:52.232+08:00",
    "processInstanceId" : "100"
  },
  {
    "id" : "456",
    "processInstanceUrl" : "http://localhost:8081/activiti-rest/service/history/historic-process-instances/100/comments/456",
    "message" : "This is another comment.",
    "author" : "gonzo",
    "time" : "2014-07-14T15:16:52.232+08:00",
    "processInstanceId" : "100"
  }
]</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 179. 获取一个历史流程实例的所有备注 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到流程实例，并已返回备注。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_获取一个历史流程实例的一个备注_get_a_comment_on_a_historic_process_instance">15.8.9. 获取一个历史流程实例的一个备注 Get a comment on a historic process instance</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-process-instances/{processInstanceId}/comments/{commentId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 180. 获取一个历史流程实例的一个备注 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取备注的历史流程实例的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">commentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">备注的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "id" : "123",
  "processInstanceUrl" : "http://localhost:8081/activiti-rest/service/history/historic-process-instances/100/comments/456",
  "message" : "This is another comment.",
  "author" : "gonzo",
  "time" : "2014-07-14T15:16:52.232+08:00",
  "processInstanceId" : "100"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 181. 获取一个历史流程实例的一个备注 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到历史流程实例与备注，并已返回备注。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的历史流程实例，或者历史流程实例中没有给定id的备注。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_从一个历史流程实例中删除一个备注_delete_a_comment_on_a_historic_process_instance">15.8.10. 从一个历史流程实例中删除一个备注 Delete a comment on a historic process instance</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE history/historic-process-instances/{processInstanceId}/comments/{commentId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 182. 从一个历史流程实例中删除一个备注 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要删除备注的历史流程实例的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">commentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">备注的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 183. 从一个历史流程实例中删除一个备注 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到历史流程实例与备注，并已删除备注。响应体设置为空。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的流程实例，或历史流程实例中没有给定ID的备注</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_获取一个历史任务实例_get_a_single_historic_task_instance">15.8.11. 获取一个历史任务实例 Get a single historic task instance</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-task-instances/{taskId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 184. 获取一个历史任务实例 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表可以找到历史任务实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表不能找到历史任务实例。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "id" : "5",
  "processDefinitionId" : "oneTaskProcess%3A1%3A4",
  "processDefinitionUrl" : "http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4",
  "processInstanceId" : "3",
  "processInstanceUrl" : "http://localhost:8182/history/historic-process-instances/3",
  "executionId" : "4",
  "name" : "My task name",
  "description" : "My task description",
  "deleteReason" : null,
  "owner" : "kermit",
  "assignee" : "fozzie",
  "startTime" : "2013-04-17T10:17:43.902+0000",
  "endTime" : "2013-04-18T14:06:32.715+0000",
  "durationInMillis" : 86400056,
  "workTimeInMillis" : 234890,
  "claimTime" : "2013-04-18T11:01:54.715+0000",
  "taskDefinitionKey" : "taskKey",
  "formKey" : null,
  "priority" : 50,
  "dueDate" : "2013-04-20T12:11:13.134+0000",
  "parentTaskId" : null,
  "url" : "http://localhost:8182/history/historic-task-instances/5",
  "variables": null,
  "tenantId":null
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="restHistoricTaskInstancesGet">15.8.12. 获取历史任务实例 Get historic task instances</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-task-instances</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 185. 获取历史任务实例 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史任务实例的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史任务实例所在流程实例的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史任务实例所在流程定义key。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionKeyLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史任务实例所在流程，流程定义key匹配给定值。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史任务实例所在流程定义的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史任务实例所在流程定义名。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionNameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史任务实例所在流程，流程定义名匹配给定值。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processBusinessKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史任务实例所在流程实例businessKey。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processBusinessKeyLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史任务实例所在流程，流程实例businessKey匹配给定值。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史任务实例的所在执行的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskDefinitionKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程任务部分的任务定义key。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史任务实例的任务名。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskNameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史任务实例的任务名&#8217;like&#8217;操作。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskDescription</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史任务实例的任务描述。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskDescriptionLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史任务实例的任务描述&#8217;like&#8217;操作。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskDefinitionKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史任务实例从流程定义得到的任务标识符。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskCategory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">选择给定分类的任务。请注意这是任务的分类，而不是流程定义的分类（即BPMN Xml内的namespace）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskDeleteReason</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史任务实例的任务删除原因。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskDeleteReasonLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史任务实例的任务删除原因&#8217;like&#8217;操作。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskAssignee</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史任务实例的办理人。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskAssigneeLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史任务实例的办理人&#8217;like&#8217;操作。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskOwner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史任务实例的属主。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskOwnerLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史任务实例的属主&#8217;like&#8217;操作。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskInvolvedUser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史任务实例的一个相关用户。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskPriority</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史任务实例的优先级。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">finished</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否已完成历史任务实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processFinished</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否为已完成流程实例的历史任务实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parentTaskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史任务实例的可选父任务的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dueDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回到期日期等于该日期的历史任务实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dueDateAfter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回到期日期在该日期之后的历史任务实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dueDateBefore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回到期日期在该日期之前的历史任务实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutDueDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回未设置到期日期的历史任务实例。如果值为<code>false</code>，则忽略本参数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskCompletedOn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回在该日期完成的历史任务实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskCompletedAfter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回在该日期之后完成的历史任务实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskCompletedBefore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回在该日期之前完成的历史任务实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskCreatedOn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回在该日期创建的历史任务实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskCreatedBefore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回在该日期之前创建的历史任务实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskCreatedAfter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回在该日期之后创建的历史任务实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeTaskLocalVariables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否同时返回历史任务实例的本地变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeProcessVariables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否同时返回历史任务实例的全局变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定tenantId的历史任务实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回teantId like给定值的历史任务实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果值为<code>true</code>，则只返回未设置tenantId的历史任务实例。如果值为<code>false</code>，则忽略<code>withoutTenantId</code>参数。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>可以在这个URL中使用通用<a href="#restPagingAndSort">分页与排序查询参数</a>。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 186. 获取历史任务实例 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表可以查询历史任务实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表传递的某个参数格式错误。状态描述中包含了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": [
    {
      "id" : "5",
      "processDefinitionId" : "oneTaskProcess%3A1%3A4",
      "processDefinitionUrl" : "http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4",
      "processInstanceId" : "3",
      "processInstanceUrl" : "http://localhost:8182/history/historic-process-instances/3",
      "executionId" : "4",
      "name" : "My task name",
      "description" : "My task description",
      "deleteReason" : null,
      "owner" : "kermit",
      "assignee" : "fozzie",
      "startTime" : "2013-04-17T10:17:43.902+0000",
      "endTime" : "2013-04-18T14:06:32.715+0000",
      "durationInMillis" : 86400056,
      "workTimeInMillis" : 234890,
      "claimTime" : "2013-04-18T11:01:54.715+0000",
      "taskDefinitionKey" : "taskKey",
      "formKey" : null,
      "priority" : 50,
      "dueDate" : "2013-04-20T12:11:13.134+0000",
      "parentTaskId" : null,
      "url" : "http://localhost:8182/history/historic-task-instances/5",
      "taskVariables": [
        {
          "name": "test",
          "variableScope": "local",
          "value": "myTest"
        }
      ],
      "processVariables": [
        {
          "name": "processTest",
          "variableScope": "global",
          "value": "myProcessTest"
        }
      ],
      "tenantId":null
    }
  ],
  "total": 1,
  "start": 0,
  "sort": "name",
  "order": "asc",
  "size": 1
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_查询历史任务实例_query_for_historic_task_instances">15.8.13. 查询历史任务实例 Query for historic task instances</h4>
<div class="listingblock">
<div class="content">
<pre>POST query/historic-task-instances</pre>
</div>
</div>
<div class="paragraph">
<p><strong>查询历史任务实例 - 请求体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "processDefinitionId" : "oneTaskProcess%3A1%3A4",
  ...

  "variables" : [
    {
      "name" : "myVariable",
      "value" : 1234,
      "operation" : "equals",
      "type" : "long"
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>支持的JSON参数字段与<a href="#restHistoricTaskInstancesGet">获取历史任务实例集合</a>的参数一模一样，但是使用JSON体参数而不是URL参数，可以进行更高级的查询，也可以避免请求URI太长的错误。另外，查询可以通过流程变量进行过滤。<code>variables</code>参数是一个JSON数组，包含<a href="#restQueryVariable">这里描述</a>的格式的对象。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 187. 查询历史任务实例 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求成功，并已返回任务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表传递的某个参数格式错误。状态描述中包含了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": [
    {
      "id" : "5",
      "processDefinitionId" : "oneTaskProcess%3A1%3A4",
      "processDefinitionUrl" : "http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4",
      "processInstanceId" : "3",
      "processInstanceUrl" : "http://localhost:8182/history/historic-process-instances/3",
      "executionId" : "4",
      "name" : "My task name",
      "description" : "My task description",
      "deleteReason" : null,
      "owner" : "kermit",
      "assignee" : "fozzie",
      "startTime" : "2013-04-17T10:17:43.902+0000",
      "endTime" : "2013-04-18T14:06:32.715+0000",
      "durationInMillis" : 86400056,
      "workTimeInMillis" : 234890,
      "claimTime" : "2013-04-18T11:01:54.715+0000",
      "taskDefinitionKey" : "taskKey",
      "formKey" : null,
      "priority" : 50,
      "dueDate" : "2013-04-20T12:11:13.134+0000",
      "parentTaskId" : null,
      "url" : "http://localhost:8182/history/historic-task-instances/5",
      "taskVariables": [
        {
          "name": "test",
          "variableScope": "local",
          "value": "myTest"
        }
      ],
      "processVariables": [
        {
          "name": "processTest",
          "variableScope": "global",
          "value": "myProcessTest"
        }
      ],
      "tenantId":null
    }
  ],
  "total": 1,
  "start": 0,
  "sort": "name",
  "order": "asc",
  "size": 1
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_删除一个历史任务实例_delete_a_historic_task_instance">15.8.14. 删除一个历史任务实例 Delete a historic task instance</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE history/historic-task-instances/{taskId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 188. 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已删除历史任务实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到该历史任务实例。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_获取一个历史任务实例的身份关联_get_the_identity_links_of_a_historic_task_instance">15.8.15. 获取一个历史任务实例的身份关联 Get the identity links of a historic task instance</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-task-instance/{taskId}/identitylinks</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 189. 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求成功，并已返回身份关联。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到该任务实例。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
 {
  "type" : "assignee",
  "user" : "kermit",
  "group" : null,
  "taskId" : "6",
  "taskUrl" : "http://localhost:8182/history/historic-task-instances/5",
  "processInstanceId" : null,
  "processInstanceUrl" : null
 }
]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_获取一个历史流程实例变量的二进制数据_get_the_binary_data_for_a_historic_task_instance_variable">15.8.16. 获取一个历史流程实例变量的二进制数据 Get the binary data for a historic task instance variable</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-task-instances/{taskId}/variables/{variableName}/data</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 190. 获取一个历史流程实例变量的二进制数据 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到任务实例，并已返回请求的变量数据。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的任务实例，或流程实例中没有给定名字的变量，或者变量没有可用的二进制流。状态消息提供了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="paragraph">
<p>响应体包含了变量的二进制值。如果变量是<code>binary</code>类型，则不论变量的content或者请求的accept-type头是什么，响应的content-type都将设置为<code>application/octet-stream</code>。如果变量是<code>serializable</code>类型，则content-type会使用<code>application/x-java-serialized-object</code>。</p>
</div>
</div>
<div class="sect3">
<h4 id="restHistoricActivityInstancesGet">15.8.17. 获取历史活动实例 Get historic activity instances</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-activity-instances</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 191. 获取历史活动实例 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">activityId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">活动实例的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">activityInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史活动实例的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">activityName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史活动实例的名字。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">activityType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史活动实例的元素类型。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史活动实例的执行的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">finished</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否已完成的历史活动实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskAssignee</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史活动实例的办理人。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史活动实例的流程实例的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史活动实例的流程定义的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定tenantId的实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回tenantId like给定值的实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果值为<code>true</code>，则只返回未设置tenantId的实例。如果值为<code>false</code>，则忽略<code>withoutTenantId</code>参数。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>可以在这个URL中使用通用<a href="#restPagingAndSort">分页与排序查询参数</a>。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 192. 获取历史活动实例 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表可以查询历史活动实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表传递的某个参数格式错误。状态描述中包含了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": [
    {
      "id" : "5",
      "activityId" : "4",
      "activityName" : "My user task",
      "activityType" : "userTask",
      "processDefinitionId" : "oneTaskProcess%3A1%3A4",
      "processDefinitionUrl" : "http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4",
      "processInstanceId" : "3",
      "processInstanceUrl" : "http://localhost:8182/history/historic-process-instances/3",
      "executionId" : "4",
      "taskId" : "4",
      "calledProcessInstanceId" : null,
      "assignee" : "fozzie",
      "startTime" : "2013-04-17T10:17:43.902+0000",
      "endTime" : "2013-04-18T14:06:32.715+0000",
      "durationInMillis" : 86400056,
      "tenantId":null
    }
  ],
  "total": 1,
  "start": 0,
  "sort": "name",
  "order": "asc",
  "size": 1
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_查询历史活动实例_query_for_historic_activity_instances">15.8.18. 查询历史活动实例 Query for historic activity instances</h4>
<div class="listingblock">
<div class="content">
<pre>POST query/historic-activity-instances</pre>
</div>
</div>
<div class="paragraph">
<p><strong>请求体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "processDefinitionId" : "oneTaskProcess%3A1%3A4"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>支持的JSON参数字段与<a href="#restHistoricTaskInstancesGet">获取历史任务实例集合（原文如此）</a>的参数一模一样，但是使用JSON体参数而不是URL参数，可以进行更高级的查询，也可以避免请求URI太长的错误。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 193. 查询历史活动实例 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求成功，并已返回活动。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表传递的某个参数格式错误。状态描述中包含了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": [
    {
      "id" : "5",
      "activityId" : "4",
      "activityName" : "My user task",
      "activityType" : "userTask",
      "processDefinitionId" : "oneTaskProcess%3A1%3A4",
      "processDefinitionUrl" : "http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4",
      "processInstanceId" : "3",
      "processInstanceUrl" : "http://localhost:8182/history/historic-process-instances/3",
      "executionId" : "4",
      "taskId" : "4",
      "calledProcessInstanceId" : null,
      "assignee" : "fozzie",
      "startTime" : "2013-04-17T10:17:43.902+0000",
      "endTime" : "2013-04-18T14:06:32.715+0000",
      "durationInMillis" : 86400056,
      "tenantId":null
    }
  ],
  "total": 1,
  "start": 0,
  "sort": "name",
  "order": "asc",
  "size": 1
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="restHistoricVariableInstancesGet">15.8.19. 历史变量实例的列表 List of historic variable instances</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-variable-instances</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 194. 历史变量实例的列表 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史变量实例的流程实例的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史变量实例的任务的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludeTaskVariables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否从结果中排除任务变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史变量实例的变量名。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableNameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史变量实例的变量名&#8217;like&#8217;操作。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>可以在这个URL中使用通用<a href="#restPagingAndSort">分页与排序查询参数</a>。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 195. 历史变量实例的列表 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表可以查询历史变量实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表传递的某个参数格式错误。状态描述中包含了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": [
    {
      "id" : "14",
      "processInstanceId" : "5",
      "processInstanceUrl" : "http://localhost:8182/history/historic-process-instances/5",
      "taskId" : "6",
      "variable" : {
        "name" : "myVariable",
        "variableScope": "global",
        "value" : "test"
      }
    }
  ],
  "total": 1,
  "start": 0,
  "sort": "name",
  "order": "asc",
  "size": 1
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_查询历史变量实例_query_for_historic_variable_instances">15.8.20. 查询历史变量实例 Query for historic variable instances</h4>
<div class="listingblock">
<div class="content">
<pre>POST query/historic-variable-instances</pre>
</div>
</div>
<div class="paragraph">
<p><strong>请求体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "processDefinitionId" : "oneTaskProcess%3A1%3A4",
  ...

  "variables" : [
    {
      "name" : "myVariable",
      "value" : 1234,
      "operation" : "equals",
      "type" : "long"
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>支持的JSON参数字段与<a href="#restHistoricVariableInstancesGet">获取历史变量实例集合</a>的参数一模一样，但是使用JSON体参数而不是URL参数，可以进行更高级的查询，也可以避免请求URI太长的错误。另外，查询可以通过流程变量进行过滤。<code>variables</code>参数是一个JSON数组，包含<a href="#restQueryVariable">这里描述</a>的格式的对象。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 196. 查询历史变量实例 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求成功，并已返回变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表传递的某个参数格式错误。状态描述中包含了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": [
    {
      "id" : "14",
      "processInstanceId" : "5",
      "processInstanceUrl" : "http://localhost:8182/history/historic-process-instances/5",
      "taskId" : "6",
      "variable" : {
        "name" : "myVariable",
        "variableScope": "global",
        "value" : "test"
      }
    }
  ],
  "total": 1,
  "start": 0,
  "sort": "name",
  "order": "asc",
  "size": 1
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_获取历史任务实例变量的二进制数据_get_the_binary_data_for_a_historic_task_instance_variable">15.8.21. 获取历史任务实例变量的二进制数据 Get the binary data for a historic task instance variable</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-variable-instances/{varInstanceId}/data</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 197. 获取历史任务实例变量的二进制数据 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到变量实例，并已返回请求的变量数据。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的变量实例，或变量实例中没有给定名字的变量（原文如此），或变量没有可用的二进制流。状态消息提供了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="paragraph">
<p>响应体包含了变量的二进制值。如果变量是<code>binary</code>类型，则不论变量的content或者请求的accept-type头是什么，响应的content-type都将设置为<code>application/octet-stream</code>。如果变量是<code>serializable</code>类型，则content-type会使用<code>application/x-java-serialized-object</code>。</p>
</div>
</div>
<div class="sect3">
<h4 id="restHistoricDetailGet">15.8.22. 获取历史详情 Get historic detail</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-detail</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 198. 获取历史详情 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史详情的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史详情的流程实例的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史详情的执行的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">activityInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史详情的活动实例的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史详情的任务的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">selectOnlyFormProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否只在结果中返回表单参数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">selectOnlyVariableUpdates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否只在结果中返回变量更新。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>可以在这个URL中使用通用<a href="#restPagingAndSort">分页与排序查询参数</a>。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 199. 获取历史详情 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表可以查询历史详情。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表传递的某个参数格式错误。状态描述中包含了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": [
    {
      "id" : "26",
      "processInstanceId" : "5",
      "processInstanceUrl" : "http://localhost:8182/history/historic-process-instances/5",
      "executionId" : "6",
      "activityInstanceId": "10",
      "taskId" : "6",
      "taskUrl" : "http://localhost:8182/history/historic-task-instances/6",
      "time" : "2013-04-17T10:17:43.902+0000",
      "detailType" : "variableUpdate",
      "revision" : 2,
      "variable" : {
        "name" : "myVariable",
        "variableScope": "global",
        "value" : "test"
      },
      "propertyId": null,
      "propertyValue": null
    }
  ],
  "total": 1,
  "start": 0,
  "sort": "name",
  "order": "asc",
  "size": 1
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_查询历史详情_query_for_historic_details">15.8.23. 查询历史详情 Query for historic details</h4>
<div class="listingblock">
<div class="content">
<pre>POST query/historic-detail</pre>
</div>
</div>
<div class="paragraph">
<p><strong>请求体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "processInstanceId" : "5",
}</pre>
</div>
</div>
<div class="paragraph">
<p>支持的JSON参数字段与<a href="#restHistoricDetailGet">获取历史详情集合</a>的参数一模一样，但是使用JSON体参数而不是URL参数，可以进行更高级的查询，也可以避免请求URI太长的错误。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 200. 查询历史详情 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求成功，并已返回历史详情。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表传递的某个参数格式错误。状态描述中包含了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": [
    {
      "id" : "26",
      "processInstanceId" : "5",
      "processInstanceUrl" : "http://localhost:8182/history/historic-process-instances/5",
      "executionId" : "6",
      "activityInstanceId": "10",
      "taskId" : "6",
      "taskUrl" : "http://localhost:8182/history/historic-task-instances/6",
      "time" : "2013-04-17T10:17:43.902+0000",
      "detailType" : "variableUpdate",
      "revision" : 2,
      "variable" : {
        "name" : "myVariable",
        "variableScope": "global",
        "value" : "test"
      },
      "propertyId" : null,
      "propertyValue" : null
    }
  ],
  "total": 1,
  "start": 0,
  "sort": "name",
  "order": "asc",
  "size": 1
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_获取历史详情变量的二进制数据_get_the_binary_data_for_a_historic_detail_variable">15.8.24. 获取历史详情变量的二进制数据 Get the binary data for a historic detail variable</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-detail/{detailId}/data</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 201. 获取历史详情变量的二进制数据 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到历史详情实例，并已返回请求的变量数据。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的历史详情实例，或历史详情实例中没有给定名字的变量，或变量没有可用的二进制流。状态消息提供了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="paragraph">
<p>响应体包含了变量的二进制值。如果变量是<code>binary</code>类型，则不论变量的content或者请求的accept-type头是什么，响应的content-type都将设置为<code>application/octet-stream</code>。如果变量是<code>serializable</code>类型，则content-type会使用<code>application/x-java-serialized-object</code>。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_表单_forms">15.9. 表单 Forms</h3>
<div class="sect3">
<h4 id="_获取表单数据_get_form_data">15.9.1. 获取表单数据 Get form data</h4>
<div class="listingblock">
<div class="content">
<pre>GET form/form-data</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 202. 获取表单数据 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是（如果没有processDefinitionId）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要获取表单数据的相应任务的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是（如果没有taskId）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要获取启动事件表单数据的相应流程定义的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 203. 获取表单数据 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表可以查询表单数据。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到该表单数据。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data": [
    {
      "formKey" : null,
      "deploymentId" : "2",
      "processDefinitionId" : "3",
      "processDefinitionUrl" : "http://localhost:8182/repository/process-definition/3",
      "taskId" : "6",
      "taskUrl" : "http://localhost:8182/runtime/task/6",
      "formProperties" : [
        {
          "id" : "room",
          "name" : "Room",
          "type" : "string",
          "value" : null,
          "readable" : true,
          "writable" : true,
          "required" : true,
          "datePattern" : null,
          "enumValues" : [
            {
              "id" : "normal",
              "name" : "Normal bed"
            },
            {
              "id" : "kingsize",
              "name" : "Kingsize bed"
            },
          ]
        }
      ]
    }
  ],
  "total": 1,
  "start": 0,
  "sort": "name",
  "order": "asc",
  "size": 1
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_提交任务表单数据_submit_task_form_data">15.9.2. 提交任务表单数据 Submit task form data</h4>
<div class="listingblock">
<div class="content">
<pre>POST form/form-data</pre>
</div>
</div>
<div class="paragraph">
<p><strong>任务表单的请求体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "taskId" : "5",
  "properties" : [
    {
      "id" : "room",
      "value" : "normal"
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>启动事件表单的请求体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "processDefinitionId" : "5",
  "businessKey" : "myKey",
  "properties" : [
    {
      "id" : "room",
      "value" : "normal"
    }
  ]
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 204. 提交任务表单数据 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求成功，并已提交表单数据。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表传递的某个参数格式错误。状态描述中包含了额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>启动事件表单数据的成功响应体（任务表单数据没有响应）：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "id" : "5",
  "url" : "http://localhost:8182/history/historic-process-instances/5",
  "businessKey" : "myKey",
  "suspended": false,
  "processDefinitionId" : "3",
  "processDefinitionUrl" : "http://localhost:8182/repository/process-definition/3",
  "activityId" : "myTask"
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_数据库表_database_tables">15.10. 数据库表 Database tables</h3>
<div class="sect3">
<h4 id="_表的列表_list_of_tables">15.10.1. 表的列表 List of tables</h4>
<div class="listingblock">
<div class="content">
<pre>GET management/tables</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 205. 表的列表 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求成功。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
   {
      "name":"ACT_RU_VARIABLE",
      "url":"http://localhost:8182/management/tables/ACT_RU_VARIABLE",
      "count":4528
   },
   {
      "name":"ACT_RU_EVENT_SUBSCR",
      "url":"http://localhost:8182/management/tables/ACT_RU_EVENT_SUBSCR",
      "count":3
   }

]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_获取一个表_get_a_single_table">15.10.2. 获取一个表 Get a single table</h4>
<div class="listingblock">
<div class="content">
<pre>GET management/tables/{tableName}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 206. 获取一个表 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取的表的名字。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
      "name":"ACT_RE_PROCDEF",
      "url":"http://localhost:8182/management/tables/ACT_RE_PROCDEF",
      "count":60
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 207. 获取一个表 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表存在该表，并已返回表记录数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表不存在请求的表。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_获取一个表的列信息_get_column_info_for_a_single_table">15.10.3. 获取一个表的列信息 Get column info for a single table</h4>
<div class="listingblock">
<div class="content">
<pre>GET management/tables/{tableName}/columns</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 208. 获取一个表的列信息 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取的表的名字。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "tableName":"ACT_RU_VARIABLE",
   "columnNames":[
      "ID_",
      "REV_",
      "TYPE_",
      "NAME_"


   ],
   "columnTypes":[
      "VARCHAR",
      "INTEGER",
      "VARCHAR",
      "VARCHAR"


   ]
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 209. 获取一个表的列信息 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表存在该表，并已返表的列信息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表不存在请求的表。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_获取一个表的行数据_get_row_data_for_a_single_table">15.10.4. 获取一个表的行数据 Get row data for a single table</h4>
<div class="listingblock">
<div class="content">
<pre>GET management/tables/{tableName}/data</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 210. 获取一个表的行数据 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取的表的名字。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 211. 获取一个表的行数据 - URL 查询参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">start</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要读取的第一行的index。默认为0。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要读取的行数，从<code>start</code>开始。默认为10。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">orderAscendingColumn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">结果行要用来排序的列名，顺序。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">orderDescendingColumn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">结果行要用来排序的列名，逆序。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "total":3,
   "start":0,
   "sort":null,
   "order":null,
   "size":3,

   "data":[
      {
         "TASK_ID_":"2",
         "NAME_":"var1",
         "REV_":1,
         "TEXT_":"123",
         "LONG_":123,
         "ID_":"3",
         "TYPE_":"integer"
      }



   ]

}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 212. 获取一个表的行数据 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表存在该表，并已返回表的行数据。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表不存在请求的表。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_引擎_engine">15.11. 引擎 Engine</h3>
<div class="sect3">
<h4 id="_获取引擎参数_get_engine_properties">15.11.1. 获取引擎参数 Get engine properties</h4>
<div class="listingblock">
<div class="content">
<pre>GET management/properties</pre>
</div>
</div>
<div class="paragraph">
<p>返回引擎内部使用的参数的只读视图。</p>
</div>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "next.dbid":"101",
   "schema.history":"create(5.15)",
   "schema.version":"5.15"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 213. 获取引擎参数 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已返回参数。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_获取引擎信息_get_engine_info">15.11.2. 获取引擎信息 Get engine info</h4>
<div class="listingblock">
<div class="content">
<pre>GET management/engine</pre>
</div>
</div>
<div class="paragraph">
<p>返回本REST服务使用的引擎的只读视图。</p>
</div>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "name":"default",
   "version":"5.15",
   "resourceUrl":"file://activiti/activiti.cfg.xml",
   "exception":null
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 214. 获取引擎信息 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已返回引擎信息。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_运行时_runtime">15.12. 运行时 Runtime</h3>
<div class="sect3">
<h4 id="_已接收到信号事件_signal_event_received">15.12.1. 已接收到信号事件 Signal event received</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/signals</pre>
</div>
</div>
<div class="paragraph">
<p>通知引擎，已经接收到一个信号事件，而不直接关联到特定的执行。</p>
</div>
<div class="paragraph">
<p><strong>JSON体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "signalName": "My Signal",
  "tenantId" : "execute",
  "async": true,
  "variables": [
      {"name": "testVar", "value": "This is a string"}

  ]
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 215. 已接收到信号事件 - JSON体参数</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必填</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">signalName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">信号的名字</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要处理信号事件的租户的ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">async</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果值为<code>true</code>，则会异步处理信号。返回码将为<code>202 - 已接受</code>，代表请求已接受，但还未执行。如果值为<code>false</code>，则会立即处理信号，在执行成功完成后才将返回结果（<code>200 - OK</code>）。如果省略，默认值为<code>false</code>。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">作为载荷与信号一同传递的变量（以通用变量格式）的数组。如果<code>async</code>设置为<code>true</code>则不能使用，否则结果为错误。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 216. 已接收到信号事件 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已处理信号，且没有发生错误。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">202</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已将信号放入作业队列，可以开始执行。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未处理信号。缺少信号名，或变量与异步一同使用。响应体中包含错误的额外信息。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_作业_jobs">15.13. 作业 Jobs</h3>
<div class="sect3">
<h4 id="_获取一个作业_get_a_single_job">15.13.1. 获取一个作业 Get a single job</h4>
<div class="listingblock">
<div class="content">
<pre>GET management/jobs/{jobId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 217. 获取一个作业 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jobId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取的作业的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "id":"8",
   "url":"http://localhost:8182/management/jobs/8",
   "processInstanceId":"5",
   "processInstanceUrl":"http://localhost:8182/runtime/process-instances/5",
   "processDefinitionId":"timerProcess:1:4",
   "processDefinitionUrl":"http://localhost:8182/repository/process-definitions/timerProcess%3A1%3A4",
   "executionId":"7",
   "executionUrl":"http://localhost:8182/runtime/executions/7",
   "retries":3,
   "exceptionMessage":null,
   "dueDate":"2013-06-04T22:05:05.474+0000",
   "tenantId":null
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 218. 获取一个作业 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表存在该作业，并已返回。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表不存在请求的作业。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_删除一个作业_delete_a_job">15.13.2. 删除一个作业 Delete a job</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE management/jobs/{jobId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 219. 删除一个作业 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jobId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要删除的作业的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 220. 删除一个作业 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到并已删除作业。响应体设置为空。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的作业。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_执行一个作业_execute_a_single_job">15.13.3. 执行一个作业 Execute a single job</h4>
<div class="listingblock">
<div class="content">
<pre>POST management/jobs/{jobId}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>JSON体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "action" : "execute"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 221. 执行一个作业 - JSON体参数</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必填</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">action</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要进行的操作，只支持<code>execute</code>。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 222. 执行一个作业 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已执行该作业。响应体设置为空。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的作业。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表执行作业时发生异常。状态描述中包含了错误的额外细节。如果需要，之后可以获取完整的异常栈。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_获取一个作业的异常栈_get_the_exception_stacktrace_for_a_job">15.13.4. 获取一个作业的异常栈 Get the exception stacktrace for a job</h4>
<div class="listingblock">
<div class="content">
<pre>GET management/jobs/{jobId}/exception-stacktrace</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 223. 获取一个作业的异常栈 - URL 参数</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必填</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jobId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取异常栈的作业的id。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 224. 获取一个作业的异常栈 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到请求的作业，并已返回异常栈。响应包含原始的异常栈，并总是用<code>text/plain</code>的Content-type。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的作业，或作业没有异常栈。状态描述中包含了错误的额外信息。。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_获取作业的列表_get_a_list_of_jobs">15.13.5. 获取作业的列表 Get a list of jobs</h4>
<div class="listingblock">
<div class="content">
<pre>GET management/jobs</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 225. 获取作业的列表 - URL 查询参数</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定id的作业</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定id的流程中的作业</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定id的执行中的作业</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定流程定义的作业</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withRetriesLeft</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果值为<code>true</code>，则只返回还能重试的作业。如果值为false，则忽略本参数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果值为<code>true</code>，则只返回可执行的作业。如果值为false，则忽略本参数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timersOnly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果值为<code>true</code>，则只返回定时器作业。如果值为false，则忽略本参数。不能与 <code>'messagesOnly'</code> 一起使用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">messagesOnly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果值为<code>true</code>，则只返回消息作业。如果值为false，则忽略本参数。不能与 <code>'timersOnly'</code> 一起使用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果值为<code>true</code>，则只返回执行时发生了异常的作业。如果值为false，则忽略本参数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dueBefore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回将在给定日期前执行的作业。使用本参数不会返回没有执行日期的作业。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dueAfter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回将在给定日期后执行的作业。使用本参数不会返回没有执行日期的作业。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">exceptionMessage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回带有给定异常消息的作业</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定tenantId的作业。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回tenantId like给定值的作业。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果值为<code>true</code>，则只返回未设置tenantId的作业。如果值为<code>false</code>，则忽略<code>withoutTenantId</code>参数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于排序结果的字段，需要为<code>id</code>, <code>dueDate</code>, <code>executionId</code>, <code>processInstanceId</code>, <code>retries</code>或<code>tenantId</code>中的一个。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>可以在这个URL中使用通用<a href="#restPagingAndSort">分页与排序查询参数</a>。</p>
</div>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "data":[
      {
         "id":"13",
         "url":"http://localhost:8182/management/jobs/13",
         "processInstanceId":"5",
         "processInstanceUrl":"http://localhost:8182/runtime/process-instances/5",
         "processDefinitionId":"timerProcess:1:4",
         "processDefinitionUrl":"http://localhost:8182/repository/process-definitions/timerProcess%3A1%3A4",
         "executionId":"12",
         "executionUrl":"http://localhost:8182/runtime/executions/12",
         "retries":0,
         "exceptionMessage":"Can't find scripting engine for 'unexistinglanguage'",
         "dueDate":"2013-06-07T10:00:24.653+0000",
         "tenantId":null
      }



   ],
   "total":2,
   "start":0,
   "sort":"id",
   "order":"asc",
   "size":2
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 226. 获取作业的列表 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已返回请求的作业。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表在url查询参数中使用了非法的值，或 <code>'messagesOnly'</code> 与 <code>'timersOnly'</code> 同时用作参数。状态描述中包含了错误的额外信息。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_用户_users">15.14. 用户 Users</h3>
<div class="sect3">
<h4 id="_获取一个用户_get_a_single_user">15.14.1. 获取一个用户 Get a single user</h4>
<div class="listingblock">
<div class="content">
<pre>GET identity/users/{userId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 227. 获取一个用户 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取的用户的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "id":"testuser",
   "firstName":"Fred",
   "lastName":"McDonald",
   "url":"http://localhost:8182/identity/users/testuser",
   "email":"no-reply@activiti.org"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 228. 获取一个用户 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表存在该用户，并已返回。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表不存在请求的用户。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_获取用户的列表_get_a_list_of_users">15.14.2. 获取用户的列表 Get a list of users</h4>
<div class="listingblock">
<div class="content">
<pre>GET identity/users</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 229. 获取用户的列表 - URL 查询参数</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定id的用户</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">firstName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定firstname的用户</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定lastname的用户</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定email的用户</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">firstNameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回firstname like给定值的用户。使用<code>%</code>作为通配符。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastNameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回lastname like给定值的用户。使用<code>%</code>作为通配符。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">emailLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回email like给定值的用户。使用<code>%</code>作为通配符。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">memberOfGroup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定组的成员用户</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">potentialStarter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定id的流程定义的潜在启动者用户。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于排序结果的字段，需要为<code>id</code>, <code>firstName</code>, <code>lastname</code>或<code>email</code>中的一个。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>可以在这个URL中使用通用<a href="#restPagingAndSort">分页与排序查询参数</a>。</p>
</div>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "data":[
      {
         "id":"anotherUser",
         "firstName":"Tijs",
         "lastName":"Barrez",
         "url":"http://localhost:8182/identity/users/anotherUser",
         "email":"no-reply@alfresco.org"
      },
      {
         "id":"kermit",
         "firstName":"Kermit",
         "lastName":"the Frog",
         "url":"http://localhost:8182/identity/users/kermit",
         "email":null
      },
      {
         "id":"testuser",
         "firstName":"Fred",
         "lastName":"McDonald",
         "url":"http://localhost:8182/identity/users/testuser",
         "email":"no-reply@activiti.org"
      }
   ],
   "total":3,
   "start":0,
   "sort":"id",
   "order":"asc",
   "size":3
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 230. 获取用户的列表 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已返回请求的用户。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_更新一个用户_update_a_user">15.14.3. 更新一个用户 Update a user</h4>
<div class="listingblock">
<div class="content">
<pre>PUT identity/users/{userId}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>JSON体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "firstName":"Tijs",
  "lastName":"Barrez",
  "email":"no-reply@alfresco.org",
  "password":"pass123"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>所有的请求值都是可选的。例如，可以只在请求体的JSON对象中包含&#8217;firstName&#8217;属性，则只更新用户的firstName，而不影响其它任何字段。若明确包含了一个属性，并设置为null，则用户值将更新为null。例如：<code>{"firstName" : null}</code>将清空用户的firstName。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 231. 更新一个用户 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已更新该用户。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的用户。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求的用户已被并发同时更新。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong>参见<code>identity/users/{userId}</code>的响应。</p>
</div>
</div>
<div class="sect3">
<h4 id="_创建一个用户_create_a_user">15.14.4. 创建一个用户 Create a user</h4>
<div class="listingblock">
<div class="content">
<pre>POST identity/users</pre>
</div>
</div>
<div class="paragraph">
<p><strong>JSON体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "id":"tijs",
  "firstName":"Tijs",
  "lastName":"Barrez",
  "email":"no-reply@alfresco.org",
  "password":"pass123"
}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 232. 创建一个用户 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已创建该用户。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表缺少用户的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong>参见<code>identity/users/{userId}</code>的响应。</p>
</div>
</div>
<div class="sect3">
<h4 id="_删除一个用户_delete_a_user">15.14.5. 删除一个用户 Delete a user</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE identity/users/{userId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 233. 删除一个用户 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要删除的用户的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 234. 删除一个用户 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到并删除该用户。响应体设置为空。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的用户。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_获取一个用户的图片_get_a_user_s_picture">15.14.6. 获取一个用户的图片 Get a user&#8217;s picture</h4>
<div class="listingblock">
<div class="content">
<pre>GET identity/users/{userId}/picture</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 235. 获取一个用户的图片 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取图片的用户的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>响应体：</strong></p>
</div>
<div class="paragraph">
<p>响应体包含原始图片数据，代表用户的图片。响应的Content-type与创建图片时设置的mimeType有关。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 236. 获取一个用户的图片 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到用户，并已在响应体中返回了图片。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的用户，或用户没有设置图片。状态描述中包含了错误的额外信息。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_更新一个用户的图片_updating_a_user_s_picture">15.14.7. 更新一个用户的图片 Updating a user&#8217;s picture</h4>
<div class="listingblock">
<div class="content">
<pre>GET identity/users/{userId}/picture</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 237. 更新一个用户的图片 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要更新图片的用户的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>请求体：</strong>请求需要是<code>multipart/form-data</code>类型的。需要有唯一的file-part，包含变量的二进制值。另外，也可以使用下列额外的form-fields：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mimeType</code>: 可选的上传图片的mime-type。如果省略，则默认使用<code>image/jpeg</code>作为该图片的mime-type。</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 238. 更新一个用户的图片 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到该用户，并已更新图片。响应体设置为空。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的用户。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_列表一个用户的信息_list_a_user_s_info">15.14.8. 列表一个用户的信息 List a user&#8217;s info</h4>
<div class="listingblock">
<div class="content">
<pre>PUT identity/users/{userId}/info</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 239. 列表一个用户的信息 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取信息的用户的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
   {
      "key":"key1",
      "url":"http://localhost:8182/identity/users/testuser/info/key1"
   },
   {
      "key":"key2",
      "url":"http://localhost:8182/identity/users/testuser/info/key2"
   }
]</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 240. 列表一个用户的信息 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到用户，并已返回信息（key与url）的列表。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的用户。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_获取一条用户信息_get_a_user_s_info">15.14.9. 获取一条用户信息 Get a user&#8217;s info</h4>
<div class="listingblock">
<div class="content">
<pre>GET identity/users/{userId}/info/{key}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 241. 获取一条用户信息 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取信息的用户的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取的用户信息的key。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "key":"key1",
   "value":"Value 1",
   "url":"http://localhost:8182/identity/users/testuser/info/key1"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 242. 获取一条用户信息 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到用户，该用户也有给定key的信息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的用户，或用户没有给定key的信息。状态描述中包含了关于错误的额外信息。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_更新一条用户信息_update_a_user_s_info">15.14.10. 更新一条用户信息 Update a user&#8217;s info</h4>
<div class="listingblock">
<div class="content">
<pre>PUT identity/users/{userId}/info/{key}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 243. 更新一条用户信息 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要更新信息的用户的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要更新的用户信息的key。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>请求体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "value":"The updated value"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "key":"key1",
   "value":"The updated value",
   "url":"http://localhost:8182/identity/users/testuser/info/key1"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 244. 更新一条用户信息 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到用户，并已更新信息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求体中缺少value。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的用户，或用户没有给定key的信息。状态描述中包含了关于错误的额外信息。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_创建一条新的用户信息记录_create_a_new_user_s_info_entry">15.14.11. 创建一条新的用户信息记录 Create a new user&#8217;s info entry</h4>
<div class="listingblock">
<div class="content">
<pre>POST identity/users/{userId}/info</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 245. 创建一条新的用户信息记录 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要创建信息的用户的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>请求体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "key":"key1",
   "value":"The value"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "key":"key1",
   "value":"The value",
   "url":"http://localhost:8182/identity/users/testuser/info/key1"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 246. 创建一条新的用户信息记录 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到用户，并已创建信息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求体中缺少key或value。状态描述中包含了关于错误的额外信息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的用户。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表用户已有给定key的信息记录，改用更新资源实例（<code>PUT</code>）。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_删除一条用户信息_delete_a_user_s_info">15.14.12. 删除一条用户信息 Delete a user&#8217;s info</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE identity/users/{userId}/info/{key}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 247. 删除一条用户信息 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要删除信息的用户的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要删除的用户信息的key。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 248. 删除一条用户信息 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到用户，并已删除给定key的信息。响应体设置为空。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的用户，或用户没有给定key的信息。状态描述中包含了关于错误的额外信息。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_组_groups">15.15. 组 Groups</h3>
<div class="sect3">
<h4 id="_获取一个组_get_a_single_group">15.15.1. 获取一个组 Get a single group</h4>
<div class="listingblock">
<div class="content">
<pre>GET identity/groups/{groupId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 249. 获取一个组 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取的组的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "id":"testgroup",
   "url":"http://localhost:8182/identity/groups/testgroup",
   "name":"Test group",
   "type":"Test type"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 250. 获取一个组 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表存在并已返回该组。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表不存在请求的组。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_获取组的列表_get_a_list_of_groups">15.15.2. 获取组的列表 Get a list of groups</h4>
<div class="listingblock">
<div class="content">
<pre>GET identity/groups</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 251. 获取组的列表 - URL 查询参数</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定id的组</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定名字的组</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定类型的组</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回名字like给定值的组。使用<code>%</code>作为通配符。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">member</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回有给定用户名作为成员的组。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">potentialStarter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回给定id的流程定义的潜在启动者组。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于排序结果的字段，需要为<code>id</code>, <code>name</code>或<code>type</code>中的一个。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>可以在这个URL中使用通用<a href="#restPagingAndSort">分页与排序查询参数</a>。</p>
</div>
<div class="paragraph">
<p><strong>成功响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "data":[
     {
        "id":"testgroup",
        "url":"http://localhost:8182/identity/groups/testgroup",
        "name":"Test group",
        "type":"Test type"
     }
   ],
   "total":3,
   "start":0,
   "sort":"id",
   "order":"asc",
   "size":3
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 252. 获取组的列表 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已返回请求的组。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_更新一个组_update_a_group">15.15.3. 更新一个组 Update a group</h4>
<div class="listingblock">
<div class="content">
<pre>PUT identity/groups/{groupId}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>JSON体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "name":"Test group",
   "type":"Test type"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>所有的请求值都是可选的。例如，可以只在请求体的JSON对象中包含&#8217;name&#8217;属性，则只更新组的名字，而不影响其它任何字段。若明确包含了一个属性，并设置为null，则组值将更新为null。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 253. 更新一个组 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已更新组。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的组。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求的组已被并发同时更新。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong>参见<code>identity/groups/{groupId}</code>的响应。</p>
</div>
</div>
<div class="sect3">
<h4 id="_创建一个组_create_a_group">15.15.4. 创建一个组 Create a group</h4>
<div class="listingblock">
<div class="content">
<pre>POST identity/groups</pre>
</div>
</div>
<div class="paragraph">
<p><strong>JSON体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "id":"testgroup",
   "name":"Test group",
   "type":"Test type"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 254. 创建一个组 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已创建组。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表缺少组的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体：</strong>参见<code>identity/groups/{groupId}</code>的响应。</p>
</div>
</div>
<div class="sect3">
<h4 id="_删除一个组_delete_a_group">15.15.5. 删除一个组 Delete a group</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE identity/groups/{groupId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 255. 删除一个组 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要删除的组的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 256. 删除一个组 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到并已删除组。响应体设置为空。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的组。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_获取一个组中的成员_get_members_in_a_group">15.15.6. 获取一个组中的成员 Get members in a group</h4>
<div class="paragraph">
<p><code>identity/groups/members</code>不能使用GET。使用<code>identity/users?memberOfGroup=sales</code>URL获取特定组中的所有用户。</p>
</div>
</div>
<div class="sect3">
<h4 id="_为一个组添加一个成员_add_a_member_to_a_group">15.15.7. 为一个组添加一个成员 Add a member to a group</h4>
<div class="listingblock">
<div class="content">
<pre>POST identity/groups/{groupId}/members</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 257. 为一个组添加一个成员 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要添加成员的组的id。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>JSON体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "user":"kermit"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 258. 为一个组添加一个成员 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到组，并已添加成员。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求体中没有包含user。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的组。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表请求的用户已经是组的成员。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "user":"kermit",
   "group":"sales",
    "url":"http://localhost:8182/identity/groups/sales/members/kermit"
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_从一个组中删除一个成员_delete_a_member_from_a_group">15.15.8. 从一个组中删除一个成员 Delete a member from a group</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE identity/groups/{groupId}/members/{userId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 259. 从一个组中删除一个成员 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要移除成员的组的id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要移除的用户的id。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 260. 从一个组中删除一个成员 - 响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表已找到组，并已删除成员。响应体设置为空。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表未找到请求的组，或用户不是组的成员。状态描述中包含了关于错误的额外信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>响应体：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "user":"kermit",
   "group":"sales",
    "url":"http://localhost:8182/identity/groups/sales/members/kermit"
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cdiintegration">16. CDI集成 CDI integration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>activiti-cid模块平衡了Activiti的可配置性与cid的可扩展性。activiti-cdi最突出的特点是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>支持@BusinessProcessScoped bean（生命周期绑定至流程实例的Cdi bean），</p>
</li>
<li>
<p>用于从流程中解析Cdi bean（包括EJB）的自定义El解析器，</p>
</li>
<li>
<p>使用注解对流程实例进行声明式控制，</p>
</li>
<li>
<p>Activiti关联cdi事件总线，</p>
</li>
<li>
<p>可以与Java EE，Java SE，以及Spring一起工作，</p>
</li>
<li>
<p>支持单元测试。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
	&lt;groupId&gt;org.activiti&lt;/groupId&gt;
	&lt;artifactId&gt;activiti-cdi&lt;/artifactId&gt;
	&lt;version&gt;5.x&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_设置activiti_cdi_setting_up_activiti_cdi">16.1. 设置activiti-cdi (Setting up activiti-cdi)</h3>
<div class="paragraph">
<p>Activiti cdi可以在不同环境中安装。在这个章节我们主要浏览配置选项。</p>
</div>
<div class="sect3">
<h4 id="_查找流程引擎_looking_up_a_process_engine">16.1.1. 查找流程引擎 Looking up a Process Engine</h4>
<div class="paragraph">
<p>cid扩展需要能访问流程引擎，因此会在运行时查找<code>org.activiti.cdi.spi.ProcessEngineLookup</code>接口的实现。cdi模块提供了默认的名为<code>org.activiti.cdi.impl.LocalProcessEngineLookup</code>的实现，使用<code>ProcessEngines</code>-Utility类查找流程引擎，默认配置下使用 <code>ProcessEngines#NAME_DEFAULT</code> 查找流程引擎。需要扩展这个类并设置一个名字。请注意：在classpath中需要有<code>activiti.cfg.xml</code>配置文件。</p>
</div>
<div class="paragraph">
<p>Activiti cdi使用java.util.ServiceLoader SPI解析<code>org.activiti.cdi.spi.ProcessEngineLookup</code>实例。为了提供接口的自定义实现，需要在部署中添加名为<code>META-INF/services/org.activiti.cdi.spi.ProcessEngineLookup</code>的纯文本文件，在其中指定实现的全限定类名。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>如果不提供自定义的<code>org.activiti.cdi.spi.ProcessEngineLookup</code>实现，则Activiti会使用默认的<code>LocalProcessEngineLookup</code>实现。在这种情况下，只需要在classpath中提供activiti.cfg.xml（参见下一章节）即可。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_配置流程引擎_configuring_the_process_engine">16.1.2. 配置流程引擎 Configuring the Process Engine</h4>
<div class="paragraph">
<p>配置方式取决于选用的流程引擎查找策略（上一章节）。这里，我们关注与LocalProcessEngineLookup一起使用的可用配置选项，需要在classpath中提供一个Spring activiti.cfg.xml文件。</p>
</div>
<div class="paragraph">
<p>Activiti根据底层事务管理策略的不同，提供不同的ProcessEngineConfiguration实现。activiti-cdi模块不关注事务，也就意味着可以使用任何事务管理策略（甚至是Spring抽象事务）。按照约定，cdi模块提供两个自定义的ProcessEngineConfiguration实现：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.activiti.cdi.CdiJtaProcessEngineConfiguration</code>: activiti JtaProcessEngineConfiguration的子类，可用于Activiti使用JTA管理事务的情况</p>
</li>
<li>
<p><code>org.activiti.cdi.CdiStandaloneProcessEngineConfiguration</code>: StandaloneProcessEngineConfiguration的子类，可用于Activiti使用简单JDBC事务的情况。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>下面是一个JBoss 7的activiti.cfg.xml文件示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;

	&lt;!-- 查找JTA事务管理器 lookup the JTA-Transaction manager --&gt;
	&lt;bean id="transactionManager" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
		&lt;property name="jndiName" value="java:jboss/TransactionManager"&gt;&lt;/property&gt;
		&lt;property name="resourceRef" value="true" /&gt;
	&lt;/bean&gt;

	&lt;!-- 流程定义配置 process engine configuration --&gt;
	&lt;bean id="processEngineConfiguration"
		class="org.activiti.cdi.CdiJtaProcessEngineConfiguration"&gt;
		&lt;!-- 查找默认的Jboss数据源 lookup the default Jboss datasource --&gt;
		&lt;property name="dataSourceJndiName" value="java:jboss/datasources/ExampleDS" /&gt;
		&lt;property name="databaseType" value="h2" /&gt;
		&lt;property name="transactionManager" ref="transactionManager" /&gt;
		&lt;!-- 使用外部管理事务 using externally managed transactions --&gt;
		&lt;property name="transactionsExternallyManaged" value="true" /&gt;
		&lt;property name="databaseSchemaUpdate" value="true" /&gt;
	&lt;/bean&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>这是Glassfish 3.1.1中的样子（假设已正确配置了名为jdbc/activiti的数据源）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;

	&lt;!-- 查找JTA事务管理器 lookup the JTA-Transaction manager --&gt;
	&lt;bean id="transactionManager" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
		&lt;property name="jndiName" value="java:appserver/TransactionManager"&gt;&lt;/property&gt;
		&lt;property name="resourceRef" value="true" /&gt;
	&lt;/bean&gt;

	&lt;!-- 流程定义配置 process engine configuration --&gt;
	&lt;bean id="processEngineConfiguration"
		class="org.activiti.cdi.CdiJtaProcessEngineConfiguration"&gt;
		&lt;property name="dataSourceJndiName" value="jdbc/activiti" /&gt;
		&lt;property name="transactionManager" ref="transactionManager" /&gt;
		&lt;!-- 使用外部管理事务 using externally managed transactions --&gt;
		&lt;property name="transactionsExternallyManaged" value="true" /&gt;
		&lt;property name="databaseSchemaUpdate" value="true" /&gt;
	&lt;/bean&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意上面的配置需要"spring-context"模块：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
	&lt;groupId&gt;org.springframework&lt;/groupId&gt;
	&lt;artifactId&gt;spring-context&lt;/artifactId&gt;
	&lt;version&gt;3.0.3.RELEASE&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Java SE环境中的配置与<a href="#configuration">创建一个流程引擎</a>章节中的示例一样，使用"StandaloneProcessEngineConfiguration"代替"CdiStandaloneProcessEngineConfiguration"。</p>
</div>
</div>
<div class="sect3">
<h4 id="_部署流程_deploying_processes">16.1.3. 部署流程 Deploying Processes</h4>
<div class="paragraph">
<p>可以使用标准activiti API（<code>RepositoryService</code>）部署流程。另外，activiti-cid也提供了自动部署流程的功能，使用classpath顶层的<code>processes.xml</code>文件提供流程列表。这是一个processes.xml文件的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;!-- 列表需要部署的流程 list the processes to be deployed --&gt;
&lt;processes&gt;
	&lt;process resource="diagrams/myProcess.bpmn20.xml" /&gt;
	&lt;process resource="diagrams/myOtherProcess.bpmn20.xml" /&gt;
&lt;/processes&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cdi的基于上下文的流程执行_contextual_process_execution_with_cdi">16.2. CDI的基于上下文的流程执行 Contextual Process Execution with CDI</h3>
<div class="paragraph">
<p>本章节我们将介绍Activiti cdi扩展使用的基于上下文的流程执行模型。BPMN业务流程通常是一个长期运行的交互动作，包含用户与系统的任务。在运行时，流程分割为独立工作单元的集合，由用户与/或应用逻辑操作。在activiti-cdi中，流程实例可以关联至一个cdi作用域，这个关联代表了一个工作单元。如果工作单元很复杂这就特别有用，例如若一个用户任务由多个不同表单的复杂顺序组成，并需要在交互过程中保持"非流程作用域（non-process-scoped）"状态。</p>
</div>
<div class="paragraph">
<p>在默认配置中，流程实例关联至"broadest（广播）"活动作用域，一开始为会话，并在会话上下文未激活时退化为请求。</p>
</div>
<div class="sect3">
<h4 id="_将一个会话关联至一个流程实例_associating_a_conversation_with_a_process_instance">16.2.1. 将一个会话关联至一个流程实例 Associating a Conversation with a Process Instance</h4>
<div class="paragraph">
<p>当解析@BusinessProcessScoped bean，或注入流程变量时，会依赖一个激活的cdi作用域与一个流程实例的已有关联。Activiti-cdi提供了<code>org.activiti.cdi.BusinessProcess</code> bean用于控制该关联，特别是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>startProcessBy(&#8230;&#8203;)</em>方法，镜像了Activiti <code>RuntimeService</code>服务暴露的对应方法，用于启动并关联一个业务流程，</p>
</li>
<li>
<p><code>resumeProcessById(String processInstanceId)</code>，用于将给定id关联至流程实例，</p>
</li>
<li>
<p><code>resumeTaskById(String taskId)</code>，用于将给定id关联至任务（以及扩展至相关的流程实例）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>当完成了一个工作单元（例如一个用户任务）时，可以调用<code>completeTask()</code>方法，解除流程实例与会话/请求的关联。这将通知Activiti当前任务已完成，并使流程实例继续运行。</p>
</div>
<div class="paragraph">
<p>请注意<code>BusinessProcess</code> bean是一个<code>@Named</code> bean，意味着可以使用表达式语言调用暴露的服务，例如在JSF页面中调用。下面的JSF2代码片段启动了一个新的会话，并将其关联至一个用户任务实例，其id作为请求参数传递（例如<code>pageName.jsf?taskId=XX</code>）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;f:metadata&gt;
&lt;f:viewParam name="taskId" /&gt;
&lt;f:event type="preRenderView" listener="#{businessProcess.startTask(taskId, true)}" /&gt;
&lt;/f:metadata&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_声明式控制流程_declaratively_controlling_the_process">16.2.2. 声明式控制流程 Declaratively controlling the Process</h4>
<div class="paragraph">
<p>Activiti可以使用注解，声明式启动流程实例以及完成任务。<code>@org.activiti.cdi.annotation.StartProcess</code>注解可以通过"key"或"name"启动一个流程实例。请注意流程实例在注解的方法返回<em>之后</em>启动。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@StartProcess("authorizeBusinessTripRequest")
public String submitRequest(BusinessTripRequest request) {
	// 进行操作 do some work
	return "success";
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>取决于Activiti的配置，被注解的方法代码以及流程实例的启动将处于同一个事务中。<code>@org.activiti.cdi.annotation.CompleteTask</code>的使用方式相同：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@CompleteTask(endConversation=false)
public String authorizeBusinessTrip() {
	// 进行操作 do some work
	return "success";
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@CompleteTask</code>注解提供了完成当前会话的能力。默认行为是在调用Activiti返回后结束回话。可以像上面的例子一样，禁用结束会话。</p>
</div>
</div>
<div class="sect3">
<h4 id="_从流程中引用bean_referencing_beans_from_the_process">16.2.3. 从流程中引用Bean (Referencing Beans from the Process)</h4>
<div class="paragraph">
<p>Activiti-cdi使用自定义解析器，将CDI bean暴露给Activiti El。因此可以像这样在流程中引用bean：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;userTask id="authorizeBusinessTrip" name="Authorize Business Trip"
			activiti:assignee="#{authorizingManager.account.username}" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>其中"authorizingManager"可以是生产者方法提供的bean：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Inject @ProcessVariable Object businessTripRequesterUsername;

@Produces
@Named
public Employee authorizingManager() {
	TypedQuery&lt;Employee&gt; query = entityManager.createQuery("SELECT e FROM Employee e WHERE e.account.username='"
		+ businessTripRequesterUsername + "'", Employee.class);
	Employee employee = query.getSingleResult();
	return employee.getManager();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用<code>activiti:expression="myEjb.method()"</code>扩展，在服务任务中调用一个EJB中的业务方法。请注意这需要在<code>MyEjb</code>类上使用<code>@Named</code>注解。</p>
</div>
</div>
<div class="sect3">
<h4 id="_使用_businessprocessscoped_bean_working_with_businessprocessscoped_beans">16.2.4. 使用@BusinessProcessScoped bean (Working with @BusinessProcessScoped beans)</h4>
<div class="paragraph">
<p>使用activiti-cdi，可以将一个bean的生命周期绑定在一个流程实例上。因此，提供了名为BusinessProcessContext的自定义的上下文实现。BusinessProcessScoped bean的实例将作为流程变量存储在当前流程实例中。BusinessProcessScoped bean需要是可持久化（PassivationCapable，例如Serializable）的。下面是一个流程作用域bean的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Named
@BusinessProcessScoped
public class BusinessTripRequest implements Serializable {
	private static final long serialVersionUID = 1L;
	private String startDate;
	private String endDate;
	// ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>有时希望在没有关联至流程实例的情况下使用流程作用域bean，例如在流程启动前。如果当前没有激活的流程实例，则BusinessProcessScoped bean的实例将临时存储在本地作用域（也就是会话或请求中，取决于上下文）。如果该作用域之后关联至一个业务流程实例，则会将bean实例刷入该流程实例。</p>
</div>
</div>
<div class="sect3">
<h4 id="_注入流程变量_injecting_process_variables">16.2.5. 注入流程变量 Injecting Process Variables</h4>
<div class="paragraph">
<p>可以注入流程变量。Activiti-CDI支持</p>
</div>
<div class="ulist">
<ul>
<li>
<p>使用<code>@Inject \[additional qualifiers\] Type fieldName</code>类型安全地注入<code>@BusinessProcessScoped</code> bean</p>
</li>
<li>
<p>使用<code>@ProcessVariable(name?)</code>限定名不安全地注入其它流程变量：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Inject @ProcessVariable Object accountNumber;
@Inject @ProcessVariable("accountNumber") Object account</code></pre>
</div>
</div>
<div class="paragraph">
<p>要在EL中引用流程变量，有类似的选择：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@Named @BusinessProcessScoped</code> bean可以直接引用，</p>
</li>
<li>
<p>其它流程变量可以通过<code>ProcessVariables</code> bean引用：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>#{processVariables['accountNumber']}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_接收流程事件_receiving_process_events">16.2.6. 接收流程事件 Receiving Process Events</h4>
<div class="paragraph">
<p><a href="#experimental">[EXPERIMENTAL]</a></p>
</div>
<div class="paragraph">
<p>Activiti可以关联至CDI事件总线。这样可以使用标准CDI事件机制获取流程事件。要为Activiti启用CDI事件支持，需要在配置中启用相应的处理监听器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;property name="postBpmnParseHandlers"&gt;
	&lt;list&gt;
		&lt;bean class="org.activiti.cdi.impl.event.CdiEventSupportBpmnParseHandler" /&gt;
	&lt;/list&gt;
&lt;/property&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>这样Activiti就被配置为使用CDI事件总线发布事件。下面介绍如何在CDI bean中接收流程事件。事件通知是类型安全的。流程事件的类型是<code>org.activiti.cdi.BusinessProcessEvent</code>。下面是一个简单的事件观察者方法的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public void onProcessEvent(@Observes BusinessProcessEvent businessProcessEvent) {
	// 处理事件 handle event
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>观察者将会被通知所有事件。如果需要限制观察者接收的事件，可以添加限定注解：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@BusinessProcess</code>: 限制事件为特定的流程定义。例如：<code>@Observes @BusinessProcess("billingProcess") BusinessProcessEvent evt</code></p>
</li>
<li>
<p><code>@StartActivity</code>: 使用特定的活动限制事件。例如：<code>@Observes @StartActivity("shipGoods") BusinessProcessEvent evt</code>将在进入id为"shipGoods"的活动时调用。</p>
</li>
<li>
<p><code>@EndActivity</code>: 使用特定的活动限制事件。例如：<code>@Observes @EndActivity("shipGoods") BusinessProcessEvent evt</code>将在离开id为"shipGoods"的活动时调用。</p>
</li>
<li>
<p><code>@TakeTransition</code>: 使用特定的路径限制事件。</p>
</li>
<li>
<p><code>@CreateTask</code>: 使用特定任务的创建限制事件。</p>
</li>
<li>
<p><code>@DeleteTask</code>: 使用特定任务的删除限制事件。</p>
</li>
<li>
<p><code>@AssignTask</code>: 使用特定任务的指派限制事件。</p>
</li>
<li>
<p><code>@CompleteTask</code>: 使用特定任务的完成限制事件。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>上面的限定名可以自由组合。例如，要接收离开"shipmentProcess"中的"shipGoods"活动时生成的所有事件，可以撰写下面的观察者方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public void beforeShippingGoods(@Observes @BusinessProcess("shippingProcess") @EndActivity("shipGoods") BusinessProcessEvent evt) {
	// 处理事件 handle event
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在默认配置中，事件监听器将在上下文的相同事务中同步调用。CDI事务性观察者（CDI transactional observer，只能与JavaEE/EJB一起使用）可以在事件交给观察者方法时控制。使用事务性观察者，可以例如保证观察者只在触发事件的事务成功时才被通知：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public void onShipmentSuceeded(@Observes(during=TransactionPhase.AFTER_SUCCESS) @BusinessProcess("shippingProcess") @EndActivity("shipGoods") BusinessProcessEvent evt) {
	// 给客户发送邮件。 send email to customer.
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_额外功能_additional_features">16.2.7. 额外功能 Additional Features</h4>
<div class="ulist">
<ul>
<li>
<p>可以注入流程引擎与服务：<code>@Inject ProcessEngine, RepositoryService, TaskService</code>, &#8230;&#8203;</p>
</li>
<li>
<p>可以注入当前的流程实例与任务：<code>@Inject ProcessInstance, Task</code>,</p>
</li>
<li>
<p>可以注入当前的businessKey：<code>@Inject @BusinessKey String businessKey</code>,</p>
</li>
<li>
<p>可以注入当前的流程实例id：<code>@Inject @ProcessInstanceId String pid</code>+</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_已知限制_known_limitations">16.3. 已知限制 Known Limitations</h3>
<div class="paragraph">
<p>尽管activiti-cdi依靠SPI实现，并设计为“移动性扩展”，但只使用Weld进行了测试。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chapter_ldap">17. 集成LDAP (LDAP integration)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>公司通常已经有了LDAP（Lightweight Directory Access Protocol，轻量级目录访问协议）系统形式的用户与组存储。从5.14版本开始，Activiti提供了一个立即可用的解决方案，可以简单配置Activiti与LDAP系统连接的方式。</p>
</div>
<div class="paragraph">
<p>在Activiti 5.14版本以前，也可以为Activiti集成LDAP。然而，在5.14中大幅简化了配置。但配置LDAP的“老”方法仍然可用。实际上，简化配置只是在“老”基础上进行的包装。</p>
</div>
<div class="sect2">
<h3 id="ldap_usage">17.1. 使用 Usage</h3>
<div class="paragraph">
<p>要在你的项目中添加LDAP集成代码，简单地在pom.xml中添加下列依赖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.activiti&lt;/groupId&gt;
  &lt;artifactId&gt;activiti-ldap&lt;/artifactId&gt;
  &lt;version&gt;latest.version&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ldap_usecases">17.2. 用例 Use cases</h3>
<div class="paragraph">
<p>目前LDAP集成有两大使用场景：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>通过IdentityService进行认证。例如在使用Activiti Explorer，并需要通过LDAP登录时很有用。</p>
</li>
<li>
<p>获取一个组中的用户。例如在查询一个特定用户可见的任务（也就是说，特定候选组的任务）时很重要。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="ldap_configuration">17.3. 配置 Configuration</h3>
<div class="paragraph">
<p>在Activiti中集成LDAP系统通过在流程引擎配置的<code>configurators</code>小节注入<code>org.activiti.ldap.LDAPConfigurator</code>完成。这个类高度可扩展：如果默认实现不能满足使用场景，可以轻松地覆盖方法，许多依赖的bean也是可插拔的。</p>
</div>
<div class="paragraph">
<p>这是一个示例配置（请注意：当然，在编程式创建引擎时完全类似）。现在不需要太关注这些参数，我们会在下一章节详细介绍。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;bean id="processEngineConfiguration" class="...SomeProcessEngineConfigurationClass"&gt;
        ...
        &lt;property name="configurators"&gt;
          &lt;list&gt;
              &lt;bean class="org.activiti.ldap.LDAPConfigurator"&gt;

                &lt;!-- 服务器连接参数 Server connection params --&gt;
                &lt;property name="server" value="ldap://localhost" /&gt;
                &lt;property name="port" value="33389" /&gt;
                &lt;property name="user" value="uid=admin, ou=users, o=activiti" /&gt;
                &lt;property name="password" value="pass" /&gt;

                &lt;!-- 查询参数 Query params --&gt;
                &lt;property name="baseDn" value="o=activiti" /&gt;
                &lt;property name="queryUserByUserId" value="(&amp;(objectClass=inetOrgPerson)(uid={0}))" /&gt;
                &lt;property name="queryUserByFullNameLike" value="(&amp;(objectClass=inetOrgPerson)(|({0}=*{1}*)({2}=*{3}*)))" /&gt;
                &lt;property name="queryGroupsForUser" value="(&amp;(objectClass=groupOfUniqueNames)(uniqueMember={0}))" /&gt;

                &lt;!-- 属性配置 Attribute config --&gt;
                &lt;property name="userIdAttribute" value="uid" /&gt;
                &lt;property name="userFirstNameAttribute" value="cn" /&gt;
                &lt;property name="userLastNameAttribute" value="sn" /&gt;
                &lt;property name="userEmailAttribute" value="mail" /&gt;


                &lt;property name="groupIdAttribute" value="cn" /&gt;
                &lt;property name="groupNameAttribute" value="cn" /&gt;

              &lt;/bean&gt;
          &lt;/list&gt;
        &lt;/property&gt;
    &lt;/bean&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ldap_properties">17.4. 参数 Properties</h3>
<div class="paragraph">
<p>可以为<code>org.activiti.ldap.LDAPConfigurator</code>设置下列参数：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 261. LDAP配置参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP系统的服务器。例如&#8217;ldap://localhost:33389'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP系统运行的端口</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接LDAP系统的用户id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接LDAP系统的密码</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initialContextFactory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接LDAP的InitialContextFactory的名字</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.sun.jndi.ldap.LdapCtxFactory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">securityAuthentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接LDAP系统时使用的&#8217;java.naming.security.authentication&#8217;参数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">simple</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">customConnectionParameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于设置没有专门setter的所有LDAP连接参数。例如 <a href="http://docs.oracle.com/javase/tutorial/jndi/ldap/jndi.html" class="bare">http://docs.oracle.com/javase/tutorial/jndi/ldap/jndi.html</a> 中的自定义参数。这些参数用于配制连接池，指定安全选项，等等。当创建到LDAP系统的连接时，会提供所有设置的参数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map&lt;String, String&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">baseDn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">开始搜索用户与组的基础“区分名”（distinguished name，DN）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userBaseDn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">开始搜索用户的基础“区分名”（distinguished name，DN）。如果未提供，则使用baseDn（见上）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupBaseDn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">开始搜索组的基础“区分名”（distinguished name，DN）。如果未提供，则使用baseDn（见上）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">searchTimeLimit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在LDAP中搜索时的超时时间，以毫秒计</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一个小时</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">queryUserByUserId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用userId搜索用户时执行的查询。例如：(&amp;(objectClass=inetOrgPerson)(uid={0})) 。将返回LDAP中所有class为&#8217;inetOrgPerson'，并匹配&#8217;uid&#8217;属性的值的对象。在例子中，用户id使用{0}注入。如果对于特定的LDAP配置，只使用该查询不满足要求，则可以使用不同的LDAPQueryBuilder插件，提供比查询更高的自由度。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">queryUserByFullNameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用全名搜索用户时执行的查询。例如：(&amp; (objectClass=inetOrgPerson) (|({0}=<strong>{1}</strong>)({2}=<strong>{3}</strong>)) ) 。将返回LDAP中所有class为&#8217;inetOrgPerson'，并匹配first name与last name的值的对象。请注意{0}注入为firstNameAttribute（在上面定义），{1}与{3}为搜索文本，{2}为lastNameAttribute。如果对于特定的LDAP配置，只使用该查询不满足要求，则可以使用不同的LDAPQueryBuilder插件，提供比查询更高的自由度。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">queryGroupsForUser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查找特定用户的组时执行的查询。例如：(&amp;(objectClass=groupOfUniqueNames)(uniqueMember={0})) 。将返回class为&#8217;groupOfUniqueNames'，且提供的DN（匹配用户的DN）为&#8217;uniqueMember&#8217;的对象。在例子中，用户id使用{0}注入。如果对于特定的LDAP配置，只使用该查询不满足要求，则可以使用不同的LDAPQueryBuilder插件，提供比查询更高的自由度。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userIdAttribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">匹配用户id的属性的名字。这个属性用于查找用户对象，并完成LDAP对象与Activiti用户对象间的映射。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userFirstNameAttribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">匹配用户first name的属性的名字。这个属性用于查找用户对象，并完成LDAP对象与Activiti用户对象间的映射。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userLastNameAttribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">匹配用户last name的属性的名字。这个属性用于查找用户对象，并完成LDAP对象与Activiti用户对象间的映射。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupIdAttribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">匹配组id的属性的名字。这个属性用于查找组对象，并完成LDAP对象与Activiti用户对象间的映射。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupNameAttribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">匹配组name的属性的名字。这个属性用于查找组对象，并完成LDAP对象与Activiti用户对象间的映射。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupTypeAttribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">匹配组type的属性的名字。这个属性用于查找组对象，并完成LDAP对象与Activiti用户对象间的映射。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>下面的参数用于自定义默认行为或引入组缓存：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 262. 高级参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldapUserManagerFactory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果默认实现不符合要求，设置一个自定义的LDAPUserManagerFactory实现。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAPUserManagerFactory的实例</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldapGroupManagerFactory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果默认实现不符合要求，设置一个自定义的LDAPGroupManagerFactory实现。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAPGroupManagerFactory的实例</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldapMemberShipManagerFactory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果默认实现不符合要求，设置一个自定义的LDAPMembershipManagerFactory实现。请注意很少出现这种情况，因为一般使用LDAP系统管理成员信息。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAPMembershipManagerFactory的实例</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldapQueryBuilder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果默认实现不符合要求，设置一个自定义的查询构建器。当在LDAP系统中使用LDAPUserManager或LDAPGroupManage进行实际查询时，会使用LDAPQueryBuilder的实例。默认实现使用在本实例中设置的参数，例如queryGroupsForUser与queryUserById</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.activiti.ldap.LDAPQueryBuilder的实例</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupCacheSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于设置组缓存的大小。这是一个为用户缓存组的LRU缓存，可以避免每次需要查询用户所在组的时候都访问LDAP系统。
</p><p class="tableblock"> 如果值小于0则不会使用缓存。默认值为-1，因此不会进行缓存。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupCacheExpirationTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">设置组缓存的过期时间，以毫秒计。当获取了一个特定用户的组，且存在组缓存时，会将组存储在缓存中，持续本参数设置的时间。也就是说，如果在00:00获取了一个组，过期时间为30分钟，则00:30之后进行的获取该用户组操作都不会使用该缓存，而是会从LDAP系统中重新获取。同样的，在00:00 - 00:30间会从该缓存中获取。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一个小时</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>使用活动目录（Active Directory）时请注意：Activiti论坛的用户报告，在使用活动目录时，需要将&#8217;InitialDirContext&#8217;设置为Context.REFERRAL。可以通过customConnectionParameters map按上面介绍的方法传递。</p>
</div>
</div>
<div class="sect2">
<h3 id="lda-explorer">17.5. 在Explorer中集成LDAP (Integrate LDAP in Explorer)</h3>
<div class="ulist">
<ul>
<li>
<p>在<code>activiti-standalone-context.xml</code>中添加上面介绍的LDAP配置</p>
</li>
<li>
<p>在WEB-INF/lib中添加activiti-ldap jar</p>
</li>
<li>
<p>移除<code>demoDataGenerator</code> bean，因为它会尝试添加用户（在集成LDAP时不允许）</p>
</li>
<li>
<p>为<code>activiti-ui.context</code>中的<code>explorerApp</code> bean添加下列配置：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;property name="adminGroups"&gt;
  &lt;list&gt;
    &lt;value&gt;admin&lt;/value&gt;
  &lt;/list&gt;
  &lt;/property&gt;
  &lt;property name="userGroups"&gt;
    &lt;list&gt;
      &lt;value&gt;user&lt;/value&gt;
    &lt;/list&gt;
&lt;/property&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>直接使用你自己的值替换即可。需要使用的值是组的id（通过<code>groupIdAttribute</code>配置）。上面的配置将使&#8217;admin&#8217;组中的所有成员都成为Activiti Explorer的管理员用户，对于user组也类似。任何不匹配这些值的组都将成为&#8217;assignment&#8217;组，也就是说可以将任务指派给他们。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_高级_advanced">18. 高级 Advanced</h2>
<div class="sectionbody">
<div class="paragraph">
<p>下面的章节介绍了Activiti的高级用例，超出了一般的BPMN 2.0流程执行的范畴。因此，要理解这里的材料需要对Activiti足够熟练与精通。</p>
</div>
<div class="sect2">
<h3 id="advanced_parseHandlers">18.1. 异步与作业执行器 Async and job executor</h3>
<div class="paragraph">
<p>从5.17.0版本开始，Activiti在已有的作业执行器之外，还提供了异步执行器。在Activiti引擎中，两个执行器都处理定时器与异步作业，因此只能启用一个执行器。这个章节将介绍异步执行器与作业执行器的区别，以及为什么我们推荐使用异步执行器。请注意默认情况下Activiti使用已有的作业执行器，因为我们不希望没有进行明确的配置就启用异步执行器。</p>
</div>
<div class="sect3">
<h4 id="_异步执行器的设计_async_executor_design">18.1.1. 异步执行器的设计 Async executor design</h4>
<div class="paragraph">
<p>异步执行器包含了一个用于执行定时器与异步作业的线程池。当启用时，引擎将会使用已经持久化的异步作业实体调用异步执行器，然后线程池将异步地执行该作业。这是与老的作业执行器的主要区别，因为在异步作业已被持久化的情况下，作业执行器将会轮询数据库获取新作业。如果找到了一个作业，将锁定并执行它，这意味着大量额外的数据库通信。异步执行器会直接执行异步作业，而不会先轮询数据库。如果异步作业是一个排他作业，异步执行器将首先锁定流程实例的执行，如果成功则将执行作业，并之后解锁流程实例执行。如果锁定流程实例失败，则会重试。</p>
</div>
<div class="paragraph">
<p>定时器作业的逻辑与异步作业不同。对于定时器作业，异步与作业执行器的实现相近。异步执行器将轮询数据库中到期的定时器作业。然后会锁定并执行作业。</p>
</div>
</div>
<div class="sect3">
<h4 id="_作业执行器的设计_job_executor_design">18.1.2. 作业执行器的设计 Job executor design</h4>
<div class="paragraph">
<p>作业执行器也包含了一个用于执行定时器与异步作业的线程池。当启用时，作业执行器会轮询数据库，获取异步作业与定时器作业的到期时间。如果找到了一个作业，执行器将锁定并执行该作业，这意味着大量额外的数据库通信。相对应的，异步执行器会直接执行异步作业，而不会首先轮询数据库。</p>
</div>
</div>
<div class="sect3">
<h4 id="_异步执行器的优点_advantages_of_the_async_executor">18.1.3. 异步执行器的优点 Advantages of the Async executor</h4>
<div class="ulist">
<ul>
<li>
<p>更少的数据库查询，因为异步作业不通过轮询数据库就执行</p>
</li>
<li>
<p>对于非排他作业，不会再遇到OptimisticLockingExceptions（乐观锁异常）</p>
</li>
<li>
<p>排他作业现在锁定在流程实例级别，而不是在作业执行器中那样，使用笨重的逻辑查询排他作业。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_配置异步执行器_async_executor_configuration">18.1.4. 配置异步执行器 Async executor configuration</h4>
<div class="paragraph">
<p>可以为异步执行器定义线程池大小与其他配置项。我们建议查看异步执行器的默认设置，核实其是否符合你的流程实例的要求。</p>
</div>
<div class="paragraph">
<p>要覆盖异步执行器的默认设置，需要在流程引擎配置中注入一个新的bean，像是：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;property name="asyncExecutor" ref="asyncExecutor" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以覆盖默认的异步执行器，以覆盖默认设置，当然也可以从DefaultAsyncJobExecutor类扩展。下面列出的配置中，DefaultAsyncJobExecutor的参数使用了新的值：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;bean id="asyncExecutor" class="org.activiti.engine.impl.asyncexecutor.DefaultAsyncJobExecutor"&gt;
    &lt;property name="corePoolSize" value="10" /&gt;
    &lt;property name="maxPoolSize" value="50" /&gt;
    &lt;property name="keepAliveTime" value="3000" /&gt;
    &lt;property name="queueSize" value="200" /&gt;
    &lt;property name="maxTimerJobsPerAcquisition" value="2" /&gt;
    &lt;property name="maxAsyncJobsDuePerAcquisition" value="2" /&gt;
    &lt;property name="defaultAsyncJobAcquireWaitTimeInMillis" value="1000" /&gt;
    &lt;property name="defaultTimerJobAcquireWaitTimeInMillis" value="1000" /&gt;
    &lt;property name="timerLockTimeInMillis" value="60000" /&gt;
    &lt;property name="asyncJobLockTimeInMillis" value="60000" /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 263. 异步执行器配置选项</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名字</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">corePoolSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">线程池中为执行作业保留的最小线程数量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxPoolSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">线程池中为执行作业保留的最大线程数量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">keepAliveTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在销毁执行作业所用的线程前，需要保持活动的时间（以毫秒计）。默认设置为5000。设置为非默认的0值会消耗资源，但在有大量执行作业的时候，可以避免总是创建新线程。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">queueSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">放置待执行作业的队列的大小。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxTimerJobsPerAcquisition</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在一次查询中获取的将到期定时器作业的数量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxAsyncJobsDuePerAcquisition</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在一次数据库查询中获取的异步作业的数量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">defaultAsyncJobAcquireWaitTimeInMillis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在两次执行异步作业查询之间等待的时间，以毫秒计。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">defaultTimerJobAcquireWaitTimeInMillis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在两次执行将到期定时器作业查询之间等待的时间，以毫秒计。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timerLockTimeInMillis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">300000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在重试之前，定时器作业进行锁定操作的时间，以毫秒计。在该时间之后，Activiti引擎会视为定时器作业已经失败，并将重试锁定。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncJobLockTimeInMillis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">300000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在重试之前，异步作业进行锁定操作的时间，以毫秒计。在该时间之后，Activiti引擎会视为异步作业已经失败，并将重试锁定。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_深入流程解析_hooking_into_process_parsing">18.2. 深入流程解析 Hooking into process parsing</h3>
<div class="paragraph">
<p>一个BPMN 2.0 XML需要解析为Activiti的内部模型，才能在Activiti引擎中执行。解析发生在部署流程时；或没有在内存中找到流程的时候，这时将会从数据库获取XML。</p>
</div>
<div class="paragraph">
<p>对于每一个流程，<code>BpmnParser</code>类都会创建一个新的<code>BpmnParser</code>实例。这个实例是所有在解析时要做的事情的容器。解析本身很简单：对于每一个BPMN 2.0元素，引擎中都有一个对应的<code>org.activiti.engine.parse.BpmnParseHandler</code>的实例。因此，解析器会将一个BPMN 2.0元素类映射至一个<code>BpmnParseHandler</code>实例。默认情况下，Activiti使用<code>BpmnParseHandler</code>实例处理所有支持的元素，并用其为流程的步骤附加执行监听器，以创建历史。</p>
</div>
<div class="paragraph">
<p>可以在Activiti引擎中添加<code>org.activiti.engine.parse.BpmnParseHandler</code>的自定义实例。常见使用场景是，例如为特定步骤添加执行监听器，用于向某个事件处理队列触发事件。Activiti内部使用这种方式处理历史。要添加这种自定义处理器，需要调整Activiti配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;property name="preBpmnParseHandlers"&gt;
  &lt;list&gt;
    &lt;bean class="org.activiti.parsing.MyFirstBpmnParseHandler" /&gt;
  &lt;/list&gt;
&lt;/property&gt;

&lt;property name="postBpmnParseHandlers"&gt;
  &lt;list&gt;
    &lt;bean class="org.activiti.parsing.MySecondBpmnParseHandler" /&gt;
    &lt;bean class="org.activiti.parsing.MyThirdBpmnParseHandler" /&gt;
  &lt;/list&gt;
&lt;/property&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>在<code>preBpmnParseHandlers</code>参数中配置的<code>BpmnParseHandler</code>实例的列表将添加在任何默认处理器之前。类似的，<code>postBpmnParseHandlers</code>中的将添加在默认处理器之后。在顺序会影响自定义解析处理器中包含的逻辑时很重要。</p>
</div>
<div class="paragraph">
<p><code>org.activiti.engine.parse.BpmnParseHandler</code>是一个简单的接口：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface BpmnParseHandler {

  Collection&lt;Class&gt;? extends BaseElement&gt;&gt; getHandledTypes();

  void parse(BpmnParse bpmnParse, BaseElement element);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>getHandledTypes()</code>方法返回该解析器处理的所有类型的集合。通过集合的泛型决定了可用的类型是<code>BaseElement</code>的子类。也可以扩展<code>AbstractBpmnParseHandler</code>类，并覆盖<code>getHandledType()</code>方法，它只返回一个类而不是一个集合。这个类也包含了一些默认解析处理器共享的辅助方法。当解析器遇到任何该方法的返回类型时，将调用<code>BpmnParseHandler</code>实例。在下面的例子里，当遇到BPMN 2.0 XML中包含的流程时，将会执行<code>executeParse</code>方法（这是一个类型转换方法，取代了<code>BpmnParseHandler</code>接口中的普通<code>parse</code>方法）中的逻辑。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class TestBPMNParseHandler extends AbstractBpmnParseHandler&lt;Process&gt; {

  protected Class&lt;? extends BaseElement&gt; getHandledType() {
    return Process.class;
  }

  protected void executeParse(BpmnParse bpmnParse, Process element) {
     ..
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>重要提示：</strong>在撰写自定义解析处理器时，不要使用任何用于解析BPMN 2.0结构的内部类。这将导致很难查找bug。实现一个自定义处理器安全的做法是实现<em>BpmnParseHandler</em>接口，或扩展内部抽象类<em>org.activiti.engine.impl.bpmn.parser.handler.AbstractBpmnParseHandler</em>。</p>
</div>
<div class="paragraph">
<p>可以（但不常见）替换默认用于将BPMN 2.0元素解析为Activiti内部模型的<code>BpmnParseHandler</code>实例。可以通过下面的代码片段实现：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;property name="customDefaultBpmnParseHandlers"&gt;
  &lt;list&gt;
    ...
  &lt;/list&gt;
&lt;/property&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>简单的例子是用于将所有服务任务都强制异步执行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class CustomUserTaskBpmnParseHandler extends ServiceTaskParseHandler {

  protected void executeParse(BpmnParse bpmnParse, ServiceTask serviceTask) {

    // 进行常规操作 Do the regular stuff
    super.executeParse(bpmnParse, serviceTask);

    // 保证异步 Make always async
    ActivityImpl activity = findActivity(bpmnParse, serviceTask.getId());
    activity.setAsync(true);
  }

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="advanced.uuid.generator">18.3. 高并发下使用的UUID id生成器 UUID id generator for high concurrency</h3>
<div class="paragraph">
<p>在某些（非常）高并发负载的情况下，默认的id生成器可能会由于不能足够快地获取新的id块而产生异常。每一个流程引擎都有一个id生成器。默认的id生成器在数据库中保留一个块的id，这样其他引擎就不能使用同一个块中的id。在引擎操作时，当默认的id生成器发现id块已经用完，就会启动一个新的事务，来获取一个新的块。在（非常）有限的使用场景下，当负载非常高时可能导致问题。对于大多数用例来说，默认的id生成器已经足够使用了。默认的<code>org.activiti.engine.impl.db.DbIdGenerator</code>也有一个<code>idBlockSize</code>参数，用于配置保留的id块的大小，可以调整获取id的行为。</p>
</div>
<div class="paragraph">
<p>默认的id生成器的替代品是<code>org.activiti.engine.impl.persistence.StrongUuidGenerator</code>，它会在本地生成一个唯一的<a href="http://en.wikipedia.org/wiki/Universally_unique_identifier">UUID</a>，并将其用作所有实体的标识符。因为UUID不需要访问数据库就能生成，因此在非常高并发的使用场景下更合适。请注意取决于机器，性能可能与默认的id生成器不同（更好更坏都有可能）。</p>
</div>
<div class="paragraph">
<p>可以在activiti配置中，像下面这样配置UUID生成器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;property name="idGenerator"&gt;
    &lt;bean class="org.activiti.engine.impl.persistence.StrongUuidGenerator" /&gt;
&lt;/property&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用UUID id生成器需要添加下列额外依赖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;dependency&gt;
    &lt;groupId&gt;com.fasterxml.uuid&lt;/groupId&gt;
    &lt;artifactId&gt;java-uuid-generator&lt;/artifactId&gt;
    &lt;version&gt;3.1.3&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="advanced.tenancy">18.4. 多租户 Multitenancy</h3>
<div class="paragraph">
<p>总的来说，多租户是一个软件为多个不同组织提供服务的概念。其核心是数据是隔离的，一个组织不能看到其他组织的数据。在这个语境中，一个这样的组织（或部门、团队……）被称为一个<em>租户（tenant）</em>。</p>
</div>
<div class="paragraph">
<p>请注意它与多实例安装方式有本质区别，其中多实例安装是指每一个组织都分别运行一个Activiti流程引擎实例（并使用不同的数据库账户）。尽管Activiti比较轻量级，运行一个流程引擎实例不会花费太多资源，但多实例安装仍然增加了复杂性与维护量。但是，在某些使用场景中，多实例安装可能是正确的解决方案。</p>
</div>
<div class="paragraph">
<p>Activiti中的多租户主要围绕着隔离数据实现。要注意<em>Activiti并不强制多租户规则</em>。这意味着当查询与使用数据时，并不会验证进行操作的用户是否属于正确的租户。这应该在调用Activiti引擎的层次实现。Activiti确保可以存储租户信息，并在获取流程数据时使用。</p>
</div>
<div class="paragraph">
<p>在Activiti流程引擎中部署流程定义时，可以传递一个<em>租户标识符（tenant identifier）</em>。这是一个字符串（例如一个UUID，部门id，等等……），限制为256个字符长，唯一标识租户：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">repositoryService.createDeployment()
            .addClassPathResource(...)
            .tenantId("myTenantId")
            .deploy();</code></pre>
</div>
</div>
<div class="paragraph">
<p>在部署时传递一个租户id带有下列含义：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>部署中包含的所有流程定义都将从该部署集成租户标识符。</p>
</li>
<li>
<p>从这些流程定义启动的所有流程实例都将从流程定义继承租户标识符。</p>
</li>
<li>
<p>在执行流程实例时，运行时创建的所有任务都将从流程实例继承租户标识符。独立任务也可以有租户标识符。</p>
</li>
<li>
<p>执行流程实例时创建的所有执行都将从流程实例继承租户标识符。</p>
</li>
<li>
<p>触发一个信号抛出事件（在流程内或通过API）时可以提供一个租户标识符。这个信号将只在该租户的上下文中执行：也就是说，如果有多个使用相同名字的信号捕获事件，只会调用带有正确租户标识符的事件。</p>
</li>
<li>
<p>所有作业（定时器与异步延续）要么从流程定义（例如定时器启动事件），要么从流程实例（运行时创建的作业，例如异步延续）继承租户标识符。这可以用于在自定义作业执行器中为部分租户设置优先级。</p>
</li>
<li>
<p>所有历史实体（历史流程实例、任务与活动）都从其对应的运行时对象继承租户标识符。</p>
</li>
<li>
<p>另外，模型也可以有租户标识符（模型在例如Activiti Modeler存储BPMN 2.0模型的时候使用）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>为了实际使用流程数据上的租户标识符，所有查询API都可以通过租户过滤。例如（也可以使用其他实体的对应查询实现替换）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">runtimeService.createProcessInstanceQuery()
    .processInstanceTenantId("myTenantId")
    .processDefinitionKey("myProcessDefinitionKey")
    .variableValueEquals("myVar", "someValue")
    .list()</code></pre>
</div>
</div>
<div class="paragraph">
<p>查询API也可以使用<em>like</em>语义通过租户标识符过滤，也可以过滤掉没有租户标识符的实体。</p>
</div>
<div class="paragraph">
<p><strong>重要的实现细节：</strong>由于数据库的原因（更确切地说，唯一约束的null处理），<em>默认的</em>代表<em>没有租户</em>的租户标识符为<strong>空字符串</strong>。（流程定义key，流程定义版本，租户标识符）的组合需要是唯一的（并且通过数据库约束检查）。也请注意租户标识符不能设置为null，不然会影响查询，因为某些数据库（Oracle）将空字符串当做null值（这就是为什么<em>.withoutTenantId</em>查询不检查空字符串还是null）。这意味着同一个流程定义（有相同的流程定义key）可以为多个租户部署，每一个租户都有他们自己的版本。并不会影响未使用租户时的使用方式。</p>
</div>
<div class="paragraph">
<p><strong>请注意上面所说都不与在集群中运行多个Activiti实例冲突。</strong></p>
</div>
<div class="paragraph">
<p>[试验性] 可以调用<em>repositoryService</em>的<em>changeDeploymentTenantId(String deploymentId, String newTenantId)</em>方法修改租户标识符。这将修改每一处之前继承的租户标识符。在从非多租户环境迁移至多租户配置时很有用。查看该方法的Javadoc了解更多细节信息。</p>
</div>
</div>
<div class="sect2">
<h3 id="advanced.custom.sql.queries">18.5. 执行自定义SQL Execute custom SQL</h3>
<div class="paragraph">
<p>Activiti API可以通过高级API与数据库交互。例如，要获取数据，查询API与原生（Native）查询API各有用武之地。然而，在某些用例下，可能不够灵活。下面的章节描述了如何在Activiti数据存储中执行完全自定义的SQL语句（select、insert、update与delete都可以），且完全在配置的流程引擎范围内（例如因此可以使用事务设置）。</p>
</div>
<div class="paragraph">
<p>要定义自定义SQL语句，activiti引擎使用其底层框架MyBatis的功能。可以在<a href="http://mybatis.github.io/mybatis-3/java-api.html">MyBatis用户手册中</a>阅读更多信息。</p>
</div>
<div class="sect3">
<h4 id="_基于注解的映射语句_annotation_based_mapped_statements">18.5.1. 基于注解的映射语句 Annotation based Mapped Statements</h4>
<div class="paragraph">
<p>当使用基于注解的映射语句时，首先要做的是创建一个ByBatis映射类。例如，假设在某个用例中，不需要所有的任务数据，而只需要其中很少一部分。可以通过映射类完成，像是这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface MyTestMapper {

    @Select("SELECT ID_ as id, NAME_ as name, CREATE_TIME_ as createTime FROM ACT_RU_TASK")
    List&lt;Map&lt;String, Object&gt;&gt; selectTasks();

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>该映射类必须像下面这样提供给流程引擎配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">...
&lt;property name="customMybatisMappers"&gt;
  &lt;set&gt;
    &lt;value&gt;org.activiti.standalone.cfg.MyTestMapper&lt;/value&gt;
  &lt;/set&gt;
&lt;/property&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意这是一个接口。底层的MyBatis框架会构造一个它的实例，并在运行时使用。也请注意方法的返回值没有类型，而只是一个map的list（代表了带有列数据的行的列表）。如果需要，可以通过MyBatis映射类设置类型。</p>
</div>
<div class="paragraph">
<p>要执行上面的查询，必须使用<em>managementService.executeCustomSql</em>方法。这个方法使用一个<em>CustomSqlExecution</em>实例。这是一个包装器，将引擎需要处理的内部数据隐藏起来。</p>
</div>
<div class="paragraph">
<p>不幸的是，Java泛型让它没有本应该的那么可读。下面的两个泛型类是映射类与其返回类型类。然而，实际的逻辑就是简单的调用映射方法，并返回其结果（若有）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">CustomSqlExecution&lt;MyTestMapper, List&lt;Map&lt;String, Object&gt;&gt;&gt; customSqlExecution =
          new AbstractCustomSqlExecution&lt;MyTestMapper, List&lt;Map&lt;String, Object&gt;&gt;&gt;(MyTestMapper.class) {

  public List&lt;Map&lt;String, Object&gt;&gt; execute(MyTestMapper customMapper) {
    return customMapper.selectTasks();
  }

};

List&lt;Map&lt;String, Object&gt;&gt; results = managementService.executeCustomSql(customSqlExecution);</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个例子里，上面列出的映射实体只包含<em>id, name与创建时间</em>，而不是完整的任务对象。</p>
</div>
<div class="paragraph">
<p>上面的方法可以使用任何SQL。另一个更复杂的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Select({
        "SELECT task.ID_ as taskId, variable.LONG_ as variableValue FROM ACT_RU_VARIABLE variable",
        "inner join ACT_RU_TASK task on variable.TASK_ID_ = task.ID_",
        "where variable.NAME_ = #{variableName}"
    })
    List&lt;Map&lt;String, Object&gt;&gt; selectTaskWithSpecificVariable(String variableName);</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用这个方法，会将任务表与变量表联合。只选择变量有特定名字的记录，并返回任务id与对应的数字值。</p>
</div>
<div class="paragraph">
<p>对于使用基于注解的映射语句的实际例子，请查看单元测试<em>org.activiti.standalone.cfg.CustomMybatisMapperTest</em>与src/test/java/org/activiti/standalone/cfg/、src/test/resources/org/activiti/standalone/cfg/目录中的其它类与资源。</p>
</div>
</div>
<div class="sect3">
<h4 id="_基于xml的映射语句_xml_based_mapped_statements">18.5.2. 基于XML的映射语句 XML based Mapped Statements</h4>
<div class="paragraph">
<p>当使用基于XML的映射语句时，语句在XML文件中定义。对于不需要整个任务数据，而只需要其中很少一部分的用例来说，XML文件像是下面这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;mapper namespace="org.activiti.standalone.cfg.TaskMapper"&gt;

  &lt;resultMap id="customTaskResultMap" type="org.activiti.standalone.cfg.CustomTask"&gt;
    &lt;id property="id" column="ID_" jdbcType="VARCHAR"/&gt;
    &lt;result property="name" column="NAME_" jdbcType="VARCHAR"/&gt;
    &lt;result property="createTime" column="CREATE_TIME_" jdbcType="TIMESTAMP" /&gt;
  &lt;/resultMap&gt;

  &lt;select id="selectCustomTaskList" resultMap="customTaskResultMap"&gt;
    select RES.ID_, RES.NAME_, RES.CREATE_TIME_ from ACT_RU_TASK RES
  &lt;/select&gt;

&lt;/mapper&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>结果映射为<em>org.activiti.standalone.cfg.CustomTask</em>类的实例，像是下面这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class CustomTask {

  protected String id;
  protected String name;
  protected Date createTime;

  public String getId() {
    return id;
  }
  public String getName() {
    return name;
  }
  public Date getCreateTime() {
    return createTime;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>必须像下面这样为流程引擎配置提供映射XML文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">...
&lt;property name="customMybatisXMLMappers"&gt;
  &lt;set&gt;
    &lt;value&gt;org/activiti/standalone/cfg/custom-mappers/CustomTaskMapper.xml&lt;/value&gt;
  &lt;/set&gt;
&lt;/property&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>语句可以如下执行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">List&lt;CustomTask&gt; tasks = managementService.executeCommand(new Command&lt;List&lt;CustomTask&gt;&gt;() {

      @SuppressWarnings("unchecked")
      @Override
      public List&lt;CustomTask&gt; execute(CommandContext commandContext) {
        return (List&lt;CustomTask&gt;) commandContext.getDbSqlSession().selectList("selectCustomTaskList");
      }
    });</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于需要更复杂语句的用例，XML映射语句很有帮助。因此Activiti内部就使用XML映射语句，它可以确保底层功能。</p>
</div>
<div class="paragraph">
<p>假设某个用例下，需要基于id、name、type、userId等字段，查询附件数据！要实现这个用例，可以创建一个扩展了<em>org.activiti.engine.impl.AbstractQuery</em>的查询类<em>AttachmentQuery</em>，像下面这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class AttachmentQuery extends AbstractQuery&lt;AttachmentQuery, Attachment&gt; {

  protected String attachmentId;
  protected String attachmentName;
  protected String attachmentType;
  protected String userId;

  public AttachmentQuery(ManagementService managementService) {
    super(managementService);
  }

  public AttachmentQuery attachmentId(String attachmentId){
    this.attachmentId = attachmentId;
    return this;
  }

  public AttachmentQuery attachmentName(String attachmentName){
    this.attachmentName = attachmentName;
    return this;
  }

  public AttachmentQuery attachmentType(String attachmentType){
    this.attachmentType = attachmentType;
    return this;
  }

  public AttachmentQuery userId(String userId){
    this.userId = userId;
    return this;
  }

  @Override
  public long executeCount(CommandContext commandContext) {
    return (Long) commandContext.getDbSqlSession()
                   .selectOne("selectAttachmentCountByQueryCriteria", this);
  }

  @Override
  public List&lt;Attachment&gt; executeList(CommandContext commandContext, Page page) {
    return commandContext.getDbSqlSession()
            .selectList("selectAttachmentByQueryCriteria", this);
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意在扩展<em>AbstractQuery</em>时，扩展类需要为super构造器传递一个<em>ManagementService</em>的实例，并需要实现<em>executeCount</em>与<em>executeList</em>来调用映射语句。</p>
</div>
<div class="paragraph">
<p>包含映射语句的XML文件像是下面这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;mapper namespace="org.activiti.standalone.cfg.AttachmentMapper"&gt;

  &lt;select id="selectAttachmentCountByQueryCriteria" parameterType="org.activiti.standalone.cfg.AttachmentQuery" resultType="long"&gt;
    select count(distinct RES.ID_)
    &lt;include refid="selectAttachmentByQueryCriteriaSql"/&gt;
  &lt;/select&gt;

  &lt;select id="selectAttachmentByQueryCriteria" parameterType="org.activiti.standalone.cfg.AttachmentQuery" resultMap="org.activiti.engine.impl.persistence.entity.AttachmentEntity.attachmentResultMap"&gt;
    ${limitBefore}
    select distinct RES.* ${limitBetween}
    &lt;include refid="selectAttachmentByQueryCriteriaSql"/&gt;
    ${orderBy}
    ${limitAfter}
  &lt;/select&gt;

  &lt;sql id="selectAttachmentByQueryCriteriaSql"&gt;
  from ${prefix}ACT_HI_ATTACHMENT RES
  &lt;where&gt;
   &lt;if test="attachmentId != null"&gt;
     RES.ID_ = #{attachmentId}
   &lt;/if&gt;
   &lt;if test="attachmentName != null"&gt;
     and RES.NAME_ = #{attachmentName}
   &lt;/if&gt;
   &lt;if test="attachmentType != null"&gt;
     and RES.TYPE_ = #{attachmentType}
   &lt;/if&gt;
   &lt;if test="userId != null"&gt;
     and RES.USER_ID_ = #{userId}
   &lt;/if&gt;
  &lt;/where&gt;
  &lt;/sql&gt;
&lt;/mapper&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以在语句中使用例如分页、排序、表名前缀等功能（因为parameterType为<em>AbstractQuery</em>的子类）。请注意可以使用已定义的<em>org.activiti.engine.impl.persistence.entity.AttachmentEntity.attachmentResultMap</em>来映射结果。</p>
</div>
<div class="paragraph">
<p>最后，<em>AttachmentQuery</em>可以如下使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">....
// 获取附件的总数 Get the total number of attachments
long count = new AttachmentQuery(managementService).count();

// 获取id为10025的附件 Get attachment with id 10025
Attachment attachment = new AttachmentQuery(managementService).attachmentId("10025").singleResult();

// 获取前10个附件 Get first 10 attachments
List&lt;Attachment&gt; attachments = new AttachmentQuery(managementService).listPage(0, 10);

// 获取用户kermit上传的所有附件 Get all attachments uploaded by user kermit
attachments = new AttachmentQuery(managementService).userId("kermit").list();
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于使用基于XML的映射语句的实际例子，请查看单元测试<em>org.activiti.standalone.cfg.CustomMybatisXMLMapperTest</em>与src/test/java/org/activiti/standalone/cfg/、src/test/resources/org/activiti/standalone/cfg/目录中的其它类与资源。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="advanced.process.engine.configurators">18.6. 使用ProcessEngineConfigurator进行高级流程引擎配置  Advanced Process Engine configuration with a ProcessEngineConfigurator</h3>
<div class="paragraph">
<p>深入流程引擎配置的高级方法是使用<em>ProcessEngineConfigurator</em>。方法是创建一个<em>org.activiti.engine.cfg.ProcessEngineConfigurator</em>接口的实现，并注入到流程引擎配置中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;bean id="processEngineConfiguration" class="...SomeProcessEngineConfigurationClass"&gt;

    ...

    &lt;property name="configurators"&gt;
        &lt;list&gt;
            &lt;bean class="com.mycompany.MyConfigurator"&gt;
                ...
            &lt;/bean&gt;
        &lt;/list&gt;
    &lt;/property&gt;

    ...

&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个接口需要实现两个方法。<em>configure</em>方法，使用一个<em>ProcessEngineConfiguration</em>实例作为参数。可以使用这个方式添加自定义配置，并且这个方法会保证<strong>在流程引擎创建之前，所有默认配置已经完成之后</strong>调用。另一个方法是<em>getPriority</em>方法，可以指定配置器的顺序，以备某些配置器对其他的有依赖。</p>
</div>
<div class="paragraph">
<p>这种配置器的一个例子是<a href="#chapter_ldap">LDAP集成</a>，其中配置器用于将默认的用户与组管理类，替换为可以处理LDAP用户存储的实现。因此基本上配置器可以相当大地改变或调整流程引擎，也意味着非常高级的使用场景。另一个例子是使用自定义的版本替换流程引擎缓存：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class ProcessDefinitionCacheConfigurator extends AbstractProcessEngineConfigurator {

    public void configure(ProcessEngineConfigurationImpl processEngineConfiguration) {
            MyCache myCache = new MyCache();
            processEngineConfiguration.setProcessDefinitionCache(enterpriseProcessDefinitionCache);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以使用<a href="http://docs.oracle.com/javase/7/docs/api/java/util/ServiceLoader.html">ServiceLoader</a>方法，从classpath中自动发现流程引擎配置器。这意味着包含配置器实现的jar必须放在classpath下，并在jar的<em>META-INF/services</em>目录下包含名为<strong>org.activiti.engine.cfg.ProcessEngineConfigurator</strong>的文件。文件的内容必须是自定义实现的全限定类名。当流程引擎启动时，日志会显示找到这些配置器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>INFO  org.activiti.engine.impl.cfg.ProcessEngineConfigurationImpl  - Found 1 auto-discoverable Process Engine Configurators
INFO  org.activiti.engine.impl.cfg.ProcessEngineConfigurationImpl  - Found 1 Process Engine Configurators in total:
INFO  org.activiti.engine.impl.cfg.ProcessEngineConfigurationImpl  - class org.activiti.MyCustomConfigurator</pre>
</div>
</div>
<div class="paragraph">
<p>请注意ServiceLoader方法可能在某些环境不能运行。可以通过ProcessEngineConfiguration的<em>enableConfiguratorServiceLoader</em>参数明确禁用（默认为true）。</p>
</div>
</div>
<div class="sect2">
<h3 id="advanced.task.query.switching">18.7. 高级查询API：在运行时与历史任务查询间无缝切换 Advanced query API: seamless switching between runtime and historic task querying</h3>
<div class="paragraph">
<p>任何BPM用户界面的核心组件都是任务列表。一般来说，最终用户操作运行时的任务，在收件箱中通过不同设置进行过滤。有时也需要在这些列表中显示历史任务，并进行类似的过滤。为了简化代码，<em>TaskQuery</em>与<em>HistoricTaskInstanceQuery</em>有共同的父接口，其中包含了所有公共操作（大多数操作都是公共的）。</p>
</div>
<div class="paragraph">
<p>这个公共接口是<em>org.activiti.engine.task.TaskInfoQuery</em>类。<em>org.activiti.engine.task.Task</em>与<em>org.activiti.engine.task.HistoricTaskInstance</em>都有公共父类<em>org.activiti.engine.task.TaskInfo</em>（并带有公共参数），并将作为例如<em>list()</em>方法的返回值。然而，有时Java泛型会帮倒忙：如果想要直接使用<em>TaskInfoQuery</em>类型，将会像是这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">TaskInfoQuery&lt;? extends TaskInfoQuery&lt;?,?&gt;, ? extends TaskInfo&gt; taskInfoQuery</code></pre>
</div>
</div>
<div class="paragraph">
<p>呃……好吧。为了“解决”这个问题，可以使用<em>org.activiti.engine.task.TaskInfoQueryWrapper</em>类来避免泛型（下面的代码来自REST的代码，将返回一个任务列表，且用户可以选择查看进行中还是已完成的任务）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">TaskInfoQueryWrapper taskInfoQueryWrapper = null;
if (runtimeQuery) {
	taskInfoQueryWrapper = new TaskInfoQueryWrapper(taskService.createTaskQuery());
} else {
	taskInfoQueryWrapper = new TaskInfoQueryWrapper(historyService.createHistoricTaskInstanceQuery());
}

List&lt;? extends TaskInfo&gt; taskInfos = taskInfoQueryWrapper.getTaskInfoQuery().or()
	.taskNameLike("%k1%")
	.taskDueAfter(new Date(now.getTime() + (3 * 24L * 60L * 60L * 1000L)))
.endOr()
.list();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="advanced.custom.session.manager">18.8. 通过覆盖标准SessionFactory自定义身份管理 Custom identity management by overriding standard SessionFactory</h3>
<div class="paragraph">
<p>如果不想像<a href="#chapter_ldap">LDAP集成</a>中那样，使用完整的<em>ProcessEngineConfigurator</em>实现，但仍然希望将自定义的身份管理插入框架中，那么也可以直接覆盖<em>ProcessEngineConfiguration</em>中的<em>SessionFactory</em>类。在Spring中，可以简单地通过向<em>ProcessEngineConfiguration</em> bean定义添加下面的代码实现：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;bean id="processEngineConfiguration" class="...SomeProcessEngineConfigurationClass"&gt;

    ...

    &lt;property name="customSessionFactories"&gt;
        &lt;list&gt;
            &lt;bean class="com.mycompany.MyGroupManagerFactory"/&gt;
            &lt;bean class="com.mycompany.MyUserManagerFactory"/&gt;
        &lt;/list&gt;
    &lt;/property&gt;

    ...

&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>MyGroupManagerFactory</em>与<em>MyUserManagerFactory</em>需要实现<em>org.activiti.engine.impl.interceptor.SessionFactory</em>接口。对<em>openSession()</em>的调用，需要返回实际管理身份的自定义类的实现。对于组，需要是继承<em>org.activiti.engine.impl.persistence.entity.GroupEntityManager</em>的类，对于用户管理，需要是继承<em>org.activiti.engine.impl.persistence.entity.UserEntityManager</em>的类。下面的代码样例包含了一个自定义的组管理器工厂：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.mycompany;

import org.activiti.engine.impl.interceptor.Session;
import org.activiti.engine.impl.interceptor.SessionFactory;
import org.activiti.engine.impl.persistence.entity.GroupIdentityManager;

public class MyGroupManagerFactory implements SessionFactory {

	@Override
	public Class&lt;?&gt; getSessionType() {
		return GroupIdentityManager.class;
	}

	@Override
	public Session openSession() {
		return new MyCompanyGroupManager();
	}

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>实际工作由这个工厂创建的<em>MyCompanyGroupManager</em>进行。但不需要覆盖<em>GroupEntityManager</em>的所有成员，只需要覆盖使用场景需要的那些即可。下面的样例展示了可能的样子（只展示一部分成员）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class MyCompanyGroupManager extends GroupEntityManager {

    private static Logger log = LoggerFactory.getLogger(MyCompanyGroupManager.class);

    @Override
    public List&lt;Group&gt; findGroupsByUser(String userId) {
        log.debug("findGroupByUser called with userId: " + userId);
        return super.findGroupsByUser(userId);
    }

    @Override
    public List&lt;Group&gt; findGroupByQueryCriteria(GroupQueryImpl query, Page page) {
        log.debug("findGroupByQueryCriteria called, query: " + query + " page: " + page);
        return super.findGroupByQueryCriteria(query, page);
    }

    @Override
    public long findGroupCountByQueryCriteria(GroupQueryImpl query) {
        log.debug("findGroupCountByQueryCriteria called, query: " + query);
        return super.findGroupCountByQueryCriteria(query);
    }

    @Override
    public Group createNewGroup(String groupId) {
        throw new UnsupportedOperationException();
    }

    @Override
    public void deleteGroup(String groupId) {
        throw new UnsupportedOperationException();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在适当的方法中添加你自己的实现，以插入自己的身份管理解决方案。需要自行判断要覆盖基类中的那些成员。例如下面的调用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">long potentialOwners = identityService.createUserQuery().memberOfGroup("management").count();</code></pre>
</div>
</div>
<div class="paragraph">
<p>会调用<em>UserIdentityManager</em>接口的下列成员：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">List&lt;User&gt; findUserByQueryCriteria(UserQueryImpl query, Page page);</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#chapter_ldap">LDAP集成</a>中的代码包含了如何实现这些的完整示例。可以在GitHub查看代码，特别是<a href="https://github.com/Activiti/Activiti/blob/master/modules/activiti-ldap/src/main/java/org/activiti/ldap/LDAPGroupManager.java">LDAPGroupManager</a>与<a href="https://github.com/Activiti/Activiti/blob/master/modules/activiti-ldap/src/main/java/org/activiti/ldap/LDAPUserManager.java">LDAPUserManager</a>。</p>
</div>
</div>
<div class="sect2">
<h3 id="advanced.safe.bpmn.xml">18.9. 启用安全BPMN 2.0 XML (Enable safe BPMN 2.0 xml)</h3>
<div class="paragraph">
<p>在大多数情况下，部署至Activiti引擎的BPMN 2.0流程都在例如开发团队的严格控制下。然而，有的时候能够向引擎上传任意的BPMN 2.0 XML很诱人。在这种情况下，需要考虑动机不良的用户可能会像<a href="http://www.jorambarrez.be/blog/2013/02/19/uploading-a-funny-xml-can-bring-down-your-server/">这里</a>描述的一样，搞坏服务器。</p>
</div>
<div class="paragraph">
<p>要避免上面链接中描述的攻击，可以在流程引擎配置中设置<em>enableSafeBpmnXml</em>参数：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;property name="enableSafeBpmnXml" value="true"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>默认情况下这个功能是禁用的！</strong>原因是它依赖<a href="http://download.java.net/jdk7/archive/b123/docs/api/javax/xml/transform/stax/StAXSource.html">StaxSource</a>类。而不幸的是，某些平台（例如JDK6， JBoss，等等）不能使用这个类（由于过时的XML解析器实现），因此不能启用安全BPMN 2.0 XML功能。</p>
</div>
<div class="paragraph">
<p>如果Activiti运行的平台支持，请一定要启用这个功能。</p>
</div>
</div>
<div class="sect2">
<h3 id="advanced.event.logging">18.10. 事件记录（试验性） Event logging (Experimental)</h3>
<div class="paragraph">
<p>从Activiti 5.16开始，引入了（试验性）的事件记录机制。记录机制基于<a href="#eventDispatcher">Activiti引擎的事件机制</a>的一般用途，并默认禁用。其思想是，来源于引擎的事件会被捕获，并创建一个包含了所有事件数据（甚至更多）的映射，提供给<em>org.activiti.engine.impl.event.logger.EventFlusher</em>，由它将这些数据刷入其他地方。默认情况下，使用简单的基于数据库的事件处理/刷入，会使用Jackson将上述映射序列化为JSON，并将其作为<em>EventLogEntryEntity</em>接口存入数据库。如果不使用事件记录，可以删除这个表。</p>
</div>
<div class="paragraph">
<p>要启用数据库记录：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">processEngineConfiguration.setEnableDatabaseEventLogging(true);</code></pre>
</div>
</div>
<div class="paragraph">
<p>或在运行时：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">databaseEventLogger = new EventLogger(processEngineConfiguration.getClock());
runtimeService.addEventListener(databaseEventLogger);</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以扩展EventLogger类。如果默认的数据库记录不符合要求，需要覆盖<em>createEventFlusher()</em>方法返回一个<em>org.activiti.engine.impl.event.logger.EventFlusher</em>接口的实例。可以通过Activiti的<em>managementService.getEventLogEntries(startLogNr, size);</em>获取<em>EventLogEntryEntity</em>实例。</p>
</div>
<div class="paragraph">
<p>容易看出这个表中的数据可以通过JSON放入大数据NoSQL存储，例如MongoDB，Elastic Search，等等。也容易看出这里使用的类（org.activiti.engine.impl.event.logger.EventLogger/EventFlusher与许多其他EventHandler类）是可插入的，可以按你的使用场景调整（例如不将JSON存入数据库，而是将其直接发送给一个队列或大数据存储）。</p>
</div>
<div class="paragraph">
<p>请注意这个事件记录机制是额外于Activiti的“传统”历史管理器的。尽管所有数据都在数据库表中，但并未对查询或快速恢复做优化。实际使用场景是末端审计并将其存入大数据存储。</p>
</div>
</div>
<div class="sect2">
<h3 id="_禁用批量插入_disabling_bulk_inserts">18.11. 禁用批量插入 Disabling bulk inserts</h3>
<div class="paragraph">
<p>默认情况下，引擎会将对同一个数据库表的多个插入语句组合在一起，作为<em>批量插入</em>，这样能够提高性能，并已在所有支持的数据库中测试与实现了。</p>
</div>
<div class="paragraph">
<p>然而，支持与测试过的数据库，可能有某个特定版本不支持批量插入（例如有报告说DB2在z/OS上不支持，尽管一般来说DB2是支持的），可以在流程引擎配置中禁用批量插入：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;property name="bulkInsertEnabled" value="false" /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="advancedSecureScripting">18.12. 安全脚本 Secure Scripting</h3>
<div class="paragraph">
<p><strong>试验性</strong>：安全脚本功能随Activiti 5.21发布。</p>
</div>
<div class="paragraph">
<p>默认情况下，使用<a href="#bpmnScriptTask">脚本任务</a>时，执行的脚本与Java代理具有相似的能力。可以完全访问JVM，永远运行（无限循环），或占用大量内存。然而，Java代理需要撰写并放在classpath的jar中，与流程定义的生命周期不同。最终用户一般不会撰写Java代理，因为这基本上是开发者的工作。</p>
</div>
<div class="paragraph">
<p>然而脚本是流程定义的一部分，具有相同的生命周期。脚本任务不需要额外的jar部署步骤，而是在流程部署后就可以执行。有时，脚本任务中的脚本不是由开发者撰写的。这就有一个上面提到的问题：脚本可以完全访问JVM，也可以在执行脚本时阻塞许多系统资源。因此允许来自几乎任何人的脚本不是一个好主意。</p>
</div>
<div class="paragraph">
<p>要解决这个问题，可以启用<em>安全脚本</em>功能。目前，这个功能只实现了<em>javascript</em>脚本。要启用它，向你的项目添加<em>activiti-secure-javascript</em>依赖。使用Maven时：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.activiti&lt;/groupId&gt;
    &lt;artifactId&gt;activiti-secure-javascript&lt;/artifactId&gt;
    &lt;version&gt;${activiti.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>添加这个依赖会同时引入Rhino依赖（参见<a href="$https://developer.mozilla.org/en-US/docs/Mozilla/Projects/Rhino$$"><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/Rhino" class="bare">https://developer.mozilla.org/en-US/docs/Mozilla/Projects/Rhino</a></a>）。Rhino是一个用于JDK的javascript引擎。过去包含在JDK版本6与7中，并已被Nashorn引擎取代。然而，Rhino项目仍然在继续开发。许多功能（包括Activiti用于实现安全脚本的）都在之后才加入。在撰写本手册的时候，Nashorn<strong>还没有</strong>实现安全脚本功能需要的功能。</p>
</div>
<div class="paragraph">
<p>这意味着脚本之间可能要做一些（基本很少）改变（例如，Rhino使用<em>importPackage</em>，而Nashorn使用<em>load()</em>）。这些改变与将脚本从JDK 7切换至8相似。</p>
</div>
<div class="paragraph">
<p>通过专门的<em>Configurator</em>对象配置安全脚本，并在流程引擎实例化之前将其传递给流程引擎配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">SecureJavascriptConfigurator configurator = new SecureJavascriptConfigurator()
  .setWhiteListedClasses(new HashSet&lt;String&gt;(Arrays.asList("java.util.ArrayList")))
  .setMaxStackDepth(10)
  .setMaxScriptExecutionTime(3000L)
  .setMaxMemoryUsed(3145728L)
  .setNrOfInstructionsBeforeStateCheckCallback(10);

processEngineConfig.addConfigurator(configurator);</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用下列设置：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>enableClassWhiteListing</strong>: 为true时，会黑名单所有类。希望运行的所有类都需要添加入白名单，这样就严格控制了暴露给脚本的东西。默认为<em>false</em>。</p>
</li>
<li>
<p><strong>whiteListedClasses</strong>: 一个全限定类名字符串的集合，表示允许脚本中使用的类。例如，要在脚本中暴露<em>execution</em>对象，需要在这个集合中添加<em>org.activiti.engine.impl.persistence.entity.ExecutionEntity</em>字符串。默认为<em>空</em>。</p>
</li>
<li>
<p><strong>maxStackDepth</strong>: 限制在脚本中调用函数时的最大栈深度。可以用于避免由于递归调用脚本中定义的方法，而导致的栈溢出异常。默认为<em>-1</em>（禁用）。</p>
</li>
<li>
<p><strong>maxScriptExecutionTime</strong>: 脚本允许运行的最大时间。默认为<em>-1</em>（禁用）。</p>
</li>
<li>
<p><strong>maxMemoryUsed</strong>: 脚本允许使用的最大内存数量，以字节计。请注意脚本引擎自己也要需要一定量的内存，也会算在这里。默认为<em>-1</em>（禁用）。</p>
</li>
<li>
<p><strong>nrOfInstructionsBeforeStateCheckCallback</strong>: 脚本每执行x个指令，就通过回调函数进行一次最大脚本执行时间与内存检测。请注意这不是指脚本指令，而是指java字节码指令（这意味着一行脚本可能有上百行字节码指令）。默认为100。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>请注意：</em><em>maxMemoryUsed</em>设置只能用于支持com.sun.management.ThreadMXBean#getThreadAllocatedBytes()方法的JVM。Oracle JDK支持它。</p>
</div>
<div class="paragraph">
<p>也有ScriptExecutionListener与ScriptTaskListener的安全形式：<em>org.activiti.scripting.secure.listener.SecureJavascriptExecutionListener</em>与<em>org.activiti.scripting.secure.listener.SecureJavascriptTaskListener</em>。</p>
</div>
<div class="paragraph">
<p>像这样使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;activiti:executionListener event="start" class="org.activiti.scripting.secure.listener.SecureJavascriptExecutionListener"&gt;
  &lt;activiti:field name="script"&gt;
	  &lt;activiti:string&gt;
		  &lt;![CDATA[
        execution.setVariable('test');
			]]&gt;
	  &lt;/activiti:string&gt;
	&lt;/activiti:field&gt;
  &lt;activiti:field name="language" stringValue="javascript" /&gt;
&lt;/activiti:executionListener&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>演示不安全脚本以及如何通过<em>安全脚本</em>功能将其变得安全的例子，可以查看<a href="https://github.com/Activiti/Activiti/tree/master/modules/activiti-secure-javascript/src/test/resources">GitHub上的单元测试</a>。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_使用activiti_crystalball仿真_试验性_simulation_with_activiti_crystalball_experimental">19. 使用Activiti-Crystalball仿真（试验性） Simulation with Activiti-Crystalball (Experimental)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="crb-introduction">19.1. 介绍 Introduction</h3>
<div class="sect3">
<h4 id="crb-overview">19.1.1. 简介 Short overview</h4>
<div class="paragraph">
<p>activiti-crystalball（CrystalBall）是一个用于Activiti业务流程管理平台的仿真引擎。CrystalBall仿真可以用于：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>支持决策——对于生产工作流（例如，我们是否要在系统中增加更多资源，以满足截止日期？）。</p>
</li>
<li>
<p>优化与理解——测试变更并理解其影响。</p>
</li>
<li>
<p>培训——仿真可以在员工铺开使用前进行培训。</p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="crb-unique">19.1.2. CrystalBall是独特的 CrystalBall is unique</h4>
<div class="paragraph">
<p>不需要：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>创建单独的仿真模型与引擎。</p>
</li>
<li>
<p>为仿真创建不同的报告。</p>
</li>
<li>
<p>为仿真引擎提供大量数据。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>CrystalBall仿真器基于Activiti。这就是为什么可以很轻易地复制数据并启动仿真，也可以从历史中重放工作流行为。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="crb-inside">19.2. 深入CrystalBall (CrystalBall inside)</h3>
<div class="paragraph">
<p>CrystalBall是一个<a href="http://en.wikipedia.org/wiki/Discrete_event_simulation">离散事件仿真器</a>。最简单的实现是org.activiti.crystalball.simulator.SimpleSimulationRun。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">init();

SimulationEvent event = removeSimulationEvent();

while (!simulationEnd(event)) {
	executeEvent(event);
	event = removeSimulationEvent();
}

close();</code></pre>
</div>
</div>
<div class="paragraph">
<p>SimulationRun也可以执行不同来源生成的仿真事件（参见<a href="#crb-playback">回放</a>）。</p>
</div>
</div>
<div class="sect2">
<h3 id="crb-history-analysis">19.3. 历史分析 History analysis</h3>
<div class="paragraph">
<p>仿真的一个使用场景是用于分析历史。生产环境不能用于重现并查找bug。也几乎不可能将流程引擎调整到生产环境发生bug时一样的状态，问题不在硬件而是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>时间——流程实例可能需要好几个月。</p>
</li>
<li>
<p>并发——流程实例运行时可能与其它的实例相互影响，只有在它们都并行执行的时候才会发现问题。</p>
</li>
<li>
<p>用户——大量用户可以参与流程实例执行。将流程实例调整到错误发生时的状态会花费大量精力。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>仿真可以容易地定位上面提到的问题。仿真的时间是虚拟的，不依赖于真实时间。Activiti流程引擎本身就是虚拟的，因此不需要创建用于仿真试验的虚拟流程引擎。在这种场景下并发也可以自然地被定位。用户的行为可以记录并回放，回放可以按照记录，或者预测并按需生成。</p>
</div>
<div class="paragraph">
<p>最好的分析历史的方式是将其重现。重现在真实生活正很难实现，但可以通过仿真实现。</p>
</div>
<div class="sect3">
<h4 id="crb-collectEvents">19.3.1. 历史中的事件 Events from the history.</h4>
<div class="paragraph">
<p>重现历史的最重要的事情，是收集所有影响过系统状态的事件。假设我们的流程通过用户事件驱动（例如申领，完成任务……）。在这个场景下，我们可以使用两种事件源：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>流程历史——当前只支持原始<a href="http://gro-mar.github.io/activiti-crystalball/">activiti-crystalball</a>项目。</p>
</li>
<li>
<p>记录的活动事件。我们可以将ActivitiEventListener加入想要记录事件的引擎。记录的事件会被存储用于之后的分析。基础的实现是org.activiti.crystalball.simulator.delegate.event.impl.InMemoryRecordActivitiEventListener：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Override
public void onEvent(ActivitiEvent event) {
  Collection&lt;SimulationEvent&gt; simulationEvents = transform(event);
  store(simulationEvents);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>事件将被存储。我们可以继续再次重现历史。</p>
</div>
</div>
<div class="sect3">
<h4 id="crb-playback">19.3.2. 回放 PlayBack</h4>
<div class="paragraph">
<p>回放的优点是可以一遍又一遍的播放，直到我们完全理解发生了什么。Crystalball仿真基于真实数据与真实用户行为，这是Crystalball的优势。</p>
</div>
<div class="paragraph">
<p>理解回放工作方式的最好的方法，是基于JUnit测试org.activiti.crystalball.simulator.delegate.event.PlaybackRunTest逐步骤地解释。测试仿真的流程是最简单的：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;process id="theSimplestProcess" name="Without task Process"&gt;
  &lt;documentation&gt;This is a process for testing purposes&lt;/documentation&gt;

  &lt;startEvent id="theStart"/&gt;
  &lt;sequenceFlow id="flow1" sourceRef="theStart" targetRef="theEnd"/&gt;
  &lt;endEvent id="theEnd"/&gt;

&lt;/process&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>流程已被部署，并将实际使用以及仿真运行。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>记录事件</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// 获取带有记录监听器的流程引擎来记录事件 get process engine with record listener to log events
ProcessEngine processEngine = (new RecordableProcessEngineFactory(THE_SIMPLEST_PROCESS, listener)).getObject();

// 使用变量启动流程实例 start process instance with variables
Map&lt;String,Object&gt; variables = new HashMap&lt;String, Object&gt;();
variables.put(TEST_VARIABLE, TEST_VALUE);
processEngine.getRuntimeService().startProcessInstanceByKey(SIMPLEST_PROCESS, BUSINESS_KEY,variables);

// 检查流程引擎状态——历史中应该有一个流程实例
// check process engine status - there should be one process instance in the history
checkStatus(processEngine);

// 关闭并销毁流程引擎 close and destroy process engine
EventRecorderTestUtils.closeProcessEngine(processEngine, listener);
ProcessEngines.destroy();</code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的代码片段将在startProcessInstanceByKey方法调用后记录ActivitiEventType.ENTITY_CREATED。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>启动仿真运行 start simulation run</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">final SimpleSimulationRun.Builder builder = new SimpleSimulationRun.Builder();
// 初始化仿真运行 init simulation run
// 获取流程引擎工厂——与RecordableProcessEngineFactory的唯一区别是没有添加记录监听器
// get process engine factory - the only difference from RecordableProcessEngineFactory that log listener is not added
DefaultSimulationProcessEngineFactory simulationProcessEngineFactory = new DefaultSimulationProcessEngineFactory(THE_SIMPLEST_PROCESS);
// 配置仿真运行 configure simulation run
builder.processEngine(simulationProcessEngineFactory)
       // 从记录的事件设置回放事件日历 set playback event calendar from recorded events
       .eventCalendar(new PlaybackEventCalendarFactory(new SimulationEventComparator(), listener.getSimulationEvents()))
       // 为仿真事件设置处理器 set handlers for simulation events
       .customEventHandlerMap(EventRecorderTestUtils.getHandlers());
SimpleSimulationRun simRun = builder.build();

simRun.execute(new NoExecutionVariableScope());

// 检查状态——在记录事件方法中使用的相同方法 check the status - the same method which was used in record events method
checkStatus(simulationProcessEngineFactory.getObject());

// 关闭并销毁流程引擎 close and destroy process engine
simRun.getProcessEngine().close();
ProcessEngines.destroy();</code></pre>
</div>
</div>
<div class="paragraph">
<p>更高级的回放例子在org.activiti.crystalball.simulator.delegate.event.PlaybackProcessStartTest中</p>
</div>
</div>
<div class="sect3">
<h4 id="crb-debug">19.3.3. 流程引擎调试 Process engine debugger</h4>
<div class="paragraph">
<p>回放限制了只能一下子执行所有仿真事件（例如启动流程，完成任务）。调试可以将执行分割为小步骤，并在步骤之间观察流程引擎的状态。</p>
</div>
<div class="paragraph">
<p>SimpleSimulationRun实现了SimulationDebugger接口。SimulationDebugger可以一步一步地执行仿真事件，将仿真运行到特定时间。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">  /**
  * 可以在调试模式运行仿真 Allows to run simulation in debug mode
  */
  public interface SimulationDebugger {
  /**
  * 初始化仿真运行 initialize simulation run
  * @param execution - 传递变量与运行仿真的变量范围 variable scope to transfer variables from and to simulation run
  */
  void init(VariableScope execution);

  /**
  * 前进一步仿真事件 step one simulation event forward
  */
  void step();

  /**
  * 继续仿真运行 continue in the simulation run
  */
  void runContinue();

  /**
  * 执行仿真运行直到simulationTime（仿真时间） execute simulation run till simulationTime
  */
  void runTo(long simulationTime);

  /**
  * 执行仿真运行直到特定类型的仿真事件 execute simulation run till simulation event of the specific type
  */
  void runTo(String simulationEventType);

  /**
  * 关闭仿真运行 close simulation run
  */
  void close();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>要实际查看流程引擎调试器，运行SimpleSimulationRunTest</p>
</div>
</div>
<div class="sect3">
<h4 id="crb-replay">19.3.4. 重放 Replay</h4>
<div class="paragraph">
<p>重放需要创建另一个流程引擎实例。回放并不影响“真实”环境，而是需要仿真试验配置。重放则运行在“真实”流程引擎上。重放在运行中的流程引擎上执行仿真事件。因此重放使用真实时间。真实时间意味着仿真事件被预定将会立即执行。</p>
</div>
<div class="paragraph">
<p>下面的例子展示了如何重放一个流程实例。同样的技术可以用在回放中，以播放一个流程实例。（ReplayRunTest）测试的第一部分初始化流程引擎，启动一个流程实例，并完成流程实例的任务。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">  ProcessEngine processEngine = initProcessEngine();

  TaskService taskService = processEngine.getTaskService();
  RuntimeService runtimeService = processEngine.getRuntimeService();

  Map&lt;String, Object&gt; variables = new HashMap&lt;String, Object&gt;();
  variables.put(TEST_VARIABLE, TEST_VALUE);
  ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(USERTASK_PROCESS, BUSINESS_KEY,
  variables);

  Task task = taskService.createTaskQuery().taskDefinitionKey("userTask").singleResult();
  TimeUnit.MILLISECONDS.sleep(50);
  taskService.complete(task.getId());</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用的流程引擎是基础的InMemoryStandaloneProcessEngine以及</p>
</div>
<div class="ulist">
<ul>
<li>
<p>InMemoryRecordActivitiEventListener（已经在回放中使用过）用于记录Activiti事件，并将其转换为仿真事件。</p>
</li>
<li>
<p>UserTaskExecutionListener——当创建了新的用户任务，且新的任务是表单重放流程引擎时，将任务完成事件预定至事件日历。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>测试的下一部分在原流程的相同流程引擎上启动了仿真调试器。重放事件处理器使用StartReplayProcessEventHandler取代了StartProcessEventHandler。StartReplayProcessEventHandler取得流程实例Id，将其用于重放以及在初始化阶段预定流程实例启动。在处理阶段StartProcessEventHandler使用一个预留的变量启动新的流程实例。变量名字为"_replay.processInstanceId"。这个变量用于存储需要重放的流程的id。与SimpleSimulationRun相比，ReplaySimulationRun并不：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>创建与关闭流程引擎实例。</p>
</li>
<li>
<p>修改仿真时间。（真实时间不能修改）</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>final SimulationDebugger simRun = new ReplaySimulationRun(processEngine,
  getReplayHandlers(processInstance.getId()));</pre>
</div>
</div>
<div class="paragraph">
<p>现在重放流程实例可以启动了。在一开始流程实例还没有运行。在历史中已经有一个已完成的流程实例。在初始化之后，在事件日历中有一个仿真事件——用于启动一个流程实例，以重放已经完成的流程实例。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">simRun.init();

// 原始流程已经完成——不应该有任何运行中的流程实例/任务
// original process is finished - there should not be any running process instance/task
assertEquals(0, runtimeService.createProcessInstanceQuery().processDefinitionKey(USERTASK_PROCESS).count());
assertEquals(0, taskService.createTaskQuery().taskDefinitionKey("userTask").count());

simRun.step();

// 重放流程已启动 replay process was started
assertEquals(1, runtimeService.createProcessInstanceQuery().processDefinitionKey(USERTASK_PROCESS).count());
// 应该有一个任务 there should be one task
assertEquals(1, taskService.createTaskQuery().taskDefinitionKey("userTask").count());</code></pre>
</div>
</div>
<div class="paragraph">
<p>当创建任务时，UserTaskExecutionListener创建了新的仿真事件，以完成用户任务。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">simRun.step();

// 用户任务已完成——重放流程已经完成 userTask was completed - replay process was finished
assertEquals(0, runtimeService.createProcessInstanceQuery().processDefinitionKey(USERTASK_PROCESS).count());
assertEquals(0, taskService.createTaskQuery().taskDefinitionKey("userTask").count());</code></pre>
</div>
</div>
<div class="paragraph">
<p>仿真结束，我们可以继续另一个流程实例启动，或任何其他事件。这次我们关闭simRun与流程引擎。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">simRun.close();
processEngine.close();
ProcessEngines.destroy();</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Tooling">20. 工具 Tooling</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="JMX">20.1. JMX</h3>
<div class="sect3">
<h4 id="jmxIntroduction">20.1.1. 介绍 Introduction</h4>
<div class="paragraph">
<p>可以使用标准Java管理扩展（JMX）技术连接Activiti引擎，以获取信息或改变其行为。可以使用任何标准的JMX客户端。启用与禁用作业执行器、部署新的流程定义文件或删除它们等等操作，都可以通过JMX完成，而不需要写一行代码。</p>
</div>
</div>
<div class="sect3">
<h4 id="jmxQuickStart">20.1.2. 快速开始 Quick Start</h4>
<div class="paragraph">
<p>默认情况下没有启用JMX。要使用默认配置启动它，只要使用Maven或其他方法，将activiti-jmx jar文件加入classpath即可。如果使用Maven，可以在pom.xml中添加下列行以添加合适的依赖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.activiti&lt;/groupId&gt;
  &lt;artifactId&gt;activiti-jmx&lt;/artifactId&gt;
  &lt;version&gt;latest.version&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>在添加依赖并构建流程引擎后，就可以使用JMX连接了。可以使用在标准JDK发行版中提供的jconsole。在本地线程列表中，可以看到包含Activit的JVM。如果由于任何原因没有在“本地进程”中列出合适的JVM，可以尝试使用这个URL从“远程进程”中连接：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>service:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi/activiti</pre>
</div>
</div>
<div class="paragraph">
<p>可以在日志文件中找到正确的本地URL。连接之后，可以看到标准JVM状态与MBeans。可以选择MBeans页签，并在右侧面板选择"org.activiti.jmx.Mbeans"，以浏览Activiti专用的MBean。选择任何MBean，都可以查询信息或修改配置。这个截图展示了jconsole的样子：</p>
</div>
<div class="paragraph">
<p>（原图缺失）</p>
</div>
<div class="paragraph">
<p>不只是jconsole，任何JMX客户端都可以访问MBeans。大多数数据中心监控工具都有可以连接至JMX MBeans的连接器。</p>
</div>
</div>
<div class="sect3">
<h4 id="_属性与操作_attributes_and_operations">20.1.3. 属性与操作 Attributes and operations</h4>
<div class="paragraph">
<p>这里有一个目前可用的属性与操作的列表。这个列表可能根据需要在未来版本中扩展。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">MBean</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">名字</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ProcessDefinitionsMBean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">已部署流程定义的<code>Id</code>, <code>Name</code>, <code>Version</code>, <code>IsSuspended</code>参数，是一个字符串的list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">当前部署的<code>Id</code>, <code>Name</code>, <code>TenantId</code>参数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">方法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">getProcessDefinitionById(String id)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">给定id流程定义的+Id+, <code>Name</code>, <code>Version</code>与<code>IsSuspended</code>参数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">方法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deleteDeployment(String id)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用给定<code>Id</code>删除部署</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">方法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">suspendProcessDefinitionById(String id)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用给定<code>Id</code>暂停流程定义</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">方法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">activatedProcessDefinitionById(String id)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用给定<code>Id</code>激活流程定义</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">方法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">suspendProcessDefinitionByKey(String id)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用给定<code>key</code>暂停流程定义</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">方法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">activatedProcessDefinitionByKey(String id)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用给定<code>key</code>激活流程定义</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">方法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployProcessDefinition(String resourceName, String processDefinitionFile)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部署流程定义文件</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JobExecutorMBean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">isJobExecutorActivated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">作业执行器是否启用</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">方法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">setJobExecutorActivate(Boolean active)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">按照给定boolean值启用或禁用作业执行器</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_配置_configuration_4">20.1.4. 配置 Configuration</h4>
<div class="paragraph">
<p>JMX使用最常使用的配置作为默认配置来简化部署。然而也可以很容易的修改默认配置，可以通过编程方式，或通过配置文件。下列代码展示了如何在配置文件中配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;bean id="processEngineConfiguration" class="...SomeProcessEngineConfigurationClass"&gt;
  ...
  &lt;property name="configurators"&gt;
    &lt;list&gt;
	  &lt;bean class="org.activiti.management.jmx.JMXConfigurator"&gt;

	    &lt;property name="connectorPort" value="1912" /&gt;
        &lt;property name="serviceUrlPath" value="/jmxrmi/activiti" /&gt;

		...
      &lt;/bean&gt;
    &lt;/list&gt;
  &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>下表展示了可配置的参数与其默认值：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名字</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">若值为true，即使已添加依赖也不会启动JMX</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.activiti.jmx.Mbeans</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MBean的域</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">createConnector</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">若值为true，则为已启动的MbeanServer创建一个连接器</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MBeanDomain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DefaultDomain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MBean服务器的域</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">registryPort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1099</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">出现在服务URL中作为注册端口</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serviceUrlPath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jmxrmi/activiti</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">出现在服务URL中</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectorPort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果大于0，则出现在服务URL中作为连接端口</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_jmx服务url_jmx_service_url">20.1.5. JMX服务URL (JMX Service URL)</h4>
<div class="paragraph">
<p>JMX服务URL为下列格式：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>service:jmx:rmi://&lt;hostName&gt;:&lt;connectorPort&gt;/jndi/rmi://&lt;hostName&gt;:&lt;registryPort&gt;/&lt;serviceUrlPath&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><code>hostName</code>会自动设置为机器的网络名。可以配置<code>connectorPort</code>、<code>registryPort</code>与<code>serviceUrlPath</code>。</p>
</div>
<div class="paragraph">
<p>如果<code>connectionPort</code>小于0，则服务URL中没有对应的部分，简化为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>service:jmx:rmi:///jndi/rmi://:&lt;hostname&gt;:&lt;registryPort&gt;/&lt;serviceUrlPath&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mavenArchetypes">20.2. Maven原型 Maven archetypes</h3>
<div class="sect3">
<h4 id="_创建测试用例_create_test_case">20.2.1. 创建测试用例 Create Test Case</h4>
<div class="paragraph">
<p>在开发过程中，有时在应用中实际实现前，创建一个小测试用例来测试想法或功能很有用，因为这样可以用测试来隔离主题。JUnit测试用例也是交流bug报告与功能需求的推荐工具。在一份bug报告或功能需求jira单中附加一个测试用例，可以有效减少修复时间。</p>
</div>
<div class="paragraph">
<p>为了便于创建测试用例，可以使用maven原型。通过使用这个原型，可以快速创建标准测试用例。原型应该在标准仓库中已经有了。如果没有，可以简单的安装在你的本地maven仓库目录中：在<strong>tooling/archtypes</strong>目录下键入<strong>mvn install</strong>。</p>
</div>
<div class="paragraph">
<p>下列命令创建单元测试项目：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>mvn archetype:generate \
-DarchetypeGroupId=org.activiti \
-DarchetypeArtifactId=activiti-archetype-unittest \
-DarchetypeVersion=5.22.0 \
-DgroupId=org.myGroup \
-DartifactId=myArtifact</code></pre>
</div>
</div>
<div class="paragraph">
<p>每个参数的效果在下表解释：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 264. 单元测试生成原型参数</caption>
<colgroup>
<col style="width: 2.3255%;">
<col style="width: 27.9069%;">
<col style="width: 69.7676%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">行</th>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">解释</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">archetypeGroupId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">原型的Group id。需要为<strong>org.activiti</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">archetypeArtifactId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">原型的Artifact id。需要为<strong>activiti-archetype-unittest</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">archetypeVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成的测试项目中使用的Activiti版本</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成的测试项目的Group id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">artifactId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成的测试项目的Artifact id</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>生成的项目的目录结构像是这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>.
├── pom.xml
└── src
    └── test
        ├── java
        │   └── org
        │       └── myGroup
        │           └── MyUnitTest.java
        └── resources
            ├── activiti.cfg.xml
            ├── log4j.properties
            └── org
                └── myGroup
                    └── my-process.bpmn20.xml</pre>
</div>
</div>
<div class="paragraph">
<p>可以修改java单元测试用例与其对应的流程模型，或者添加新的单元测试用例与流程模型。如果使用该项目来表述一个bug或功能，测试用例应该在初始时失败，然后在修复了预期的bug或实现了预期的功能以后成功。请确保在发送之前键入<strong>mvn clean</strong>清理项目。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="docker">20.3. Docker镜像 Docker images</h3>
<div class="sect3">
<h4 id="dockerIntroduction">20.3.1. 介绍 Introduction</h4>
<div class="paragraph">
<p><a href="https://www.docker.com/">Docker</a>是一个神奇的虚拟化工具。可以将一个应用与其所有依赖打包为一个标准的软件开发单元。人们可以创建持久化的镜像，并将其发布至共享服务器。其他人可以获取该镜像，并轻松启动与运行该软件。</p>
</div>
<div class="paragraph">
<p>Activiti docker镜像的目的是快速运行activiti explorer与rest-api，而不需要为设置开发环境而处理复杂的细节。对于希望尽快运行、测试与使用Activiti的人来说十分有益。对展示演示也很有价值。</p>
</div>
</div>
<div class="sect3">
<h4 id="dockerSingleImage">20.3.2. 使用 Usage</h4>
<div class="paragraph">
<p>第一步是安装docker，如果还没有安装的话。<a href="https://docs.docker.com/engine/installation/">安装</a>十分简单明了。几乎所有主流OS都有可用的二进制安装文件。在安装Docker之后，可以使用这个命令，将activiti镜像与其依赖取回本地机器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>docker pull activiti/activiti-single-image:latest explorer</code></pre>
</div>
</div>
<div class="paragraph">
<p>取决于Internet连接速度，可能需要一段时间下载镜像。只有第一次或共享服务器版本更新之后，才需要下载。</p>
</div>
<div class="paragraph">
<p>下一步是运行镜像与创建容器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>docker run -p 8080:8080  -t -i activiti/activiti-single-image:latest explorer</code></pre>
</div>
</div>
<div class="paragraph">
<p>就是这样，镜像已经启动并运行了explorer web应用。可以使用这个URL访问：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>localhost:8080/activiti-explorer</code></pre>
</div>
</div>
<div class="paragraph">
<p>本地机器的端口号可以通过修改第二部分8080:8080参数修改。</p>
</div>
<div class="paragraph">
<p>最后的参数决定了运行的应用。有两个可选项：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>explorer</p>
</li>
<li>
<p>rest</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>选择“rest”则会运行rest-api。例如这个URL会获取部署的列表：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>http://kermit:kermit@localhost:8080/activiti-rest/service/repository/deployments</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果没有提供参数，默认为“explorer”。</p>
</div>
</div>
<div class="sect3">
<h4 id="dockerBuild">20.3.3. 构建docker镜像 Build docker image</h4>
<div class="paragraph">
<p>Docker使用tooling/dockerImage/singleImage文件夹下的Dockerfile构建。一个名为"buildImage.sh"的工具集合文件包含了构建镜像所需的命令行。如果构建的镜像需要由其他用户使用，需要使用这个命令将其发布至docker共享服务器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>docker push activiti/activiti-single-image:latest</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-01-19 14:47:47 中国标准时间
</div>
</div>
</body>
</html>